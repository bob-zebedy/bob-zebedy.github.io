<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Cloudflare Workers é€šç”¨ Turnstile éªŒè¯æ¨¡å—</title>
    <url>/post/7b67508c.html</url>
    <content><![CDATA[<p>æœ€è¿‘ä½¿ç”¨ Cloudflare Workers å®ç°äº†ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC1ub3RlLmFwcC8=">åœ¨çº¿ç¬”è®°æœ¬<i class="fa fa-external-link-alt"></i></span> å’Œ <span class="exturl" data-url="aHR0cHM6Ly85bG5rLmlvLw==">çŸ­é“¾æ¥æœåŠ¡<i class="fa fa-external-link-alt"></i></span> åˆ†åˆ«ä½¿ç”¨äº† <code>Cloudflare KV</code> å’Œ <code>Cloudflare D1</code> è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ ¹æ® <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL2t2L3BsYXRmb3JtL3ByaWNpbmcv">Cloudflare KV å®šä»·æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span> å…è´¹è®¡åˆ’æ¯å¤©æ˜¯æœ‰æ¬¡æ•°é™åˆ¶çš„ã€‚ä¸ºäº†é¿å…äº’è”ç½‘ä¸Šå„ç§æ‰«æå™¨çš„è¯·æ±‚å¯¼è‡´æ¶ˆè€—é™é¢ï¼Œå°±éœ€è¦è¿‡æ»¤ä¸€æ³¢éäººç±»è¯·æ±‚äº†ã€‚</p>
<span id="more"></span>

<p>è€Œåœ¨ä¸ä¹…å‰ï¼Œæˆ‘åˆšåˆšä½¿ç”¨ <code>Cloudflare Turnstile</code> ç»™åšå®¢å¢åŠ äº†ä¸€ä¸‹äººå·¥éªŒè¯ï¼Œå¯ä»¥å¦‚æ³•ç‚®åˆ¶ç»™è¿™ä¸ªä¹ŸåŠ ä¸Šã€‚ä½†æ˜¯ä»¥åæ¯ä¸€ä¸ª <code>worker</code> æƒ³è¿˜ç”¨éªŒè¯éƒ½éœ€è¦é‡å¤æ·»åŠ  <code>Turnstile</code> çš„ä»£ç ï¼Œæ‰€ä»¥å°±æŠŠè¿™ä¸ªé€»è¾‘ç»™æŠ½å‡ºæ¥ç»„æˆä¸€ä¸ªå•ç‹¬çš„æ¨¡å—äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cloudflare Workers é€šç”¨ Turnstile éªŒè¯æ¨¡å—</span></span><br><span class="line"><span class="comment"> * æä¾›å®Œæ•´çš„ Turnstile éªŒè¯ã€JWT Token ç®¡ç†å’Œ Cookie å¤„ç†åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT_CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">TURNSTILE_URL</span>: <span class="string">&quot;https://challenges.cloudflare.com/turnstile/v0/siteverify&quot;</span>,</span><br><span class="line">  <span class="attr">TURNSTILE_EXPIRE</span>: <span class="number">3600</span>,</span><br><span class="line">  <span class="attr">JWT_ALGORITHM</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆ JWT Token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">payload</span> - JWT payload</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;string&gt;</span>&#125; JWT token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateToken</span>(<span class="params">payload, secret</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> header = <span class="title function_">btoa</span>(</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">alg</span>: <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">JWT_ALGORITHM</span>, <span class="attr">typ</span>: <span class="string">&quot;JWT&quot;</span> &#125;)</span><br><span class="line">  ).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> encodedPayload = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(payload)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;encodedPayload&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(secret),</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(</span><br><span class="line">    <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">    key,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(data)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;data&#125;</span>.<span class="subst">$&#123;btoa(</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="built_in">String</span>.fromCharCode(...<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(signature))</span></span></span><br><span class="line"><span class="subst"><span class="string">  ).replace(/=/g, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ JWT Token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">token</span> - JWT token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyToken</span>(<span class="params">token, secret</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è·å–: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [header, payload, signature] = token.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!header || !payload || !signature) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;payload&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">      <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(secret),</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      [<span class="string">&quot;verify&quot;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSignature = <span class="title class_">Uint8Array</span>.<span class="title function_">from</span>(</span><br><span class="line">      <span class="title function_">atob</span>(signature + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (signature.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>)),</span><br><span class="line">      <span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">verify</span>(</span><br><span class="line">      <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">      key,</span><br><span class="line">      expectedSignature,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(data)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token æœ‰æ•ˆ: <span class="subst">$&#123;isValid&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isValid) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decodedPayload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">      <span class="title function_">atob</span>(payload + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (payload.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è§£ç : <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decodedPayload)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isExpired = decodedPayload.<span class="property">exp</span> &gt; <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è¿‡æœŸ: <span class="subst">$&#123;!isExpired&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> isExpired;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token å¤±è´¥: <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ Turnstile Response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">response</span> - Turnstile response token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">remoteip</span> - å®¢æˆ·ç«¯ IP</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secretKey</span> - Turnstile secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyTurnstile</span>(<span class="params">response, remoteip, secretKey</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile è´¨è¯¢: <span class="subst">$&#123;remoteip&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;secret&quot;</span>, secretKey);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;response&quot;</span>, response);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;remoteip&quot;</span>, remoteip);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">await</span> (</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">TURNSTILE_URL</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      <span class="attr">body</span>: formData,</span><br><span class="line">    &#125;)</span><br><span class="line">  ).<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile ç»“æœ: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> result.<span class="property">success</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²é€šè¿‡éªŒè¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Request</span>&#125; <span class="variable">request</span> - è¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">cookieName</span> - Cookieå ç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">jwtSecret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">isVerified</span>(<span class="params">request, cookieName, jwtSecret</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cookie = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Cookie&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> match = cookie.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`<span class="subst">$&#123;cookieName&#125;</span>=([^;]+)`</span>));</span><br><span class="line">  <span class="keyword">return</span> match ? <span class="keyword">await</span> <span class="title function_">verifyToken</span>(match[<span class="number">1</span>], jwtSecret) : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆ Turnstile éªŒè¯é¡µé¢ HTML</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">options</span> - é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; options.siteKey - Turnstile site key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.title] - é¡µé¢æ ‡é¢˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.logo] - Logoæ–‡æœ¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.description] - æè¿°æ–‡æœ¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">string</span>&#125; HTMLå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTurnstileHTML</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  siteKey,</span></span><br><span class="line"><span class="params">  title = <span class="string">&quot;å®‰å…¨éªŒè¯&quot;</span>,</span></span><br><span class="line"><span class="params">  logo = <span class="string">&quot;ğŸ”’&quot;</span>,</span></span><br><span class="line"><span class="params">  description = <span class="string">&quot;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­ä½¿ç”¨&quot;</span>,</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&lt;title&gt;<span class="subst">$&#123;title&#125;</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;script src=&quot;https://challenges.cloudflare.com/turnstile/v0/api.js&quot; async defer&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">body&#123;font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;padding:0;min-height:100vh;display:flex;align-items:center;justify-content:center&#125;</span></span><br><span class="line"><span class="string">.container&#123;background:white;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);padding:40px;width:400px;text-align:center&#125;</span></span><br><span class="line"><span class="string">.logo&#123;font-size:24px;font-weight:bold;color:#333;margin-bottom:24px&#125;</span></span><br><span class="line"><span class="string">.title&#123;color:#333;margin-bottom:16px;font-size:18px&#125;</span></span><br><span class="line"><span class="string">.description&#123;color:#666;margin-bottom:24px;font-size:14px&#125;</span></span><br><span class="line"><span class="string">.turnstile-container&#123;display:flex;justify-content:center;margin:20px 0;min-height:65px&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;container&quot;&gt;&lt;div class=&quot;logo&quot;&gt;<span class="subst">$&#123;logo&#125;</span>&lt;/div&gt;&lt;h2 class=&quot;title&quot;&gt;<span class="subst">$&#123;title&#125;</span>&lt;/h2&gt;&lt;p class=&quot;description&quot;&gt;<span class="subst">$&#123;description&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;form method=&quot;POST&quot;&gt;&lt;div class=&quot;turnstile-container&quot;&gt;&lt;div class=&quot;cf-turnstile&quot; data-sitekey=&quot;<span class="subst">$&#123;siteKey&#125;</span>&quot; data-callback=&quot;onSuccess&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;function onSuccess()&#123;document.querySelector(&#x27;form&#x27;).submit();&#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®éªŒè¯æˆåŠŸçš„å“åº”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">targetPath</span> - é‡å®šå‘ç›®æ ‡è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">cookieName</span> - Cookieåç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">jwtSecret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [expireTime] - è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;Response&gt;</span>&#125; é‡å®šå‘å“åº”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setSuccessResponse</span>(<span class="params"></span></span><br><span class="line"><span class="params">  targetPath,</span></span><br><span class="line"><span class="params">  cookieName,</span></span><br><span class="line"><span class="params">  jwtSecret,</span></span><br><span class="line"><span class="params">  expireTime</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123;</span><br><span class="line">    <span class="attr">verified</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">iat</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>),</span><br><span class="line">    <span class="attr">exp</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + expireTime,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">await</span> <span class="title function_">generateToken</span>(payload, jwtSecret);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Cookie è®¾ç½®: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">302</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Location</span>: targetPath,</span><br><span class="line">      <span class="string">&quot;Set-Cookie&quot;</span>: <span class="string">`<span class="subst">$&#123;cookieName&#125;</span>=<span class="subst">$&#123;token&#125;</span>; Path=/; Max-Age=<span class="subst">$&#123;expireTime&#125;</span>; HttpOnly; SameSite=Lax; Secure`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Turnstile éªŒè¯ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"> * ```javascript</span></span><br><span class="line"><span class="comment"> * import &#123; turnstileMiddleware &#125; from &#x27;./shared/turnstile-auth.js&#x27;;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const turnstileAuth = turnstileMiddleware(&#123;</span></span><br><span class="line"><span class="comment"> *   cookieName: &#x27;my_app_verified&#x27;,</span></span><br><span class="line"><span class="comment"> *   logo: &#x27;ğŸ“ MyApp&#x27;,</span></span><br><span class="line"><span class="comment"> *   skipPaths: [&#x27;/api/public&#x27;]</span></span><br><span class="line"><span class="comment"> * &#125;);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * export default &#123;</span></span><br><span class="line"><span class="comment"> *   async fetch(request, env) &#123;</span></span><br><span class="line"><span class="comment"> *     const authResult = await turnstileAuth(request, env);</span></span><br><span class="line"><span class="comment"> *     if (authResult) return authResult;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     // éªŒè¯é€šè¿‡ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment"> *     return new Response(&#x27;Hello World&#x27;);</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * ```</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¯å¢ƒå˜é‡é…ç½®ï¼š</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_SITE_KEY: Turnstile ç«™ç‚¹ Key</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_SECRET_KEY: Turnstile ç«™ç‚¹å¯†é’¥</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_EXPIRE: Turnstile è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 3600ï¼ˆ1å°æ—¶ï¼‰</span></span><br><span class="line"><span class="comment"> * - JWT_SECRET: JWT ç­¾åå¯†é’¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">turnstileMiddleware</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    cookieName = <span class="string">&quot;app_verified&quot;</span>,</span><br><span class="line">    logo = <span class="string">&quot;ğŸ”’&quot;</span>,</span><br><span class="line">    title = <span class="string">&quot;å®‰å…¨éªŒè¯&quot;</span>,</span><br><span class="line">    description = <span class="string">&quot;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­ä½¿ç”¨&quot;</span>,</span><br><span class="line">    skipPaths = [],</span><br><span class="line">    skipMethods = [<span class="string">&quot;OPTIONS&quot;</span>],</span><br><span class="line">  &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">turnstileAuth</span>(<span class="params">request, env</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; pathname, search &#125; = url;</span><br><span class="line">    <span class="keyword">const</span> &#123; method &#125; = request;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      skipMethods.<span class="title function_">includes</span>(method) ||</span><br><span class="line">      skipPaths.<span class="title function_">some</span>(<span class="function">(<span class="params">path</span>) =&gt;</span> pathname.<span class="title function_">startsWith</span>(path))</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">isVerified</span>(request, cookieName, env.<span class="property">JWT_SECRET</span>))) &#123;</span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">await</span> request.<span class="title function_">formData</span>();</span><br><span class="line">        <span class="keyword">const</span> remoteip = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;CF-Connecting-IP&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> response = formData.<span class="title function_">get</span>(<span class="string">&quot;cf-turnstile-response&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          <span class="keyword">await</span> <span class="title function_">verifyTurnstile</span>(response, remoteip, env.<span class="property">TURNSTILE_SECRET_KEY</span>)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">const</span> expireTime =</span><br><span class="line">            <span class="built_in">parseInt</span>(env.<span class="property">TURNSTILE_EXPIRE</span>) || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">TURNSTILE_EXPIRE</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">setSuccessResponse</span>(</span><br><span class="line">            pathname + search,</span><br><span class="line">            cookieName,</span><br><span class="line">            env.<span class="property">JWT_SECRET</span>,</span><br><span class="line">            expireTime</span><br><span class="line">          );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;éªŒè¯å¤±è´¥&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·³è½¬ Turnstile é¡µé¢&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(</span><br><span class="line">        <span class="title function_">getTurnstileHTML</span>(&#123;</span><br><span class="line">          <span class="attr">siteKey</span>: env.<span class="property">TURNSTILE_SITE_KEY</span>,</span><br><span class="line">          title,</span><br><span class="line">          logo,</span><br><span class="line">          description,</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">headers</span>: &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html; charset=utf-8&quot;</span> &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦å°†ä»¥ä¸Šä»£ç ä¿å­˜æ‰¾ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œåœ¨ <code>worker</code> ä»£ç ä¸­å¼•ç”¨ï¼Œå¹¶ä¸”é€šè¿‡åœ¨ <code>wrangler.jsonc</code> ä¸­è®¾ç½® <code>TURNSTILE_SITE_KEY</code>(å¿…é¡») <code>TURNSTILE_SECRET_KEY</code>(å¿…é¡») <code>JWT_SECRET</code>(å¿…é¡») <code>TURNSTILE_EXPIRE</code>(å¯é€‰) è¿™å‡ ä¸ªç¯å¢ƒå˜é‡ï¼Œå‰©ä¸‹çš„æŒ‰ç…§ä»£ç ä¸­çš„ç¤ºä¾‹ä½¿ç”¨å³å¯ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Cloudflare è®¾ç½®å¼•ç”¨ç«™ç‚¹ç­–ç•¥</title>
    <url>/post/e6a2e300.html</url>
    <content><![CDATA[<p>å‰å‡ æ—¥ï¼ŒæŠŠæˆ‘çš„åšå®¢éƒ¨ç½²åœ¨ <code>Cloudflare Pages</code> ä¸Šé¢äº†ã€‚åŒæ—¶ç»‘å®šäº†ä¸€ä¸ªæ‰˜ç®¡åœ¨ <code>Cloudflare</code> ä¸Šé¢çš„åŸŸåï¼Œåˆ°è¿™é‡Œä¸€åˆ‡é¡ºåˆ©ã€‚<br>ä½†æ˜¯å½“æˆ‘å…´è‡´å‹ƒå‹ƒçš„æ‰“å¼€åšå®¢çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå›¾ç‰‡å…¨ 403 äº†ï¼Ÿ</p>
<span id="more"></span>

<p>ä¸€å¼€å§‹æƒ³åˆ°äº†å¯èƒ½æ˜¯æˆ‘çš„ <code>OSS</code> é˜²ç›—é“¾ã€‚è·‘å»çœ‹äº†ä¸€ä¸‹ï¼Œæˆ‘å·²ç»æ·»åŠ äº†å¯¹åº”çš„ <code>Referer</code> åŸŸåã€‚ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯æ·»åŠ  <code>Referer</code> ç”Ÿæ•ˆéœ€è¦æ—¶é—´ï¼Œäºæ˜¯ä¹è¿‡äº†å‡ ä¸ªå°æ—¶å†æ‰“å¼€é—®é¢˜ä¾æ—§ã€‚<br>æœ€è¯¡å¼‚çš„æ˜¯ï¼Œæ‰“å¼€ <code>Cloudflare Pages</code> é»˜è®¤çš„ <code>pages.dev</code> åŸŸåçš„æ—¶å€™ï¼Œå›¾ç‰‡å°±æ˜¯æ­£å¸¸çš„ã€‚æ’æŸ¥äº†ä¸€ä¸‹ï¼Œç„¶åå°±å‘ç°äº†ç«¯å€ªã€‚<br>é—®é¢˜æ¥è‡ªé€šè¿‡ç»‘å®šçš„è‡ªå®šä¹‰åŸŸåè®¿é—®çš„æ—¶å€™ï¼Œå›¾ç‰‡è¯·æ±‚çš„ Header ä¸­æ²¡æœ‰ <code>Referer</code> å­—æ®µã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€è°“çš„é˜²ç›—é“¾å…¶å®å°±æ˜¯æ£€æŸ¥ <code>Referer</code> å­—æ®µæ˜¯ä¸æ˜¯åœ¨ç™½åå•ä¸­ã€‚é‚£ä¹ˆé—®é¢˜æ¥è¿™äº†ï¼Œä¸ºä»€ä¹ˆ <code>pages.dev</code> åŸŸåä¸­è¯·æ±‚å›¾ç‰‡æœ‰ <code>Referer</code> ä½†æ˜¯è‡ªå®šä¹‰åŸŸåæ²¡æœ‰ï¼Ÿ<br>å†æ¬¡ç¨åŠ è§‚å¯Ÿå‘ç°äº†ä¸€ä¸ªç°è±¡</p>
<img src="https://images.zabrian.com/538e6269-12f2-4f3a-0bf1-bf030ba01501/origin" title="è‡ªå®šä¹‰åŸŸå" style="zoom:18%;" />

<img src="https://images.zabrian.com/a95cabc7-4b98-47be-7bdb-bc59cbb46101/origin" title="pages.dev åŸŸå" style="zoom:21%;" />

<p>åŸå› å°±åœ¨è¿™é‡Œ</p>
<ul>
<li>è‡ªå®šä¹‰åŸŸåçš„å¼•ç”¨ç«™ç‚¹ç­–ç•¥ä¸º <code>same-origin</code></li>
<li>pages.dev åŸŸåçš„å¼•ç”¨ç«™ç‚¹ç­–ç•¥ä¸º <code>strict-origin-when-cross-origin</code></li>
</ul>
<p>å°±æ˜¯å› ä¸ºæµè§ˆå™¨çš„ <strong>åŒæºç­–ç•¥(Same-Origin Policy)</strong> å› æ­¤è‡ªå®šä¹‰åŸŸåçš„è¯·æ±‚å›¾ç‰‡çš„æ—¶å€™æœªå¸¦ä¸Š <code>Referer</code><br>æ—¢ç„¶é—®é¢˜çŸ¥é“äº†ï¼Œå°±å¯ä»¥è§£å†³äº†ï¼šåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹è‡ªå®šä¹‰åŸŸåçš„è¯·æ±‚å¤´å°±è¡Œäº†ã€‚  </p>
<ol>
<li>æ‰“å¼€ Cloudflare æ§åˆ¶å°ï¼Œé€‰æ‹©å¯¹åº”çš„åŸŸå</li>
<li>ä¾§è¾¹æ é€‰æ‹© <strong>è§„åˆ™</strong> â†’ <strong>åˆ›å»ºè§„åˆ™</strong> â†’ <strong>å“åº”å¤´è½¬æ¢è§„åˆ™</strong></li>
<li>é€‰æ‹© <strong>å‘å“åº”æ·»åŠ é™æ€æ ‡å¤´</strong> æ¨¡æ¿</li>
<li>é€‰æ‹© <strong>è‡ªå®šä¹‰ç­›é€‰è¡¨è¾¾å¼</strong></li>
<li>ç¼–è¾‘è¡¨è¾¾å¼ <code>(http.request.full_uri wildcard &quot;https://è¿™é‡Œå¡«å†™ä½ è‡ªå·±çš„åŸŸå/*&quot;)</code></li>
<li>è§„åˆ™ <strong>æ·»åŠ é™æ€å“åº”å¤´</strong><ul>
<li><code>cross-origin-resource-policy = cross-origin</code></li>
<li><code>referrer-policy = strict-origin-when-cross-origin</code></li>
</ul>
</li>
</ol>
<p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶å†è®¿é—®è‡ªå®šä¹‰åŸŸåï¼Œå‘ç°å›¾ç‰‡å°±æ­£å¸¸æºå¸¦äº† <code>Referer</code></p>
]]></content>
  </entry>
  <entry>
    <title>Garmin å›½è¡Œç è¡¨ä½¿ç”¨ OSM åœ°å›¾</title>
    <url>/post/16e3b020.html</url>
    <content><![CDATA[<p>å›½è¡Œçš„ Garmin ç è¡¨ä¸‹è½½å¹¶å®‰è£… <code>OSM China</code> åœ°å›¾ä½œä¸ºéª‘è¡Œåœ°å›¾ã€‚<br>æ•°æ®æ¥æº <span class="exturl" data-url="aHR0cHM6Ly9hbHRlcm5hdGl2YXNsaWJyZXMub3JnL2VuL2Rvd25sb2Fkcy5waHAjQXNpYQ==">alternativaslibres<i class="fa fa-external-link-alt"></i></span> å¹¶æ·»åŠ äº†å¿…è¦çš„å…ƒæ•°æ®ã€‚</p>
<span id="more"></span>

<h1 id="ä¸‹è½½é“¾æ¥"><a href="#ä¸‹è½½é“¾æ¥" class="headerlink" title="ä¸‹è½½é“¾æ¥"></a>ä¸‹è½½é“¾æ¥</h1><p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¹¶å°†ä¸‹è½½å¥½çš„ <code>img</code> æ–‡ä»¶å¤åˆ¶åˆ°ä½³æ˜ç è¡¨ <code>Garmin/Maps/</code> ç„¶ååœ¨ç è¡¨åœ°å›¾ä¸­ç¦ç”¨è‡ªå¸¦çš„æ‰€æœ‰åœ°å›¾å³å¯ä½¿ç”¨ã€‚</p>
<a class="btn" href="https://9lnk.io/gJHF" title="ç‚¹å‡»ä¸‹è½½ 2025-10-04"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½ 2025-10-04</a>
]]></content>
  </entry>
  <entry>
    <title>Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†</title>
    <url>/post/ec93b507.html</url>
    <content><![CDATA[<p>æœ€æ—©è¿™ä¸ªåšå®¢æ˜¯æ‰˜ç®¡åœ¨ GitHub pages ä¸Šçš„ï¼Œç»‘å®šçš„åŸŸåæ˜¯åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„ï¼Œå‡ ä¸ªæœˆå‰å¶ç„¶ä¸€æ¬¡æœºä¼šï¼Œåœ¨ Cloudflare ä¸Šæ³¨å†Œäº†ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„åŸŸåã€‚äºæ˜¯å°±ä¹Ÿé€šè¿‡ Cloudflare pages æ‰˜ç®¡äº†ç›¸åŒçš„ GitHub pages ä»“åº“ï¼Œå› æ­¤ç›®å‰ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnphYnJpYW4uY29tLw==">Cloudflare pages<i class="fa fa-external-link-alt"></i></span> æˆ–è€… <a href="https://blog.zebedy.com/">GitHub pages</a> å‡å¯è®¿é—®ï¼Œå†…å®¹éƒ½æ¥è‡ªåŒä¸€ä¸ª GitHub repo</p>
<span id="more"></span>

<h1 id="ä½¿ç”¨-Images"><a href="#ä½¿ç”¨-Images" class="headerlink" title="ä½¿ç”¨ Images"></a>ä½¿ç”¨ Images</h1><p>å°±åœ¨æˆ‘æ— èŠæŠŠç©èµ›åšè©è¨çš„å„ç§åŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç° Images çš„å®šä»·è¿˜ç®—å¾ˆå®æƒ ï¼Œäºæ˜¯ä¹å¼€é€šäº† Images Stream Bundle Basic å¥—é¤ï¼ŒåŒ…å«é¢„ä»˜è´¹ $5.00&#x2F;æœˆ 100,000 å¼ å›¾ç‰‡å’Œ 1,000 åˆ†é’Ÿè§†é¢‘å­˜å‚¨ä»¥åŠåä»˜è´¹ $1.00&#x2F;100,000 å¼ å›¾ç‰‡çš„äº¤ä»˜ã€‚<br>æ—¢ç„¶éƒ½è®¢é˜…äº†ï¼Œç„¶åå°±æƒ³ç€æŠŠåšå®¢ç°åœ¨çš„å›¾ç‰‡éƒ½è¿ç§»åˆ° Images ä¸Šæ¥ã€‚ä½†æ˜¯å§ï¼Œé—®é¢˜å°±åœ¨äº Images çš„å›¾ç‰‡æ˜¯å¯ä»¥å…¬å…±è¯»çš„ã€‚ç›´æ¥æ”¾åˆ°åšå®¢ä¸Šä¸‡ä¸€å“ªå¤©è¢«åˆ·æµé‡äº†ï¼Œå¾—ä¸å¿å¤±ã€‚ç ”ç©¶äº†ä¸€ä¸‹å‘ç° Images æ˜¯å¯ä»¥ç”Ÿæˆå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç­¾å URL çš„ï¼Œå¯æ˜¯é—®é¢˜æ˜¯æˆ‘çš„åšå®¢æ˜¯é™æ€åšå®¢ï¼Œå›¾ç‰‡é“¾æ¥éƒ½éœ€è¦å†™æ­»åœ¨ <code>&lt;img&gt;</code> æ ‡ç­¾é‡Œé¢ã€‚å·¦æ€å³æƒ³ä¹‹ä¸‹æƒ³åˆ°äº†ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•ã€‚<br>æ€»ä½“æ€è·¯å°±æ˜¯ä¸Šä¼ çš„å›¾ç‰‡æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åè¯¥å›¾ç‰‡å°±å¿…é¡»é€šè¿‡ç­¾å URL è®¿é—®ï¼Œç„¶åå®ç°ä¸€ä¸ª Worker åˆ¤æ–­ URL æ˜¯å¦åŒ…å«ç­¾åä¿¡æ¯ï¼Œå¦‚æœä¸åŒ…å«ï¼Œåˆ™é€šè¿‡ URL æ¥æ”¶ <code>å›¾åƒ ID(imageID)</code> å’Œ <code>å˜ä½“(variant)</code> ç„¶åå¯¹ URL å®ç°ç­¾åï¼Œç”Ÿæˆä¸€ä¸ªå¸¦ç­¾åçš„ URL å¹¶ 302 é‡å®šå‘å› Workerã€‚å¦‚æœ URL åŒ…å«ç­¾åä¿¡æ¯ï¼Œåˆ™è¯·æ±‚å›¾ç‰‡èµ„æºå¹¶è¿”å›ã€‚</p>
<img src="https://images.zabrian.com/2d0fc541-8fd3-48d7-d763-e1fee14d3401/origin" title="æµç¨‹å›¾" style="zoom:42%;" />

<p>æ€è·¯æœ‰äº†é‚£å°±å¼€å§‹ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ª Worker ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCOUNT_HASH</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Images å¸æˆ·å“ˆå¸Œ&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">KEY</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Image è´¦æˆ· API ä»¤ç‰Œ&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_CUSTOM_DOMAIN</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Worker ç»‘å®šçš„è‡ªå®šä¹‰åŸŸå&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EXPIRATION</span> = <span class="number">60</span>; <span class="comment">// ç­¾åå›¾ç‰‡è¿‡æœŸæ—¶é—´ 1 min</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ALLOWED_REFERERS</span> = []; <span class="comment">// æ­¤å¤„å¡«å†™è¯·æ±‚ Referer ç™½åå•ä½œä¸ºé˜²ç›—é“¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_DELIVERY_DOMAIN</span> = <span class="string">&quot;imagedelivery.net&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">bufferToHex</span> = (<span class="params">buffer</span>) =&gt;</span><br><span class="line">  [...<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buffer)]</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>))</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateSignedUrl</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">  <span class="keyword">const</span> secretKey = encoder.<span class="title function_">encode</span>(<span class="variable constant_">KEY</span>);</span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    secretKey,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> exp = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + <span class="variable constant_">EXPIRATION</span>;</span><br><span class="line">  url.<span class="property">searchParams</span>.<span class="title function_">set</span>(<span class="string">&quot;exp&quot;</span>, exp);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stringToSign = url.<span class="property">pathname</span> + <span class="string">&quot;?&quot;</span> + url.<span class="property">searchParams</span>.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">const</span> mac = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(</span><br><span class="line">    <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">    key,</span><br><span class="line">    encoder.<span class="title function_">encode</span>(stringToSign)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="title function_">bufferToHex</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(mac).<span class="property">buffer</span>);</span><br><span class="line">  url.<span class="property">searchParams</span>.<span class="title function_">set</span>(<span class="string">&quot;sig&quot;</span>, signature);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ Referer (åªæœ‰ ALLOWED_REFERERS ä¸ä¸ºç©ºæ—¶æ‰æ£€æŸ¥)</span></span><br><span class="line">    <span class="keyword">const</span> referer = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Referer&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">ALLOWED_REFERERS</span>.<span class="property">length</span> &amp;&amp; !<span class="variable constant_">ALLOWED_REFERERS</span>.<span class="title function_">some</span>(<span class="function">(<span class="params">allow</span>) =&gt;</span> referer.<span class="title function_">startsWith</span>(allow))) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Forbidden&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> match = url.<span class="property">pathname</span>.<span class="title function_">match</span>(<span class="regexp">/^\/([^/]+)\/([^/]+)$/</span>);</span><br><span class="line">    <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Bad Request&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">400</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [, imageID, variant] = match;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!url.<span class="property">searchParams</span>.<span class="title function_">has</span>(<span class="string">&quot;exp&quot;</span>) || !url.<span class="property">searchParams</span>.<span class="title function_">has</span>(<span class="string">&quot;sig&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// æ— ç­¾å - ç”Ÿæˆç­¾åå¹¶é‡å®šå‘</span></span><br><span class="line">      <span class="keyword">const</span> deliveryUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_DELIVERY_DOMAIN&#125;</span>/<span class="subst">$&#123;ACCOUNT_HASH&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> signedUrl = <span class="keyword">await</span> <span class="title function_">generateSignedUrl</span>(deliveryUrl);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> redirectUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_CUSTOM_DOMAIN&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      redirectUrl.<span class="property">search</span> = signedUrl.<span class="property">search</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">redirect</span>(redirectUrl.<span class="title function_">toString</span>(), <span class="number">302</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æœ‰ç­¾å - ç›´æ¥è¯·æ±‚å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> imageUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_DELIVERY_DOMAIN&#125;</span>/<span class="subst">$&#123;ACCOUNT_HASH&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      imageUrl.<span class="property">search</span> = url.<span class="property">search</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">fetch</span>(imageUrl.<span class="title function_">toString</span>(), request);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(resp.<span class="property">body</span>, &#123;</span><br><span class="line">        <span class="attr">status</span>: resp.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">headers</span>: resp.<span class="property">headers</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°† <code>Worker.js</code> ä¸­ <code>IMAGE_CUSTOM_DOMAIN</code> çš„åŸŸåç»‘å®šåˆ°è¿™ä¸ª Worker ä¸Šã€‚<br>åœ¨ Images ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œæ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åè·å–åˆ°ä»–çš„<code>å›¾åƒ ID</code>ï¼Œå¯ä»¥åœ¨ Images é‡Œé¢è‡ªå®šä¹‰ä¸€ä¸ª<code>å˜ä½“</code>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ <code>https://IMAGE_CUSTOM_DOMAIN/&#123;imageID&#125;/&#123;variant&#125;</code> è®¿é—®è¯¥å›¾ç‰‡ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ° <code>https://IMAGE_CUSTOM_DOMAIN/&#123;imageID&#125;/&#123;variant&#125;?exp=&#123;exp&#125;&amp;sig=&#123;sig&#125;</code> å…¶ä¸­ <code>sig</code> å°±æ˜¯ç­¾åä¿¡æ¯ï¼Œ<code>exp</code> æ˜¯è¯¥é“¾æ¥çš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœå¡«å†™äº† <code>ALLOWED_REFERERS</code> åˆ™è¯·æ±‚å¿…é¡»æºå¸¦å¯¹åº”çš„ <code>Referer</code> å¦åˆ™ä¼š <code>403</code></p>
<p>ç°åœ¨ Cloudflare çš„æµç¨‹å°±æ²¡æœ‰é—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥è§£å†³é™æ€åšå®¢çš„é—®é¢˜ã€‚æˆ‘æ˜¯ç”¨çš„ Hexo çš„é™æ€åšå®¢ï¼Œæ–‡ç« ä¸­æ’å…¥å›¾ç‰‡éœ€è¦ä½¿ç”¨ <code>&lt;img&gt;</code> æ ‡ç­¾ã€‚æ¯æ¬¡éƒ½éœ€è¦å°†æœ¬åœ°å›¾ç‰‡ä¼ åˆ° Cloudflare Images å¹¶ä¸”ç¼–è¾‘å›¾åƒæ‰‹åŠ¨æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åå†è·å–åˆ°å¯¹åº”çš„å›¾åƒ ID å†æ›¿æ¢ä¸º URL ç•¥æ˜¾éº»çƒ¦ã€‚å› æ­¤æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªè„šæœ¬è‡ªåŠ¨åŒ–å®ç°ä»¥ä¸ŠåŠŸèƒ½ï¼Œæˆ‘åªéœ€è¦åœ¨ <code>&lt;img&gt;</code> æ ‡ç­¾ä¸­æ·»åŠ å›¾ç‰‡çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œç„¶åå†™å¥½åšå®¢ä¹‹åè°ƒç”¨è„šæœ¬å°±ä¼šè‡ªåŠ¨å°†æ–‡ç« ä¸­å¼•ç”¨çš„ img å›¾ç‰‡ä¸Šä¼ åˆ° Cloudflare Images å¹¶ä¸”æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åæ ¹æ®è¿”å›çš„å›¾åƒ ID è‡ªåŠ¨æ‹¼æ¥ http é“¾æ¥å¹¶æ›¿æ¢åŸæ–‡ <code>&lt;img&gt;</code> æ ‡ç­¾çš„æœ¬åœ°æ–‡ä»¶åœ°å€ã€‚</p>
<p>åœ¨æœ¬åœ° Hexo é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª <code>tools/upload-images.js</code> æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FormData</span> = <span class="built_in">require</span>(<span class="string">&quot;form-data&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sharp = <span class="built_in">require</span>(<span class="string">&quot;sharp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cloudflare Images API é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_ACCOUNT_ID</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Image å¸æˆ· ID&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_API_TOKEN</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Cloudflare API Token&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_IMAGES_API_URL</span> = <span class="string">`https://api.cloudflare.com/client/v4/accounts/<span class="subst">$&#123;CF_ACCOUNT_ID&#125;</span>/images/v1`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_BASE_URL</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Worker å¸¦ https çš„ URL åœ°å€&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_WIDTH</span> = <span class="number">800</span>; <span class="comment">// å›¾åƒçš„æœ€å¤§å®½åº¦</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_HEIGHT</span> = <span class="number">600</span>; <span class="comment">// å›¾åƒçš„æœ€å¤§é«˜åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> abbrlink = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">if</span> (!abbrlink) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;è¯·æä¾› abbrlink\n  ä¾‹å¦‚: npm run upload e6a2e300&quot;</span>);</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ® abbrlink æŸ¥æ‰¾å¯¹åº”çš„æ–‡ç« æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findPostByAbbrlink</span>(<span class="params">abbrlink</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> postsDir = path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;../source/_posts&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(postsDir);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.<span class="title function_">endsWith</span>(<span class="string">&quot;.md&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(postsDir, file);</span><br><span class="line">    <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(filePath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ front matter</span></span><br><span class="line">    <span class="keyword">const</span> frontMatterMatch = content.<span class="title function_">match</span>(<span class="regexp">/^---\n([\s\S]*?)\n---/</span>);</span><br><span class="line">    <span class="keyword">if</span> (frontMatterMatch) &#123;</span><br><span class="line">      <span class="keyword">const</span> frontMatter = frontMatterMatch[<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">const</span> abbrlinkMatch = frontMatter.<span class="title function_">match</span>(<span class="regexp">/abbrlink:\s*([a-fA-F0-9]+)/</span>);</span><br><span class="line">      <span class="keyword">if</span> (abbrlinkMatch &amp;&amp; abbrlinkMatch[<span class="number">1</span>] === abbrlink) &#123;</span><br><span class="line">        <span class="keyword">return</span> filePath;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—åˆé€‚çš„å›¾ç‰‡å°ºå¯¸å’Œç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">calculateOptimalSize</span>(<span class="params">imagePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metadata = <span class="keyword">await</span> <span class="title function_">sharp</span>(imagePath).<span class="title function_">metadata</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; width, height &#125; = metadata;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (width &lt;= <span class="variable constant_">MAX_WIDTH</span> &amp;&amp; height &lt;= <span class="variable constant_">MAX_HEIGHT</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      width,</span><br><span class="line">      height,</span><br><span class="line">      <span class="attr">zoom</span>: <span class="number">100</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> widthScale = <span class="variable constant_">MAX_WIDTH</span> / width;</span><br><span class="line">  <span class="keyword">const</span> heightScale = <span class="variable constant_">MAX_HEIGHT</span> / height;</span><br><span class="line">  <span class="keyword">const</span> scale = <span class="title class_">Math</span>.<span class="title function_">min</span>(widthScale, heightScale);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newWidth = <span class="title class_">Math</span>.<span class="title function_">round</span>(width * scale);</span><br><span class="line">  <span class="keyword">const</span> newHeight = <span class="title class_">Math</span>.<span class="title function_">round</span>(height * scale);</span><br><span class="line">  <span class="keyword">const</span> zoom = <span class="title class_">Math</span>.<span class="title function_">round</span>(scale * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">width</span>: newWidth,</span><br><span class="line">    <span class="attr">height</span>: newHeight,</span><br><span class="line">    <span class="attr">zoom</span>: zoom</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»æ–‡ä»¶å†…å®¹ä¸­æå–æ‰€æœ‰å›¾ç‰‡æ ‡ç­¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extractImageTags</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="comment">// åŒ¹é… HTML img æ ‡ç­¾: &lt;img src=&quot;path&quot; title=&quot;title&quot;&gt;</span></span><br><span class="line">  <span class="keyword">const</span> regex = <span class="regexp">/&lt;img\s+src=&quot;([^&quot;]+)&quot;(?:\s+title=&quot;([^&quot;]*)&quot;)?[^&gt;]*&gt;/g</span>;</span><br><span class="line">  <span class="keyword">const</span> matches = [];</span><br><span class="line">  <span class="keyword">let</span> match;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ((match = regex.<span class="title function_">exec</span>(content)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">    matches.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">fullTag</span>: match[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">localPath</span>: match[<span class="number">1</span>],</span><br><span class="line">      <span class="attr">title</span>: match[<span class="number">2</span>] || <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> matches;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸Šä¼ å›¾ç‰‡åˆ° Cloudflare Images</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadToCloudflare</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> fileName = path.<span class="title function_">basename</span>(filePath);</span><br><span class="line">  <span class="keyword">const</span> newFileName = <span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>-<span class="subst">$&#123;fileName&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> form = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  form.<span class="title function_">append</span>(<span class="string">&quot;file&quot;</span>, fs.<span class="title function_">createReadStream</span>(filePath), &#123; <span class="attr">filename</span>: newFileName &#125;);</span><br><span class="line">  form.<span class="title function_">append</span>(<span class="string">&quot;requireSignedURLs&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="variable constant_">CF_IMAGES_API_URL</span>, form, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;CF_API_TOKEN&#125;</span>`</span>,</span><br><span class="line">      ...form.<span class="title function_">getHeaders</span>(),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!response.<span class="property">data</span>.<span class="property">success</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ä¸Šä¼ å¤±è´¥: &quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response.<span class="property">data</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">result</span>.<span class="property">id</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å¤„ç†æ–‡ç« : <span class="subst">$&#123;abbrlink&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> postPath = <span class="title function_">findPostByAbbrlink</span>(abbrlink);</span><br><span class="line">  <span class="keyword">if</span> (!postPath) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æœªæ‰¾åˆ°è¯¥æ–‡ç« `</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(postPath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> imageTags = <span class="title function_">extractImageTags</span>(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (imageTags.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å›¾ç‰‡æ•°é‡ <span class="subst">$&#123;imageTags.length&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> tag <span class="keyword">of</span> imageTags) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è·³è¿‡ URL å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">if</span> (tag.<span class="property">localPath</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: è·³è¿‡ URL å›¾ç‰‡ <span class="subst">$&#123;tag.localPath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è§£ææœ¬åœ°è·¯å¾„</span></span><br><span class="line">      <span class="keyword">const</span> imagePath = path.<span class="title function_">isAbsolute</span>(tag.<span class="property">localPath</span>)</span><br><span class="line">        ? tag.<span class="property">localPath</span></span><br><span class="line">        : path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, tag.<span class="property">localPath</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(imagePath)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å›¾ç‰‡ä¸å­˜åœ¨ <span class="subst">$&#123;imagePath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æ­£åœ¨å¤„ç† <span class="subst">$&#123;tag.localPath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è‡ªåŠ¨ç¼©æ”¾å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> &#123; width, height, zoom &#125; = <span class="keyword">await</span> <span class="title function_">calculateOptimalSize</span>(imagePath);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: è‡ªåŠ¨ç¼©æ”¾ <span class="subst">$&#123;width&#125;</span>x<span class="subst">$&#123;height&#125;</span> (<span class="subst">$&#123;zoom&#125;</span>%)`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> imageId = <span class="keyword">await</span> <span class="title function_">uploadToCloudflare</span>(imagePath);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: ä¸Šä¼ æˆåŠŸ <span class="subst">$&#123;imageId&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç”Ÿæˆæ–°æ ‡ç­¾ - HTML img æ ¼å¼</span></span><br><span class="line">      <span class="keyword">const</span> newUrl = <span class="string">`<span class="subst">$&#123;IMAGE_BASE_URL&#125;</span>/<span class="subst">$&#123;imageId&#125;</span>/origin`</span>;</span><br><span class="line">      <span class="keyword">const</span> titleText = tag.<span class="property">title</span> || <span class="string">&quot;å›¾ç‰‡&quot;</span>;</span><br><span class="line">      <span class="keyword">const</span> newTag = <span class="string">`&lt;img src=&quot;<span class="subst">$&#123;newUrl&#125;</span>&quot; title=&quot;<span class="subst">$&#123;titleText&#125;</span>&quot; style=&quot;zoom:<span class="subst">$&#123;zoom&#125;</span>%;&quot; /&gt;`</span>;</span><br><span class="line"></span><br><span class="line">      content = content.<span class="title function_">replace</span>(tag.<span class="property">fullTag</span>, newTag);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å¤„ç†å®Œæˆ <span class="subst">$&#123;tag.localPath&#125;</span> -&gt; <span class="subst">$&#123;newUrl&#125;</span> (<span class="subst">$&#123;zoom&#125;</span>%)`</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å¤„ç†å¤±è´¥: <span class="subst">$&#123;tag.localPath&#125;</span>`</span>, error.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(postPath, content, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤„ç†å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<p>å¹¶å°†è¯¥è„šæœ¬æ·»åŠ åˆ° package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...çœç•¥</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...çœç•¥</span></span><br><span class="line">    <span class="attr">&quot;upload&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node tools/upload-images.js&quot;</span></span><br><span class="line">    <span class="comment">// ...çœç•¥</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// ...çœç•¥</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥é€šè¿‡ <code>npm run upload xxxxxxxx</code> è‡ªåŠ¨ä¸Šä¼ è¯¥æ–‡ç« ä¸­å‡ºç°çš„å›¾ç‰‡å¹¶æ›¿æ¢é“¾æ¥å•¦ã€‚</p>
<h1 id="ä½¿ç”¨-R2"><a href="#ä½¿ç”¨-R2" class="headerlink" title="ä½¿ç”¨ R2"></a>ä½¿ç”¨ R2</h1><p>å¦‚æœä¸æƒ³ä½¿ç”¨ Images çš„ä»˜è´¹åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ R2 çš„å…è´¹å¥—é¤æ­å»ºã€‚å…¶ä¸­ R2 çš„å…è´¹å¥—é¤åŒ…å« 10G å­˜å‚¨ç©ºé—´ã€ A ç±»æ“ä½œ 100w&#x2F;æœˆ å’Œ B ç±»æ“ä½œ 1000w&#x2F;æœˆã€‚</p>
<blockquote>
<p>è¯¦æƒ…å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3IyL3ByaWNpbmcvIzp+OnRleHQ9Zm9yJTIwMiUyMEdCLi0sRnJlZSUyMHRpZXIsLVlvdSUyMGNhbiUyMHVzZQ==">Cloudflare Docs R2<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>å¦‚æœç›´æ¥æŠŠåŸŸåç»‘å®šåˆ° <code>R2 Bucket</code> ä¸Šå¼€å¯å…¬ç½‘è®¿é—®ï¼Œå¾ˆå®¹æ˜“ä¸€å¤œä¹‹é—´å€¾å®¶è¡äº§ã€‚æ‰€ä»¥å…³é—­ <code>R2 Bucket</code> å…¬ç½‘è®¿é—®ï¼Œä½¿ç”¨ Workers å…è´¹è®¡åˆ’çš„ 10w&#x2F;å¤© çš„è¯·æ±‚é‡å¤©ç„¶çš„é™åˆ¶é¿å…è¢«åˆ·æµé‡ã€‚</p>
<blockquote>
<p>è¯¦æƒ…å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3dvcmtlcnMvcGxhdGZvcm0vcHJpY2luZy8jOn46dGV4dD1QYWdlcyUyMEZ1bmN0aW9ucyUyMHByaWNpbmcuLSxXb3JrZXJzLC1Vc2VycyUyMG9uJTIwdGhl">Cloudflare Docs Workers<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>R2 Bucket</code>ï¼Œåç§°è‡ªå®šä¹‰ã€‚ç„¶åæ–°å»ºä¸€ä¸ª Workers ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request, env</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">method</span> !== <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Method Not Allowed&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">405</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> path = <span class="built_in">decodeURIComponent</span>(url.<span class="property">pathname</span>.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (!path) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Not Found&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">404</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cacheKey = <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="string">`<span class="subst">$&#123;url.origin&#125;</span><span class="subst">$&#123;url.pathname&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> cached = <span class="keyword">await</span> caches.<span class="property">default</span>.<span class="title function_">match</span>(cacheKey);</span><br><span class="line">      <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> file = <span class="keyword">await</span> env.<span class="property">IMAGES</span>.<span class="title function_">get</span>(path); <span class="comment">// IMAGES ä¸ºåç»­æ­¥éª¤ä¸­ç»‘å®šçš„åç§°ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">      <span class="keyword">if</span> (!file) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Not Found&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">404</span> &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">new</span> <span class="title class_">Response</span>(file.<span class="property">body</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&quot;Content-Type&quot;</span>: file.<span class="property">httpMetadata</span>?.<span class="property">contentType</span> || <span class="string">&quot;application/octet-stream&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;public, max-age=21600&quot;</span>, <span class="comment">// ç¼“å­˜æ—¶é—´ 6 å°æ—¶ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> caches.<span class="property">default</span>.<span class="title function_">put</span>(cacheKey, response.<span class="title function_">clone</span>());</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Server Error&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">500</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ Workers ç»‘å®šå¤„æ·»åŠ ç»‘å®šä¸Šé¢åˆ›å»ºçš„ <code>R2 Bucket</code>ï¼Œåç§°åªéœ€è¦ä¸ Workers ä»£ç ä¸­çš„åç§°ä¸€è‡´å³å¯ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>GitLab è‡ªåŠ¨éƒ¨ç½² GitHub Pages åšå®¢</title>
    <url>/post/4a4b01f0.html</url>
    <content><![CDATA[<p>åœ¨ä¹‹å‰ã€Š<a href="/post/8d4f8799.html" title="æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨">æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨</a>ã€‹è¯´åˆ°æˆ‘ç°åœ¨æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè€Œä¸”æ ¹æ®ä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬å·²ç»æ­å»ºå¥½äº†è¿™æ ·çš„ä¸€ä¸ªç¯å¢ƒã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆå°±èµ¶ç´§ç”¨èµ·æ¥å§ã€‚</p>
<span id="more"></span>

<p>é‚£ä¹ˆè¿™ä¸€ç¯‡ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç”¨è¿™ä¸ªå®¶åº­ç§äºº GitLab å®ç°è‡ªåŠ¨éƒ¨ç½²æ‰˜ç®¡åœ¨ GitHub Pages ä¸Šçš„åšå®¢ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ <code>Hexo</code> æ¡†æ¶ + <code>Next</code> ä¸»é¢˜ï¼Œå…¶ä»–çš„é™æ€åšå®¢æ¡†æ¶å¤§åŒå°å¼‚ã€‚è¿™çš„å…³æ³¨ç‚¹ä¸åœ¨æ­å»ºåšå®¢ï¼Œè¿™é‡Œå‡å®šä½ å·²ç»æœ‰äº†ä¸€ä¸ªæ­£åœ¨æ‰˜ç®¡çš„ GitHub Pages åšå®¢ã€‚è¿™ç¯‡æ–‡ç« å°†æ­¤åšå®¢ä¸ºä¾‹å­è®²è§£ä¸€ä¸‹ã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h1><p>ç”¨è¿‡ <code>Hexo</code> çš„éƒ½çŸ¥é“ï¼Œå®ƒéœ€è¦åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šæ­å»ºä¸€ä¸ª <code>Node</code> ç¯å¢ƒã€‚å®‰è£…æ¡†æ¶ã€è‡ªå®šä¹‰ä¿®æ”¹é…ç½®ã€Markdown å†™æ–‡ç« ï¼Œç„¶åç”Ÿæˆã€æœ€ååˆ©ç”¨ Git æ¨é€åˆ° GitHub ä»“åº“ ç„¶åæ‰èƒ½åœ¨ç½‘ä¸Šçœ‹åˆ°å‘å¸ƒçš„æ–‡ç« ã€‚é‚£ä¹ˆè¿™æ ·å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸä¸€å¤©ä½ æœ¬åœ°çš„å†™åšå®¢çš„ç¯å¢ƒä¸¢å¤±äº†ï¼ˆæ¯”å¦‚ç”µè„‘åäº†ï¼Œç¡¬ç›˜åäº†ç­‰ç­‰ç­‰ç­‰ï¼‰é‚£ä¹ˆå¦‚æœä½ æƒ³å†æ›´æ–°ä½ çš„åšå®¢å°±éœ€è¦å†æ¬¡æ­å»ºè¿™æ ·ä¸€ä¸ªç¯å¢ƒï¼Œé™¤äº†éœ€è¦å°†æ‰€æœ‰çš„é…ç½®å†æ¬¡é…ç½®ä¸€éï¼Œå…³é”®æ˜¯æ—§çš„ Markdown æ–‡ç« å·²ç»å‡ ä¹å†æ‰¾ä¸å›æ¥äº†ã€‚</p>
<p>å‡ å¹´å‰æˆ‘ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´æ”¾å¼ƒäº†ä¹‹å‰å†™äº†å¾ˆå¤šæ–‡ç« çš„åšå®¢ã€‚é‚£åˆ°è¿™é‡Œå°±æœ‰äººæƒ³äº†ï¼Œå¦‚æœæˆ‘æŠŠä½äºæœ¬åœ°çš„é‚£ä¸ª â€˜ç¯å¢ƒâ€™ ä¹Ÿç”¨ Git ç®¡ç†èµ·æ¥å‘¢ï¼Ÿä¸é”™çš„æƒ³æ³•ï¼Œä¹‹åæˆ‘ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œåœ¨ GitHub ä¸Šå†æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥ä¿å­˜æœ¬åœ°å†™åšå®¢çš„ç¯å¢ƒï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ¢ç”µè„‘äº†ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªä»“åº“ clone ä¸‹æ¥ï¼Œå®‰è£…ä¸€ä¸‹ç›¸å…³çš„ä¾èµ–ï¼Œå°±å¯ä»¥ç»§ç»­äº†ã€‚</p>
<p>çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†å¾ˆå¿«å°±é‡åˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šè¿™é‡Œç›¸å½“äºæŠŠä½ çš„åšå®¢æ‰€æœ‰æºç éƒ½å…¬å¼€äº†å‡ºå»ï¼Œæœ‰ä»€ä¹ˆå¼Šç«¯ä¹ˆï¼Ÿæ¯”å¦‚å‡å¦‚ä½ ä½¿ç”¨äº† <code>hexo-blog-encrypt</code> æ’ä»¶å¯¹æŸäº›åšå®¢è¿›è¡ŒåŠ å¯†ï¼Œå¯†ç ä½¿éœ€è¦æ˜æ–‡å†™åœ¨å¾…åŠ å¯†åšå®¢çš„å¤´éƒ¨ä¿¡æ¯é‡Œçš„ã€‚å¥½å®¶ä¼™ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸å°±æˆäº†é˜²å›å­ä¸é˜²å°äººäº†ï¼Ÿæ‰€ä»¥è¿™å°±éœ€è¦æŠŠæºç æ‰˜ç®¡åœ¨æˆ‘ä»¬ä¹‹å‰æ­å»ºé‚£ä¸ªå®¶åº­ç§äººçš„ GitLab ä¸Šçš„ã€‚</p>
<p>ä½†æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘åˆåŒå’å•å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ç»å¸¸å¿˜è®°æŠŠæœ¬åœ°çš„åšå®¢æºç  push åˆ° GitLab ä¸Šã€‚å¤§éƒ¨åˆ†çš„æ—¶å€™éƒ½æ˜¯æœ¬åœ°å†™å®Œï¼Œä¿®æ”¹çš„å·®ä¸å¤šä¹‹åå°± <code>hexo deploy</code> éƒ¨ç½²åå°±å¿˜äº† push åˆ° GitLabï¼Œå¯¼è‡´ç”¨çš„æ—¶å€™è¯¥ä¸¢çš„æ–‡ç« è¿˜æ˜¯ä¸¢äº†ã€‚æ¼ç¾æˆæ€’ä¹‹ä¸‹ï¼ŒèŒç”Ÿäº†åˆ©ç”¨ GitLab CI&#x2F;CD è‡ªåŠ¨éƒ¨ç½²ã€‚å®ç°æ¯æ¬¡å†™å®Œæ–‡ç« ï¼Œåªéœ€è¦ push æœ¬åœ°æºç åˆ° GitLabï¼Œç„¶å GitLab è‡ªåŠ¨éƒ¨ç½²ã€‚è¿™æ ·ä¸€æ¥å°±ä¸æ€•æ¯æ¬¡å†™å®Œæ–‡ç« æ‰‹åŠ¨éƒ¨ç½²ä¹‹åå¿˜è®°æäº¤æœ¬åœ°æºç ï¼ŒäºŒæ¥ä¹Ÿå‡å°‘äº†éœ€è¦æ‰‹åŠ¨çš„æ­¥éª¤ã€‚æ¯•ç«Ÿæ‡’æƒ°æ‰æ˜¯äººç±»çš„ç¬¬ä¸€ç”Ÿäº§åŠ›ã€‚</p>
<h1 id="å¼€å§‹å§"><a href="#å¼€å§‹å§" class="headerlink" title="å¼€å§‹å§"></a>å¼€å§‹å§</h1><h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><p>ä½¿ç”¨ GitLab CI&#x2F;CD åŠŸèƒ½ä¸æ˜¯å¿…é¡» Dockerï¼Œä½†æ˜¯å®¹å™¨åŒ–çš„ Docker èƒ½å¤Ÿéš”ç¦»ç‰©ç†æœºï¼Œé˜²æ­¢ä¸€è¨€ä¸åˆä¸€ä¸ª <code>rm -rf /*</code> è®©ä½ çš„å¿ƒè¡€ç™½è´¹ã€‚</p>
<p>ä»¥ä¸‹å‘½ä»¤éœ€è¦ ssh åˆ° GitLab æœåŠ¡æ‰€åœ¨çš„æœºå™¨ä¸­è¿›è¡Œ</p>
<ol>
<li>å¸è½½æ—§ç‰ˆæœ¬ Dockerï¼ˆå¦‚æœæ²¡å®‰è£…è¿‡ï¼Œå¯ä»¥çœç•¥ï¼‰</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®‰è£…å¿…è¦ä¾èµ–</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt install apt-transport-https ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ·»åŠ  apt æº</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line"> <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string"> <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å®‰è£… Docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¯åŠ¨ Docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥ä¸Šå‘½ä»¤æ²¡æœ‰å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆ docker å°±å·²ç»å®‰è£…åˆ°æœåŠ¡å™¨ä¸Šäº†ã€‚å¦‚æœä¸æ”¾å¿ƒï¼Œå¯ä»¥é€šè¿‡ <code>sudo docker -v</code> å‘½ä»¤ï¼Œå¦‚æœè¾“å‡ºç±»ä¼¼ <code>Docker version 20.10.12, build e91ed57</code> å°±è¯´æ˜ docker å·²ç»æ­£ç¡®å®‰è£…äº†ã€‚</p>
<h2 id="å®‰è£…-Gitlab-Runner"><a href="#å®‰è£…-Gitlab-Runner" class="headerlink" title="å®‰è£… Gitlab-Runner"></a>å®‰è£… Gitlab-Runner</h2><p>ä»¥ä¸‹çš„å‘½ä»¤éƒ½éœ€è¦ ssh åˆ° GitLab æœåŠ¡æ‰€åœ¨çš„æœºå™¨ä¸­è¿›è¡Œ</p>
<ol>
<li>æ·»åŠ  gitlab-runner åº“</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -L <span class="string">&quot;https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh&quot;</span> | <span class="built_in">sudo</span> bash</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®‰è£… gitlab-runner</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gitlab-runner</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œgitlab-runner å°±å®‰è£…å¥½äº†ï¼Œå¯ä»¥è¿è¡Œ <code>sudo gitlab-runner -v</code> å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ gitlab-runner å®‰è£…æˆåŠŸã€‚</p>
<h2 id="æ³¨å†Œ-Runner"><a href="#æ³¨å†Œ-Runner" class="headerlink" title="æ³¨å†Œ Runner"></a>æ³¨å†Œ Runner</h2><p>é¦–å…ˆä½¿ç”¨ <code>root</code> ç”¨æˆ·ç™»å½• gitlab -&gt; ç‚¹å‡»å·¦ä¸Šæ–¹ <code>Menu</code> -&gt; è¿›å…¥ <code>Admin</code> -&gt; ç‚¹å‡»å·¦ä¾§é¢æ¿ <code>Overview</code> ä¸‹çš„ <code>Runners</code><br><img src="https://images.zabrian.com/4dc2c2e2-dffb-44f5-2a7e-4140ab776f01/origin" title="GitLab-Admin-Runners" style="zoom:100%;" /></p>
<p>ç„¶åç‚¹å‡»å³ä¸Šæ–¹ Register an instance runnerï¼Œå¤åˆ¶ Registration token<br><img src="https://images.zabrian.com/fc6c425a-3304-44c8-a670-b425588c6101/origin" title="Register an instance runner" style="zoom:100%;" /></p>
<p>å†æ¬¡é€šè¿‡ ssh è¿æ¥ GitLab æœåŠ¡å™¨æ³¨å†Œä¸€ä¸ªå…±äº« Runner</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-runner register</span><br><span class="line">Enter the GitLab instance URL (<span class="keyword">for</span> example, https://gitlab.com/):</span><br><span class="line">http://git.home/            <span class="comment"># æœ¬åœ° GitLab åŸŸåæˆ–è€…IP</span></span><br><span class="line">Enter the registration token:</span><br><span class="line">xxxxxxxxxxxxxxxx            <span class="comment"># ä¸Šé¢è·å–åˆ°çš„ token</span></span><br><span class="line">Enter a description <span class="keyword">for</span> the runner:</span><br><span class="line">[ubuntu]: node              <span class="comment"># runner è‡ªå®šä¸€ä¸ªåå­—</span></span><br><span class="line">Enter tags <span class="keyword">for</span> the runner (comma-separated):</span><br><span class="line">node                        <span class="comment"># runner tag çš„åå­—ï¼Œé€šè¿‡ tag æŒ‡å®šè¿è¡Œ runner</span></span><br><span class="line">Registering runner... succeeded                     runner=xxxxxx</span><br><span class="line">Enter an executor: custom, ssh, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, shell, virtualbox, docker+machine:</span><br><span class="line">docker                      <span class="comment"># è¿™é‡Œé€‰æ‹© docker</span></span><br><span class="line">Enter the default Docker image (<span class="keyword">for</span> example, ruby:2.6):</span><br><span class="line">node:17                     <span class="comment"># docker é•œåƒä»¥åŠç‰ˆæœ¬</span></span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">&#x27;s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>

<p>å½“åˆ›å»ºå¥½ Runner ä¹‹åï¼Œå†æ¬¡å›åˆ° <code>Runners</code> é¡µé¢åˆ·æ–°å°±å¯ä»¥æ˜¾ç¤ºåˆšåˆšåˆ›å»ºçš„ Runner äº†ã€‚</p>
<h2 id="åˆ›å»º-SSH-å¯†é’¥å¯¹"><a href="#åˆ›å»º-SSH-å¯†é’¥å¯¹" class="headerlink" title="åˆ›å»º SSH å¯†é’¥å¯¹"></a>åˆ›å»º SSH å¯†é’¥å¯¹</h2><p>åœ¨æœ¬åœ°æˆ–è€…æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -f blog -t rsa -b 2048 -C <span class="string">&quot;xxxx@xxx.xxx&quot;</span>     <span class="comment"># é‚®ç®±è‡ªè¡Œæ›¿æ¢</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä¸€ä¸ªæ— å¯†ç çš„ SSH çš„å¯†é’¥å¯¹</p>
<p>å…¬é’¥ä¸º <code>blog.pub</code>ï¼Œç§é’¥ä¸º <code>blog</code></p>
<h2 id="GitHub-æ·»åŠ -Deploy-keys"><a href="#GitHub-æ·»åŠ -Deploy-keys" class="headerlink" title="GitHub æ·»åŠ  Deploy keys"></a>GitHub æ·»åŠ  Deploy keys</h2><p>ç™»å½• GitHubï¼Œè¿›å…¥éƒ¨ç½²çš„åšå®¢ä»“åº“ï¼Œç‚¹å‡» <code>Settings</code> -&gt; <code>Deploy keys</code> -&gt; <code>Add deploy key</code></p>
<p>å°† <code>blog.pub</code> å…¬é’¥çš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ° <code>Key</code> ä¸­ï¼Œç„¶å <code>Title</code> å¤„è‡ªå®šä¹‰ä¸€ä¸ªåå­—</p>
<h2 id="GitLab-é…ç½®-CI-CD"><a href="#GitLab-é…ç½®-CI-CD" class="headerlink" title="GitLab é…ç½® CI&#x2F;CD"></a>GitLab é…ç½® CI&#x2F;CD</h2><p>è¿›å…¥ GitLab åšå®¢é¡¹ç›®ï¼Œç‚¹å‡» <code>Settings</code> ä¸‹çš„ <code>CI/CD</code>ï¼Œå³ä¾§å±•å¼€ <code>Runners</code> é€‰é¡¹å¡ï¼Œå³ä¾§ <code>Shared runners</code> æ‰“å¼€ <code>Enable shared runners for this project</code> é€‰é¡¹<br><img src="https://images.zabrian.com/6f66496d-6e87-463b-1fe6-657a77a5d801/origin" title="Enable shared runners for this project" style="zoom:25%;" /></p>
<p>ç„¶åå†å±•å¼€åˆ°ä¸‹æ–¹ <code>Variables</code></p>
<p>æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡åˆ†åˆ«æ˜¯</p>
<ul>
<li><code>SSH_KNOWN_HOSTS</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=</span><br></pre></td></tr></table></figure>

<ul>
<li><code>SSH_PRIVATE_KEY</code><br><a href="#%E5%88%9B%E5%BB%BA-SSH-%E5%AF%86%E9%92%A5%E5%AF%B9">åˆ›å»º SSH å¯†é’¥å¯¹</a> ä¸­çš„ç§é’¥ <code>blog</code> å†…å®¹<img src="https://images.zabrian.com/5f546e74-b6d1-4751-a4d7-c80d71e37801/origin" title="GitLab-CICD-Settings-Variables" style="zoom:47%;" /></li>
</ul>
<h2 id="é¡¹ç›®-gitlab-ci-yml-é…ç½®"><a href="#é¡¹ç›®-gitlab-ci-yml-é…ç½®" class="headerlink" title="é¡¹ç›® .gitlab-ci.yml é…ç½®"></a>é¡¹ç›® <code>.gitlab-ci.yml</code> é…ç½®</h2><p>ç»è¿‡ä»¥ä¸Šé…ç½®ï¼Œç°åœ¨ç¦»æˆåŠŸæœ‰ä¸€æ­¥ä¹‹é¥ã€‚</p>
<p>åœ¨ GitLab åšå®¢æºç é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.gitlab-ci.yml</code> çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">main</span> <span class="comment"># æŒ‡å®šåªæœ‰ä¸»åˆ†æ”¯è§¦å‘è¯¥ CI</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node</span> <span class="comment"># æ­¤å¤„ tag æŒ‡å®šåˆ›å»º GitLab Runner æ—¶å€™å¡«å†™ tag åå­—</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ln</span> <span class="string">-sf</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span> <span class="string">/etc/localtime</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">eval</span> <span class="string">$(ssh-agent</span> <span class="string">-s)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">touch</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;$SSH_PRIVATE_KEY&quot;</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">touch</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;$SSH_KNOWN_HOSTS&quot;</span> <span class="string">&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">700</span> <span class="string">~/.ssh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">700</span> <span class="string">~/.ssh/*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;xxxx@xxx.xxx&quot;</span> <span class="comment"># GitHub çš„é‚®ç®±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;xxxx&quot;</span> <span class="comment"># GitHub çš„åå­—</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">init.defaultBranch</span> <span class="string">main</span> <span class="comment"># GitHub é¡¹ç›®çš„ä¸»åˆ†æ”¯ main æˆ–è€… master</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">-g</span> <span class="string">hexo-cli</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-deployer-git</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-renderer-swig</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-generator-searchdb</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-symbols-count-time</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-generator-sitemap</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-abbrlink</span> <span class="string">--save</span> <span class="comment"># ä»¥ä¸Š npm æ­¥éª¤æ ¹æ®è‡ªå·±æ·»åŠ çš„æ’ä»¶è‡ªå®šä¹‰</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>

<p>ç„¶å <code>git add .gitlab-ci.yml</code> æœ€åæ¨é€åˆ°ä»“åº“ä¹‹åï¼Œä»ä¾§è¾¹ <code>CI/CD</code> ä¸‹ <code>Pipelines</code> å°±å¯ä»¥çœ‹åˆ°è‡ªåŠ¨è¿è¡Œéƒ¨ç½²å·¥ä½œäº†</p>
<h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œç°åœ¨å°±å¯ä»¥æ¯æ¬¡åœ¨æœ¬åœ°ç¼–è¾‘åï¼Œåªéœ€è¦æ¨é€åˆ° GitLab å¹¶ç¨ç­‰ç‰‡åˆ»ï¼ŒGitHub Pages çš„é¡µé¢å°±æœ‰æœ€æ–°çš„å†…å®¹äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Hexo ä½¿ç”¨é€šè¡Œå¯†é’¥å¯¹æ–‡ç« åŠ å¯†</title>
    <url>/post/4de6100b.html</url>
    <content><![CDATA[<p>Hexo ä¸­ä¸»æµä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0QwbjlYMW4vaGV4by1ibG9nLWVuY3J5cHQ=">hexo-blog-encrypt<i class="fa fa-external-link-alt"></i></span> æ’ä»¶å¯ä»¥å¯¹æ–‡ç« è¿›è¡ŒåŠ å¯†ã€‚è¿™ç§æ–¹æ³•é€šè¿‡å¯†ç å®ç°ã€‚ç›¸æ¯”æ›´ä¸ºç®€å•çš„å‰ç«¯ JavaScript å¯†ç æ¯”è¾ƒéªŒè¯ï¼Œè¯¥æ–¹æ³•çš„åŠ å¯†æµç¨‹å¦‚ä¸‹</p>
<ul>
<li>Markdown æ–‡ç« å¤´éƒ¨å¯†ç  â†’ PBKDF2 æ´¾ç”Ÿå¯†é’¥ â†’ AES-256-CBC åŠ å¯†åŸå§‹å†…å®¹ â†’ ç”Ÿæˆ HMAC å®Œæ•´æ€§æ ¡éªŒ â†’ è¾“å‡ºåŠ å¯†çš„ HTML</li>
</ul>
<p>ä»è€Œå®ç°ä½¿ç”¨åŠ å¯†åšçš„å†…å®¹æ›¿æ¢åŸå§‹å†…å®¹ï¼Œé˜²æ­¢é€šè¿‡ç®€å• JavaScript æ‰‹æ®µç›´æ¥è·³è¿‡å¯†ç éªŒè¯ã€‚åŒæ—¶è§£å¯†è¿‡ç¨‹åˆ™æ˜¯</p>
<ul>
<li>ç”¨æˆ·è¾“å…¥å¯†ç  â†’ PBKDF2 æ´¾ç”Ÿå¯†é’¥ â†’ éªŒè¯ HMAC â†’ AES-256-CBC è§£å¯† â†’ è·å–åŸå§‹ HTML å†…å®¹ â†’ æ¸²æŸ“æ–‡ç« å†…å®¹</li>
</ul>
<span id="more"></span>

<p>è¿™ç§æ–¹æ¡ˆçš„å¥½å¤„æ˜¯ç®€å•æ˜“ç”¨ï¼Œå¯¹äºéœ€è¦ä¿å¯†çš„æ–‡ç« å†…å®¹ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨æ’ä»¶å¹¶åœ¨æ–‡ç« å¤´éƒ¨å¢åŠ å¯†ç å³å¯ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªä¼šç‚¹æŠ€æœ¯çš„æŠ˜è…¾å…šæ€ä¹ˆæ»¡è¶³äºæ¯æ¬¡æ‰‹åŠ¨è¾“å…¥å¯†ç ï¼Ÿçœ‹ç€ç°åœ¨å„å¤§ç½‘ç«™æ¨è¡Œçš„é€šè¡Œå¯†é’¥ï¼Œç™»å½•åªéœ€è¦è§¦æ‘¸ä¸€ä¸‹ TouchID çš„å¿«æ„Ÿç¡®å®æ˜¯ä¼ ç»Ÿè¾“å…¥å¯†ç ä¸èƒ½æ¯”æ‹Ÿçš„ã€‚æ‰€ä»¥å°±åœ¨å›½åº†æœŸé—´å¥½å¥½æ¢ç´¢äº†ä¸€ä¸‹å…¶å¯è¡Œæ€§ï¼Œæœ€ç»ˆä¹Ÿæ˜¯åœ¨é™æ€åšå®¢ä¸­ç”¨ä¸Šäº†ä¸€è§¦å³è¾¾çš„é€šè¡Œå¯†é’¥ã€‚</p>
<h1 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h1><img src="https://images.zabrian.com/85d3037a-fadf-4e98-8ee2-d84196e8ce01/origin" style="zoom:16%;" />

<h1 id="æ··åˆåŠ å¯†-Hybrid-Encryption"><a href="#æ··åˆåŠ å¯†-Hybrid-Encryption" class="headerlink" title="æ··åˆåŠ å¯† (Hybrid Encryption)"></a>æ··åˆåŠ å¯† (Hybrid Encryption)</h1><img src="https://images.zabrian.com/bf70281b-6855-47bb-84b8-69fcb164db01/origin" style="zoom:23%;" />

<div class="note info"><p><strong>Q</strong>: ä¸ºä»€ä¹ˆä½¿ç”¨æ··åˆåŠ å¯†è€Œä¸æ˜¯ç›´æ¥ç”¨ FIDO2 å¯†é’¥åŠ å¯†ï¼Ÿ<br><strong>A</strong>: <strong>æ”¯æŒå¤šè®¾å¤‡</strong></p>
<p><strong>Q</strong>: PRF Salt å¿…é¡»ä¿å¯†å—ï¼Ÿ<br><strong>A</strong>: <strong>ä¸éœ€è¦</strong> å› ä¸º PRF Salt çš„ä½œç”¨æ˜¯ä¸ºäº† <strong>è·¨åŸŸä¸€è‡´æ€§</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›¸åŒ FIDO2 è®¾å¤‡ + ç›¸åŒ Salt â†’ ç›¸åŒå¯†é’¥</span></span><br><span class="line">wrappingKey = <span class="title class_">FIDO2</span>_PRF(hardware_key, prfSalt)</span><br><span class="line">                             â†‘           â†‘</span><br><span class="line">                           ä¿å¯†çš„       å…¬å¼€çš„</span><br></pre></td></tr></table></figure>
<ul>
<li>PRF Salt &#x3D; ç›å€¼ï¼ˆå…¬å¼€ï¼‰</li>
<li>Hardware Key &#x3D; å¯†ç ï¼ˆä¿å¯†ï¼‰</li>
</ul>
<p>å³ä½¿çŸ¥é“ Saltï¼Œç¡¬ä»¶å¯†é’¥ä¸€èˆ¬ä»…å­˜åœ¨ FIDO2 è®¾å¤‡ä¸­æ— æ³•å¯¼å‡ºï¼Œå› æ­¤æ²¡æœ‰ç¡¬ä»¶å¯†é’¥ä»ç„¶æ— æ³•æ´¾ç”Ÿå‡º wrappingKey</p>
<p><strong>Q</strong>: ä¸‹è½½äº†æˆ‘çš„åšå®¢ HTMLï¼Œèƒ½ç ´è§£å—ï¼Ÿ<br><strong>A</strong>: <strong>ä¸èƒ½</strong>ï¼ŒåŸå› å¦‚ä¸‹</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ä» HTML å¯ä»¥è·å¾—:</span><br><span class="line"><span class="bullet"> 1.</span> åŠ å¯†çš„æ–‡ç« å†…å®¹ (ciphertext)</span><br><span class="line"><span class="bullet"> 2.</span> åˆå§‹åŒ–å‘é‡ (iv, authTag)</span><br><span class="line"><span class="bullet"> 3.</span> åŒ…è£…åçš„ CEK (wrappedKeys)</span><br><span class="line"><span class="bullet"> 4.</span> PRF Salt</span><br><span class="line"></span><br><span class="line">ä¸èƒ½è·å¾—ï¼š</span><br><span class="line">  âŒ åŒ…è£…å¯†é’¥ (wrappingKey)</span><br><span class="line"><span class="code">     â””â”€ ä½¿ç”¨ AES-256-GCM åŠ å¯†ï¼Œå®‰å…¨æ€§ç›®å‰å°šå¯</span></span><br></pre></td></tr></table></figure></div>

<h1 id="æµ‹è¯•é¡µé¢"><a href="#æµ‹è¯•é¡µé¢" class="headerlink" title="æµ‹è¯•é¡µé¢"></a>æµ‹è¯•é¡µé¢</h1><a href="/post/19c1a188.html" title="æµ‹è¯•åŠ å¯†æ–‡ç« ">æµ‹è¯•åŠ å¯†æ–‡ç« </a>

<p>å¯†ç : <code>123456</code></p>
<div style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-start;">
  <div style="position:relative; flex:1 1 480px; max-width:100%; aspect-ratio:100/52.96875;">
    <iframe
      src="https://customer-fonbnn17ffsh6xbx.cloudflarestream.com/a8621952cca955db2b06c529a54ac473/iframe?preload=true&loop=true&autoplay=true&title=%E9%80%9A%E8%A1%8C%E5%AF%86%E9%92%A5%E9%AA%8C%E8%AF%81"
      loading="lazy"
      style="position:absolute; inset:0; width:100%; height:100%; border:0;"
      allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
      allowfullscreen="true"
    ></iframe>
  </div>

  <div style="position:relative; flex:1 1 480px; max-width:100%; aspect-ratio:100/52.96875;">
    <iframe
      src="https://customer-fonbnn17ffsh6xbx.cloudflarestream.com/2da0cc46efa7b773d05561cfe24a1437/iframe?preload=true&loop=true&autoplay=true&title=%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81"
      loading="lazy"
      style="position:absolute; inset:0; width:100%; height:100%; border:0;"
      allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
      allowfullscreen="true"
    ></iframe>
  </div>
</div>

<h1 id="é£Ÿç”¨æŒ‡å—"><a href="#é£Ÿç”¨æŒ‡å—" class="headerlink" title="é£Ÿç”¨æŒ‡å—"></a>é£Ÿç”¨æŒ‡å—</h1><div class="note danger"><p>æ³¨æ„: ä»¥ä¸‹ä»£ç åªé’ˆå¯¹ NexT ä¸»é¢˜ä¿®æ”¹ï¼Œå¦‚æœä½¿ç”¨çš„ä¸æ˜¯ NexT ä¸»é¢˜åˆ™éœ€è¦è‡ªè¡Œæ ¹æ®éœ€è¦é’ˆå¯¹æ€§ä¿®æ”¹</p>
</div>

<h2 id="ç«™ç‚¹é…ç½®"><a href="#ç«™ç‚¹é…ç½®" class="headerlink" title="ç«™ç‚¹é…ç½®"></a>ç«™ç‚¹é…ç½®</h2><figure class="highlight yml"><figcaption><span>ç«™ç‚¹ _config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">encryption:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># å¯ç”¨åŠ å¯†</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># è§£å¯†åç¼“å­˜æ—¶é•¿ (åˆ†é’Ÿ)</span></span><br><span class="line">  <span class="comment"># é»˜è®¤ 0 è¡¨ç¤ºä¸ç¼“å­˜ï¼Œå³æ¯æ¬¡åˆ·æ–°é¡µé¢åéƒ½éœ€è¦é‡æ–°è®¤è¯</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">  <span class="attr">cache:</span> <span class="number">10</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># 64 ä½ç›å€¼</span></span><br><span class="line">  <span class="comment"># å¯é€šè¿‡ openssl rand -hex 32 ç”Ÿæˆ</span></span><br><span class="line">  <span class="comment"># ä¿®æ”¹åéœ€è¦é‡æ–°æ³¨å†Œ FIDO2 è®¾å¤‡</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">  <span class="attr">salt:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------   </span></span><br><span class="line">  <span class="comment"># FIDO2 è®¾å¤‡æ³¨å†Œåç”Ÿæˆçš„ key (åˆ‡å‹¿æ³„éœ²!!) </span></span><br><span class="line">  <span class="comment"># å¦‚æœæ³¨å†Œå¤šä¸ª key åˆ™åœ¨ä¸‹æ–¹ä¾æ¬¡æ·»åŠ å³å¯</span></span><br><span class="line">  <span class="comment"># æ¯æ·»åŠ ä¸€ä¸ªæ–° key éœ€è¦é‡æ–° generate å¹¶éƒ¨ç½²æ‰èƒ½ç”Ÿæ•ˆ</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line">  <span class="attr">keys:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å†Œ-FIDO2-æµç¨‹"><a href="#æ³¨å†Œ-FIDO2-æµç¨‹" class="headerlink" title="æ³¨å†Œ FIDO2 æµç¨‹"></a>æ³¨å†Œ FIDO2 æµç¨‹</h2><ul>
<li><code>./source/register.html</code> (æ–°å¢)</li>
</ul>
<div class="note info"><p>æ³¨æ„: æ³¨å†Œé¡µé¢ä¸­éœ€è¦å¡«å†™ <code>ç«™ç‚¹ _config.yml</code> ä¸­ä½¿ç”¨çš„ <code>salt</code></p>
</div>

<div class="tabs" id="æ³¨å†Œ-fido2-æµç¨‹"><ul class="nav-tabs"><li class="tab active"><a href="#æ³¨å†Œ-fido2-æµç¨‹-1"><i class="fa fa-code"></i>./source/register.html</a></li></ul><div class="tab-content"><div class="tab-pane active" id="æ³¨å†Œ-fido2-æµç¨‹-1"><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ³¨å†Œé€šè¡Œå¯†é’¥<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      * &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: -apple-system, <span class="string">&quot;PingFang SC&quot;</span>, <span class="string">&quot;Microsoft YaHei&quot;</span>, <span class="string">&quot;sans-serif&quot;</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: white;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: flex-start;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">60px</span> <span class="number">20px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">max-width</span>: <span class="number">650px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">28px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.subtitle</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.register-btn</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#059669</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-weight</span>: <span class="number">600</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.register-btn</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#047857</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.register-btn</span><span class="selector-pseudo">:disabled</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">cursor</span>: not-allowed;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#9ca3af</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.register-btn</span> <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#status</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.note</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.note</span><span class="selector-class">.success</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#d4edda</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#c3e6cb</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#155724</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.note</span><span class="selector-class">.danger</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#f8d7da</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#f5c6cb</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#721c24</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.note</span><span class="selector-class">.info</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#d1ecf1</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#bee5eb</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#0c5460</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.note</span> <span class="selector-tag">code</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: <span class="string">&quot;Monaco&quot;</span>, <span class="string">&quot;Courier New&quot;</span>, monospace;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">user-select</span>: all;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">word-break</span>: break-all;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">10px</span> auto;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.copy-btn</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#0284c7</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">10px</span> auto <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.copy-btn</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#0369a1</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.copy-btn</span> <span class="selector-tag">i</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.salt-container</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.salt-container</span> <span class="selector-tag">label</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.salt-container</span> <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">13px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-family</span>: monospace;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ³¨å†Œé€šè¡Œå¯†é’¥<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;subtitle&quot;</span>&gt;</span></span><br><span class="line">        ä½¿ç”¨ YubiKeyã€Touch ID æˆ–å…¶ä»– FIDO2 è®¾å¤‡ä¿æŠ¤æ‚¨çš„åŠ å¯†å†…å®¹</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;salt-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;prf-salt-input&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span>PRF Salt <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #ef4444&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&lt;/label</span><br><span class="line">        &gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;prf-salt-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;register-btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;register-btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-key&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> å¼€å§‹æ³¨å†Œ</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;status&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">getRPID</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> hostname = location.<span class="property">hostname</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> hostname === <span class="string">&quot;127.0.0.1&quot;</span> ? <span class="string">&quot;localhost&quot;</span> : hostname;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">class</span> <span class="title class_">FIDO2Registrar</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">btn</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;register-btn&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">saltInput</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;prf-salt-input&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">onclick</span> = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">register</span>();</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">saltInput</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">validateInput</span>());</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">validateInput</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">validateInput</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> isValid = <span class="variable language_">this</span>.<span class="property">saltInput</span>.<span class="property">value</span>.<span class="title function_">trim</span>().<span class="property">length</span> &gt; <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">disabled</span> = !isValid;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">PublicKeyCredential</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">show</span>(</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;æµè§ˆå™¨ä¸æ”¯æŒ FIDO2/WebAuthn&lt;/p&gt;&lt;/div&gt;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">show</span>(<span class="string">&#x27;&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;æ­£åœ¨æ³¨å†Œé€šè¡Œå¯†é’¥...&lt;/p&gt;&lt;/div&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> userId = crypto.<span class="title function_">getRandomValues</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">32</span>));</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> challenge = crypto.<span class="title function_">getRandomValues</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">32</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> cred = <span class="keyword">await</span> navigator.<span class="property">credentials</span>.<span class="title function_">create</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">publicKey</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                challenge,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">rp</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;Undefined Blog&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="title function_">getRPID</span>(),</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">user</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: userId,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;Zabrian&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">displayName</span>: <span class="string">&quot;Zabrian&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">pubKeyCredParams</span>: [</span></span><br><span class="line"><span class="language-javascript">                  &#123; <span class="attr">alg</span>: -<span class="number">7</span>, <span class="attr">type</span>: <span class="string">&quot;public-key&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                  &#123; <span class="attr">alg</span>: -<span class="number">257</span>, <span class="attr">type</span>: <span class="string">&quot;public-key&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                ],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">authenticatorSelection</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">residentKey</span>: <span class="string">&quot;required&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">userVerification</span>: <span class="string">&quot;preferred&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">requireResidentKey</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">timeout</span>: <span class="number">60000</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">extensions</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">prf</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!cred) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ç”Ÿæˆå‡­è¯å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> prfEnabled = cred.<span class="title function_">getClientExtensionResults</span>().<span class="property">prf</span>?.<span class="property">enabled</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!prfEnabled) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="title function_">show</span>(<span class="string">&#x27;&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;PRF æ‰©å±•ä¸å¯ç”¨&lt;/p&gt;&lt;/div&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">generateEncryptionKey</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> msg = <span class="string">&quot;æ³¨å†Œå¤±è´¥: &quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">name</span> === <span class="string">&quot;NotAllowedError&quot;</span>) msg += <span class="string">&quot;æ“ä½œå–æ¶ˆ&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">name</span> === <span class="string">&quot;InvalidStateError&quot;</span>) msg += <span class="string">&quot;é‡å¤æ³¨å†Œ&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">else</span> msg += e.<span class="property">message</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">show</span>(<span class="string">`&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;<span class="subst">$&#123;msg&#125;</span>&lt;/p&gt;&lt;/div&gt;`</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">finally</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">btn</span>.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="title function_">generateEncryptionKey</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> prfSaltString = <span class="variable language_">this</span>.<span class="property">saltInput</span>.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">show</span>(</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;æ­£åœ¨ç”ŸæˆåŠ å¯†å¯†é’¥...&lt;/p&gt;&lt;/div&gt;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> challenge = crypto.<span class="title function_">getRandomValues</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">32</span>));</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> prfSalt = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">digest</span>(</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&quot;SHA-256&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(prfSaltString)</span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> assertion = <span class="keyword">await</span> navigator.<span class="property">credentials</span>.<span class="title function_">get</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">publicKey</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                challenge,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">rpId</span>: <span class="title function_">getRPID</span>(),</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">userVerification</span>: <span class="string">&quot;preferred&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">timeout</span>: <span class="number">60000</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">extensions</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">prf</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">eval</span>: &#123; <span class="attr">first</span>: prfSalt &#125;,</span></span><br><span class="line"><span class="language-javascript">                  &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> prfKey =</span></span><br><span class="line"><span class="language-javascript">              assertion.<span class="title function_">getClientExtensionResults</span>().<span class="property">prf</span>?.<span class="property">results</span>?.<span class="property">first</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!prfKey) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;æ— æ³•è·å– PRF å¯†é’¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> encryptionKey = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(prfKey);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> encryptionKeyHex = <span class="title class_">Array</span>.<span class="title function_">from</span>(encryptionKey)</span></span><br><span class="line"><span class="language-javascript">              .<span class="title function_">map</span>(<span class="function">(<span class="params">b</span>) =&gt;</span> b.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">              .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">show</span>(<span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">              &lt;div class=&quot;note success&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                &lt;p&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                  &lt;code id=&quot;encryption-key&quot;&gt;<span class="subst">$&#123;encryptionKeyHex&#125;</span>&lt;/code&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                  &lt;button class=&quot;copy-btn&quot; onclick=&quot;copyEncryptionKey(event)&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                    &lt;i class=&quot;fa fa-copy&quot;&gt;&lt;/i&gt; å¤åˆ¶å¯†é’¥</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                  &lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                &lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">              &lt;/div&gt;`</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">show</span>(</span></span><br><span class="line"><span class="language-javascript">              <span class="string">`&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;ç”Ÿæˆå¯†é’¥å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>&lt;/p&gt;&lt;/div&gt;`</span></span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">show</span>(<span class="params">html</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;status&quot;</span>).<span class="property">innerHTML</span> = html;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;status&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">copyEncryptionKey</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> key = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;encryption-key&quot;</span>).<span class="property">textContent</span>;</span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">clipboard</span>.<span class="title function_">writeText</span>(key).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> btn = event.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">&quot;button&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> originalText = btn.<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">          btn.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;i class=&quot;fa fa-check&quot;&gt;&lt;/i&gt; å·²å¤åˆ¶&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            btn.<span class="property">innerHTML</span> = originalText;</span></span><br><span class="line"><span class="language-javascript">          &#125;, <span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">FIDO2Registrar</span>());</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="åŠ å¯†æµç¨‹"><a href="#åŠ å¯†æµç¨‹" class="headerlink" title="åŠ å¯†æµç¨‹"></a>åŠ å¯†æµç¨‹</h2><ul>
<li><code>./scripts/post-encrypt.js</code> (æ–°å¢)</li>
</ul>
<div class="tabs" id="åŠ å¯†æµç¨‹"><ul class="nav-tabs"><li class="tab active"><a href="#åŠ å¯†æµç¨‹-1"><i class="fa fa-code"></i>./scripts/post-encrypt.js</a></li></ul><div class="tab-content"><div class="tab-pane active" id="åŠ å¯†æµç¨‹-1"><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PBKDF2</span>_ITERATIONS = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypt</span>(<span class="params">text, masterKey</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> iv = crypto.<span class="title function_">randomBytes</span>(<span class="number">12</span>);</span><br><span class="line">  <span class="keyword">const</span> keyBuffer = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(masterKey, <span class="string">&quot;hex&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> cipher = crypto.<span class="title function_">createCipheriv</span>(<span class="string">&quot;aes-256-gcm&quot;</span>, keyBuffer, iv);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> encrypted = cipher.<span class="title function_">update</span>(text, <span class="string">&quot;utf8&quot;</span>, <span class="string">&quot;base64&quot;</span>);</span><br><span class="line">  encrypted += cipher.<span class="title function_">final</span>(<span class="string">&quot;base64&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">ciphertext</span>: encrypted,</span><br><span class="line">    <span class="attr">iv</span>: iv.<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">authTag</span>: cipher.<span class="title function_">getAuthTag</span>().<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encryptCEK</span>(<span class="params">cek, wrapKey</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> iv = crypto.<span class="title function_">randomBytes</span>(<span class="number">12</span>);</span><br><span class="line">  <span class="keyword">const</span> keyBuffer = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(wrapKey, <span class="string">&quot;hex&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> cipher = crypto.<span class="title function_">createCipheriv</span>(<span class="string">&quot;aes-256-gcm&quot;</span>, keyBuffer, iv);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> encrypted = cipher.<span class="title function_">update</span>(cek);</span><br><span class="line">  encrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([encrypted, cipher.<span class="title function_">final</span>()]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;fido2&quot;</span>,</span><br><span class="line">    <span class="attr">encryptedCEK</span>: encrypted.<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">iv</span>: iv.<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">authTag</span>: cipher.<span class="title function_">getAuthTag</span>().<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">derivePBKDF2Key</span>(<span class="params">password, salt, iterations</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">pbkdf2Sync</span>(</span><br><span class="line">    <span class="title class_">Buffer</span>.<span class="title function_">from</span>(password, <span class="string">&quot;utf8&quot;</span>),</span><br><span class="line">    <span class="title class_">Buffer</span>.<span class="title function_">from</span>(salt, <span class="string">&quot;utf8&quot;</span>),</span><br><span class="line">    iterations,</span><br><span class="line">    <span class="number">32</span>,</span><br><span class="line">    <span class="string">&quot;sha256&quot;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encryptCEKWithPassword</span>(<span class="params">cek, password, salt, iterations</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapKey = <span class="title function_">derivePBKDF2Key</span>(password, salt, iterations);</span><br><span class="line">  <span class="keyword">const</span> iv = crypto.<span class="title function_">randomBytes</span>(<span class="number">12</span>);</span><br><span class="line">  <span class="keyword">const</span> cipher = crypto.<span class="title function_">createCipheriv</span>(<span class="string">&quot;aes-256-gcm&quot;</span>, wrapKey, iv);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> encrypted = cipher.<span class="title function_">update</span>(cek);</span><br><span class="line">  encrypted = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([encrypted, cipher.<span class="title function_">final</span>()]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">    <span class="attr">encryptedCEK</span>: encrypted.<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">iv</span>: iv.<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">authTag</span>: cipher.<span class="title function_">getAuthTag</span>().<span class="title function_">toString</span>(<span class="string">&quot;base64&quot;</span>),</span><br><span class="line">    <span class="attr">salt</span>: salt,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genTemplate</span>(<span class="params">abbrlink, encData, wrappedKeys, prfSalt, cache</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> wrappedKeysJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(wrappedKeys).<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&quot;&amp;quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> hasFido2 = wrappedKeys.<span class="title function_">some</span>(<span class="function">(<span class="params">k</span>) =&gt;</span> k.<span class="property">type</span> === <span class="string">&quot;fido2&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> hasPassword = wrappedKeys.<span class="title function_">some</span>(<span class="function">(<span class="params">k</span>) =&gt;</span> k.<span class="property">type</span> === <span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fido2Html = hasFido2</span><br><span class="line">    ? <span class="string">`&lt;button class=&quot;decrypt-btn&quot; id=&quot;fido2-verify-btn&quot;&gt;&lt;i class=&quot;fa fa-fingerprint&quot;&gt;&lt;/i&gt; é€šè¡Œå¯†é’¥éªŒè¯&lt;/button&gt;`</span></span><br><span class="line">    : <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> passwordHtml = hasPassword</span><br><span class="line">    ? <span class="string">`&lt;div class=&quot;password-decrypt-group&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;button class=&quot;decrypt-btn&quot; id=&quot;show-password-btn&quot;&gt;&lt;i class=&quot;fa fa-lock&quot;&gt;&lt;/i&gt; å¯†ç éªŒè¯&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;password-input-group&quot; id=&quot;password-input-group&quot; style=&quot;display:none&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;input type=&quot;password&quot; class=&quot;password-input&quot; id=&quot;password-input&quot; placeholder=&quot;è¾“å…¥å¯†ç &quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;button class=&quot;decrypt-btn&quot; id=&quot;password-decrypt-btn&quot;&gt;&lt;i class=&quot;fa fa-key&quot;&gt;&lt;/i&gt; ç¡®å®š&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;`</span></span><br><span class="line">    : <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;div class=&quot;encrypted-post-container&quot; </span></span><br><span class="line"><span class="string">    data-ciphertext=&quot;<span class="subst">$&#123;encData.ciphertext&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    data-iv=&quot;<span class="subst">$&#123;encData.iv&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    data-auth-tag=&quot;<span class="subst">$&#123;encData.authTag&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    data-abbrlink=&quot;<span class="subst">$&#123;abbrlink || <span class="string">&quot;&quot;</span>&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    data-wrapped-keys=&#x27;<span class="subst">$&#123;wrappedKeysJson&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">    data-prf-salt=&quot;<span class="subst">$&#123;prfSalt&#125;</span>&quot;</span></span><br><span class="line"><span class="string">    data-cache=&quot;<span class="subst">$&#123;cache || <span class="number">0</span>&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;div class=&quot;encrypted-post-notice&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;decrypt-methods&quot;&gt;<span class="subst">$&#123;fido2Html&#125;</span><span class="subst">$&#123;passwordHtml&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;verification-status&quot; id=&quot;verification-status&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;div class=&quot;decrypted-content&quot; id=&quot;decrypted-content&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;`</span>.<span class="title function_">trim</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getKeys</span>(<span class="params">cfg</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(cfg.<span class="property">keys</span>) ? cfg.<span class="property">keys</span> : cfg.<span class="property">key</span> ? [cfg.<span class="property">key</span>] : [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateConfig</span>(<span class="params">cfg</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!cfg?.<span class="property">enabled</span>) &#123;</span><br><span class="line">    hexo.<span class="property">log</span>.<span class="title function_">warn</span>(<span class="string">&quot;åŠ å¯†åŠŸèƒ½æœªå¯ç”¨&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!cfg.<span class="property">salt</span> || !<span class="regexp">/^[a-fA-F0-9]&#123;64&#125;$/</span>.<span class="title function_">test</span>(cfg.<span class="property">salt</span>)) &#123;</span><br><span class="line">    hexo.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">&quot;PRF Salt é…ç½®æ— æ•ˆ&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="title function_">getKeys</span>(cfg);</span><br><span class="line">  <span class="keyword">if</span> (keys.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    hexo.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">&quot;è¯·å…ˆæ³¨å†Œ FIDO2 é€šè¡Œå¯†é’¥&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> keys) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^[a-fA-F0-9]&#123;64&#125;$/</span>.<span class="title function_">test</span>(key)) &#123;</span><br><span class="line">      hexo.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">`å¯†é’¥æ ¼å¼æ— æ•ˆ: <span class="subst">$&#123;key&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(</span><br><span class="line">  <span class="string">&quot;after_post_render&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!data.<span class="property">encrypted</span>) <span class="keyword">return</span> data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cfg = hexo.<span class="property">config</span>.<span class="property">encryption</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">validateConfig</span>(cfg)) <span class="keyword">return</span> data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> cek = crypto.<span class="title function_">randomBytes</span>(<span class="number">32</span>);</span><br><span class="line">      <span class="keyword">const</span> encData = <span class="title function_">encrypt</span>(data.<span class="property">content</span>, cek.<span class="title function_">toString</span>(<span class="string">&quot;hex&quot;</span>));</span><br><span class="line">      <span class="keyword">const</span> wrappedKeys = <span class="title function_">getKeys</span>(cfg).<span class="title function_">map</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> <span class="title function_">encryptCEK</span>(cek, key));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (data.<span class="property">password</span>) &#123;</span><br><span class="line">        wrappedKeys.<span class="title function_">push</span>(</span><br><span class="line">          <span class="title function_">encryptCEKWithPassword</span>(</span><br><span class="line">            cek,</span><br><span class="line">            <span class="title class_">String</span>(data.<span class="property">password</span>),</span><br><span class="line">            <span class="title class_">String</span>(cfg.<span class="property">salt</span>),</span><br><span class="line">            <span class="title class_">PBKDF2</span>_ITERATIONS</span><br><span class="line">          )</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      data.<span class="property">content</span> = <span class="title function_">genTemplate</span>(</span><br><span class="line">        data.<span class="property">abbrlink</span>,</span><br><span class="line">        encData,</span><br><span class="line">        wrappedKeys,</span><br><span class="line">        cfg.<span class="property">salt</span>,</span><br><span class="line">        cfg.<span class="property">cache</span></span><br><span class="line">      );</span><br><span class="line">      hexo.<span class="property">log</span>.<span class="title function_">info</span>(<span class="string">`Encrypted: <span class="subst">$&#123;data.title&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      hexo.<span class="property">log</span>.<span class="title function_">error</span>(<span class="string">`Encrypted: <span class="subst">$&#123;data.title&#125;</span> <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">15</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="è§£å¯†æµç¨‹"><a href="#è§£å¯†æµç¨‹" class="headerlink" title="è§£å¯†æµç¨‹"></a>è§£å¯†æµç¨‹</h2><ul>
<li><code>./source/js/decrypt.js</code> (æ–°å¢)</li>
<li><code>./source/_data/styles.styl</code> (æ–°å¢)</li>
</ul>
<div class="tabs" id="è§£å¯†æµç¨‹"><ul class="nav-tabs"><li class="tab active"><a href="#è§£å¯†æµç¨‹-1"><i class="fa fa-code"></i>./source/js/decrypt.js</a></li><li class="tab"><a href="#è§£å¯†æµç¨‹-2"><i class="fa fa-code"></i>./source/_data/styles.styl</a></li></ul><div class="tab-content"><div class="tab-pane active" id="è§£å¯†æµç¨‹-1"><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">PBKDF2</span>_ITERATIONS = <span class="number">500000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRPID</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hostname = location.<span class="property">hostname</span>;</span><br><span class="line">  <span class="keyword">return</span> hostname === <span class="string">&quot;127.0.0.1&quot;</span> ? <span class="string">&quot;localhost&quot;</span> : hostname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Decryptor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">container</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rpId</span> = <span class="title function_">getRPID</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">container</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.encrypted-post-container&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = &#123;</span><br><span class="line">      <span class="attr">ciphertext</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">ciphertext</span>,</span><br><span class="line">      <span class="attr">iv</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">iv</span>,</span><br><span class="line">      <span class="attr">authTag</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">authTag</span>,</span><br><span class="line">      <span class="attr">abbrlink</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">abbrlink</span>,</span><br><span class="line">      <span class="attr">wrappedKeys</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">wrappedKeys</span> || <span class="string">&quot;[]&quot;</span>),</span><br><span class="line">      <span class="attr">prfSalt</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">prfSalt</span>,</span><br><span class="line">      <span class="attr">cache</span>: <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">dataset</span>.<span class="property">cache</span>) || <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">checkCache</span>()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> fido2Btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;fido2-verify-btn&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fido2Btn) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">PublicKeyCredential</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">&quot;æµè§ˆå™¨ä¸æ”¯æŒ FIDO2/WebAuthn&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fido2Btn.<span class="property">onclick</span> = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">authenticate</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> showPasswordBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;show-password-btn&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (showPasswordBtn) &#123;</span><br><span class="line">      showPasswordBtn.<span class="property">onclick</span> = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">showPasswordInput</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> passwordBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-decrypt-btn&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (passwordBtn) &#123;</span><br><span class="line">      passwordBtn.<span class="property">onclick</span> = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">decryptWithPassword</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> passwordInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-input&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (passwordInput) &#123;</span><br><span class="line">      passwordInput.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&quot;Enter&quot;</span>) <span class="variable language_">this</span>.<span class="title function_">decryptWithPassword</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getCacheKey</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">abbrlink</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">showPasswordInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> showBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;show-password-btn&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> inputGroup = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-input-group&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> passwordInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (showBtn) showBtn.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (inputGroup) inputGroup.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;flex&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (passwordInput) &#123;</span><br><span class="line">      passwordInput.<span class="title function_">focus</span>();</span><br><span class="line">      passwordInput.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function">() =&gt;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updatePasswordButtonState</span>()</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updatePasswordButtonState</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">updatePasswordButtonState</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> passwordInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> passwordBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-decrypt-btn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!passwordInput || !passwordBtn) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hasPassword = passwordInput.<span class="property">value</span>.<span class="title function_">trim</span>().<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">    passwordBtn.<span class="property">disabled</span> = !hasPassword;</span><br><span class="line">    passwordBtn.<span class="property">style</span>.<span class="property">opacity</span> = hasPassword ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0.5&quot;</span>;</span><br><span class="line">    passwordBtn.<span class="property">style</span>.<span class="property">cursor</span> = hasPassword ? <span class="string">&quot;pointer&quot;</span> : <span class="string">&quot;not-allowed&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">checkCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">cache</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> cached = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="variable language_">this</span>.<span class="title function_">getCacheKey</span>());</span><br><span class="line">      <span class="keyword">if</span> (!cached) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; html, expired &#125; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(cached);</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() &lt; expired) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>(html);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">hideStatus</span>(), <span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="variable language_">this</span>.<span class="title function_">getCacheKey</span>());</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">saveCache</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">cache</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> expired = <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">cache</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getCacheKey</span>(),</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; html, expired &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">authenticate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showStatus</span>(<span class="string">&quot;æ­£åœ¨éªŒè¯èº«ä»½...&quot;</span>, <span class="string">&quot;info&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> challenge = crypto.<span class="title function_">getRandomValues</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="number">32</span>));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> prfSalt = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">digest</span>(</span><br><span class="line">        <span class="string">&quot;SHA-256&quot;</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">prfSalt</span>)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> assertion = <span class="keyword">await</span> navigator.<span class="property">credentials</span>.<span class="title function_">get</span>(&#123;</span><br><span class="line">        <span class="attr">publicKey</span>: &#123;</span><br><span class="line">          challenge,</span><br><span class="line">          <span class="attr">rpId</span>: <span class="variable language_">this</span>.<span class="property">rpId</span>,</span><br><span class="line">          <span class="attr">userVerification</span>: <span class="string">&quot;preferred&quot;</span>,</span><br><span class="line">          <span class="attr">timeout</span>: <span class="number">60000</span>,</span><br><span class="line">          <span class="attr">extensions</span>: &#123; <span class="attr">prf</span>: &#123; <span class="attr">eval</span>: &#123; <span class="attr">first</span>: prfSalt &#125; &#125; &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> prfResults = assertion.<span class="title function_">getClientExtensionResults</span>().<span class="property">prf</span>;</span><br><span class="line">      <span class="keyword">if</span> (!prfResults?.<span class="property">results</span>?.<span class="property">first</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;PRF æ‰©å±•ä¸å¯ç”¨&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> wrappingKey = prfResults.<span class="property">results</span>.<span class="property">first</span>;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showStatus</span>(<span class="string">&quot;éªŒè¯æˆåŠŸï¼Œæ­£åœ¨è§£å¯†...&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">unwrapAndDecrypt</span>(wrappingKey), <span class="number">300</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">name</span> === <span class="string">&quot;NotAllowedError&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">&quot;éªŒè¯è¢«æ‹’ç»&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">name</span> === <span class="string">&quot;InvalidStateError&quot;</span> || e.<span class="property">name</span> === <span class="string">&quot;NotFoundError&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">&quot;æœªæ³¨å†Œçš„é€šè¡Œå¯†é’¥&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">`éªŒè¯å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">derivePBKDF2Key</span>(<span class="params">password, salt, iterations = PBKDF2_ITERATIONS</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> passwordBuffer = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(password);</span><br><span class="line">    <span class="keyword">const</span> saltBuffer = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(salt);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> baseKey = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">      <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">      passwordBuffer,</span><br><span class="line">      <span class="string">&quot;PBKDF2&quot;</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      [<span class="string">&quot;deriveBits&quot;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> derivedBits = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">deriveBits</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;PBKDF2&quot;</span>,</span><br><span class="line">        <span class="attr">salt</span>: saltBuffer,</span><br><span class="line">        <span class="attr">iterations</span>: iterations,</span><br><span class="line">        <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      baseKey,</span><br><span class="line">      <span class="number">256</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> derivedBits;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">decryptWithPassword</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> passwordInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password-input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> password = passwordInput?.<span class="property">value</span>.<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!password) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">&quot;è¯·è¾“å…¥å¯†ç &quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showStatus</span>(<span class="string">&quot;æ­£åœ¨è§£å¯†...&quot;</span>, <span class="string">&quot;info&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> passwordWrapped = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">wrappedKeys</span>.<span class="title function_">find</span>(</span><br><span class="line">        <span class="function">(<span class="params">k</span>) =&gt;</span> k.<span class="property">type</span> === <span class="string">&quot;password&quot;</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (!passwordWrapped) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;æ–‡ç« ä¸æ”¯æŒå¯†ç &quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> wrappingKey = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">derivePBKDF2Key</span>(</span><br><span class="line">        password,</span><br><span class="line">        passwordWrapped.<span class="property">salt</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">unwrapAndDecrypt</span>(wrappingKey, <span class="string">&quot;password&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">`è§£å¯†å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">combineWithAuthTag</span>(<span class="params">data, authTag</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> combined = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data.<span class="property">byteLength</span> + authTag.<span class="property">byteLength</span>);</span><br><span class="line">    combined.<span class="title function_">set</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data), <span class="number">0</span>);</span><br><span class="line">    combined.<span class="title function_">set</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(authTag), data.<span class="property">byteLength</span>);</span><br><span class="line">    <span class="keyword">return</span> combined;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">unwrapAndDecrypt</span>(<span class="params">wrappingKey, type = <span class="string">&quot;fido2&quot;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> wrapKeyBuffer = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">        <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">        wrappingKey,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&quot;AES-GCM&quot;</span> &#125;,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        [<span class="string">&quot;decrypt&quot;</span>]</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> targetKeys = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">wrappedKeys</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">k</span>) =&gt;</span> k.<span class="property">type</span> === type);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> cek = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> wrapped <span class="keyword">of</span> targetKeys) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> encCEK = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(wrapped.<span class="property">encryptedCEK</span>);</span><br><span class="line">          <span class="keyword">const</span> wrapIV = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(wrapped.<span class="property">iv</span>);</span><br><span class="line">          <span class="keyword">const</span> wrapAuthTag = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(wrapped.<span class="property">authTag</span>);</span><br><span class="line">          <span class="keyword">const</span> wrappedCEK = <span class="variable language_">this</span>.<span class="title function_">combineWithAuthTag</span>(encCEK, wrapAuthTag);</span><br><span class="line"></span><br><span class="line">          cek = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">            &#123; <span class="attr">name</span>: <span class="string">&quot;AES-GCM&quot;</span>, <span class="attr">iv</span>: wrapIV, <span class="attr">tagLength</span>: <span class="number">128</span> &#125;,</span><br><span class="line">            wrapKeyBuffer,</span><br><span class="line">            wrappedCEK</span><br><span class="line">          );</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!cek)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(type === <span class="string">&quot;password&quot;</span> ? <span class="string">&quot;å¯†ç é”™è¯¯&quot;</span> : <span class="string">&quot;é€šè¡Œå¯†é’¥æ— æƒé™&quot;</span>);</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">decryptContent</span>(cek);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">`è§£å¯†å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">decryptContent</span>(<span class="params">decryptionKey</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showStatus</span>(<span class="string">&quot;æ­£åœ¨è§£å¯†...&quot;</span>, <span class="string">&quot;info&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> ciphertext = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">ciphertext</span>);</span><br><span class="line">      <span class="keyword">const</span> iv = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">iv</span>);</span><br><span class="line">      <span class="keyword">const</span> authTag = <span class="variable language_">this</span>.<span class="title function_">b64ToAB</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">authTag</span>);</span><br><span class="line">      <span class="keyword">const</span> encData = <span class="variable language_">this</span>.<span class="title function_">combineWithAuthTag</span>(ciphertext, authTag);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">        <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">        decryptionKey,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&quot;AES-GCM&quot;</span> &#125;,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        [<span class="string">&quot;decrypt&quot;</span>]</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> decrypted = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&quot;AES-GCM&quot;</span>, iv, <span class="attr">tagLength</span>: <span class="number">128</span> &#125;,</span><br><span class="line">        key,</span><br><span class="line">        encData</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> html = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>().<span class="title function_">decode</span>(decrypted);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">saveCache</span>(html);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">render</span>(html);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">hideStatus</span>(), <span class="number">2000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showError</span>(<span class="string">`è§£å¯†å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">html</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;decrypted-content&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> notice = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.encrypted-post-notice&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!content || !notice) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    notice.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    content.<span class="property">innerHTML</span> = html;</span><br><span class="line">    content.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">renderRefresh</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`åˆ·æ–°æ¸²æŸ“å¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">showStatus</span>(<span class="params">msg, type = <span class="string">&quot;info&quot;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;verification-status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!el) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> icons = &#123;</span><br><span class="line">      <span class="attr">info</span>: <span class="string">&quot;fa-info-circle&quot;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="string">&quot;fa-check-circle&quot;</span>,</span><br><span class="line">      <span class="attr">error</span>: <span class="string">&quot;fa-times-circle&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">    el.<span class="property">className</span> = <span class="string">`verification-status <span class="subst">$&#123;type&#125;</span>`</span>;</span><br><span class="line">    el.<span class="property">innerHTML</span> = <span class="string">`&lt;i class=&quot;fa <span class="subst">$&#123;icons[type]&#125;</span>&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;msg&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">showError</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showStatus</span>(msg, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">hideStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;verification-status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (el) el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">rebuildTOC</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;decrypted-content&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> tocWrap = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.post-toc-wrap&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> sidebar = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.sidebar-inner&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> utils = <span class="variable language_">window</span>.<span class="property">NexT</span>?.<span class="property">utils</span>;</span><br><span class="line">      <span class="keyword">if</span> (!content || !tocWrap) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> headings = content.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;h1,h2,h3,h4,h5,h6&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">ensureToc</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">        tocWrap.<span class="title function_">querySelector</span>(<span class="string">&quot;.post-toc&quot;</span>) ||</span><br><span class="line">        (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">          el.<span class="property">className</span> = <span class="string">&quot;post-toc animated&quot;</span>;</span><br><span class="line">          tocWrap.<span class="title function_">appendChild</span>(el);</span><br><span class="line">          <span class="keyword">return</span> el;</span><br><span class="line">        &#125;)();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!headings.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> exist = tocWrap.<span class="title function_">querySelector</span>(<span class="string">&quot;.post-toc&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (exist) exist.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        sidebar?.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;sidebar-nav-active&quot;</span>, <span class="string">&quot;sidebar-toc-active&quot;</span>);</span><br><span class="line">        sidebar?.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;sidebar-overview-active&quot;</span>);</span><br><span class="line">        utils?.<span class="property">registerSidebarTOC</span>?.();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; roots &#125; = <span class="title class_">Array</span>.<span class="title function_">from</span>(headings).<span class="title function_">reduce</span>(</span><br><span class="line">        <span class="function">(<span class="params">acc, h, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!h.<span class="property">id</span>) h.<span class="property">id</span> = <span class="string">`heading-<span class="subst">$&#123;i&#125;</span>`</span>;</span><br><span class="line">          <span class="keyword">const</span> level = <span class="built_in">parseInt</span>(h.<span class="property">tagName</span>[<span class="number">1</span>], <span class="number">10</span>);</span><br><span class="line">          <span class="keyword">const</span> node = &#123;</span><br><span class="line">            level,</span><br><span class="line">            <span class="attr">id</span>: h.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">text</span>: h.<span class="property">textContent</span>.<span class="title function_">trim</span>(),</span><br><span class="line">            <span class="attr">children</span>: [],</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">while</span> (acc.<span class="property">stack</span>.<span class="property">length</span> &amp;&amp; acc.<span class="property">stack</span>.<span class="title function_">at</span>(-<span class="number">1</span>).<span class="property">level</span> &gt;= level)</span><br><span class="line">            acc.<span class="property">stack</span>.<span class="title function_">pop</span>();</span><br><span class="line">          (acc.<span class="property">stack</span>.<span class="property">length</span> ? acc.<span class="property">stack</span>.<span class="title function_">at</span>(-<span class="number">1</span>).<span class="property">children</span> : acc.<span class="property">roots</span>).<span class="title function_">push</span>(node);</span><br><span class="line">          acc.<span class="property">stack</span>.<span class="title function_">push</span>(node);</span><br><span class="line">          <span class="keyword">return</span> acc;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; <span class="attr">roots</span>: [], <span class="attr">stack</span>: [] &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">nodes, depth = <span class="number">1</span></span>) =&gt;</span><br><span class="line">        nodes</span><br><span class="line">          .<span class="title function_">map</span>(<span class="function">(<span class="params">n</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> link = <span class="string">`&lt;a class=&quot;nav-link&quot; href=&quot;#<span class="subst">$&#123;n.id&#125;</span>&quot;&gt;&lt;span class=&quot;nav-text&quot;&gt;<span class="subst">$&#123;n.text&#125;</span>&lt;/span&gt;&lt;/a&gt;`</span>;</span><br><span class="line">            <span class="keyword">const</span> kids = n.<span class="property">children</span>.<span class="property">length</span></span><br><span class="line">              ? <span class="string">`&lt;ol class=&quot;nav-child&quot;&gt;<span class="subst">$&#123;render(n.children, depth + <span class="number">1</span>)&#125;</span>&lt;/ol&gt;`</span></span><br><span class="line">              : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`&lt;li class=&quot;nav-item nav-level-<span class="subst">$&#123;depth&#125;</span>&quot;&gt;<span class="subst">$&#123;link&#125;</span><span class="subst">$&#123;kids&#125;</span>&lt;/li&gt;`</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> toc = <span class="title function_">ensureToc</span>();</span><br><span class="line">      toc.<span class="property">innerHTML</span> = <span class="string">`&lt;ol class=&quot;nav&quot;&gt;<span class="subst">$&#123;render(roots)&#125;</span>&lt;/ol&gt;`</span>;</span><br><span class="line"></span><br><span class="line">      sidebar?.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;sidebar-nav-active&quot;</span>, <span class="string">&quot;sidebar-toc-active&quot;</span>);</span><br><span class="line">      sidebar?.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;sidebar-overview-active&quot;</span>);</span><br><span class="line">      utils?.<span class="property">registerSidebarTOC</span>?.();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`TOC é‡å»ºå¤±è´¥: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">renderRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">rebuildTOC</span>();</span><br><span class="line">    <span class="title class_">NexT</span>?.<span class="property">boot</span>?.<span class="property">refresh</span>?.();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">b64ToAB</span>(<span class="params">b64</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="title function_">atob</span>(b64);</span><br><span class="line">    <span class="keyword">const</span> bytes = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(str.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) bytes[i] = str.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    <span class="keyword">return</span> bytes.<span class="property">buffer</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decryptor = <span class="keyword">new</span> <span class="title class_">Decryptor</span>();</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.encrypted-post-container&quot;</span>)) decryptor.<span class="title function_">init</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="è§£å¯†æµç¨‹-2"><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.encrypted-post-container</span></span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">300px</span></span><br><span class="line"></span><br><span class="line">.encrypted-post-notice</span><br><span class="line">  text-align: center</span><br><span class="line">  padding: <span class="number">40px</span> <span class="number">20px</span></span><br><span class="line">  background: transparent</span><br><span class="line">  border-radius: <span class="number">12px</span></span><br><span class="line">  margin: <span class="number">20px</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">.decrypt-methods</span><br><span class="line">  display: flex</span><br><span class="line">  flex-direction: column</span><br><span class="line">  align-items: center</span><br><span class="line">  gap: <span class="number">15px</span></span><br><span class="line">  max-width: <span class="number">280px</span></span><br><span class="line">  margin: <span class="number">0</span> auto</span><br><span class="line"></span><br><span class="line">.decrypt-btn</span><br><span class="line">  width: <span class="number">100%</span></span><br><span class="line">  background: <span class="number">#3b8fc7</span></span><br><span class="line">  color: white</span><br><span class="line">  border: none</span><br><span class="line">  padding: <span class="number">15px</span> <span class="number">40px</span></span><br><span class="line">  font-size: <span class="number">16px</span></span><br><span class="line">  border-radius: <span class="number">30px</span></span><br><span class="line">  cursor: pointer</span><br><span class="line">  transition: all .<span class="number">3s</span> ease</span><br><span class="line">  box-shadow: <span class="number">0</span> <span class="number">4px</span> <span class="number">15px</span> <span class="built_in">rgba</span>(<span class="number">59</span>,<span class="number">143</span>,<span class="number">199</span>,.<span class="number">4</span>)</span><br><span class="line">  text-align: center</span><br><span class="line"></span><br><span class="line">.decrypt-btn:hover</span><br><span class="line">  transform: <span class="built_in">translateY</span>(-<span class="number">2px</span>)</span><br><span class="line">  box-shadow: <span class="number">0</span> <span class="number">6px</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">59</span>,<span class="number">143</span>,<span class="number">199</span>,.<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">.decrypt-btn:active</span><br><span class="line">  transform: <span class="built_in">translateY</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">.decrypt-btn:disabled</span><br><span class="line">  opacity: <span class="number">0.5</span></span><br><span class="line">  cursor: not-allowed</span><br><span class="line">  transform: none</span><br><span class="line"></span><br><span class="line">.decrypt-btn:disabled:hover</span><br><span class="line">  transform: none</span><br><span class="line">  box-shadow: <span class="number">0</span> <span class="number">4px</span> <span class="number">15px</span> <span class="built_in">rgba</span>(<span class="number">59</span>,<span class="number">143</span>,<span class="number">199</span>,.<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">.decrypt-btn i</span><br><span class="line">  margin-right: <span class="number">8px</span></span><br><span class="line"></span><br><span class="line">.password-decrypt-group</span><br><span class="line">  width: <span class="number">100%</span></span><br><span class="line">  display: flex</span><br><span class="line">  flex-direction: column</span><br><span class="line">  gap: <span class="number">10px</span></span><br><span class="line"></span><br><span class="line">.password-input-group</span><br><span class="line">  width: <span class="number">100%</span></span><br><span class="line">  display: flex</span><br><span class="line">  flex-direction: column</span><br><span class="line">  gap: <span class="number">10px</span></span><br><span class="line">  animation: fadeIn .<span class="number">3s</span> ease-in</span><br><span class="line"></span><br><span class="line">.password-input</span><br><span class="line">  width: <span class="number">100%</span></span><br><span class="line">  padding: <span class="number">12px</span> <span class="number">20px</span></span><br><span class="line">  font-size: <span class="number">15px</span></span><br><span class="line">  border: <span class="number">2px</span> solid <span class="number">#e0e0e0</span></span><br><span class="line">  border-radius: <span class="number">25px</span></span><br><span class="line">  outline: none</span><br><span class="line">  transition: border-color .<span class="number">3s</span> ease</span><br><span class="line">  box-sizing: border-box</span><br><span class="line"></span><br><span class="line">.password-input:focus</span><br><span class="line">  border-color: <span class="number">#3b8fc7</span></span><br><span class="line"></span><br><span class="line">.verification-status</span><br><span class="line">  margin-top: <span class="number">20px</span></span><br><span class="line">  padding: <span class="number">12px</span> <span class="number">20px</span></span><br><span class="line">  border-radius: <span class="number">8px</span></span><br><span class="line">  font-size: <span class="number">14px</span></span><br><span class="line">  display: none</span><br><span class="line">  max-width: <span class="number">300px</span></span><br><span class="line">  margin-left: auto</span><br><span class="line">  margin-right: auto</span><br><span class="line"></span><br><span class="line">.verification-status.info</span><br><span class="line">  background: <span class="number">#e7f3ff</span></span><br><span class="line">  color: <span class="number">#0066cc</span></span><br><span class="line">  border: <span class="number">1px</span> solid <span class="number">#b3d9ff</span></span><br><span class="line"></span><br><span class="line">.verification-status.success</span><br><span class="line">  background: <span class="number">#e6f9e6</span></span><br><span class="line">  color: <span class="number">#00aa00</span></span><br><span class="line">  border: <span class="number">1px</span> solid <span class="number">#b3e6b3</span></span><br><span class="line"></span><br><span class="line">.verification-status.error</span><br><span class="line">  background: <span class="number">#ffe6e6</span></span><br><span class="line">  color: <span class="number">#cc0000</span></span><br><span class="line">  border: <span class="number">1px</span> solid <span class="number">#ffb3b3</span></span><br><span class="line"></span><br><span class="line">.verification-status i</span><br><span class="line">  margin-right: <span class="number">8px</span></span><br><span class="line"></span><br><span class="line">.decrypted-content</span><br><span class="line">  animation: fadeIn .<span class="number">5s</span> ease-in</span><br><span class="line"></span><br><span class="line">@keyframes fadeIn</span><br><span class="line">  from</span><br><span class="line">    opacity: <span class="number">0</span></span><br><span class="line">    transform: <span class="built_in">translateY</span>(<span class="number">10px</span>)</span><br><span class="line">  to</span><br><span class="line">    opacity: <span class="number">1</span></span><br><span class="line">    transform: <span class="built_in">translateY</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">.encrypted-post-preview</span><br><span class="line">  padding: <span class="number">20px</span></span><br><span class="line">  background: <span class="number">#f8f9fa</span></span><br><span class="line">  border-radius: <span class="number">4px</span></span><br><span class="line">  color: <span class="number">#666</span></span><br><span class="line"></span><br><span class="line">.encrypted-status</span><br><span class="line">  display: flex</span><br><span class="line">  align-items: center</span><br><span class="line">  justify-content: center</span><br><span class="line">  gap: <span class="number">8px</span></span><br><span class="line">  font-size: <span class="number">15px</span></span><br><span class="line">  color: <span class="number">#888</span></span><br><span class="line"></span><br><span class="line">.encrypted-status i</span><br><span class="line">  color: <span class="number">#667eea</span></span><br><span class="line">  font-size: <span class="number">16px</span></span><br><span class="line"></span><br><span class="line">.encrypted-decrypted-preview</span><br><span class="line">  animation: fadeIn .<span class="number">5s</span> ease-in</span><br><span class="line">  line-height: <span class="number">1.8</span></span><br><span class="line">  color: <span class="number">#333</span></span><br><span class="line"></span><br><span class="line">.encrypted-lock-icon-index</span><br><span class="line">  color: <span class="number">#e74c3c</span></span><br><span class="line">  margin-right: <span class="number">8px</span></span><br><span class="line">  font-size: <span class="number">18px</span></span><br><span class="line">  vertical-align: baseline</span><br><span class="line">  position: relative</span><br><span class="line">  top: -<span class="number">1px</span></span><br><span class="line">  transition: color <span class="number">0.3s</span> ease</span><br><span class="line"></span><br><span class="line">.encrypted-lock-icon-index.decrypted</span><br><span class="line">  color: <span class="number">#27ae60</span></span><br><span class="line"></span><br><span class="line">.encrypted-lock-icon-small</span><br><span class="line">  color: <span class="number">#e74c3c</span></span><br><span class="line">  margin-right: <span class="number">6px</span></span><br><span class="line">  font-size: <span class="number">10px</span></span><br><span class="line">  vertical-align: baseline</span><br><span class="line">  position: relative</span><br><span class="line">  top: -<span class="number">1px</span></span><br><span class="line"></span><br><span class="line">.encrypted-lock-icon-small.decrypted</span><br><span class="line">    color: <span class="number">#27ae60</span></span><br><span class="line"></span><br><span class="line">@media (prefers-color-scheme: dark)</span><br><span class="line">  .encrypted-post-notice</span><br><span class="line">    background: transparent</span><br><span class="line"></span><br><span class="line">  .password-input</span><br><span class="line">    background: <span class="number">#374151</span></span><br><span class="line">    color: <span class="number">#f3f4f6</span></span><br><span class="line">    border-color: <span class="number">#4b5563</span></span><br><span class="line"></span><br><span class="line">  .password-input:focus</span><br><span class="line">    border-color: <span class="number">#3b8fc7</span></span><br><span class="line"></span><br><span class="line">  .encrypted-post-preview</span><br><span class="line">    background: <span class="number">#2d3748</span></span><br><span class="line">    color: <span class="number">#a0aec0</span></span><br><span class="line">  </span><br><span class="line">  .encrypted-status</span><br><span class="line">    color: <span class="number">#9ca3af</span></span><br><span class="line">  </span><br><span class="line">  .encrypted-status i</span><br><span class="line">    color: <span class="number">#9fa8da</span></span><br><span class="line">  </span><br><span class="line">  .encrypted-decrypted-preview</span><br><span class="line">    color: <span class="number">#e5e7eb</span></span><br><span class="line">  </span><br><span class="line">  .encrypted-lock-icon-index</span><br><span class="line">    color: <span class="number">#ff6b6b</span></span><br><span class="line">  </span><br><span class="line">  .encrypted-lock-icon-index.decrypted</span><br><span class="line">    color: <span class="number">#2ecc71</span></span><br><span class="line"></span><br><span class="line">  .encrypted-lock-icon-small</span><br><span class="line">    color: <span class="number">#ff6b6b</span></span><br><span class="line"></span><br><span class="line">  .encrypted-lock-icon-small.decrypted</span><br><span class="line">    color: <span class="number">#2ecc71</span></span><br></pre></td></tr></table></figure></div></div></div>

<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ul>
<li><code>encrypted</code>: å¯é€‰<ul>
<li><code>true</code> åŠ å¯†è¯¥æ–‡ç« </li>
<li><code>false</code> ä¸åŠ å¯†è¯¥æ–‡ç« </li>
</ul>
</li>
<li><code>password</code>: å¯é€‰</li>
</ul>
<div class="note info"><ul>
<li><code>encrypted</code> æ§åˆ¶æ–‡ç« æ˜¯å¦åŠ å¯†ï¼Œä½¿ç”¨å·²æ³¨å†Œçš„å®‰å…¨å¯†é’¥å¯ä»¥è§£å¯†æ‰€æœ‰åŠ å¯†æ–‡ç« ã€‚</li>
<li><code>password</code> å¢åŠ å¯†ç è§£å¯†çš„é€‰é¡¹ï¼Œå¯ä»¥æ¯ä¸ªæ–‡ç« ä¸åŒã€‚å®‰å…¨å¯†é’¥æˆ–è€…å¯†ç ä½¿ç”¨å…¶ä¸€å‡å¯ä»¥è§£å¯†ã€‚</li>
</ul>
</div>

<p>ä¸€ä¸ªå…¸å‹çš„æ–‡ç«  Markdown å¤´å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ–‡ç« æ ‡é¢˜</span></span><br><span class="line"><span class="attr">abbrlink:</span>  <span class="number">12345678</span></span><br><span class="line"><span class="attr">encrypted:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸ƒé›¶å…«ç¢"><a href="#ä¸ƒé›¶å…«ç¢" class="headerlink" title="ä¸ƒé›¶å…«ç¢"></a>ä¸ƒé›¶å…«ç¢</h2><h3 id="ä¿®è¡¥-head-unique-njk"><a href="#ä¿®è¡¥-head-unique-njk" class="headerlink" title="ä¿®è¡¥ head-unique.njk"></a>ä¿®è¡¥ head-unique.njk</h3><p>å› ä¸ºä½¿ç”¨ <code>generate</code> ç”Ÿæˆæ–‡ç«  HTML çš„æ—¶å€™ä¼šç”Ÿæˆä¸€äº› <code>meta</code> æ ‡ç­¾æ•°æ®ï¼Œå…¶ä¸­ä¼šåŒ…æ‹¬ <code>description</code> ä¿¡æ¯ï¼Œå¦‚æœæ–‡ç« å¤´éƒ¨æ²¡æœ‰ <code>description</code> å­—æ®µåˆ™ä¼šä½¿ç”¨æ­£æ–‡çš„éƒ¨åˆ†å†…å®¹ä½œä¸º <code>meta.description</code> è¿™æ ·ä¼šå¯¼è‡´æ–‡ç« éƒ¨åˆ†å†…å®¹æ³„éœ²åˆ° HTML ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œä¿®è¡¥ä¸€ä¸‹è¿™é‡Œçš„é€»è¾‘ï¼Œå¦‚æœæ˜¯åŠ å¯†æ–‡ç« åˆ™ä¸ç”Ÿæˆ <code>meta</code> æ ‡ç­¾</p>
<ul>
<li><code>./themes/next/layout/_partials/head/head-unique.njk</code> (ä¿®æ”¹)</li>
</ul>
<div class="tabs" id="head-unique.njk"><ul class="nav-tabs"><li class="tab active"><a href="#head-unique.njk-1"><i class="fa fa-code"></i>./themes/next/layout/_partials/head/head-unique.njk</a></li></ul><div class="tab-content"><div class="tab-pane active" id="head-unique.njk-1"><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;# åˆ¤æ–­æ–‡ç« æ˜¯å¦æ˜¯æ˜¯åŠ å¯†çš„ï¼Œå¦‚æœä¸æ˜¯åˆ™ç”Ÿæˆå¯¹åº”çš„ meta æ ‡ç­¾ #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> not page.encrypted %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-variable">&#123;&#123; open_graph() &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;# https://github.com/theme-next/hexo-theme-next/issues/866 #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name">set</span> canonical = url | replace(r/index\.html$/, &#x27;&#x27;) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> not config.permalink.endsWith(&#x27;.html&#x27;) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name">set</span> canonical = canonical | replace(r/\.html$/, &#x27;&#x27;) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;canonical&quot;</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; canonical &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;# Exports some front-matter variables to Front-End #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;# https://hexo.io/docs/variables.html #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; next_data(&#x27;page&#x27;, next_config_unique()) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; next_data(&#x27;calendar&#x27;,</span></span><br><span class="line"><span class="template-variable">  theme.calendar if page.type === &#x27;schedule&#x27; else &#x27;&#x27;)</span></span><br><span class="line"><span class="template-variable">&#125;&#125;</span></span><br></pre></td></tr></table></figure></div></div></div>


<h3 id="ä¿®è¡¥-post-njk"><a href="#ä¿®è¡¥-post-njk" class="headerlink" title="ä¿®è¡¥ post.njk"></a>ä¿®è¡¥ post.njk</h3><p>åŠ å¯†åçš„æ–‡ç« åœ¨é¦–é¡µé¢„è§ˆçš„æ—¶å€™ä¼šæ˜¾ç¤º <code>æ–‡ç« å·²åŠ å¯†</code> çš„æç¤ºå­—æ ·ã€‚åŒæ—¶å¦‚æœæ–‡ç« å·²ç»è§£å¯†ï¼Œåˆ™æ­£å¸¸å±•ç¤ºé¢„è§ˆéƒ¨åˆ† (å³ <code>&lt;!-- more --&gt;</code> ä¹‹å‰çš„å†…å®¹) </p>
<p>åŒæ—¶åœ¨é¦–é¡µæ–‡ç« æ ‡é¢˜å‰é¢å¢åŠ ä¸€æŠŠé”å›¾æ ‡ï¼Œæœªè§£å¯†æ—¶æ˜¯çº¢è‰²é”å®šå›¾æ ‡ï¼Œå·²è§£å¯†å˜ä¸ºç»¿è‰²å¼€é”å›¾æ ‡</p>
<ul>
<li><code>./themes/next/layout/_macro/post.njk</code> (ä¿®æ”¹)</li>
</ul>
<div class="tabs" id="post.njk"><ul class="nav-tabs"><li class="tab active"><a href="#post.njk-1"><i class="fa fa-code"></i>./themes/next/layout/_macro/post.njk</a></li></ul><div class="tab-content"><div class="tab-pane active" id="post.njk-1"><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;# POST BLOCK éƒ¨åˆ†çš„ä¿®æ”¹ #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;##################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;### POST BLOCK ###&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;##################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.header !== false %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;post-header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  &lt;</span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> is_index %&#125;</span><span class="language-xml">h2</span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml">h1</span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"> class=&quot;post-title</span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> post.direction and post.direction.toLowerCase() === &#x27;rtl&#x27; %&#125;</span><span class="language-xml"> rtl</span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml">&quot; itemprop=&quot;name headline&quot;&gt;</span></span><br><span class="line"><span class="language-xml">    </span><span class="comment">&#123;# Link posts #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.link %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.sticky &gt; 0 %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-sticky-flag&quot;</span> <span class="attr">title</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; __(&#x27;post.sticky&#x27;) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbtack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name">set</span> postTitleIcon = &#x27;&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&#x27; %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name">set</span> postText = post.title or post.link %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;- next_url(post.link, postText + postTitleIcon, &#123;class: &#x27;post-title-link post-title-link-external&#x27;, itemprop: &#x27;url&#x27;&#125;) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">elif</span></span> is_index %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.sticky &gt; 0 %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-sticky-flag&quot;</span> <span class="attr">title</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; __(&#x27;post.sticky&#x27;) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumbtack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="comment">&#123;# å¢åŠ å¯¹åŠ å¯†æ–‡ç« çš„åˆ¤æ–­ #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.encrypted %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-lock encrypted-lock-icon-index&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lock-icon-</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">data-abbrlink</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;- next_url(post.path, post.title or __(&#x27;post.untitled&#x27;), &#123;class: &#x27;post-title-link&#x27;, itemprop: &#x27;url&#x27;&#125;) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;- post.title &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123;- post_edit(post.source) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  &lt;/</span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> is_index %&#125;</span><span class="language-xml">h2</span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml">h1</span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml">&gt;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123; partial(&#x27;_partials/post/post-meta.njk&#x27;) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.description and (not theme.excerpt_description or not is_index) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-description&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123; post.description &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;# POST BODY éƒ¨åˆ†çš„ä¿®æ”¹ #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;#################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;### POST BODY ###&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="comment">&#123;#################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-body</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> post.direction and post.direction.toLowerCase() === &#x27;rtl&#x27; %&#125;</span><span class="language-xml"><span class="tag"><span class="string"> rtl</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;articleBody&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> is_index %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.encrypted %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;encrypted-post-preview&quot;</span> <span class="attr">id</span>=<span class="string">&quot;encrypted-preview-</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">data-abbrlink</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;encrypted-status&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-shield-alt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> æ–‡ç« å·²åŠ å¯†</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;encrypted-decrypted-preview&quot;</span> <span class="attr">id</span>=<span class="string">&quot;decrypted-preview-</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> theme.read_more_btn %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-button&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; url_for(post.path) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-variable">&#123;&#123; __(&#x27;post.read_more&#x27;) &#125;&#125;</span><span class="language-xml"> <span class="symbol">&amp;raquo;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--/noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">const</span> cacheKey = <span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml">&quot;;</span></span><br><span class="line"><span class="language-xml">          try &#123;</span></span><br><span class="line"><span class="language-xml">            const cached = localStorage.getItem(cacheKey);</span></span><br><span class="line"><span class="language-xml">            if (!cached) return;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            const &#123; html, expired &#125; = JSON.parse(cached);</span></span><br><span class="line"><span class="language-xml">            if (Date.now() &gt;= expired) &#123;</span></span><br><span class="line"><span class="language-xml">              localStorage.removeItem(cacheKey);</span></span><br><span class="line"><span class="language-xml">              return;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            const tempDiv = document.createElement(&quot;div&quot;);</span></span><br><span class="line"><span class="language-xml">            tempDiv.innerHTML = html;</span></span><br><span class="line"><span class="language-xml">            const moreElement = tempDiv.querySelector(&quot;#more&quot;);</span></span><br><span class="line"><span class="language-xml">            </span></span><br><span class="line"><span class="language-xml">            let preview = &quot;&quot;;</span></span><br><span class="line"><span class="language-xml">            if (moreElement) &#123;</span></span><br><span class="line"><span class="language-xml">              const range = document.createRange();</span></span><br><span class="line"><span class="language-xml">              range.setStartBefore(tempDiv.firstChild);</span></span><br><span class="line"><span class="language-xml">              range.setEndBefore(moreElement);</span></span><br><span class="line"><span class="language-xml">              preview = range.cloneContents().textContent.trim();</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">            </span></span><br><span class="line"><span class="language-xml">            if (!preview) &#123;</span></span><br><span class="line"><span class="language-xml">              const text = tempDiv.textContent.trim();</span></span><br><span class="line"><span class="language-xml">              preview = text ? text.substring(0, 200) + (text.length &gt; 200 ? &quot;...&quot; : &quot;&quot;) : &quot;æš‚æ— é¢„è§ˆ&quot;;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            const previewEl = document.getElementById(&quot;decrypted-preview-</span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml">&quot;);</span></span><br><span class="line"><span class="language-xml">            const encryptedEl = document.getElementById(&quot;encrypted-preview-</span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml">&quot;);</span></span><br><span class="line"><span class="language-xml">            </span></span><br><span class="line"><span class="language-xml">            if (previewEl) &#123;</span></span><br><span class="line"><span class="language-xml">              previewEl.textContent = preview;</span></span><br><span class="line"><span class="language-xml">              previewEl.style.display = &quot;block&quot;;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">            if (encryptedEl) encryptedEl.style.display = &quot;none&quot;;</span></span><br><span class="line"><span class="language-xml">          &#125; catch (e) &#123;&#125;</span></span><br><span class="line"><span class="language-xml">        &#125;)();</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">elif</span></span> post.description and theme.excerpt_description %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; post.description &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> theme.read_more_btn %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-button&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; url_for(post.path) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-variable">&#123;&#123; __(&#x27;post.read_more&#x27;) &#125;&#125;</span><span class="language-xml"> <span class="symbol">&amp;raquo;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--/noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">elif</span></span> post.excerpt %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123; post.excerpt &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> theme.read_more_btn %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-button&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; url_for(post.path) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">#more&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;contents&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-variable">&#123;&#123; __(&#x27;post.read_more&#x27;) &#125;&#125;</span><span class="language-xml"> <span class="symbol">&amp;raquo;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--/noindex--&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123; post.content &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123; post.content | safe &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div></div></div>

<h3 id="ä¿®è¡¥-post-collapse-njk"><a href="#ä¿®è¡¥-post-collapse-njk" class="headerlink" title="ä¿®è¡¥ post-collapse.njk"></a>ä¿®è¡¥ post-collapse.njk</h3><p>é™¤äº†é¦–é¡µå¢åŠ é”å›¾æ ‡ï¼Œåœ¨å½’æ¡£é¡µé¢å¢åŠ åŒæ ·çš„é€»è¾‘</p>
<ul>
<li><code>./themes/next/layout/_macro/post-collapse.njk</code> (ä¿®æ”¹)</li>
</ul>
<div class="tabs" id="post-collapse.njk"><ul class="nav-tabs"><li class="tab active"><a href="#post-collapse.njk-1"><i class="fa fa-code"></i>./themes/next/layout/_macro/post-collapse.njk</a></li></ul><div class="tab-content"><div class="tab-pane active" id="post-collapse.njk-1"><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">macro</span> render(posts) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name">set</span> current_year = &#x27;1970&#x27; %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">for</span></span> post <span class="keyword">in</span> posts.toArray() %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name">set</span> year = date(post.date, &#x27;YYYY&#x27;) %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> year !== current_year %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-tag">&#123;%- <span class="name">set</span> current_year = year %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;collection-year&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;collection-header&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123; current_year &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">article</span> <span class="attr">itemscope</span> <span class="attr">itemtype</span>=<span class="string">&quot;http://schema.org/Article&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;post-header&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">time</span> <span class="attr">itemprop</span>=<span class="string">&quot;dateCreated&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">datetime</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; moment(post.date).format() &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">content</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; date(post.date, config.date_format) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-variable">&#123;&#123; date(post.date, &#x27;MM-DD&#x27;) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">time</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-title&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.link %&#125;</span><span class="comment">&#123;# Link posts #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-tag">&#123;%- <span class="name">set</span> postTitleIcon = &#x27;&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&#x27; %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-tag">&#123;%- <span class="name">set</span> postText = post.title or post.link %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="template-variable">&#123;&#123; next_url(post.link, postText + postTitleIcon, &#123;class: &#x27;post-title-link post-title-link-external&#x27;, itemprop: &#x27;url&#x27;&#125;) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;post-title-link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; url_for(post.path) &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">itemprop</span>=<span class="string">&quot;url&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span><span class="comment">&#123;########################################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            </span><span class="comment">&#123;########### å¢åŠ å¯¹åŠ å¯†æ–‡ç« çš„åˆ¤æ–­ ##########&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            </span><span class="comment">&#123;########################################&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-tag">&#123;%- <span class="name"><span class="name">if</span></span> post.encrypted %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-lock encrypted-lock-icon-small&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lock-icon-small-</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">const</span> cacheKey = <span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml">&quot;;</span></span><br><span class="line"><span class="language-xml">                try &#123;</span></span><br><span class="line"><span class="language-xml">                  const cached = localStorage.getItem(cacheKey);</span></span><br><span class="line"><span class="language-xml">                  if (!cached) return;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                  const &#123; expired &#125; = JSON.parse(cached);</span></span><br><span class="line"><span class="language-xml">                  if (Date.now() &gt;= expired) &#123;</span></span><br><span class="line"><span class="language-xml">                    localStorage.removeItem(cacheKey);</span></span><br><span class="line"><span class="language-xml">                    return;</span></span><br><span class="line"><span class="language-xml">                  &#125;</span></span><br><span class="line"><span class="language-xml">                    </span></span><br><span class="line"><span class="language-xml">                  const lockIcon = document.getElementById(&quot;lock-icon-small-</span><span class="template-variable">&#123;&#123; post.abbrlink &#125;&#125;</span><span class="language-xml">&quot;);</span></span><br><span class="line"><span class="language-xml">                  if (lockIcon) &#123;</span></span><br><span class="line"><span class="language-xml">                    lockIcon.classList.add(&#x27;decrypted&#x27;);</span></span><br><span class="line"><span class="language-xml">                    lockIcon.className = lockIcon.className.replace(&#x27;fa-lock&#x27;, &#x27;fa-unlock&#x27;);</span></span><br><span class="line"><span class="language-xml">                  &#125;</span></span><br><span class="line"><span class="language-xml">                &#125; catch (e) &#123;&#125;</span></span><br><span class="line"><span class="language-xml">              &#125;)();</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">itemprop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123; post.title or __(&#x27;post.untitled&#x27;) &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="template-tag">&#123;%- <span class="name"><span class="name">endif</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      </span><span class="template-variable">&#123;&#123; post_gallery(post.photos) &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;%- <span class="name"><span class="name">endfor</span></span> %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">endmacro</span> %&#125;</span></span><br></pre></td></tr></table></figure></div></div></div>]]></content>
  </entry>
  <entry>
    <title>Hexo é™æ€åšå®¢ä½¿ç”¨ Cloudflare Turnstile</title>
    <url>/post/50a431e6.html</url>
    <content><![CDATA[<p>åœ¨ <a href="/post/ec93b507.html" title="Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†">Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†</a> ä¸€æ–‡ä¸­ã€‚ä½¿ç”¨ Workers æ­å»ºäº†ä¸€ä¸ª Images ä»£ç†ï¼Œé€šè¿‡è®¾ç½® <code>Referer</code> å’Œ URL ç­¾åæœ‰æ•ˆæœŸå®ç°ç®€æ˜“çš„é˜²ç›—é“¾ä»¥åŠé˜²åˆ·æµé‡ã€‚ä½†æ˜¯è¿™äº›æªæ–½åªèƒ½åšåˆ°é˜²å›å­ä¸é˜²å°äººï¼Œå…¶å®å¾ˆè½»æ˜“çš„å°±å¯ä»¥é€šè¿‡ä»£ç è‡ªåŠ¨å®ç°åˆ·å›¾ç‰‡æµé‡ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæƒ³ç€èƒ½ä¸èƒ½ä½¿ç”¨ <code>Cloudflare Turnstile</code> é˜»æŒ¡éäººç±»è¯·æ±‚çš„æµé‡ã€‚ä½†æ˜¯ç ”ç©¶äº†ä¸€ä¸‹å‘ç° <code>Cloudflare Turnstile</code> éœ€è¦ <strong><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3R1cm5zdGlsZS9nZXQtc3RhcnRlZC9zZXJ2ZXItc2lkZS12YWxpZGF0aW9uLw==">æœåŠ¡ç«¯ä»£ç éªŒè¯<i class="fa fa-external-link-alt"></i></span></strong> ä½†æ˜¯å¾ˆæ˜¾ç„¶ï¼Œ<code>Hexo</code> è¿™ç§çº¯é™æ€åšå®¢æ²¡æœ‰åç«¯æœåŠ¡ï¼Œæ‰€ä»¥æ€ç´¢äº†ä¸€ä¸‹å†³å®šè¿˜æ˜¯ä½¿ç”¨ Workers å®ç°ä¸€ä¸ªæ”¯æŒé™æ€ç½‘é¡µçš„ <code>Cloudflare Turnstile</code> æ–¹æ¡ˆã€‚</p>
<span id="more"></span>

<p>æ€è·¯å°±æ˜¯å°†åŸå§‹åšå®¢é€šè¿‡ <code>Cloudflare Pages</code> æ‰˜ç®¡å¹¶ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰åŸŸåæ¯”å¦‚ <code>source.example.com</code> ä½œä¸ºé™æ€é¡µé¢çš„æºç«™ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ª blog çš„ Workers (ç»‘å®šè‡ªå®šä¹‰åŸŸå <code>blog.example.com</code>) ä½œä¸ºä»£ç†ç«™ï¼Œåœ¨è¿™ä¸ª blog çš„ Workers ä¸­å®ç° <code>Cloudflare Turnstile</code> çš„æœåŠ¡ç«¯éªŒè¯é€»è¾‘ï¼ŒéªŒè¯é€šè¿‡åˆ™æ³¨å…¥ä¸€ä¸ª <code>JWT Token</code> å®ç°åœ¨æœ‰æ•ˆæœŸå†…å°±æ— éœ€å†æ¬¡éªŒè¯ã€‚</p>
<ol>
<li>æ‰“å¼€ <span class="exturl" data-url="aHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tLw==">Cloudflare Dashboard<i class="fa fa-external-link-alt"></i></span> ç‚¹å‡»å·¦ä¾§çš„ <strong>Turnstile</strong> åœ¨å³ä¾§ç‚¹å‡» <strong>æ·»åŠ å°ç»„ä»¶</strong><img src="https://images.zabrian.com/d0a19b46-f067-4866-2f22-f3d224d3a301/origin" title="Turnstile é¦–é¡µ" style="zoom:16%;" /></li>
<li>æŒ‰ç…§å®é™…æƒ…å†µå¡«å†™ä¿¡æ¯ï¼ŒåŸŸååˆ™æ·»åŠ é™æ€é¡µé¢çš„ä»£ç†åŸŸå (ä¸Šæ–‡ä¸­çš„ <code>blog.example.com</code> è€Œä¸æ˜¯ <code>source.example.com</code>)ï¼Œä¸‹æ–¹é€‰æ‹© <strong>æ‰˜ç®¡</strong> å’Œ <strong>å¦</strong><img src="https://images.zabrian.com/b0bdf585-c029-4e0c-ffb8-6b1fe7c34401/origin" title="Turnstile æ·»åŠ ç»„ä»¶" style="zoom:16%;" /></li>
<li>æ·»åŠ å®Œæˆåç¡®è®¤å·²ç»æ·»åŠ æ­£ç¡®çš„åŸŸåï¼Œå¹¶ä¸”ç”Ÿæˆä¸¤ä¸ªéœ€è¦ç”¨åˆ°çš„æ•°æ®: <strong>ç«™ç‚¹å¯†é’¥</strong> å’Œ <strong>å¯†é’¥</strong> æ— éœ€é©¬ä¸Šè®°ä¸‹æ¥ï¼Œåç»­è¿˜å¯ä»¥å†æ¬¡æŸ¥çœ‹ã€‚<img src="https://images.zabrian.com/517237f3-678a-463f-a7f8-8fd73f39cf01/origin" title="æŸ¥çœ‹ä¿¡æ¯" style="zoom:16%;" /></li>
<li>é…ç½® <code>Cloudflare Pages</code> æºç«™ç‚¹ç»‘å®š <code>source.example.com</code> åŸŸåï¼Œå¹¶ç¡®è®¤æºç«™ç‚¹å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</li>
<li>æ·»åŠ è‡ªå®šä¹‰ Workers ä½¿ç”¨ä¸‹æ–¹ä»£ç ï¼Œæ›¿æ¢ä¸ºå®é™…çš„å†…å®¹ã€‚ç»‘å®šè‡ªå®šä¹‰åŸŸå <code>blog.example.com</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é…ç½®å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">BLOG_SOURCE</span>: <span class="string">&quot;https://source.example.com&quot;</span>, <span class="comment">// é™æ€é¡µé¢æºç«™ URLï¼Œè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">  <span class="attr">TURNSTILE_URL</span>: <span class="string">&quot;https://challenges.cloudflare.com/turnstile/v0/siteverify&quot;</span>, <span class="comment">// Turnstile éªŒè¯åœ°å€</span></span><br><span class="line">  <span class="attr">TURNSTILE_SITEKEY</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// Turnstile ç«™ç‚¹å¯†é’¥ï¼Œæ ¹æ®å®é™…ä¿®æ”¹</span></span><br><span class="line">  <span class="attr">TURNSTILE_SECRET</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// Turnstile å¯†é’¥ï¼Œæ ¹æ®å®é™…ä¿®æ”¹</span></span><br><span class="line">  <span class="attr">JWT_SECRET</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// JWT å¯†é’¥ï¼Œå¯é€šè¿‡å‘½ä»¤ç”Ÿæˆ openssl rand -base64 48</span></span><br><span class="line">  <span class="attr">COOKIE_NAME</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// æ³¨å…¥çš„ JWT Token cookie åå­—ï¼Œå¯è‡ªå®šä¹‰</span></span><br><span class="line">  <span class="attr">COOKIE_EXPIRE</span>: <span class="number">3600</span>, <span class="comment">// Turnstile æœ‰æ•ˆæœŸ 1 å°æ—¶ï¼Œå¯è‡ªå®šä¹‰</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆ JWT token</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateToken</span>(<span class="params">payload</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> header = &#123; <span class="attr">alg</span>: <span class="string">&quot;HS256&quot;</span>, <span class="attr">typ</span>: <span class="string">&quot;JWT&quot;</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> encodedHeader = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(header)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> encodedPayload = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(payload)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;encodedHeader&#125;</span>.<span class="subst">$&#123;encodedPayload&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    encoder.<span class="title function_">encode</span>(<span class="variable constant_">CONFIG</span>.<span class="property">JWT_SECRET</span>),</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(<span class="string">&quot;HMAC&quot;</span>, key, encoder.<span class="title function_">encode</span>(data));</span><br><span class="line">  <span class="keyword">const</span> encodedSignature = <span class="title function_">btoa</span>(</span><br><span class="line">    <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(...<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(signature))</span><br><span class="line">  ).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;data&#125;</span>.<span class="subst">$&#123;encodedSignature&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ JWT token</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyToken</span>(<span class="params">token</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è·å–: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parts = token.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (parts.<span class="property">length</span> !== <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [header, payload, signature] = parts;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;payload&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">      <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">      encoder.<span class="title function_">encode</span>(<span class="variable constant_">CONFIG</span>.<span class="property">JWT_SECRET</span>),</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      [<span class="string">&quot;verify&quot;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSignature = <span class="title class_">Uint8Array</span>.<span class="title function_">from</span>(</span><br><span class="line">      <span class="title function_">atob</span>(signature + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (signature.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>)),</span><br><span class="line">      <span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">verify</span>(</span><br><span class="line">      <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">      key,</span><br><span class="line">      expectedSignature,</span><br><span class="line">      encoder.<span class="title function_">encode</span>(data)</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token æœ‰æ•ˆ: <span class="subst">$&#123;isValid&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isValid) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decodedPayload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">      <span class="title function_">atob</span>(payload + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (payload.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è§£ç : <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decodedPayload)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> isExpired = decodedPayload.<span class="property">exp</span> &gt; <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è¿‡æœŸ: <span class="subst">$&#123;!isExpired&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> isExpired;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token å¤±è´¥: <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turnstile HTML é¡µé¢</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTurnstileHTML</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;å®‰å…¨éªŒè¯ - Zabrian&#x27;s Blog&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;script src=&quot;https://challenges.cloudflare.com/turnstile/v0/api.js&quot; async defer&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    body &#123; font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; &#125;</span></span><br><span class="line"><span class="string">    .container &#123; background: white; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); padding: 40px; width: 400px; min-height: 300px; text-align: center; box-sizing: border-box; &#125;</span></span><br><span class="line"><span class="string">    .logo &#123; font-size: 24px; font-weight: bold; color: #333; margin-bottom: 24px; &#125;</span></span><br><span class="line"><span class="string">    .title &#123; color: #333; margin-bottom: 16px; font-size: 18px; font-weight: 500; &#125;</span></span><br><span class="line"><span class="string">    .description &#123; color: #666; margin-bottom: 24px; font-size: 14px; line-height: 1.5; &#125;</span></span><br><span class="line"><span class="string">    .turnstile-container &#123; display: flex; justify-content: center; align-items: center; margin: 20px 0; min-height: 65px; width: 100%; &#125;</span></span><br><span class="line"><span class="string">    .cf-turnstile &#123; margin: 0 auto; &#125;</span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;logo&quot;&gt;Zabrian&#x27;s Blog&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class=&quot;title&quot;&gt;å®‰å…¨éªŒè¯&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;description&quot;&gt;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­è®¿é—®&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;turnstile-container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-turnstile&quot; data-sitekey=&quot;<span class="subst">$&#123;CONFIG.TURNSTILE_SITEKEY&#125;</span>&quot; data-callback=&quot;onSuccess&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;script&gt;function onSuccess()&#123;document.querySelector(&#x27;form&#x27;).submit();&#125;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ Turnstile Response</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyTurnstile</span>(<span class="params">response, remoteip</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile è´¨è¯¢: <span class="subst">$&#123;remoteip&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;secret&quot;</span>, <span class="variable constant_">CONFIG</span>.<span class="property">TURNSTILE_SECRET</span>);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;response&quot;</span>, response);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;remoteip&quot;</span>, remoteip);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> verifyResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">CONFIG</span>.<span class="property">TURNSTILE_URL</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: formData,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> verifyResponse.<span class="title function_">json</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile ç»“æœ: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> result.<span class="property">success</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡ JWT éªŒè¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">isVerifiedToken</span>(<span class="params">request</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cookie = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Cookie&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> match = cookie.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="variable constant_">CONFIG</span>.<span class="property">COOKIE_NAME</span> + <span class="string">&quot;=([^;]+)&quot;</span>));</span><br><span class="line">  <span class="keyword">if</span> (!match) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = match[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">verifyToken</span>(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®éªŒè¯æˆåŠŸçš„ Cookie</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setSuccessResponse</span>(<span class="params">targetPath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123;</span><br><span class="line">    <span class="attr">verified</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">iat</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>),</span><br><span class="line">    <span class="attr">exp</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + <span class="variable constant_">CONFIG</span>.<span class="property">COOKIE_EXPIRE</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">await</span> <span class="title function_">generateToken</span>(payload);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Cookie è®¾ç½®: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">302</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Location</span>: targetPath,</span><br><span class="line">      <span class="string">&quot;Set-Cookie&quot;</span>: <span class="string">`<span class="subst">$&#123;CONFIG.COOKIE_NAME&#125;</span>=<span class="subst">$&#123;token&#125;</span>; Path=/; Max-Age=<span class="subst">$&#123;CONFIG.COOKIE_EXPIRE&#125;</span>; HttpOnly; SameSite=Lax; Secure`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request, env, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²éªŒè¯</span></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">isVerifiedToken</span>(request))) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†è´¨è¯¢è¯·æ±‚</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">await</span> request.<span class="title function_">formData</span>();</span><br><span class="line">        <span class="keyword">const</span> remoteip = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;CF-Connecting-IP&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> response = formData.<span class="title function_">get</span>(<span class="string">&quot;cf-turnstile-response&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">verifyTurnstile</span>(response, remoteip)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">setSuccessResponse</span>(url.<span class="property">pathname</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;éªŒè¯å¤±è´¥&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ˜¾ç¤ºéªŒè¯é¡µé¢</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·³è½¬ Turnstile é¡µé¢&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="title function_">getTurnstileHTML</span>(), &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html; charset=utf-8&quot;</span> &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»£ç†åˆ°æºç«™</span></span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable constant_">CONFIG</span>.<span class="property">BLOG_SOURCE</span> + url.<span class="property">pathname</span> + url.<span class="property">search</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ä»£ç†æºç«™: <span class="subst">$&#123;target&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(target, request);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œå°±å®ç°äº†é€šè¿‡è®¿é—® <code>blog.example.com</code> æ˜¾ç¤ºä¸€ä¸ªéªŒè¯é¡µé¢çš„æ•ˆæœã€‚<br><img src="https://images.zabrian.com/028c5ff7-7939-4fd4-dc38-3de8f13f4801/origin" title="Turnstile éªŒè¯é¡µé¢" style="zoom:100%;" /><br>éªŒè¯é€šè¿‡åå³å¯è®¿é—®é™æ€é¡µé¢ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ä¿®æ”¹ä»£ç ä¸­çš„ <code>COOKIE_EXPIRE</code> è‡ªè¡Œè°ƒæ•´éªŒè¯é—´éš”æ—¶é—´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæºç«™ç‚¹çš„ URL ä¸æš´éœ²ï¼Œåªé€šè¿‡ä»£ç†ç«™ç‚¹çš„ URL è®¿é—®ï¼Œå³å¯å®ç°å®šæœŸé€šè¿‡ <code>Cloudflare Turnstile</code> é¿å…å¤§é‡æœºå™¨æµé‡ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>NexT ä¸»é¢˜é«˜çº§æ ‡ç­¾æ’ä»¶</title>
    <url>/post/daa7f9d2.html</url>
    <content><![CDATA[<p>Hexo NexT ä¸»é¢˜æä¾›äº†ä¸€ç³»åˆ—çš„é«˜çº§çš„æ ‡ç­¾æ’ä»¶ï¼Œå¯ä»¥ç®€å•çš„å®ç°ä¸€äº›å¤æ‚çš„åŠŸèƒ½ã€‚</p>
<span id="more"></span>

<h1 id="æŒ‰é’®-Button"><a href="#æŒ‰é’®-Button" class="headerlink" title="æŒ‰é’® Button"></a>æŒ‰é’® Button</h1><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">button</span> url, text, icon [class], [title] %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> url, text, icon [class], [title] %&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>url</code>: ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„çš„ URL</li>
<li><code>text</code>: æŒ‰é’®æ–‡æœ¬ã€‚å¦‚æœæœªæŒ‡å®šå›¾æ ‡ï¼Œåˆ™ä¸ºå¿…å¡«é¡¹</li>
<li><code>icon</code>: <span class="exturl" data-url="aHR0cHM6Ly9mb250YXdlc29tZS5jb20vdjQvaWNvbnM=">FontAwesome<i class="fa fa-external-link-alt"></i></span> å›¾æ ‡ã€‚å¦‚æœæœªæŒ‡å®šæ–‡æœ¬ï¼Œåˆ™ä¸ºå¿…å¡«é¡¹</li>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>fa-fw</code>; å¯é€‰: <code>fa-fw</code> | <code>fa-lg</code> | <code>fa-2x</code> | <code>fa-3x</code> | <code>fa-4x</code> | <code>fa-5x</code></li>
<li><code>[title]</code>: å¯é€‰å‚æ•°; é¼ æ ‡æ‚¬åœæ—¶æç¤º</li>
</ul>
<h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">button</span> #, æŒ‰é’®æ–‡æœ¬ %&#125;</span></span><br></pre></td></tr></table></figure>
<a class="btn" href="#">æŒ‰é’®æ–‡æœ¬</a>

<figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">btn</span> #, æŒ‰é’®æ–‡æœ¬ %&#125;</span><span class="language-xml"> </span><span class="template-tag">&#123;% <span class="name">btn</span> #, æŒ‰é’®æ–‡æœ¬ &amp; æŒ‰é’®æ ‡é¢˜,, æŒ‰é’®æ ‡é¢˜ %&#125;</span></span><br></pre></td></tr></table></figure>
<a class="btn" href="#">æŒ‰é’®æ–‡æœ¬</a> <a class="btn" href="#" title="æŒ‰é’®æ ‡é¢˜">æŒ‰é’®æ–‡æœ¬ & æŒ‰é’®æ ‡é¢˜</a>

<figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">btn</span> #,, home %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> #,, home fa-lg %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> #,, home fa-2x %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> #,, home fa-3x %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> #,, home fa-4x %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">btn</span> #,, home fa-5x %&#125;</span></span><br></pre></td></tr></table></figure>
<a class="btn" href="#"><i class="fa fa-home"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-lg"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-2x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-3x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-4x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-5x"></i></a>

<figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">btn</span> #, æŒ‰é’®æ–‡æœ¬, home %&#125;</span></span><br></pre></td></tr></table></figure>
<a class="btn" href="#"><i class="fa fa-home"></i>æŒ‰é’®æ–‡æœ¬</a>

<h1 id="ç¬”è®°-Note"><a href="#ç¬”è®°-Note" class="headerlink" title="ç¬”è®° Note"></a>ç¬”è®° Note</h1><h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><figure class="highlight yml"><figcaption><span>NexT _config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Note tag (bootstrap callout)</span></span><br><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bootstrap callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bootstrap callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">modern</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">note</span> [class] [no-icon] [summary] %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ç¬”è®°å†…å®¹</span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">endnote</span> %&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>default</code>; å¯é€‰: <code>default</code> | <code>primary</code> | <code>success</code> | <code>info</code> | <code>warning</code> | <code>danger</code></li>
<li><code>[no-icon]</code>: å¯é€‰å‚æ•°; ç¦ç”¨ icon</li>
<li><code>[summary]</code>: å¯é€‰å‚æ•°; ç¬”è®°æ‘˜è¦</li>
</ul>
<h2 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="note default"><p>default æ ·ä¾‹</p>
</div>
<div class="note primary"><p>primary æ ·ä¾‹</p>
</div>
<div class="note success"><p>success æ ·ä¾‹</p>
</div>
<div class="note info"><p>info æ ·ä¾‹</p>
</div>
<div class="note warning"><p>warning æ ·ä¾‹</p>
</div>
<div class="note danger"><p>danger æ ·ä¾‹</p>
</div>

<h1 id="æ ‡ç­¾é¡µ-Tabs"><a href="#æ ‡ç­¾é¡µ-Tabs" class="headerlink" title="æ ‡ç­¾é¡µ Tabs"></a>æ ‡ç­¾é¡µ Tabs</h1><h2 id="è®¾ç½®-1"><a href="#è®¾ç½®-1" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><figure class="highlight yml"><figcaption><span>NexT _config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tabs tag</span></span><br><span class="line"><span class="attr">tabs:</span></span><br><span class="line">  <span class="comment"># Make the nav bar of tabs with long content stick to the top.</span></span><br><span class="line">  <span class="attr">sticky:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">transition:</span></span><br><span class="line">    <span class="attr">tabs:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">labels:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ³•-2"><a href="#ç”¨æ³•-2" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">tabs</span> Unique name, [index] %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- tab [Tab caption] [@icon] --&gt;</span></span></span><br><span class="line"><span class="language-xml">  æ ‡ç­¾é¡µå†…å®¹</span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- endtab --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">endtabs</span> %&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>Unique name</code>: å½“å‰é¡µé¢ä¸‹å”¯ä¸€åç§°</li>
<li><code>[index]</code>: æ´»åŠ¨æ ‡ç­¾é¡µç´¢å¼•</li>
<li><code>[Tab caption]</code>: æ ‡ç­¾é¡µæ ‡é¢˜</li>
<li><code>[@icon]</code>: <span class="exturl" data-url="aHR0cHM6Ly9mb250YXdlc29tZS5jb20vdjQvaWNvbnM=">FontAwesome<i class="fa fa-external-link-alt"></i></span> å›¾æ ‡</li>
</ul>
<h2 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="tabs" id="æ ‡ç­¾é¡µ"><ul class="nav-tabs"><li class="tab active"><a href="#æ ‡ç­¾é¡µ-1"><i class="fa fa-table"></i>è¡¨æ ¼</a></li><li class="tab"><a href="#æ ‡ç­¾é¡µ-2"><i class="fa fa-code"></i>ä»£ç å—</a></li><li class="tab"><a href="#æ ‡ç­¾é¡µ-3"><i class="fa fa-camera"></i>å›¾ç‰‡</a></li></ul><div class="tab-content"><div class="tab-pane active" id="æ ‡ç­¾é¡µ-1"><table>
<thead>
<tr>
<th align="left">å·¦å¯¹é½åˆ—</th>
<th align="right">å³å¯¹é½åˆ—</th>
<th align="center">å±…ä¸­åˆ—</th>
</tr>
</thead>
<tbody><tr>
<td align="left">11</td>
<td align="right">12</td>
<td align="center">13</td>
</tr>
<tr>
<td align="left">21</td>
<td align="right">22</td>
<td align="center">23</td>
</tr>
<tr>
<td align="left">31</td>
<td align="right">32</td>
<td align="center">33</td>
</tr>
</tbody></table></div><div class="tab-pane" id="æ ‡ç­¾é¡µ-2"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">    a,b = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        a,b = b,a+b</span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="æ ‡ç­¾é¡µ-3"><p>  <img src="https://images.zabrian.com/e9347cac-bb91-4e23-392c-536d7ae0b401/origin"></p></div></div></div>

<h1 id="æ–‡æœ¬æ ‡ç­¾-Label"><a href="#æ–‡æœ¬æ ‡ç­¾-Label" class="headerlink" title="æ–‡æœ¬æ ‡ç­¾ Label"></a>æ–‡æœ¬æ ‡ç­¾ Label</h1><h2 id="ç”¨æ³•-3"><a href="#ç”¨æ³•-3" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">label</span> [class]@text %&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>default</code>; å¯é€‰: <code>default</code> | <code>primary</code> | <code>success</code> | <code>info</code> | <code>warning</code> | <code>danger</code></li>
<li><code>text</code>: æ ‡ç­¾æ–‡æœ¬</li>
</ul>
<h2 id="ä¾‹å­-3"><a href="#ä¾‹å­-3" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>æ›²æ›²æŠ˜æŠ˜çš„è·å¡˜ä¸Šé¢ï¼Œå¼¥æœ›æ—³æ˜¯ç”°ç”°çš„å¶å­ã€‚å¶å­å‡ºæ°´å¾ˆé«˜ï¼Œåƒ<mark class="label default">äº­äº­æ—³èˆå¥³æ—³è£™</mark>ã€‚<br>å±‚å±‚çš„å¶å­ä¸­é—´ï¼Œé›¶æ˜Ÿåœ°ç‚¹ç¼€ç€äº›ç™½èŠ±ï¼Œæœ‰è¢…å¨œåœ°å¼€ç€æ—³ï¼Œæœ‰ç¾æ¶©åœ°æ‰“ç€æœµå„¿æ—³ï¼›æ­£å¦‚<mark class="label primary">ä¸€ç²’ç²’çš„æ˜ç </mark>ï¼Œåˆå¦‚<mark class="label success">ç¢§å¤©é‡Œçš„æ˜Ÿæ˜Ÿ</mark>ï¼Œåˆå¦‚<mark class="label info">åˆšå‡ºæµ´çš„ç¾äºº</mark>ã€‚<br>å¾®é£è¿‡å¤„ï¼Œé€æ¥ç¼•ç¼•æ¸…é¦™ï¼Œ<mark class="label warning">ä»¿ä½›è¿œå¤„é«˜æ¥¼ä¸Šæ¸ºèŒ«çš„æ­Œå£°ä¼¼çš„</mark>ã€‚è¿™æ—¶å€™å¶å­ä¸èŠ±ä¹Ÿæœ‰ä¸€ä¸çš„é¢¤åŠ¨ï¼Œåƒé—ªç”µèˆ¬ï¼Œéœæ—¶ä¼ è¿‡è·å¡˜çš„é‚£è¾¹å»äº†ã€‚<br>å¶å­æœ¬æ˜¯è‚©å¹¶è‚©å¯†å¯†åœ°æŒ¨ç€ï¼Œè¿™ä¾¿å®›ç„¶æœ‰äº†ä¸€é“<mark class="label danger">å‡ç¢§çš„æ³¢ç—•</mark>ã€‚å¶å­åº•ä¸‹æ˜¯è„‰è„‰çš„æµæ°´ï¼Œé®ä½äº†ï¼Œä¸èƒ½è§ä¸€äº›é¢œè‰²ï¼›è€Œå¶å­å´æ›´è§é£è‡´äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>OpenWrt é…ç½®è®°å½•</title>
    <url>/post/465f36a1.html</url>
    <content><![CDATA[<div class="encrypted-post-container" 
    data-ciphertext="0ly1q4MVnZnbxBdkVEC5RLbfITDQ2QU0eu5u0YwIhSDHoyA9PS7HMDkJ7pztud2hPoAMB3nzO8ruisdXmxExg4EDUENqrbhVnYEkT88VAc1RG02jIKz33TQGJMKavqgX/N9+xdYrBMYOlIPoqPnv2Smiv4DiNkAz/Gb1M7VWHtCoYifrfKG7DMpCNmpcmSHstOJXnw+1wjm2p3mCgy+Fp+JOE6cu3RkBAPs4xWINZxVedZ4RS140KG7uO8ua4FJ1enytmOe0qs4OsKdz0FsaY+8tMvWPzrEVXcX4gp+GP/q6zRHGZj8WWMmubS8C6q5+TcdlorFhKv0/oosAAnyJ9TLJ130Hrju/a6E1DoCxpqcmiWQoiywiTYrRqIy6U9LPDl6okQTqOQdm5OgGaiwAhU0zozvhJ6uJBHvw5cuEjkaMrpXc5iS6spLxKkoMQ84H/e3xYKLu+pCwfHtPakVOSQbn7qX6Ib6BqlWan5S0hUw4wlb35o3hAOKYIaeOzLCnJ18XMTRTykUKGVaYzh/xi4OSQ+yVhnTuHo7cqnJsB/inDd7icFEw01L9OaVWqJXq9Q7FIM//pFLl6rBEl5YfbzFx+RPbTHgZr2gDF2TOarPO71mM3TlrzPenjZagL5wjB8YOZpuzR26CzhaKmaSEDCAZcx1WlmP0q+3TFip4QspydDXe2IgXcBv00c30d9Da/Cr+AtKgHlNI75jWHwwA4DgcKS4DilT2XbAF4CoUzj52tfZXKVhWf16/BVFMD7CQLCzjBjZgFwt7E1f7kD9RGfL34nVeru/7GQClXNkjnXWLalTF08qiyblpwiWo4hOVUP97k14fUtBadjDwSZYvkZyiEndav0HdhaDYkSr2fpkkgw9kM7sybBodbM1uVJ/UoFg0SUP10r8s5SmZQ6306Lrx4iE8Wz6ec1Mr8+ZfftlQMOAbP2LejcAEyhtxExJDTGsXEvFHcTpeq4BBwsWbo3d6ZJp+NakkcoiiibXaE1pQXgGEspNuT6v8iKAWWrqZOWE2FVS4QtJTqOPp9LoEFpvdE5yx/x4OrffyIl0bUSAFL0Qa5BHAX8UuLBVdLjMFvczSwUHNuZML7XK+bZftrLXxsRRmQFoPKZhUBE9l1hpfGCi0NWUCWHW9kC8T3hz5EjxwkMpE//b22MxiDVYOEf//d0Izb9kKDz+kMhpPWWNrw0IdcRKKYdEh7atSr7uXkE2i9gX0ShF8TxGhNjYrFfuZxMRDQWaYQGn20A2mnzHX1yfL4sL4j8tDp5nnT0dx6nquWmUhozSlzsN3a2uU9JdIovbj2dYzESZQCfieqggp9wlvk3VeJDqkaDK2ReQvYcoWgRe25x1M801U6lYGieINOn9DX8eA8lYT960aQVqBa2vpr9OGke2wNrAVu48op3t2UDBAmStHmaVHodeBgH5X9WmGQlIGTQ4CCYIybvhRAVBXBy3Rhdfk/GvqwnvX4OTdmCyve+SBd/hPmlLgOQUOzCqZJWoVoYEMFArkSOu24utzVAOrHU+0VxlOdaPQfE3GswKqkNyiKZVyE3BLHWA83yYQbSTxCa0LvUe+a1Wyt5HRmIDhYbTgU0BADvxNanBBIpDXOPvwQ4x8rPk6YvtwSTgmUZ4aVSlYGKy7J77NkN9d3lSnzgRKHvyh8hQ8ATDZMZ/Noeb+8ZUT6wnarFGLIOK/0B+rJBhLUAgxcvms8rbxa+MVaoxPlRE/Vv78BQiwsCBHF2AfmnuqaHYKe/f6I22xATpJ2uIJYoZ4PQqWnuv8l8iIOA11qtLfxyBsMJYHlGKlUiQIIuRwWYE3Y+L8QJTc1Fo8dCdK4RkaDfsAiXFHZ7TzOqNulye6EtcbqmQRfZtERdKRGgKM4xAjcuYyQ6yFLQ84sRU6Kh7j5+9Qe/CmrW7LsLduW9whmwT6Zvb2bxwAt9CXlPINghyaHjIERQxbt7UfHkBz14POtfgU8cSJP3gBG0wQaQ++IReac2ibgFpY0WMJv+pjZmyUi1ByFHsaXTvuzooREew79W2OC9lVKHMSb5Ek89GxiM5MQ0RAIVbibiEyZyojptJMwAv3vHNyC7YxChMhDYK/k4IAk4fnb60G/D5+yYGlb4olugfn6KyCJLeTyAJFf05LQhpfCWAL7KiuJDAOnDJQUavk62rNi9gYzCwIWS/9yTTQ02bZGXJY69IuL09CHCIhHacmfgbaScbEL6Rh5cb04MBuxK0dI/xt4iriAWLcXS1RlGPOKPg1H8raWdKAsfCQTCR39Dwoq5tWvc/YDAiWIYWQujSAKfnl5c/e76x/+D2CtE2RkqbO7r3MzHJYcuLDapxpb/vssi12JgD1hriVK0q2pbzM1jhQqWQMTUoBTJfpd5Gblv3MWES/uSW/Ogz9VITmVybxvQVqcIMusCvSCau0TlzOWNQyAm6XToccxVgjhedJAGD+rxXmCWVIB0GlK+bToFhN8XWBP2J1XGDjCXo5+7tswm2YmGZUjiP3/bxycuIg8LnU0ud4qf/8MlnVV+BGhPwOeGOtM3ZpGjSm3YSPF0sCAJZFZpHQx5/QmdZO873q05EcibT035oUudaP4Nd5L9ohODq07+ppfQhoQFolUssDuBsgo5Glvpqv2jD4rlAvQ6AYcbYevareuRm65M7yqHq+bgoT+vru6bmXx1oLw6lwJ/KrTM8JKy9NScLaT6OaNzQfSdPIQW3IDMpmH+1caKVapmsEB/6GS5KCKzG3/06+50O59Ws/YlcEGq+cCyUaY1z5mBVtTq2oD72/5DzTQtulEpTNaMgoOrcA1uweoLgsT453ABRh4TJTkyDqPOfmnooMLtLLZdGOtE3BuPLX4Cxr92ntCC5yaM7P/rxLHpxt48vAl/z6rR+zqhlIyCRsKMMXpnWz0z8H0mjaHKrEN6+i+iT4QRL9dWSrCvGoAYX4vNN3/3ZpshF1RL0yHEO+jqM7BqJg+5IwuVRCVLI3EIQtFwPTBpfzUD95ji93Xpp2g2F2dbnG29ohD5pU8nzWTNR9ov2twV4e71Tmw0HazJIVhYwdpda819+3BmhEyODq2caaYnAmWkFUZX3hT6BmPif4Kvt/sY/jnuULeXHK23KD2ChKV97XxkpVxGBJa58fdLgKBM5aG67Ah9+ujAypvM2+R5BPX2aToO7IA+Xt4boryP+nyWTfGVl/6u9YD2Xx8AeHzhSMEYJiaiuQG6LIZryL/2ColxOYtaePv3OW4ZQrlgx3zwwkjiS6wLxhtPPGvyj/ZI1YJ+Qr5xvB0SU7vgP5kgE9IMK73OowLCJnr/kfvM9lgZM3DJ6UdyJM4ljLn+Rg37CPWTj9kfI7Za6FdTxkPsOhAskYVTt/S1M2/Gn3ChcLFnrk3jq9BXn/ySObPCg10E+7YYXuhxknnsTAptMebQfuCAg1+fkRvRFzcj1T3dKChq9vKCaboFobZ6U4UJQKSPerR6IsExk3C3T6gVHOIsbQ3bP9ZPb4FJmczL48/GhZrfwsMEkf1zwGelWYAoSOrKGq8SK5F4W+vk8249pjVaeigMXUQMDmYlgOZM38sxMYBwspYqFwLjpunq75Iti3HvIk5lxCrbVtID+sTQeIQ9MTuLc6JmqyDpUqFjIGZ6HiW9Z8u0obqP3EClYshcpSBydXy+5PTq8/iTmIZSSDOeqHBtIHhMwK7ndyH56X1aWLrLKcfBoGoeXa6MwF1IuTjz3pJu2AGPPTJLIrc+ABLlT3ZMNXH3TmYuOznRRYnEIMOz9X4hQhaRIU/5t/l3OZ19xNLx752fd410iG4DQ5DOjlEBqVBSKxjG8WK7uRuYAPrYOADePkdAJJhsNBeM6hb9+1nSyekp8PDJrDggCwXtCKvVQaWm7Z4ujiQxpa1tawCXPxQ9u0NbkMg1tuEMN17FBYSR3KQKuclDfRuh/d9jlETBuUWh67zVYinzGkUG4FlQdXDv//CRT1QgrkaELWeBOMZP1pWadZDWkwketqh8vRbo69d3oY/KbnwBuFQ7WqJCw7NhYMauLa2P+jW8f6tl+/l1QuDzC0WYVWrPgCLmf4ZM5SHRlj5jqKnDpDpMKe69Wwy7IFwV7VOwTc/pOEE8VvsimrzpjcA3ZkeRsJQ8Ixj6AFqlwdTDVJVwo0qtm+kUx8tzIK1zGqLmYCQKV/73c9mQmjOVkLMQTqJxHFU2/x8nl85XTQ+OrwcxfXKVzqLg296+gFD+ZACSQDzkKOHLHR6aYfT7poTShHRwnomiqFcFOTpWCMdAfQIHgJKcO/yKZcGbEyj/rIuP4XeiprufkM3rNbeoERbjqgwiN4ECI1SaT6KI25GVMtQmIMx423xidVn4EX01SDIBrX9ZCNNRW/g1yRP3a8EhDi9rykDI8TVuastQVDoS4We2gMi/nKjMib+Tl18kYdJoMJ6LPhEWK2wZZ94Jd/aFTEz5VRxfgtiN+56tgH1mssppXXMJ+Mlc2diCC6nubLSJU1pRh9t3EmUlfOhLDK08tj3Js6P60VvwBXRdpOseFnpaG6hQuDTDUrqW62Z8VCiTNkU9/dYmW3wzil+PS7ZKzPsMyDeuGDuvrKguYV+rFOwGXzHzU0+NhuGDBsnfq7mOaESb52I11ATZ5YU61JcXIhOSQhnH8r9mgyynVFx0tx3LhY36/YxPp8JoRZnQrpxzmJWG+Xn6RRlKdYWK97wDclXKZ+zl+jLXhLEc1hAcfPe52cSyUXfuSiD9Zt5533c6+FYuIF6/2ev2gNwjnECvRdS5uRFrwWIZ4O/SNY97yNLl68yfPW5ZmAkvw3NuKsKnV3UMA67jMdHPVzKFd7jFlhRTVOQoL3g8TeyBIyVKv1GovXSJ6KU4YEQXn5B082uO9ALAJvsRKyS2tz67hSEpPy4A6XuoF3G7xc3YopPNCL7N0jGfg0brHiPB6o59b0ehFMIpjYsWswHhXF1E2lC3xfdWA1+laq2ZnQwA=="
    data-iv="m1ASmMJLXlBnUjV0"
    data-auth-tag="X7ZnjCNgGNcMDjriMP8OJA=="
    data-abbrlink="465f36a1"
    data-wrapped-keys='[{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;TfvTghVcPCp9Ks8mYXGt8cCupVcb0uSCbBXSkxH4s1Q=&quot;,&quot;iv&quot;:&quot;1dHAIgHHT3afHssb&quot;,&quot;authTag&quot;:&quot;rnIgaDH66x5MTn0AWg7AmQ==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;3q20irGPNoLrGlN/q7qpbcOlFn1byRtOSA2iwpR7Eg0=&quot;,&quot;iv&quot;:&quot;ye+e+lLR/bRxzq3H&quot;,&quot;authTag&quot;:&quot;MI4WgOC2dAa/gE40rlIYcA==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;ebj1MF0y3Jonv0ShEs5oMe8nFm+zl04g2ZI6ZQNZ0ew=&quot;,&quot;iv&quot;:&quot;nMRJ7hxU2tdhyBVE&quot;,&quot;authTag&quot;:&quot;jSxoAbUANyGuYYxy5BIBKA==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;4TFMcPF1NAIolLqAcdaEzoaflq1vZ5GdA9YowhNsM3U=&quot;,&quot;iv&quot;:&quot;iRgcONlNBVT582ff&quot;,&quot;authTag&quot;:&quot;QQFlJWZzGvp2BqbOL/AEbQ==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;hpydGjykocZR+nm7sFc8ilT8t1NkstvdxlN59JlRBPY=&quot;,&quot;iv&quot;:&quot;H7TbkQk2mSupGXtO&quot;,&quot;authTag&quot;:&quot;VoOfUiOwPOuzWRs61ppalQ==&quot;},{&quot;type&quot;:&quot;password&quot;,&quot;encryptedCEK&quot;:&quot;J1hBRfpgwZQtskdQ27AZU4os/E5y0sNy4kkgGITzCp0=&quot;,&quot;iv&quot;:&quot;0tkYfFtR4cra73Kx&quot;,&quot;authTag&quot;:&quot;m4TEKjW2ZWAmQG7icRHZeQ==&quot;,&quot;salt&quot;:&quot;1be53724816528d8cc0547ca98dfcc2649f00b343011a7d07f4633d72252943b&quot;}]'
    data-prf-salt="1be53724816528d8cc0547ca98dfcc2649f00b343011a7d07f4633d72252943b"
    data-cache="0">
  <div class="encrypted-post-notice">
    <div class="decrypt-methods"><button class="decrypt-btn" id="fido2-verify-btn"><i class="fa fa-fingerprint"></i> é€šè¡Œå¯†é’¥éªŒè¯</button><div class="password-decrypt-group">
        <button class="decrypt-btn" id="show-password-btn"><i class="fa fa-lock"></i> å¯†ç éªŒè¯</button>
        <div class="password-input-group" id="password-input-group" style="display:none">
          <input type="password" class="password-input" id="password-input" placeholder="è¾“å…¥å¯†ç " />
          <button class="decrypt-btn" id="password-decrypt-btn"><i class="fa fa-key"></i> ç¡®å®š</button>
        </div>
      </div></div>
    <div class="verification-status" id="verification-status"></div>
  </div>
  <div class="decrypted-content" id="decrypted-content" style="display:none"></div>
</div>]]></content>
  </entry>
  <entry>
    <title>Windy è‡ªå®šä¹‰è‰²å±‚</title>
    <url>/post/fbb67a4e.html</url>
    <content><![CDATA[<p>Windy è‡ªå®šä¹‰è‰²å±‚</p>
<p>ä¿®æ”¹æ–¹æ³•ï¼šæ‰“å¼€ App â­¢ <strong>è®¾ç½®</strong> â­¢ åº•éƒ¨ <strong>è‡ªå®šä¹‰è‰²å±‚</strong> â­¢ <strong>Select overlay</strong> é€‰æ‹©å¯¹åº”çš„æ•°æ® â­¢ åº•éƒ¨ <strong>Import&#x2F;Export color</strong> â­¢ å¤åˆ¶å¯¹åº”çš„ä»£ç åˆ°ä¸‹æ–¹æ–‡æœ¬æ¡† â­¢ ç‚¹å‡» <strong>Import gradient</strong> â­¢ ç‚¹å‡» <strong>Save created color</strong></p>
<span id="more"></span>

<h1 id="æ°”è±¡é›·è¾¾-radar"><a href="#æ°”è±¡é›·è¾¾-radar" class="headerlink" title="æ°”è±¡é›·è¾¾ [radar]"></a>æ°”è±¡é›·è¾¾ [radar]</h1><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="https://images.zabrian.com/e26a271a-0f7d-461f-8ebc-f334f7010f01/origin" title="åŸå§‹å›¾å±‚" style="zoom:20%;" /></div><div class="group-picture-column"><img src="https://images.zabrian.com/c0abf2e7-61e3-447b-ef4a-8d43b4ff5b01/origin" title="ä¿®æ”¹åå›¾å±‚" style="zoom:20%;" /></div></div></div>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">239</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">4.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">239</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="number">157</span><span class="punctuation">,</span> <span class="number">241</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">9.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="number">157</span><span class="punctuation">,</span> <span class="number">241</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">10</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">231</span><span class="punctuation">,</span> <span class="number">235</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">14.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">231</span><span class="punctuation">,</span> <span class="number">235</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">15</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">109</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">61</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">19.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">109</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">61</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">20</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">216</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">24.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">216</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">25</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">144</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">29.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">144</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">30</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">34.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">35</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">231</span><span class="punctuation">,</span> <span class="number">192</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">39.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">231</span><span class="punctuation">,</span> <span class="number">192</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">44.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">45</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">49.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">50</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">215</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">54.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">215</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">55</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">59.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">60</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">64.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">150</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">180</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">69.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">150</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">180</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">70</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">175</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">79.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">175</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">80</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">81</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/post/4a17b156.html</url>
    <content><![CDATA[<center>Hello World</center>
]]></content>
  </entry>
  <entry>
    <title>iPhone 17 å£çº¸</title>
    <url>/post/958b861f.html</url>
    <content><![CDATA[<p>2025-09-10 è‹¹æœå‘å¸ƒäº†å…¨æ–°çš„ iPhone 17 ç³»åˆ—ï¼Œé™¤äº†å¸¦æ¥äº†å…¨æ–°çš„ iPhone Air ç³»åˆ—ï¼ŒåŒæ—¶è¿˜æ–°å¢äº†æ¯æ¬¾æœºå‹å¯¹åº”çš„ç³»ç»Ÿå£çº¸ã€‚</p>
<span id="more"></span>

<div class="tabs" id="iphone-17-ç³»åˆ—å£çº¸"><ul class="nav-tabs"><li class="tab active"><a href="#iphone-17-ç³»åˆ—å£çº¸-1"><i class="fa fa-mobile"></i>iPhone 17 ç³»åˆ—</a></li><li class="tab"><a href="#iphone-17-ç³»åˆ—å£çº¸-2"><i class="fa fa-mobile"></i>iPhone 17 Air ç³»åˆ—</a></li><li class="tab"><a href="#iphone-17-ç³»åˆ—å£çº¸-3"><i class="fa fa-mobile"></i>iPhone 17 Pro ç³»åˆ—</a></li></ul><div class="tab-content"><div class="tab-pane active" id="iphone-17-ç³»åˆ—å£çº¸-1"><img src="https://images.zabrian.com/d81266c0-d74e-49ce-64fe-0794ab6d1001/origin" title="iPhone 17 ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/eSDn" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a><center>
  <br></div><div class="tab-pane" id="iphone-17-ç³»åˆ—å£çº¸-2"><img src="https://images.zabrian.com/65a42a74-6d52-41c6-f26e-a484100d9801/origin" title="iPhone 17 Air ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/dC4Q" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a><center>
  <br></div><div class="tab-pane" id="iphone-17-ç³»åˆ—å£çº¸-3"><img src="https://images.zabrian.com/6755691c-557d-4069-7881-fb08a524cd01/origin" title="iPhone 17 Pro ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/XEkx" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a></center>
  <br></div></div></div>]]></content>
  </entry>
  <entry>
    <title>macOS Chrome &#39;è¿™äº›æ‰©å±•ç¨‹åºä¸å†å—æ”¯æŒï¼Œå› æ­¤å·²åœç”¨&#39; è§£å†³åŠæ³•</title>
    <url>/post/e72f1311.html</url>
    <content><![CDATA[<p>ä»Šå¤©æ—©ä¸Šå‘ç° macOS Chrome ç‰ˆæœ¬æ›´æ–°åˆ°äº† 138.0.7204.101 æ‰“å¼€æµè§ˆå™¨çš„æ—¶å€™æç¤º â€œè¿™äº›æ‰©å±•ç¨‹åºä¸å†å—æ”¯æŒï¼Œå› æ­¤å·²åœç”¨â€ï¼Œç®€å•æœäº†ä¸€ä¸‹å‘ç°æœ‰è§£å†³åŠæ³•ï¼Œä½†æ˜¯éƒ½æ˜¯é’ˆå¯¹äº Windows ä¸‹çš„è§£å†³æ–¹æ¡ˆã€‚<br>è€Œå¯¹äº macOS æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼Œä»»é€‰å…¶ä¸€å³å¯ã€‚</p>
<div class="note danger"><p>2025-09-11 æ›´æ–°: Chrome å·²ç»æ›´æ–°åˆ° 140 ç‰ˆæœ¬ï¼Œä»¥ä¸‹æ–¹æ³•å·²ç»ä¸é€‚ç”¨ã€‚</p>
</div>

<span id="more"></span>

<h2 id="é€šè¿‡-chrome-flags-æ¨è"><a href="#é€šè¿‡-chrome-flags-æ¨è" class="headerlink" title="é€šè¿‡ chrome:&#x2F;&#x2F;flags (æ¨è)"></a>é€šè¿‡ chrome:&#x2F;&#x2F;flags (æ¨è)</h2><ol>
<li>å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Chrome</li>
<li>åœ°å€æ è¾“å…¥ <code>chrome://flags</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Enabled</code><br><code>temporary-unexpire-flags-m137</code></li>
<li>é‡å¯æµè§ˆå™¨å¹¶å†æ¬¡æ‰“å¼€ <code>chrome://flags</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Disabled</code><br><code>extension-manifest-v2-deprecation-warning</code><br><code>extension-manifest-v2-deprecation-disabled</code><br><code>extension-manifest-v2-deprecation-unsupported</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Enabled</code><br><code>allow-legacy-mv2-extensions</code></li>
<li>é‡å¯æµè§ˆå™¨</li>
</ol>
<h2 id="é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†"><a href="#é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†" class="headerlink" title="é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†"></a>é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†</h2><p>æ ¹æ® <span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWVlbnRlcnByaXNlLmdvb2dsZS9pbnRsL3poX2NuL3BvbGljaWVzLz9wb2xpY3k9RXh0ZW5zaW9uTWFuaWZlc3RWMkF2YWlsYWJpbGl0eQ==">ExtensionManifestV2Availability<i class="fa fa-external-link-alt"></i></span> çš„æè¿°ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡ä¼ä¸šæ§åˆ¶ç®¡ç†è¿›è¡Œè®¾ç½®ã€‚<br>æ­¤æ–¹æ³•æœ‰ä¸€éš”å¼Šç«¯æ˜¯ Chrome ä¼šæ˜¾ç¤ºä¸€æ¡ <code>æ‚¨çš„æµè§ˆå™¨ç”±è´µå•ä½ç®¡ç†</code> çš„æç¤ºï¼Œåªæ˜¯å› ä¸ºä½¿ç”¨äº†ä¼ä¸šç®¡ç†çš„é…ç½®ï¼Œæ‰€ä»¥ä¼šæç¤ºã€‚å®é™…å¹¶æ— ä»»ä½•ä¼ä¸šå¯¹ä½ çš„æµè§ˆå™¨è¿›è¡Œç®¡ç†ã€‚<br>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p <span class="string">&quot;/Library/Managed Preferences&quot;</span> &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">tee</span> <span class="string">&quot;/Library/Managed Preferences/com.google.Chrome.plist&quot;</span> &gt;/dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;</span></span><br><span class="line"><span class="string">  &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;\&gt;</span></span><br><span class="line"><span class="string">&lt;plist version=&quot;1.0&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;dict&gt;</span></span><br><span class="line"><span class="string">    &lt;key&gt;ExtensionManifestV2Availability&lt;/key&gt;</span></span><br><span class="line"><span class="string">    &lt;integer&gt;2&lt;/integer&gt;</span></span><br><span class="line"><span class="string">  &lt;/dict&gt;</span></span><br><span class="line"><span class="string">&lt;/plist&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>å®Œå…¨å…³é—­ Chrome åå†æ‰“å¼€ï¼Œåœ¨åœ°å€æ è¾“å…¥ <code>chrome://policy/</code> ç‚¹å‡»å·¦ä¸Šè§’çš„é‡æ–°åŠ è½½æ”¿ç­–ï¼Œç„¶åæ—§ç‰ˆçš„æ‰©å±•å°±å¯ä»¥ç»§ç»­ä½¿ç”¨å•¦ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>macOS GPG ä½¿ç”¨æŒ‡å—</title>
    <url>/post/cb9ee24d.html</url>
    <content><![CDATA[<p>è¿™ç¯‡æŒ‡å—é¢å‘çš„æ˜¯å¯¹ <code>GPG</code> æœ‰äº†ä¸€å®šäº†è§£çš„çš„æœ‹å‹ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ <code>GPG</code> æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦å…ˆè¡¥å……ä¸€ä¸‹è¿™éƒ¨åˆ†çš„åŸºç¡€çŸ¥è¯†ï¼Œå†æ¥é£Ÿç”¨æ¯”è¾ƒåˆé€‚ã€‚</p>
<p>å¦‚æœä½ å·²ç»å¤§æ¦‚äº†è§£ <code>GPG</code> çš„ä¸€äº›å†…å®¹ï¼ŒçŸ¥é“å®ƒèƒ½ç”¨æ¥å¹²ä»€ä¹ˆè€Œä¸”ä½ çœŸçš„éœ€è¦ç”¨åˆ°ã€‚é‚£ä¹ˆè¿™ç¯‡æŒ‡å—æˆ–è®¸å¯¹ä½ æœ‰ä¸€ç‚¹çš„å¸®åŠ©ã€‚</p>
<p>è¿™ç¯‡æŒ‡å—ä¸»è¦é’ˆå¯¹äº <code>macOS</code> ç³»ç»Ÿä¸‹çš„ <code>GPG</code> ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>Windows</code> æˆ–è€… <code>Linux</code>ï¼Œå…¶ä¸­æœ‰äº›å†…å®¹å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚</p>
<span id="more"></span>

<p>æ–‡ä¸­ä½¿ç”¨çš„ <code>GPG</code> ç‰ˆæœ¬æ˜¯ <code>2.4.5</code> ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ã€‚</p>
<blockquote>
<p>å¤‡æ³¨: ä¸‹æ–‡ä¸­æ‰€æœ‰çš„å±•ç¤ºå†…å®¹çš„éƒ¨åˆ† <code>$</code> å¼€å¤´çš„è¡Œè¡¨ç¤ºçš„å½“å‰ <code>shell</code> ç¯å¢ƒçš„å‘½ä»¤è¾“å…¥è¡Œã€‚å‘½ä»¤å‡ä¸åŒ…å« <code>$</code> æœ¬èº«ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --version</span><br><span class="line">gpg (GnuPG) 2.4.5</span><br><span class="line">libgcrypt 1.10.3</span><br><span class="line">Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">License GNU GPL-3.0-or-later &lt;https://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Home: /Users/zebedy/.gnupg</span><br><span class="line">æ”¯æŒçš„ç®—æ³•ï¼š</span><br><span class="line">å…¬é’¥ï¼š RSA, ELG, DSA, ECDH, ECDSA, EDDSA</span><br><span class="line">å¯†æ–‡ï¼š IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,</span><br><span class="line">    CAMELLIA128, CAMELLIA192, CAMELLIA256</span><br><span class="line">æ•£åˆ—ï¼š SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224</span><br><span class="line">å‹ç¼©ï¼š  ä¸å‹ç¼©, ZIP, ZLIB, BZIP2</span><br></pre></td></tr></table></figure>

<h1 id="åˆæ¬¡ä½¿ç”¨"><a href="#åˆæ¬¡ä½¿ç”¨" class="headerlink" title="åˆæ¬¡ä½¿ç”¨"></a>åˆæ¬¡ä½¿ç”¨</h1><p>å¦‚æœä½ è¿˜æ²¡æœ‰ä»»ä½•å¯†é’¥ï¼Œæƒ³æ–°ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ã€‚å»ºè®®ä»è¿™é‡Œå¼€å§‹ã€‚</p>
<h2 id="ç”Ÿæˆä¸»å¯†é’¥"><a href="#ç”Ÿæˆä¸»å¯†é’¥" class="headerlink" title="ç”Ÿæˆä¸»å¯†é’¥"></a>ç”Ÿæˆä¸»å¯†é’¥</h2><p>ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>--gen-key</code> å°±å¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„ç»†èŠ‚è®¾ç½®ï¼Œæ‰€ä»¥ç”¨ <code>--full-gen-key</code> æ¥ä»£æ›¿</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --full-gen-key</span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š</span><br><span class="line">   (1) RSA å’Œ RSA</span><br><span class="line">   (2) DSA å’Œ Elgamal</span><br><span class="line">   (3) DSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (4) RSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (9) ECCï¼ˆç­¾åå’ŒåŠ å¯†ï¼‰ *é»˜è®¤*</span><br><span class="line">  (10) ECCï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line"> ï¼ˆ14ï¼‰å¡ä¸­ç°æœ‰å¯†é’¥</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 9</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥ç‰ˆæœ¬ï¼ˆ<code>2.4.5</code>ï¼‰ä¸‹å¯ä»¥é€šè¿‡ <code>*é»˜è®¤*</code> å¯ä»¥çœ‹é»˜è®¤çš„å¯†é’¥ç±»å‹ä¸º <code>ECCï¼ˆç­¾åå’ŒåŠ å¯†ï¼‰</code> è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚ä½¿ç”¨é»˜è®¤å³å¯ã€‚</p>
<p>åœ¨å½“å‰ç•Œé¢è¾“å…¥é€‰é¡¹å‰é¢æ‹¬å·ä¸­çš„æ•°å­— <code>9</code> ä¹‹åå›è½¦ç¡®è®¤ï¼Œæˆ–è€…ä¸è¾“å…¥ä»»ä½•å†…å®¹ç›´æ¥å›è½¦ç¡®è®¤å³å¯ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·é€‰æ‹©æ‚¨æƒ³è¦ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ï¼š</span><br><span class="line">   (1) Curve 25519 *é»˜è®¤*</span><br><span class="line">   (4) NIST P-384</span><br><span class="line">   (6) Brainpool P-256</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 1</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼ä¸Šä¸€æ­¥ï¼Œé€‰æ‹©ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ï¼Œè¿™é‡Œé€‰æ‹©é»˜è®¤ <code>Curve 25519</code> å³å¯ã€‚</p>
<p>åœ¨å½“å‰ç•Œé¢è¾“å…¥ <code>1</code> ä¹‹åå›è½¦ç¡®è®¤ï¼Œæˆ–è€…ä¸è¾“å…¥ä»»ä½•å†…å®¹ç›´æ¥å›è½¦ç¡®è®¤å³å¯ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚</span><br><span class="line">         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ</span><br><span class="line">      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ</span><br><span class="line">å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œéœ€è¦é€‰æ‹©å¯†é’¥çš„æœ‰æ•ˆæœŸã€‚</p>
<p>å¦‚æœæ˜¯ä¸ªäººä½¿ç”¨ï¼Œå¯ä»¥é€‰æ‹©æ°¸ä¸è¿‡æœŸï¼Œè¿™æ ·å¯ä»¥é¿å…ä»¥åè¿‡æœŸåè¿˜éœ€è¦å†æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ã€‚</p>
<p>è€Œå¦‚æœéœ€è¦é…ç½®ç‰¹å®šçš„è¿‡æœŸæ—¶é—´ã€‚åˆ™æ ¹æ®ä¸‹é¢çš„ä¸‰ä¸ªé€‰é¡¹è¾“å…¥å¯¹åº”çš„å†…å®¹å³å¯ï¼Œæ¯”å¦‚éœ€è¦åœ¨ä¸€å‘¨åè¿‡æœŸï¼Œåˆ™è¾“å…¥ <code>1w</code> 3 ä¸ªæœˆåè¿‡æœŸ <code>3m</code></p>
<p>æˆ‘è¿™é‡Œå°±é€‰äº† <code>0</code> è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚è¾“å…¥æ•°å­— <code>0</code> å›è½¦åç»è¿‡äºŒæ¬¡ç¡®è®¤ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚</span><br><span class="line"></span><br><span class="line">çœŸå®å§“åï¼š</span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œå¼€å§‹åé¢çš„æ­¥éª¤å°±æ˜¯è¾“å…¥å¯†é’¥å¯¹åº”çš„ä¸ªäººä¿¡æ¯äº†ã€‚</p>
<p>ä¾æ¬¡è¾“å…¥å†…å®¹åŒ…æ‹¬ <code>çœŸå®å§“å</code>, <code>ç”µå­é‚®ä»¶åœ°å€</code>, <code>æ³¨é‡Š</code> å…¶ä¸­æ³¨é‡Šå¯ä»¥çœç•¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚</span><br><span class="line"></span><br><span class="line">çœŸå®å§“åï¼š zebedy</span><br><span class="line">ç”µå­é‚®ä»¶åœ°å€ï¼š zebedy@example.com</span><br><span class="line">æ³¨é‡Šï¼š</span><br><span class="line">æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š</span><br><span class="line">    â€œzebedy &lt;zebedy@example.com&gt;â€</span><br><span class="line"></span><br><span class="line">æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¦‚æœç¡®è®¤ä¸ªäººä¿¡æ¯è¾“å…¥æ²¡é—®é¢˜ï¼Œå°±å¯ä»¥è¾“å…¥å­—æ¯ <code>O</code> å›è½¦ç¡®è®¤ã€‚</p>
<p>ç¡®å®šä¹‹åæ ¹æ®æç¤ºè®¾ç½®ä¸»å¯†é’¥çš„å¯†ç ã€‚ç¡®å®šå¯†ç åã€‚ç»è¿‡çŸ­æš‚çš„æ—¶é—´å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥äº†ã€‚</p>
<p>è¿™ä¸ªå¯†ç ä¸€å®šè¦å¦¥å–„ä¿ç®¡ï¼Œä¼šç»å¸¸éœ€è¦ä½¿ç”¨ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line">gpg: åŠé”€è¯ä¹¦å·²è¢«å­˜å‚¨ä¸ºâ€˜/Users/zebedy/.gnupg/openpgp-revocs.d/A31F6E522B93990CA1A1C548D188A1DD832AB894.revâ€™</span><br><span class="line">å…¬é’¥å’Œç§é’¥å·²ç»ç”Ÿæˆå¹¶è¢«ç­¾åã€‚</span><br><span class="line"></span><br><span class="line">pub   ed25519 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                      zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519 2024-03-24 [E]</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œï¼Œä¸»å¯†é’¥å°±ç”Ÿæˆç»“æŸäº†ã€‚</p>
<h2 id="ç”Ÿæˆå­å¯†é’¥"><a href="#ç”Ÿæˆå­å¯†é’¥" class="headerlink" title="ç”Ÿæˆå­å¯†é’¥"></a>ç”Ÿæˆå­å¯†é’¥</h2><h3 id="æ›¿æ¢é»˜è®¤-pinentry"><a href="#æ›¿æ¢é»˜è®¤-pinentry" class="headerlink" title="æ›¿æ¢é»˜è®¤ pinentry"></a>æ›¿æ¢é»˜è®¤ <code>pinentry</code></h3><p>åœ¨ç”Ÿæˆå­å¯†é’¥ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åšä¸€ä¸ªäº‹æƒ…ï¼šæ›¿æ¢é»˜è®¤çš„ <code>pinentry</code></p>
<p><code>pinentry</code> æ˜¯ç”¨æ¥åˆç”¨ä¹äº¤äº’è¾“å…¥å¯†ç çš„ï¼Œå› ä¸ºé»˜è®¤çš„ <code>pinentry</code> ä¾èµ– <code>GPG_TTY</code> æ‰€ä»¥å¯ä»¥å†ç»ˆç«¯ä¸­å®ç°è¾“å…¥å¯†ç ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å…¶ä»–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ VSCode æˆ–è€… JB å…¨å®¶æ¡¶çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å› ä¸ºæ— æ³•è¾“å…¥å¯†ç å¯¼è‡´å¤±è´¥ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹çš„ <code>pinentry-mac</code>ï¼Œå¹¶æ›¿æ¢é»˜è®¤ <code>pinentry</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install pinentry-mac</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;pinentry-program <span class="subst">$(which pinentry-mac)</span>&quot;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡å¯ <code>gpg-agent</code> å³å¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> RELOADAGENT | gpg-connect-agent</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç”¨äº-SSH-é‰´æƒçš„å­å¯†é’¥"><a href="#åˆ›å»ºç”¨äº-SSH-é‰´æƒçš„å­å¯†é’¥" class="headerlink" title="åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥"></a>åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥</h3><h4 id="åˆ›å»ºå­å¯†é’¥"><a href="#åˆ›å»ºå­å¯†é’¥" class="headerlink" title="åˆ›å»ºå­å¯†é’¥"></a>åˆ›å»ºå­å¯†é’¥</h4><p>é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ä¸»å¯†é’¥çš„ç›¸å…³ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">gpg: æ­£åœ¨æ£€æŸ¥ä¿¡ä»»åº¦æ•°æ®åº“</span><br><span class="line">gpg: marginals needed: 3  completes needed: 1  trust model: pgp</span><br><span class="line">gpg: æ·±åº¦ï¼š0  æœ‰æ•ˆæ€§ï¼š  4  å·²ç­¾åï¼š  0  ä¿¡ä»»åº¦ï¼š0-ï¼Œ0qï¼Œ0nï¼Œ0mï¼Œ0fï¼Œ4u</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€è¡Œ å¼€å¤´çš„ <code>pub</code> è¡¨ç¤ºè¿™ä¸ªæ˜¯å…¬é’¥, <code>ed25519</code> æ˜¯ä¸Šé¢åˆ›å»ºå¯†é’¥æ—¶é€‰æ‹©çš„æ¤­åœ†æ›²çº¿æ–¹æ³•, åé¢çš„ <code>D188A1DD832AB894</code> æ˜¯å…¬é’¥çš„ 16 ä½çŸ­æ‘˜è¦, <code>2024-03-24</code> æ˜¯ç”Ÿæˆæ—¶é—´, <code>[SC]</code> ä¸­ <code>S:signing</code> è¡¨ç¤ºå¯ä»¥ç”¨äºç­¾å <code>C:certification</code> è¡¨ç¤ºå¯ä»¥ç”¨äºè®¤è¯ã€‚</li>
<li>ç¬¬äºŒè¡Œ <code>A31F6E522B93990CA1A1C548D188A1DD832AB894</code> æ˜¯å¯†é’¥çš„ 40 ä½é•¿æ‘˜è¦ã€‚å…¶ä¸­ä¸Šé¢çš„çŸ­æ‘˜è¦å°±æ˜¯é•¿æ‘˜è¦çš„å 16 ä½ã€‚</li>
<li>ç¬¬ä¸‰è¡Œ <code>uid</code> æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>[ ç»å¯¹ ]</code> è¡¨ç¤ºè¯¥å¯†é’¥çš„ä¿¡ä»»ç­‰çº§æ˜¯æœ€é«˜çº§åˆ«: ç»å¯¹ä¿¡ä»»ã€‚åé¢åˆ†åˆ«æ˜¯è¾“å…¥çš„åå­—ï¼Œæ³¨é‡Šå’Œç”µå­é‚®ä»¶</li>
<li>ç¬¬å››è¡Œ <code>sub</code> è¡¨ç¤ºè¿™ä¸ªæ˜¯å­å…¬é’¥ï¼Œæ˜¯åˆ›å»ºä¸»å¯†é’¥çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªå­å¯†é’¥ï¼Œæœ€åçš„<code>[E]</code> ä¸­ <code>E:encryption</code> è¡¨ç¤ºå¯ç”¨äºåŠ å¯†</li>
</ul>
<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>--list-secret-keys</code> æŸ¥çœ‹ç§é’¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-secret-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">sec   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">ssb   cv25519/2978529F4782B600 2024-03-24 [E]</span><br></pre></td></tr></table></figure>

<p>å†…å®¹å’Œä¸Šé¢åªæœ‰å‰é¢çš„ <code>pub</code> -&gt; <code>sec</code>(è¡¨ç¤ºç§é’¥)ï¼Œ<code>sub</code> -&gt; <code>ssb</code>(è¡¨ç¤ºå­ç§é’¥) ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„å†…å®¹éƒ½ä¸€æ ·ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çŸ¥é“ä¸»å¯†é’¥çš„æ‘˜è¦æ˜¯ <code>D188A1DD832AB894</code> (è¿™é‡Œç”¨é•¿çŸ­æ‘˜è¦éƒ½å¯ä»¥ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢å°±éƒ½ç”¨çŸ­æ‘˜è¦ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>uid</code> ä¸­çš„å§“å)</p>
<p>æ¥ä¸‹æ¥å°±éœ€è¦ç”¨è¿™ä¸ªä¸»å¯†é’¥ç”Ÿæˆä¸€ä¸ªå­å¯†é’¥ã€‚å› ä¸ºéœ€è¦ç”¨åˆ°é«˜çº§è‡ªå®šä¹‰ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š <code>--expert</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --expert --edit-key D188A1DD832AB894 <span class="comment"># æˆ–è€…æ˜¯ gpg --expert --edit-key zebedy</span></span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">ç§é’¥å¯ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ <code>shell</code> å˜æˆäº† <code>gpg&gt;</code> è¡¨ç¤ºè¿›å…¥äº†ä¸ <code>GPG</code> çš„äº¤äº’</p>
<p>è¾“å…¥ <code>addkey</code> æ·»åŠ ä¸€ä¸ªæ–°çš„å­å¯†é’¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg&gt; addkey</span><br><span class="line">è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š</span><br><span class="line">   (3) DSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (4) RSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (5) ElGamalï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">   (6) RSAï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">   (7) DSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">   (8) RSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">  (10) ECCï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">  (11) ECCï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">  (12) ECCï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">  (13) ç°æœ‰å¯†é’¥</span><br><span class="line"> ï¼ˆ14ï¼‰å¡ä¸­ç°æœ‰å¯†é’¥</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 8</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥ <code>8</code> å›è½¦ç¡®è®¤ï¼Œä½¿ç”¨ <code>RSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</code> é€‰é¡¹æ‰‹åŠ¨é…ç½®è¿™ä¸ªå¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ S</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå­å¯†é’¥ç›®å‰å¯ç”¨çš„åŠŸèƒ½æœ‰ <code>ç­¾åï¼ˆSignï¼‰</code> å’Œ <code>åŠ å¯†ï¼ˆEncryptï¼‰</code></p>
<p>ä½†æ˜¯ <code>SSH</code> é‰´æƒä¸éœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦å–æ¶ˆè¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚</p>
<p>è¾“å…¥ <code>S</code> å›è½¦åå–æ¶ˆ <code>ç­¾åï¼ˆSignï¼‰</code> çš„åŠŸèƒ½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š åŠ å¯†ï¼ˆEncryptï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ E</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å­å¯†é’¥ç›®å‰å¯ç”¨çš„åŠŸèƒ½å°±åªæœ‰ <code>åŠ å¯†ï¼ˆEncryptï¼‰</code> äº†ï¼Œå†æ¬¡è¾“å…¥ <code>E</code> å›è½¦ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ A</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å·²å¯ç”¨åŠŸèƒ½å°±æ²¡æœ‰äº†ä»»ä½•å†…å®¹ï¼Œè¾“å…¥ <code>A</code> å›è½¦åå¼€å¯ <code>SSH</code> é‰´æƒéœ€è¦çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ Q</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¾“å…¥ <code>Q</code> ç»“æŸè‡ªå®šä¹‰åŠŸèƒ½ï¼Œè¿›å…¥ <code>RSA</code> å¯†é’¥é€‰é¡¹ã€‚</p>
<p>å› ä¸ºæ·»åŠ å­å¯†é’¥çš„æ—¶å€™é€‰æ‹©çš„æ˜¯ <code>RSA</code> å¯†é’¥ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡å®šå¯†é’¥é•¿åº¦ã€‚é•¿åº¦è¶Šé•¿ï¼Œå®‰å…¨æ€§è¶Šé«˜ã€‚æˆ‘è¿™é‡Œå°±é€‰æ‹© <code>4096</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„é•¿åº¦åº”åœ¨ 1024 ä½ä¸ 4096 ä½ä¹‹é—´ã€‚</span><br><span class="line">æ‚¨æƒ³è¦ä½¿ç”¨çš„å¯†é’¥é•¿åº¦ï¼Ÿ(3072) 4096</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¾ç½®å­å¯†é’¥çš„æœ‰æ•ˆæœŸã€‚å› ä¸ºä¹Ÿæ˜¯ä¸ªäººé•¿æœŸä½¿ç”¨ï¼Œæ‰€ä»¥é€‰æ‹© <code>0 å¯†é’¥æ°¸ä¸è¿‡æœŸ</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚</span><br><span class="line">         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ</span><br><span class="line">      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ</span><br><span class="line">å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0</span><br></pre></td></tr></table></figure>

<p>ç„¶åç»è¿‡ä¸¤æ¬¡è¾“å…¥ <code>y</code> çš„ç¡®è®¤åï¼Œä¼šæç¤ºè¾“å…¥ä¸»å¯†é’¥çš„å¯†ç ã€‚å› ä¸ºåˆ›å»ºå­å¯†é’¥éœ€è¦ç”¨åˆ°ä¸»å¯†é’¥çš„ç§é’¥ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°ä¸»å¯†é’¥çš„å¯†ç ã€‚</p>
<p>è¾“å…¥å®Œæ­£ç¡®å¯†ç åï¼Œç»è¿‡çŸ­æš‚æ—¶é—´å°±ç”Ÿæˆäº†ä¸€ä¸ª <code>RSA</code> å¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt;</span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šé¢ç›¸æ¯”å¯ä»¥çœ‹åˆ°å·²ç»å¤šäº†ä¸€ä¸ªæ‘˜è¦ä¸º <code>EFA3B0684ECE9D91</code> çš„å­å¯†é’¥ã€‚</p>
<p>è¿˜æœ‰æœ€åä¸€æ­¥ï¼Œè¾“å…¥ <code>save</code> å›è½¦ä¿å­˜å°±é€€å‡º <code>GPG</code> çš„äº¤äº’ <code>shell</code> äº†ã€‚</p>
<p>è‡³æ­¤ï¼Œå­å¯†é’¥åˆ›å»ºå®Œæˆã€‚</p>
<p>å›åˆ°æŸ¥çœ‹å¯†é’¥ä¿¡æ¯é‚£é‡Œã€‚æˆ‘ä»¬å†é€šè¿‡ <code>--list-keys</code> æŸ¥çœ‹å½“å‰å¯†é’¥ä¿¡æ¯å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå­å¯†é’¥äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”ä¸Šé¢å¯ä»¥çœ‹åˆ°åˆ°äº†ä¸€ä¸ª <code>EFA3B0684ECE9D91</code> çš„å­å¯†é’¥</p>
<h4 id="é…ç½®-SSH"><a href="#é…ç½®-SSH" class="headerlink" title="é…ç½® SSH"></a>é…ç½® SSH</h4><h5 id="å¯ç”¨-GPG-Agent-çš„-SSH-æ”¯æŒ"><a href="#å¯ç”¨-GPG-Agent-çš„-SSH-æ”¯æŒ" class="headerlink" title="å¯ç”¨ GPG Agent çš„ SSH æ”¯æŒ"></a>å¯ç”¨ GPG Agent çš„ SSH æ”¯æŒ</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.gnupg/gpg-agent.conf <span class="comment"># æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶ä¸­å•ç‹¬ä¸€è¡Œæ·»åŠ  <code>enable-ssh-support</code></p>
<h5 id="è®¾ç½®-GPG-Agent-æ›¿ä»£-SSH-Agent"><a href="#è®¾ç½®-GPG-Agent-æ›¿ä»£-SSH-Agent" class="headerlink" title="è®¾ç½® GPG Agent æ›¿ä»£ SSH Agent"></a>è®¾ç½® GPG Agent æ›¿ä»£ SSH Agent</h5><p>ä¿®æ”¹å¯¹åº” shell çš„é…ç½®æ–‡ä»¶ (æˆ‘ä½¿ç”¨çš„æ˜¯ <code>zsh</code>ï¼Œè‡ªå·±æ ¹æ®ä½¿ç”¨çš„ <code>shell</code> è°ƒæ•´)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ°åˆé€‚çš„åœ°æ–¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GPG_TTY=$(<span class="built_in">tty</span>)</span><br><span class="line"><span class="built_in">export</span> SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)</span><br><span class="line">gpgconf --launch gpg-agent</span><br></pre></td></tr></table></figure>

<h5 id="æ·»åŠ å­å¯†é’¥-keygrip"><a href="#æ·»åŠ å­å¯†é’¥-keygrip" class="headerlink" title="æ·»åŠ å­å¯†é’¥ keygrip"></a>æ·»åŠ å­å¯†é’¥ keygrip</h5><p>é¦–å…ˆé€šè¿‡ <code>--with-keygrip</code> è·å–å­å¯†é’¥çš„ <code>keygrip</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --with-keygrip --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">      Keygrip = F95E3D5B168563C4F65853E8C0396815CE819A21</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">      Keygrip = C5F82430DCB7B754782189638CBC8778D3E84AB8</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br><span class="line">      Keygrip = 9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°ä¸Šä¸€æ­¥åˆ›å»ºçš„å­å¯†é’¥ <code>EFA3B0684ECE9D91</code> ä»–çš„ <code>Keygrip = 9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</code></p>
<p>ç¼–è¾‘ <code>~/.gnupg/sshcontrol</code> æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.gnupg/sshcontrol</span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ª <code>9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</code> æ·»åŠ åˆ°å•ç‹¬ä¸€è¡Œï¼Œä¿å­˜ã€‚</p>
<p>ç„¶åé‡å¯ç»ˆç«¯</p>
<p>æ£€æŸ¥ <code>SSH Key</code> æ˜¯å¦å­˜åœ¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-add -l</span><br><span class="line">4096 SHA256:GvaU9MfvKVMa9FVM+KN28z+MDCML6429dWeILycSPPw (none) (RSA)</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°ç±»ä¼¼å†…å®¹å°±è¡¨ç¤ºæ·»åŠ æˆåŠŸ</p>
<h5 id="å¯¼å‡º-SSH-å…¬é’¥"><a href="#å¯¼å‡º-SSH-å…¬é’¥" class="headerlink" title="å¯¼å‡º SSH å…¬é’¥"></a>å¯¼å‡º SSH å…¬é’¥</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --export-ssh-key EFA3B0684ECE9D91 <span class="comment"># æˆ–è€…æ˜¯ gpg --export-ssh-key zebedy</span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6guDA+iEFZe2op48auILxCkN6IRWJstpp1X/iNtohEcUpBxJ3g0qMKiMQnFHOTsL0PCci2Ifmg740DE5RWC+QPhAiJCl/VT6nUK4wT+wx+0CoseQEg9RLWnq6+WYXi2GLEKZLIdxvpcrsm6IaEIUk8Z8CMbuJocFrOeAGsV9F9QsRIFyqGNw8v6/+rBDDZdfGbKrp54heNM61YtvVDtSSCgMq0iFW8mlxR1F3egaiffJid/LWWlDht15ndB8C+5ZIpK/Tbr6bHy9VWnbXOmxP4MBL4SyTUkEgvAqMEG5PWiS6PsfUbkvWTNRx6TG5RsZ7Xu0AVcB6//ZEHkjZeIeW9glMf7tC3H8bhpadDcDusPCeJv04TuAkFjYZVUSCnvR1qVUxe6VR9rhE6tBi86YGngvIRcWHjVe7o1CiQLSFAp9T5vD1HjRo8Q6pnKP4sq66jXH61MrhLMhLQt3RVryWe2AlPYtcYPlWRrl4uj3o8TKNQDhBFO7tMssHo474eC50epzpdOoC4etzHcIIVmMKSnvSl1Z46LUgkmcgL4Wj0NTqBWx58KFKjpYAT5dcZisvUsGM6pbFgFJRLRUcjibiR3vm3H34p08vaLYW5ldOJKwTf59rGiRI/ileY+1xpBsbc48PBAyX13433Lgw9TnRvjd+Ovkma7PU/QoJPKm+Sw== openpgp:0x4ECE9D91</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æŠŠè¿™ä¸ªå®ƒæ·»åŠ åˆ°ä»»ä½•éœ€è¦ä½¿ç”¨ <code>SSH</code> çš„åœ°æ–¹ï¼Œæ¯”å¦‚ <code>GitHub</code> æˆ–è€…è‡ªå·±æœåŠ¡å™¨ä¸Šçš„ <code>~/.ssh/authorized_keys</code> ä¸­ã€‚</p>
<p>è‡³æ­¤ï¼Œé€šè¿‡ GPG ç”Ÿæˆ SSH ä¸“ç”¨å¯†é’¥çš„è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</p>
<h3 id="åˆ›å»ºç”¨äº-ä»£ç ç­¾å-çš„å­å¯†é’¥"><a href="#åˆ›å»ºç”¨äº-ä»£ç ç­¾å-çš„å­å¯†é’¥" class="headerlink" title="åˆ›å»ºç”¨äº ä»£ç ç­¾å çš„å­å¯†é’¥"></a>åˆ›å»ºç”¨äº ä»£ç ç­¾å çš„å­å¯†é’¥</h3><h4 id="æ£€æŸ¥å¯†é’¥é‚®ç®±"><a href="#æ£€æŸ¥å¯†é’¥é‚®ç®±" class="headerlink" title="æ£€æŸ¥å¯†é’¥é‚®ç®±"></a>æ£€æŸ¥å¯†é’¥é‚®ç®±</h4><blockquote>
<p>å¤‡æ³¨: å¦‚æœåœ¨<a href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8">åˆæ¬¡ä½¿ç”¨</a>çš„æ—¶å€™è¾“å…¥çš„é‚®ç®±ä¸æ˜¯ <code>GitHub</code> æˆ–è€… <code>GitLab</code> çš„é‚®ç®±ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆéœ€è¦åœ¨ç¼–è¾‘å¯†é’¥ <code>gpg --expert --edit-key D188A1DD832AB894</code> çš„äº¤äº’ä¸­é€šè¿‡ <code>adduid</code> ç»™ä¸»å¯†é’¥æ·»åŠ å¯¹åº”çš„é‚®ç®±ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --edit-key D188A1DD832AB894 <span class="comment"># ç¼–è¾‘ä¸»å¯†é’¥</span></span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">ç§é’¥å¯ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt; adduid</span><br><span class="line">çœŸå®å§“åï¼š github name <span class="comment"># GitHub/GitLab ç”¨æˆ·åï¼ˆä¹Ÿå¯ä»¥ä¸å’Œç”¨æˆ·åä¸€è‡´ï¼‰</span></span><br><span class="line">ç”µå­é‚®ä»¶åœ°å€ï¼š github@gmail.com <span class="comment"># GitHub/GitLab é‚®ç®±ï¼ˆå¿…é¡»ä¸€è‡´ï¼‰</span></span><br><span class="line">æ³¨é‡Šï¼š github <span class="comment"># å¯é€‰</span></span><br><span class="line">æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š</span><br><span class="line">    â€œgithub name (github) &lt;github@gmail.com&gt;â€</span><br><span class="line"></span><br><span class="line">æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ O</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1)  zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">[ æœªçŸ¥ ] (2). github name (github) &lt;github@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt; save <span class="comment"># save ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹å¯†é’¥ä¿¡æ¯å°±å¯ä»¥çœ‹åˆ°å·²ç»åŒ…å«æ–°çš„ <code>uid</code> äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] github name (github) &lt;github@gmail.com&gt;</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿæˆå­å¯†é’¥-1"><a href="#ç”Ÿæˆå­å¯†é’¥-1" class="headerlink" title="ç”Ÿæˆå­å¯†é’¥"></a>ç”Ÿæˆå­å¯†é’¥</h4><p>å’Œä¸Šé¢ç”Ÿæˆ<a href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E4%BA%8E-SSH-%E9%89%B4%E6%9D%83%E7%9A%84%E5%AD%90%E5%AF%86%E9%92%A5">åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥</a>å­å¯†é’¥çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå®šä¹‰å¯†é’¥åŠŸèƒ½ã€‚æ‰€ä»¥ä¸å¿…ä½¿ç”¨ <code>--expert</code> å‚æ•°</p>
<p>è¿™é‡Œå¯†é’¥ç±»å‹å¯ä»¥é€‰æ‹© <code>ECC</code> ä¹Ÿå¯ä»¥é€‰æ‹© <code>RSA</code>ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸ç®¡æ˜¯ <code>ECC</code> è¿˜æ˜¯ <code>RSA</code>ï¼Œéƒ½éœ€è¦é€‰æ‹©åŒ…å« <code>ä»…ç”¨äºç­¾å</code> çš„é€‰é¡¹ã€‚</p>
<p>è¿™é‡Œæˆ‘å°±ç”¨ <code>ECC</code> ä¸¾ä¾‹ï¼Œå…·ä½“è¿‡ç¨‹å°±ä¸å†èµ˜è¿°ï¼Œå’Œä¸Šé¢<a href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E5%AF%86%E9%92%A5">åˆ›å»ºå­å¯†é’¥</a>çš„è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯æ²¡æœ‰äº†è‡ªå®šä¹‰å¯†é’¥åŠŸèƒ½ï¼Œè¿‡ç¨‹æ›´ç®€å•äº†ã€‚</p>
<p>åˆ›å»ºå®ŒæˆååŒæ ·è®°å¾—ä½¿ç”¨ <code>save</code> ä¿å­˜åè‡ªåŠ¨é€€å‡º <code>GPG</code> çš„äº¤äº’ç¯å¢ƒï¼Œç„¶åæŸ¥è¯¢ä¸€ä¸‹å½“å‰çš„å¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] github name (github) &lt;github@gmail.com&gt;</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br><span class="line">sub   ed25519/0623CAE2AAFF25C2 2024-03-24 [S]</span><br></pre></td></tr></table></figure>

<p>å°±çœ‹åˆ°äº†æ–°åˆ›å»ºçš„å¯†é’¥ <code>0623CAE2AAFF25C2</code> ç”¨é€”åªæœ‰ <code>[S]</code>ï¼Œåªç”¨äºç­¾åã€‚</p>
<h4 id="æŸ¥è¯¢å­å¯†é’¥å…¬é’¥"><a href="#æŸ¥è¯¢å­å¯†é’¥å…¬é’¥" class="headerlink" title="æŸ¥è¯¢å­å¯†é’¥å…¬é’¥"></a>æŸ¥è¯¢å­å¯†é’¥å…¬é’¥</h4><p>é€šè¿‡ <code>--export</code> æŸ¥è¯¢å­å¯†é’¥å…¬é’¥ï¼Œä½†æ˜¯é»˜è®¤æ˜¯äºŒè¿›åˆ¶çš„æ ¼å¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦ <code>--armor</code> æ˜¾ç¤ºä¸ºæ–‡æœ¬æ ¼å¼æ‰èƒ½ä½¿ç”¨ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --armor --<span class="built_in">export</span> 0623CAE2AAFF25C2! <span class="comment"># æ³¨æ„è¿™é‡Œåœ¨å¯†é’¥æ‘˜è¦æœ«å°¾æœ‰ä¸€ä¸ªè‹±æ–‡çš„æ„Ÿå¹å·!</span></span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">mDMEZf+fkxYJKwYBBAHaRw8BAQdA8JIOJ9bqkGIH/b2Q5B8iLeYC7KhGy8I5AesQ</span><br><span class="line">Vgt2eju0J2dpdGh1YiBuYW1lIChnaXRodWIpIDxnaXRodWJAZ21haWwuY29tPoiT</span><br><span class="line">BBMWCgA7FiEEox9uUiuTmQyhocVI0Yih3YMquJQFAmX/pYwCGwMFCwkIBwICIgIG</span><br><span class="line">FQoJCAsCBBYCAwECHgcCF4AACgkQ0Yih3YMquJSl/wEAqpJRTjfRuUiCrYuIPech</span><br><span class="line">ffae/iYtz4St5xtgsgfVRi8BAPcAU9+HLFHZCK80vpiEVlp1jhCIUihetVuxzTJ6</span><br><span class="line">6x8AtBt6ZWJlZHkgPHplYmVkeUBleGFtcGxlLmNvbT6IkwQTFgoAOxYhBKMfblIr</span><br><span class="line">k5kMoaHFSNGIod2DKriUBQJl/5+TAhsDBQsJCAcCAiICBhUKCQgLAgQWAgMBAh4H</span><br><span class="line">AheAAAoJENGIod2DKriUPxgA/1g/tpw/gRrf6zwCVPQfuG5pgV25nqJlHNLqKv2c</span><br><span class="line">k8+FAP4ri6zN9Ay5QQX1lEU3xQROGq53irN/ZPBI6d0EP9q5B7gzBGX/pv8WCSsG</span><br><span class="line">AQQB2kcPAQEHQIrZWY1psJL/ELYuNi5lXSSUeWLw8wjHA+YvDiLxUyiXiO8EGBYK</span><br><span class="line">ACAWIQSjH25SK5OZDKGhxUjRiKHdgyq4lAUCZf+m/wIbAgCBCRDRiKHdgyq4lHYg</span><br><span class="line">BBkWCgAdFiEEhVrKN2SCNk5enPJMBiPK4qr/JcIFAmX/pv8ACgkQBiPK4qr/JcKo</span><br><span class="line">qAD9HGRow6SUGM7ySZXLxPa/AWa2iHnmbru3z7HheRSZ4q8A/jiCY75rPpsOjT6k</span><br><span class="line">rRejWTCDEJFL5SLdnWSsFwzbTQUE5FUA/j/CphTxuujBMdu/52EHwYg5Bo2+eeLp</span><br><span class="line">AFNyPSyt71g0AQDNhS5X8GQ1GSBZ5CvBRZ/fRd0vShn3kikkTt51UP9OBA==</span><br><span class="line">=qGsF</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆè¦åœ¨æ‘˜è¦æœ«å°¾æ·»åŠ ä¸€ä¸ª <code>!</code> å·å‘¢ï¼Ÿ</p>
<p>å› ä¸ºå¦‚æœæ²¡æœ‰è¿™ä¸ªæ„Ÿå¹å·åˆ™ä¼šå¯¼å‡ºè¿™ä¸ªå­å¯†é’¥æ‰€å±çš„ä¸»å¯†é’¥ä¸‹çš„æ‰€æœ‰å…¬é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --armor --<span class="built_in">export</span> 0623CAE2AAFF25C2 <span class="comment"># è¿™é‡Œæ²¡æœ‰æ„Ÿå¹å·ï¼Œå‘ç°å†…å®¹ç›¸æ¯”ä¸Šé¢é•¿äº†å¾ˆå¤š</span></span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">mDMEZf+fkxYJKwYBBAHaRw8BAQdA8JIOJ9bqkGIH/b2Q5B8iLeYC7KhGy8I5AesQ</span><br><span class="line">Vgt2eju0J2dpdGh1YiBuYW1lIChnaXRodWIpIDxnaXRodWJAZ21haWwuY29tPoiT</span><br><span class="line">BBMWCgA7FiEEox9uUiuTmQyhocVI0Yih3YMquJQFAmX/pYwCGwMFCwkIBwICIgIG</span><br><span class="line">FQoJCAsCBBYCAwECHgcCF4AACgkQ0Yih3YMquJSl/wEAqpJRTjfRuUiCrYuIPech</span><br><span class="line">ffae/iYtz4St5xtgsgfVRi8BAPcAU9+HLFHZCK80vpiEVlp1jhCIUihetVuxzTJ6</span><br><span class="line">6x8AtBt6ZWJlZHkgPHplYmVkeUBleGFtcGxlLmNvbT6IkwQTFgoAOxYhBKMfblIr</span><br><span class="line">k5kMoaHFSNGIod2DKriUBQJl/5+TAhsDBQsJCAcCAiICBhUKCQgLAgQWAgMBAh4H</span><br><span class="line">AheAAAoJENGIod2DKriUPxgA/1g/tpw/gRrf6zwCVPQfuG5pgV25nqJlHNLqKv2c</span><br><span class="line">k8+FAP4ri6zN9Ay5QQX1lEU3xQROGq53irN/ZPBI6d0EP9q5B7g4BGX/n5MSCisG</span><br><span class="line">AQQBl1UBBQEBB0DLVTiDrM7loVyWzEQPpHDjsjtUz6tKLINI+I4Sr1pfWQMBCAeI</span><br><span class="line">eAQYFgoAIBYhBKMfblIrk5kMoaHFSNGIod2DKriUBQJl/5+TAhsMAAoJENGIod2D</span><br><span class="line">KriUPiYA/j2FEaBqUYpR497NgPggF0WNe55OJGF38ER3WqFOTcxzAP9vPRsBp+Jx</span><br><span class="line">s4MHTfnU+v7XZNNASWeomn8/+9+241kWDrkCDQRl/6GfARAAuoLgwPohBWXtqKeP</span><br><span class="line">GriC8QpDeiEVibLaadV/4jbaIRHFKQcSd4NKjCojEJxRzk7C9DwnItiH5oO+NAxO</span><br><span class="line">UVgvkD4QIiQpf1U+p1CuME/sMftAqLHkBIPUS1p6uvlmF4thixCmSyHcb6XK7Jui</span><br><span class="line">GhCFJPGfAjG7iaHBazngBrFfRfULESBcqhjcPL+v/qwQw2XXxmyq6eeIXjTOtWLb</span><br><span class="line">1Q7UkgoDKtIhVvJpcUdRd3oGon3yYnfy1lpQ4bdeZ3QfAvuWSKSv026+mx8vVVp2</span><br><span class="line">1zpsT+DAS+Esk1JBILwKjBBuT1okuj7H1G5L1kzUcekxuUbGe17tAFXAev/2RB5I</span><br><span class="line">2XiHlvYJTH+7Qtx/G4aWnQ3A7rDwnib9OE7gJBY2GVVEgp70dalVMXulUfa4ROrQ</span><br><span class="line">YvOmBp4LyEXFh41Xu6NQokC0hQKfU+bw9R40aPEOqZyj+LKuuo1x+tTK4SzIS0Ld</span><br><span class="line">0Va8lntgJT2LXGD5Vka5eLo96PEyjUA4QRTu7TLLB6OO+HgudHqc6XTqAuHrcx3C</span><br><span class="line">CFZjCkp70pdWeOi1IJJnIC+Fo9DU6gVsefChSo6WAE+XXGYrL1LBjOqWxYBSUS0V</span><br><span class="line">HI4m4kd75tx9+KdPL2i2FuZXTiSsE3+faxokSP4pXmPtcaQbG3OPDwQMl9d+N9y4</span><br><span class="line">MPU50b43fjr5Jmuz1P0KCTypvksAEQEAAYhvBBgWCgAhFiEEox9uUiuTmQyhocVI</span><br><span class="line">0Yih3YMquJQFAmX/oZ8DGyAEAACPZwD9GPj32r7XUNSffp2lPSNhV8eAMVxzdkov</span><br><span class="line">lYEWNJuCTZ0A/3gCT77sacaH3jDmoeT8yhFxA4YR8CcVteiXt3/RVCAAuDMEZf+m</span><br><span class="line">/xYJKwYBBAHaRw8BAQdAitlZjWmwkv8Qti42LmVdJJR5YvDzCMcD5i8OIvFTKJeI</span><br><span class="line">7wQYFgoAIBYhBKMfblIrk5kMoaHFSNGIod2DKriUBQJl/6b/AhsCAIEJENGIod2D</span><br><span class="line">KriUdiAEGRYKAB0WIQSFWso3ZII2Tl6c8kwGI8riqv8lwgUCZf+m/wAKCRAGI8ri</span><br><span class="line">qv8lwqioAP0cZGjDpJQYzvJJlcvE9r8BZraIeeZuu7fPseF5FJnirwD+OIJjvms+</span><br><span class="line">mw6NPqStF6NZMIMQkUvlIt2dZKwXDNtNBQTkVQD+P8KmFPG66MEx27/nYQfBiDkG</span><br><span class="line">jb554ukAU3I9LK3vWDQBAM2FLlfwZDUZIFnkK8FFn99F3S9KGfeSKSRO3nVQ/04E</span><br><span class="line">=7KWW</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬åªéœ€è¦è¿™ä¸ªå­å¯†é’¥ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>!</code> åªåŒ…å«è¯¥å­å¯†é’¥çš„å…¬é’¥å°±è¡Œã€‚</p>
<p>ç„¶åå°†è¯¥å…¬é’¥æ·»åŠ åˆ° <code>GitHub</code> æˆ–è€… <code>GitLab</code> ä¸­å³å¯ã€‚</p>
<h4 id="é…ç½®-Git"><a href="#é…ç½®-Git" class="headerlink" title="é…ç½® Git"></a>é…ç½® Git</h4><p>ç»™ Git å…¨å±€é…ç½®ç­¾å Key</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global user.signingkey 0623CAE2AAFF25C2!</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸éœ€è¦è‡ªåŠ¨ä½¿ç”¨ GPG ç­¾åä»£ç ï¼Œå¯ä»¥æ¯æ¬¡åœ¨ <code>commit</code> çš„æ—¶å€™ä½¿ç”¨ <code>-S</code> å‚æ•°ï¼ˆå¤§å†™ Sï¼‰è¿›è¡Œç­¾å</p>
<p>å¦‚æœæƒ³æäº¤çš„æ—¶å€™è‡ªåŠ¨ç­¾åï¼Œå¯ä»¥è¿›è¡Œé…ç½®ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ¬¡æäº¤ä»£ç åå°±å¯ä»¥æŸ¥çœ‹ç­¾åä¿¡æ¯äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --show-signature</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ <code>push</code> åˆ° <code>GitHub</code> ä¸Šåä¹Ÿå¯ä»¥çœ‹åˆ°æäº¤æœ‰ä¸€ä¸ª <code>verified</code> çš„æ ‡è®°ã€‚</p>
<p>è‡³æ­¤ï¼Œåˆ›å»ºç”¨äºä»£ç ç­¾åçš„å­å¯†é’¥ç»“æŸã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨</title>
    <url>/post/8d4f8799.html</url>
    <content><![CDATA[<p>å¤§æ¦‚ä»Šå¹´ï¼ˆ2022ï¼‰ä¸€æœˆä¸­æ—¬çš„æ—¶å€™å…¥æ‰‹äº†ä¸€ä¸ª <span class="exturl" data-url="aHR0cHM6Ly9yODZzLm5ldC8=">R86S<i class="fa fa-external-link-alt"></i></span> çš„å°ä¸»æœºã€‚å› ä¸ºé”™è¿‡äº†ä¼—ç­¹çš„è½¦ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥ä¸‹çš„å•ã€‚æœ€åå…¥æ‰‹äº† 16G çš„é»‘è‰²åƒå…†ç‰ˆæœ¬ã€‚ä¸ä¸Šä¸‡å…†ä¸€ä¸ªåŸå› æ˜¯å®¶é‡Œæ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ä¸‡å…†ç‰ˆçš„æ²¡æœ‰ NVME ç¡¬ç›˜ä½ï¼Œè¿™ä¸€ç‚¹å¯¹æˆ‘è¿˜æ˜¯åˆšéœ€ã€‚</p>
<span id="more"></span>

<p>æœ€åç”¨äº†å·®ä¸å¤šä¸€å‘¨çš„æ—¶é—´ï¼Œç»ˆäºåœ¨å¹´å‰ï¼Œè¿™ä¸ªå¿ƒå¿ƒå¿µçš„å°ä¸»æœºåˆ°æ‰‹äº†ã€‚<br>æœ‰å…³è¿™ä¸ªå°ä¸»æœºæˆ‘å°±ä¸å¤šåšä»‹ç»äº†ï¼Œä»Šå¤©ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹æˆ‘æ€ä¹ˆç”¨å®ƒåœ¨æˆ‘çš„å®¶åº­ç¯å¢ƒæ­å»ºä¸€ä¸ªç§äººçš„ GitLabã€‚è¿™ç¯‡æ–‡ç« ä»æˆ‘ä¸ºä»€ä¹ˆè¦æ­å»ºå®¶åº­ç§äºº GitLab ä»¥åŠå¦‚ä½•æ­å»ºã€‚éƒ½ä¼šéƒ½åšä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚</p>
<h1 id="åˆè¡·"><a href="#åˆè¡·" class="headerlink" title="åˆè¡·"></a>åˆè¡·</h1><p>å®¶é‡Œæ˜¯æœ‰ä¸€ä¸ª J4125 çš„è½¯è·¯ç”±ï¼Œå»å¹´å¾ˆæ—©å°±ä¹°äº†ã€‚ä¸€ç›´åœ¨æˆ‘å®¶ä½œä¸ºä¸»è·¯ç”±è´Ÿè´£æ‹¨å·å’Œç§‘å­¦ä¸Šç½‘çš„åŠŸèƒ½ï¼Œç”¨çš„ OpenWrt ä¹Ÿæ˜¯æˆ‘è‡ªå·±é…ç½®å’Œ GitHub Action ç¼–è¯‘çš„ï¼Œä¹Ÿæ»¡è¶³äº†æˆ‘å®¶çš„åŸºæœ¬éœ€æ±‚ã€‚è€Œä¸”ä¹Ÿå› ä¸ºæ˜¯ç‰©ç†æœºç›´è£…ï¼Œå†åŠ ä¸Šå®³æ€• J4125 ç©èµ·æ¥æ€•æ€§èƒ½ä¸å¤Ÿï¼Œå†å½±å“äº†æ­£å¸¸çš„ç½‘ç»œã€‚æ‰€ä»¥ä¹Ÿå°±ä¸æƒ³å†æŠ˜è…¾ä»–äº†ï¼Œå°±è®©ä»–å®‰å®‰å¿ƒå¿ƒåšæˆ‘å®¶çš„è·¯ç”±å™¨å°±å¥½äº†ã€‚</p>
<p>ä½†ä¸æ­¤åŒæ—¶å‘¢ï¼Œä½œä¸ºä¸€ä¸ªçˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜ï¼Œèº«è¾¹çš„å¾ˆå¤šä¸ç®¡æ˜¯ç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶çš„å°ç©æ„å„¿éƒ½æ˜¯æœ‰ç‰¹åˆ«çš„éœ€æ±‚çš„ã€‚</p>
<p>å°±æ¯”å¦‚å»å¹´ï¼ˆ2021ï¼‰å¹´ä¹°çš„ä¸€ä¸ª <span class="exturl" data-url="aHR0cHM6Ly9kcm9wLmNvbS9idXkvc3RhY2stb3ZlcmZsb3ctdGhlLWtleS1tYWNyb3BhZA==">STACK OVERFLOW THE KEY MACROPAD<i class="fa fa-external-link-alt"></i></span> é”®ç›˜ï¼Œé…ä¸Šä»æ·˜å®ä¹°çš„é”®å¸½ï¼Œå› ä¸ºä½¿ç”¨ QMK çš„é”®ç›˜æ–¹æ¡ˆï¼Œæ‰€ä»¥å¯ä»¥å®šåˆ¶å›ºä»¶ã€‚ç°åœ¨å·²ç»æˆä¸ºäº†æˆ‘çš„ä¸“ç”¨å¯†ç è¾“å…¥å™¨ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨è¿˜å°è¯•çœ‹ä»–è¿˜æœ‰æ²¡åˆ«çš„å¥½ç©çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘éœ€è¦å¯¹è¿™ä¸ªé”®ç›˜å›ºä»¶çš„ä»£ç ä¸æ–­è¿›è¡Œä¿®æ”¹ã€ç¼–è¯‘ã€åˆ·å…¥ï¼Œç„¶åå†å°è¯•ä¿®æ”¹ã€ç¼–è¯‘ã€åˆ·å…¥ã€‚è¿™æ ·çš„æ“ä½œé‡å¤èµ·æ¥ä¼šè®©äººå¾ˆç¹çï¼Œä½†æ˜¯å› ä¸ºå›ºä»¶ä¸­å­˜åœ¨ä¸€äº›æ•æ„Ÿä»£ç ï¼ˆæ¯”å¦‚æˆ‘çš„å„ç§å¯†ç ï¼‰æ‰€ä»¥ä¸æ–¹ä¾¿æ‰˜ç®¡åˆ° GitHubã€‚æ‰€ä»¥ä¹‹å‰æˆ‘å°±åœ¨æƒ³è¦æ˜¯èƒ½æœ‰ä¸€ä¸ªç§äººçš„ Git å¤šå¥½ã€‚é™¤äº†ä»£ç çš„æ‰˜ç®¡ï¼Œå¦‚æœè¿˜å¯ä»¥åŠ å…¥ CI&#x2F;CD è¿™ç§æŒç»­é›†æˆçš„èƒ½åŠ›ï¼Œå°±å¯ä»¥è§£æ”¾å¾ˆå¤šæ— è°“çš„é‡å¤çš„åŠ³åŠ¨ã€‚è€Œèƒ½åŒæ—¶æ»¡è¶³è¿™ä¸ªéœ€æ±‚çš„è®©æˆ‘æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ GitLab äº†ã€‚</p>
<p>é™¤äº†ä¸Šé¢è¯´çš„é‚£ä¸ªé”®ç›˜å›ºä»¶ï¼Œè¿˜æœ‰æ¯”å¦‚è¯´æˆ‘çš„ Rimeï¼ˆé¼ é¡»ç®¡ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºè¯åº“ä¸­æœ‰å¾ˆå¤šçš„è‡ªå®šä¹‰è¯ï¼Œä»¥åŠè¿˜æœ‰äººåé€šè®¯åœ°å€ä¹‹ç±»çš„æ•æ„Ÿè¯ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸æ–¹ä¾¿æŠŠè¿™ä¸ªé…ç½®ç›´æ¥æ‰˜ç®¡åœ¨ GitHub ä¸Šçš„ã€‚</p>
<p>è¿˜æœ‰ç°åœ¨çœ‹åˆ°çš„è¿™ä¸ªåšå®¢ï¼Œç”¨ Hexo ç”Ÿæˆçš„ GitHub Pages é™æ€é¡µé¢ï¼Œåšå®¢æœ¬èº«çš„ä»£ç æˆ‘ä¸æƒ³æ”¾åˆ° GitHub ä¸Šï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„æˆ‘ä¹Ÿéœ€è¦ä¸€ä¸ªç§äººçš„ GitLabã€‚é™¤äº†èƒ½å®ç°ä»£ç çš„æ‰˜ç®¡ï¼Œè¿˜èƒ½é¡ºä¾¿åˆ©ç”¨ GitLab CI å®ç°ä¸€é”®å‘å¸ƒï¼Œæ¯æ¬¡åªè¦æäº¤äº†ä»£ç ï¼Œç¨ç­‰ç‰‡åˆ» GitHub Pages å°±è‡ªåŠ¨éƒ¨ç½²å¥½äº†ã€‚</p>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šã€‚ç°åœ¨æœ‰äº† R86S è¿™æ ·ä¸€ä¸ªæ€§èƒ½è·Ÿå¾—ä¸Šçš„å°ä¸»æœºï¼Œåœ¨ä¸œè¥¿åˆ°è´§çš„ç¬¬äºŒå¤©ï¼Œå°±å¼€å§‹äº†ä»–çš„æŠ˜è…¾ä¹‹è·¯ã€‚</p>
<h2 id="å®‰è£…ç¡¬ä»¶"><a href="#å®‰è£…ç¡¬ä»¶" class="headerlink" title="å®‰è£…ç¡¬ä»¶"></a>å®‰è£…ç¡¬ä»¶</h2><p>å› ä¸ºè¿™ä¸ª R86S åªå¸¦äº†ä¸€ä¸ªç”µæºï¼Œå†…ç½®çš„ä¸€ä¸ª EMMC å®¹é‡åªæœ‰ 128G ä¸”æ€§èƒ½å ªå¿§ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯å®‰è£…ä¸€ä¸ªè‡ªå·±çš„ NVME å›ºæ€ã€‚è®°å¾—ä¹‹å‰æœ‰ä¸€å—ä¹°å¤šäº†çš„åƒç°ä¸‰æ˜Ÿ 980 Pro 500Gï¼Œéƒ½æ²¡æœ‰å¼€å°ã€‚ä¹‹å‰è¿˜å·®ç‚¹ç»™æŒ‚åˆ°æµ·é²œå¸‚åœºå‡ºæ‰ï¼Œç°åœ¨ç»ˆäºæ´¾ä¸Šç”¨åœºäº†ã€‚<br>å®‰è£…å¥½ç¡¬ç›˜ç„¶åæ‰¾ä¸€ä¸ªç½‘çº¿ï¼Œè¿æ¥å¥½è·¯ç”±å™¨çš„ LAN å£å’Œ R86S çš„éšä¾¿ä¸€ä¸ªç½‘å£ã€‚è¿æ¥å¥½é”®ç›˜é¼ æ ‡ï¼Œå°±å¯ä»¥æ’ä¸Šç”µæºè‡ªåŠ¨ä¸Šç”µå¼€æœºäº†ã€‚</p>
<h2 id="å®‰è£…ç³»ç»Ÿ"><a href="#å®‰è£…ç³»ç»Ÿ" class="headerlink" title="å®‰è£…ç³»ç»Ÿ"></a>å®‰è£…ç³»ç»Ÿ</h2><p>æ—¢ç„¶æ˜¯æ˜¯è¦åšå°å‹æœåŠ¡å™¨ï¼Œå“ªæœ‰ç”¨æ¡Œé¢æ“ä½œç³»ç»Ÿçš„ã€‚æ‰€ä»¥è¿™é‡Œå°±é€‰æ‹©äº† <span class="exturl" data-url="aHR0cHM6Ly91YnVudHUuY29tL2Rvd25sb2FkL3NlcnZlcg==">Ubuntu Server 20.04.3 LTS<i class="fa fa-external-link-alt"></i></span>ã€‚ä¸‹è½½å®Œé•œåƒåï¼Œå†™å…¥åˆ° U ç›˜ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡ U ç›˜ å¯åŠ¨å°±å¯ä»¥è¿›å®‰è£…ç¯èŠ‚äº†ã€‚<br>å®‰è£…ç³»ç»Ÿæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹</p>
<ol>
<li><p>åˆ†é… IP åœ°å€çš„æ–¹å¼</p>
<p>åœ¨è¿›è¡Œç½‘ç»œé…ç½®çš„æ—¶å€™ï¼Œæ—¢å¯ä»¥é€šè¿‡ DHCP åŠ¨æ€åˆ†é… IPï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šã€‚å¦‚æœæ˜¯ DHCP åˆ†é…ï¼Œåˆ™åç»­éœ€è¦åˆ°è·¯ç”±å™¨ä¸­ç»‘å®šä¸€ä¸‹ Mac åœ°å€å’Œ IPï¼Œæ¯•ç«Ÿæˆ‘ä»¬åœ¨å†…ç½‘è®¿é—®ä¹Ÿæ˜¯éœ€è¦æœ‰ä¸€ä¸ªå†…ç½‘çš„å›ºå®š IPã€‚é€šè¿‡æ‰‹åŠ¨æŒ‡å®š IP åœ°å€ï¼Œè¦æ³¨æ„ä¸è¦å’Œç°æœ‰åˆ†é…çš„çš„åœ°å€å†²çªã€‚æ‰‹åŠ¨æŒ‡å®š IP å°±ä¸éœ€è¦åç»­åˆ°è·¯ç”±å™¨ç»‘å®š Mac åœ°å€å’Œ IP äº†ã€‚</p>
</li>
<li><p>é€‰æ‹©å®‰è£…ç¡¬ç›˜</p>
<p>å› ä¸ºä¸»æ¿ä¸Šå¸¦ä¸€ä¸ª EMMCï¼Œæ‰€ä»¥åœ¨é€‰æ‹©ç¡¬ç›˜çš„æ—¶å€™è®°å¾—é€‰è‡ªå·±å®‰è£…çš„ NVME SSD ä¸Šï¼Œè€Œä¸”è°ƒæ•´æ ¹ç›®å½•å¤§å°è°ƒæ•´ä¸ºå‰©ä½™ SSD æ‰€ç”±ç©ºé—´ã€‚å¦åˆ™æ ¹ç›®å½•é»˜è®¤åªåˆ’åˆ†äº† 100Gï¼Œåé¢è¿›å…¥ç³»ç»Ÿåè¿˜éœ€è¦æ‰‹åŠ¨æ‰©å®¹ã€‚</p>
</li>
<li><p>å®‰è£…åä¿®æ”¹ç½‘ç»œé…ç½®</p>
<p>å®‰è£…å®Œç³»ç»Ÿåé‡æ–°å¯åŠ¨æœ‰å¯èƒ½ä¼šå‡ºç°æ—¥å¿— <code>A start job is running for wait for network to be configured.</code> å¯¼è‡´éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½è¿›å…¥ç³»ç»Ÿã€‚è¿™æ—¶å€™éœ€è¦ç­‰è¿›åˆ°ç³»ç»Ÿåä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶</p>
<p><code>/etc/netplan/00-installer-config.yaml</code>ï¼ˆæ–‡ä»¶å <code>00-installer-config.yaml</code> ä¸å›ºå®šï¼Œä½†æ˜¯æ–‡ä»¶åç±»ä¼¼çš„ä¸€ä¸ª <code>yaml</code> æ–‡ä»¶)</p>
<p>åœ¨æ¯ä¸€ä¸ªè®¾å¤‡ä¸‹é¢æ·»åŠ  <code>optional: true</code></p>
<p>æœ€åçš„é…ç½®åº”è¯¥ç±»ä¼¼</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp1s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp2s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååº”ç”¨æ›´æ”¹</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netplan <span class="built_in">apply</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="åˆ›å»º-GitLab-å¤‡ä»½ä½ç½®"><a href="#åˆ›å»º-GitLab-å¤‡ä»½ä½ç½®" class="headerlink" title="åˆ›å»º GitLab å¤‡ä»½ä½ç½®"></a>åˆ›å»º GitLab å¤‡ä»½ä½ç½®</h2><p>ä¸Šé¢è¯´åˆ°äº†ï¼Œè¿™ä¸ª R86S è‡ªå¸¦ä¸€ä¸ª 128G çš„ EMMC å­˜å‚¨ï¼Œè™½ç„¶æ€§èƒ½æ¯”è¾ƒå·®ï¼Œä½†æ˜¯ä¸œè¥¿ä¸èƒ½æµªè´¹äº†ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘æ‹¿æ¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ GitLab æ•°æ®å¤‡ä»½å­˜å‚¨ï¼Œå³ä½¿æ˜¯ä¸»ç¡¬ç›˜æŒ‚äº†ï¼Œè¿˜æœ‰ä¸€ä»½ç‹¬ç«‹çš„å¤‡ä»½å­˜åœ¨ï¼Œè€Œä¸”çŸ­æ—¶é—´å†… 128G è¿˜æ˜¯å¤Ÿç”¨çš„ã€‚</p>
<h3 id="åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº"><a href="#åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº"></a>åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> cfdisk /dev/mmcblk0        <span class="comment"># mmcblk0 æ˜¯ EMMC è®¾å¤‡</span></span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 /dev/mmcblk0     <span class="comment"># æ ¼å¼åŒ–ä¸º ext4</span></span><br></pre></td></tr></table></figure>

<h3 id="æŒ‚è½½åˆ°-mmc"><a href="#æŒ‚è½½åˆ°-mmc" class="headerlink" title="æŒ‚è½½åˆ° &#x2F;mmc"></a>æŒ‚è½½åˆ° &#x2F;mmc</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/fstab</span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line">/dev/mmcblk0 /mmc ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-GitLab"><a href="#å®‰è£…-GitLab" class="headerlink" title="å®‰è£… GitLab"></a>å®‰è£… GitLab</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y curl openssh-server ca-certificates tzdata perl</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ -GitLab-æº"><a href="#æ·»åŠ -GitLab-æº" class="headerlink" title="æ·»åŠ  GitLab æº"></a>æ·»åŠ  GitLab æº</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | <span class="built_in">sudo</span> bash</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-GitLab-1"><a href="#å®‰è£…-GitLab-1" class="headerlink" title="å®‰è£… GitLab"></a>å®‰è£… GitLab</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gitlab-ce</span><br></pre></td></tr></table></figure>

<h3 id="è·å–-root-ç”¨æˆ·å¯†ç "><a href="#è·å–-root-ç”¨æˆ·å¯†ç " class="headerlink" title="è·å– root ç”¨æˆ·å¯†ç "></a>è·å– root ç”¨æˆ·å¯†ç </h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/gitlab/initial_root_password</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶åé¢ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚å› æ­¤è¯·åŠæ—¶ä¿ç®¡å¥½è¯¥å¯†ç æˆ–è€…åŠæ—¶è¿›è¡Œä¿®æ”¹ã€‚</strong></p>
<h3 id="é…ç½®-GitLab"><a href="#é…ç½®-GitLab" class="headerlink" title="é…ç½® GitLab"></a>é…ç½® GitLab</h3><p>å¦‚æœä¸Šé¢å‡ æ­¥éƒ½æ¯”è¾ƒé¡ºåˆ©ï¼Œä¸å‡ºæ„å¤–ï¼Œç°åœ¨åº”è¯¥å·²ç»åœ¨è¿™ä¸ªç³»ç»Ÿä¸­å®‰è£…å¥½äº† GitLabã€‚æ¥ä¸‹æ¥å…ˆè¿›è¡Œä¸€äº›ç®€è¦åœ°é…ç½®ã€‚</p>
<p>GitLab çš„é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/gitlab/gitlab.rb</code></p>
<p>æˆ‘å®¶ OpenWrt ä¸»è·¯ç”±åœ¨ DHCP ä¸­è®¾ç½®çš„ <code>æœ¬åœ°æœåŠ¡å™¨</code> å’Œ <code>æœ¬åœ°åŸŸå</code> åˆ†åˆ«ä¸º <code>/home/</code> å’Œ <code>home</code>ï¼ŒåŒæ—¶æˆ‘ä¹Ÿå¸Œæœ›èƒ½é€šè¿‡åŸŸåè®¿é—®è¿™ä¸ª GitLab æœåŠ¡å™¨ã€‚æ‰€ä»¥æˆ‘è¿˜æ·»åŠ äº†ä¸€æ¡ <code>è‡ªå®šä¹‰æŒŸæŒåŸŸå</code>ï¼Œå…¶ä¸­åŸŸåä¸º <code>git</code>ï¼ŒIP åœ°å€ä¸º R86S åˆ†é…çš„å›ºå®š IPï¼ˆæ¯”å¦‚æˆ‘å®¶çš„æ˜¯ <code>192.168.50.50</code>ï¼‰ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥é€šè¿‡åŸŸå <code>http://git.home</code> æ¥è®¿é—®è¿™ä¸ª GitLab æœåŠ¡å™¨äº†ã€‚</p>
<p>æ ¹æ®ä»¥ä¸Šå‰æï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹çš„å‡ ä¸ªåœ°æ–¹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">external_url</span> <span class="string">&#x27;http://git.home&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;gitlab_ssh_host&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;git.home&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;time_zone&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;backup_path&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;/mmc&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>backup_path</code> å³ä¸º <a href="#%E5%88%9B%E5%BB%BA-GitLab-%E5%A4%87%E4%BB%BD%E4%BD%8D%E7%BD%AE">EMMC è®¾å¤‡çš„æŒ‚è½½ç‚¹</a></p>
<p>ä¿®æ”¹å®Œ <code>gitlab.rb</code> åéœ€è¦é‡æ–°é…ç½® GitLab æ‰èƒ½ç”Ÿæ•ˆ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>

<p>ç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <span class="exturl" data-url="aHR0cDovL2dpdC5ob21lLw==">http://git.home<i class="fa fa-external-link-alt"></i></span> å°±å¯ä»¥çœ‹åˆ°æ­å»ºå¥½çš„ GitLab äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>åŒ—äº¬è”é€šå¼‚åœ°å®½å¸¦åŠç†æŒ‡å—</title>
    <url>/post/de583f28.html</url>
    <content><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒåŒ—äº¬è”é€šçš„å®½å¸¦æ˜¯çœŸçš„è´µã€‚ä¹‹å‰è”ç³»äº†è”é€šçš„å®½å¸¦ä¸“å‘˜ï¼Œå’¨è¯¢äº†ä¸€ä¸‹èåˆå¥—é¤ã€‚</p>
<ul>
<li>1000 Mbps ä¸‰å¹´åˆçº¦ 149 å…ƒ&#x2F;æœˆï¼ˆè¿™ä¸ªè¿˜æ˜¯æœ‰ä¼˜æƒ çš„ä»·æ ¼ï¼‰æå‰è§£çº¦è¿çº¦é‡‘ &#x3D; æœªå±¥çº¦æœˆæ•° âœ–ï¸ 30 å…ƒ</li>
<li>500 Mbps æ— åˆçº¦ 166 å…ƒ&#x2F;æœˆ</li>
</ul>
<p>å› ä¸ºæˆ‘å®¶æ‰€æœ‰çš„æ‰‹æœºå·éƒ½æ˜¯è”é€šçš„ï¼Œå¥—é¤ä¹Ÿéƒ½å¾ˆå¤Ÿç”¨ï¼Œæ‰€ä»¥èåˆå¥—çš„æ‰‹æœºå·å¥—é¤æ²¡å•¥ç”¨ã€‚äº†è§£åˆ°å¼‚åœ°å®½å¸¦ä»·æ ¼å¾ˆç¾ä¸½åå°±æƒ³ç€åŠä¸€ä¸ªã€‚</p>
<span id="more"></span>

<p>åŒ—äº¬åœ°åŒºçš„å¼‚åœ°å®½å¸¦åˆ†ä¸¤ç§</p>
<ul>
<li>300 Mbps 60 å…ƒ&#x2F;æœˆ</li>
<li>500 Mbps 80 å…ƒ&#x2F;æœˆ</li>
</ul>
<img src="https://images.zabrian.com/8ec6254c-3291-42f6-69b0-2c8d53f22901/origin" title="å¼‚åœ°å®½å¸¦å¥—é¤" style="zoom:62%;" />

<h1 id="åŠå¡"><a href="#åŠå¡" class="headerlink" title="åŠå¡"></a>åŠå¡</h1><p>æ—¢ç„¶æ˜¯å¼‚åœ°å®½å¸¦ï¼Œé¦–å…ˆæ˜¯éœ€è¦ä¸€ä¸ªå¼‚åœ°æ‰‹æœºå¡ã€‚åœ¨æŸå®æ‰¾äº†ä¸€ä¸ªåŠå¡ï¼Œé€‰äº†ä¸€ä¸ª 19 å—é’±çš„å¥—é¤ï¼Œåæ­£å°±æ˜¯èƒ½åŠå¤šä¾¿å®œå°±å¤šä¾¿å®œã€‚19 å·®ä¸å¤šå°±æ˜¯èƒ½åœ¨å¼€å¡çš„æœ€ä¾¿å®œäº†ã€‚å¼‚åœ°é€‰çš„å¤©æ´¥ï¼Œä¸»è¦å°±æ˜¯ç¦»åŒ—äº¬è¿‘ï¼Œæ–¹ä¾¿ã€‚</p>
<p>ç„¶åè®°å¾—è¯¢é—®ä¸€ä¸‹å¡æ˜¯ä¸æ˜¯èƒ½æ­£å¸¸æ”¹å¥—é¤åŠå®½å¸¦å•¥çš„ï¼Œåˆ«åŠç‰©è”ç½‘å¡å°±è¡Œï¼Œè¦åŠçš„ä¸€å®šæ˜¯æ­£å¸¸çš„æ‰‹æœºå¡ã€‚ç„¶åé…é€åœ°å€å†™ä¸€ä¸ªå¤©æ´¥çš„åœ°å€ï¼Œåƒä¸‡ä¸èƒ½å†™å¼‚åœ°ï¼Œå› ä¸ºå¤©æ´¥è”é€šä¸èƒ½å¼‚åœ°é…é€ã€‚å¿…é¡»è¦å¤©æ´¥æœ¬åœ°çš„åœ°å€ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å°±ç›´æ¥å†™åˆ°äº†å¤©æ´¥ç«™ã€‚</p>
<p>ç„¶åå°±æ˜¯æäº¤èº«ä»½è¯å•¥çš„å®¡æ ¸ï¼Œå½“å¤©å®¡æ ¸é€šè¿‡ä¸‹åˆæ˜¾ç¤ºå°±åˆ†é…äº†å°å“¥ä¸Šé—¨é€å¡ã€‚ç„¶åå°±æ˜¯æ‰“ç”µè¯ç»™å°å“¥æ”¹ä¸€ä¸‹æ—¶é—´ã€‚æ¯•ç«Ÿå½“å¤©ä¸‹åˆå·²ç» 3 ç‚¹äº†ï¼Œè¿˜åœ¨ä¸Šç­å’‹ï¼Œå¯èƒ½åˆ°å¤©æ´¥å–å¡ã€‚</p>
<p>ç„¶åæˆ‘å°±çº¦åˆ°äº†å‘¨å…­ä¸‹åˆ 3 ç‚¹äº†ã€‚ç„¶åå°±æ˜¯ä¹°äº†å‘¨å…­ 14:09 ~ 14:42 ä»åŒ—äº¬åˆ°å¤©æ´¥çš„å»ç¨‹ï¼Œ15:22 ~ 15:52 ä»å¤©æ´¥åˆ°åŒ—äº¬å—çš„è¿”ç¨‹ã€‚ä¸€å…±èŠ±äº† 100 è¿‡ç‚¹ã€‚</p>
<p>å½“å¤©ä¸Šè½¦ä¹‹åç»™å°å“¥æ‰“äº†ä¸ªç”µè¯ï¼Œè¯´äº†ä¸‹æ˜¯ä¸“ç¨‹æ¥åŠå¡çš„ï¼Œè¿”ç¨‹æ—¶é—´æ¯”è¾ƒç´§ï¼Œå¸Œæœ›èƒ½å°½å¿«åˆ°ã€‚å°å“¥è¡¨ç¤ºæ²¡é—®é¢˜ã€‚ç„¶åæˆ‘å¿«åˆ°ç«™çš„æ—¶å€™å°å“¥æ¥ç”µè¯äº†è¯´ä»–å·²ç»åˆ°äº†ï¼ˆd&#x3D;(Â´â–½ ï½€)&#x3D;bï¼‰</p>
<p>ç„¶åå°±å’Œå°å“¥åœ¨è½¦ç«™é‡Œé¢ç¢°ä¸Šé¢äº†ã€‚æ‹ç…§åŠå¡ä¸€æ°”å‘µæˆï¼Œå…¨ç¨‹èŠ±äº†ä¸åˆ° 5 åˆ†é’Ÿã€‚äº¤äº† 500 å—é’±è¯è´¹ç»“æŸã€‚ç„¶åè¿”ç¨‹å›å®¶ã€‚</p>
<h1 id="æ”¹å¥—é¤"><a href="#æ”¹å¥—é¤" class="headerlink" title="æ”¹å¥—é¤"></a>æ”¹å¥—é¤</h1><p>å¼€å¡çš„æ—¶å€™é€‰çš„æ˜¯ 19 å—é’±çš„å¥—é¤ï¼Œç¬¬äºŒå¤©ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ”¹åˆ° 8 å…ƒä¿å·å¥—é¤ã€‚æ‰€ä»¥ä¸Šé¢åŠå¡çš„æ—¶å€™éœ€è¦ç¡®è®¤å¡ç‰‡å¥—é¤èƒ½å¦ä¿®æ”¹ï¼ˆæœ‰çš„æœ‰åˆçº¦ï¼Œä¸èƒ½ä¿®æ”¹æˆ–è€…å¾—è¿‡å‡ ä¸ªæœˆæ‰èƒ½ä¿®æ”¹ï¼‰å¯ä»¥ç›´æ¥æ‰“ç”µè¯ç»™è”é€šï¼Œè½¬åˆ°äººå·¥æ”¹ã€‚ä½†æ˜¯æˆ‘å«Œæ‰“ç”µè¯éº»çƒ¦ï¼Œä¸‹è½½äº†è”é€š appï¼Œç”¨æ–°åŠçš„æ‰‹æœºå¡ç™»å½•ï¼Œå³ä¸Šè§’åœ¨çº¿å®¢æœä¿®æ”¹å¥—é¤åˆ° 8 å…ƒä¿å·å¥—é¤å°±è¡Œã€‚å®¢æœä¼šå‘Šè¯‰ä½ ä¼šæœ‰ä¸“å±ç»ç† 48h å†…è”ç³»ï¼Œä½†æ˜¯æˆ‘çš„å½“å¤©ä¸‹åˆå°±æ¥ç”µè”ç³»äº†ï¼Œç¡®è®¤ä¿®æ”¹åæ¬¡æœˆå°±ç”Ÿæ•ˆäº†ã€‚</p>
<img src="https://images.zabrian.com/83d18cc4-1a34-43d3-043c-b63386745e01/origin" title="è”ç³»å®¢æœä¿®æ”¹å¥—é¤" style="zoom:62%;" />

<h1 id="åŠå®½å¸¦"><a href="#åŠå®½å¸¦" class="headerlink" title="åŠå®½å¸¦"></a>åŠå®½å¸¦</h1><p>è¿™é‡ŒåŠå®½å¸¦ä¸€å®šè¦ä»è”é€š app ä¸ŠåŠç†ï¼Œå»è¥ä¸šå…æ˜¯åŠä¸äº†è¿™ä¸ªä»·æ ¼çš„å¼‚åœ°å®½å¸¦ã€‚</p>
<p>app é‡Œé¢çš„ä½ç½®åœ¨è¿™é‡Œ</p>
<img src="https://images.zabrian.com/8d192054-73d8-4156-87f5-c8f5eed0fd01/origin" title="å¼‚åœ°åŒäº«ä¸“åŒº" style="zoom:62%;" />

<p>ç„¶åé€‰æ‹©å…¨å›½ä¸€å®¶äº²å¼‚åœ°å®½å¸¦</p>
<img src="https://images.zabrian.com/32f222f5-5e1f-4b39-5329-848898dd2f01/origin" title="å…¨å›½ä¸€å®¶äº²å¼‚åœ°å®½å¸¦" style="zoom:62%;" />

<p>ç„¶åè¿›å»ä¹‹åé€‰æ‹©å®½å¸¦åŠç†çš„åŸå¸‚ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯åŒ—äº¬ï¼Œç„¶åå°±ä¼šæœ‰èƒ½åŠç†çš„ç±»å‹ï¼ŒåŒ…æ‹¬ 300 Mbps å’Œ 500 Mbps é€‰å¥½ä¹‹åå¡«å†™ä¸‹é¢çš„å…·ä½“çš„å†…å®¹ï¼Œæäº¤é¢„çº¦å³å¯ã€‚</p>
<p>ç„¶åè¿‡äº†å‡ ä¸ªå°æ—¶å°±æœ‰è”é€šçš„ç”µè¯äº†ï¼Œç¡®å®šåŠç†çš„å®½å¸¦åï¼Œè¡¨ç¤ºåŒ—äº¬æœ‰ä¸€ä¸ª 300 å—é’±çš„å®‰è£…è´¹ã€‚æ¬¡æœˆä»è¯è´¹é‡Œé¢æ‰£é™¤ã€‚ç¡®å®šæ— è¯¯åå®¢æœç»™æˆ‘å‘äº†ä¸€ä¸ªçŸ­ä¿¡ï¼Œé‡Œé¢æœ‰ä¸ªé“¾æ¥ã€‚éœ€è¦ä¸Šä¼ èº«ä»½è¯æ­£åé¢å’Œæ‹æ‘„ä¸€å¼ å…å† è‡ªæ‹ç…§ã€‚ç„¶åå°±ç­‰ç€åˆ†é…å°å“¥å§ã€‚</p>
<h1 id="ä¸Šé—¨å®‰è£…"><a href="#ä¸Šé—¨å®‰è£…" class="headerlink" title="ä¸Šé—¨å®‰è£…"></a>ä¸Šé—¨å®‰è£…</h1><p>åˆ°äº†é¢„çº¦çš„é‚£å¤©ï¼Œå°å“¥ä¸Šé—¨ã€‚ç¡®è®¤äº†ä¿¡æ¯ä¹‹åå°±å¼€å§‹è£…å…‰çŒ«å•¥çš„ã€‚åœ¨è¿™ä¸ªé€”ä¸­ï¼Œå› ä¸ºç°åœ¨åŒ—äº¬å¤©æ°”å·²ç»å¾ˆçƒ­äº†ï¼Œå°å“¥åˆæ˜¯ä¸­åˆä¸Šé—¨çš„ã€‚é€’ä¸Šç“¶æ°´ï¼Œæ‹¿ä¸ªæ¿å‡³åä¼šå„¿ã€‚è¦æ˜¯æŠ½çƒŸå¯ä»¥å†é€’ä¸ªçƒŸå•¥çš„ã€‚ä¹‹åå°±å¼€å§‹è¡¨è¾¾è‡ªå·±æƒ³è¦å…¬ç½‘ IP çš„è¯‰æ±‚ï¼ˆæ¯•ç«Ÿæ±‚äººåŠäº‹å„¿ï¼Œæ‰€ä»¥å‰é¢å°±å®¢æ°”ç‚¹ï¼‰å°å“¥é—®äº†ä¸ªåŸå› ï¼Œæˆ‘è¯´å®¶é‡Œæœ‰ç›‘æ§éœ€è¦ã€‚ç„¶åå°å“¥è¿˜æ‹äº†ä¸ªç›‘æ§çš„ç…§ç‰‡ï¼Œå¹¶ä¸”è¿˜è¯´ï¼šâ€œç°åœ¨å…¬ç½‘ IP ä¸å¥½æ‹¿ï¼Œéœ€è¦æœ‰æ˜ç¡®çš„éœ€æ±‚æ‰èƒ½ç”³è¯·ï¼Œä½ è¿™ä¸ªè¦ç”¨ç›‘æ§ã€‚ä½†å…¶å®ç°åœ¨ç›‘æ§è¿™ä¸ªç†ç”±ä¸æ€ä¹ˆèƒ½è¿‡äº†ã€‚ä½ è¦æ˜¯æœ‰æ˜ç¡®è¯‰æ±‚å¯ä»¥ç»™ä½ ç”³è¯·ã€‚â€ï¼ˆåæ­£å°±æ˜¯ä¸€è¾¹è¡¨è¾¾ä¸å¥½æï¼Œä½†æ˜¯ä¸€è¾¹è¿˜éƒ½ç»™ç”³è¯·äº†ï¼‰ç„¶åå°±é¡ºä¾¿è¿æ¡¥æ¥ä¸€èµ·ç»™åŠäº†ï¼Œé¡ºä¾¿åŠ äº†ä¸€ä¸‹å°å“¥ç§äººçš„å¾®ä¿¡ï¼ˆè™½ç„¶ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯è¦åŠ ä¼å¾®ï¼Œä½†æ˜¯å°å“¥è¿˜æ˜¯ç»™äº†ä»–ç§äººçš„å¾®ä¿¡ï¼‰æœ€åè£…å¥½åä»–é‚£èµ°äº†ä¸ªæµ‹é€Ÿï¼Œå®‰è£… 500 M å®é™…æµ‹é€Ÿèƒ½åˆ° 650ã€‚è¿˜ä¸é”™ã€‚æœ€åè®°äº†ä¸€ä¸‹å®½å¸¦çš„å¯†ç ï¼Œæå®šã€‚ä»ä¸Šé—¨åˆ°æœ€åå°å“¥èµ°ä¸€å…±èŠ±äº†ä¸åˆ° 10 minï¼Œå¤–åŠ ä¸€ç“¶æ°´çš„é’±ã€‚</p>
<h1 id="åŠç†ä¸Šè¡Œæé€Ÿ"><a href="#åŠç†ä¸Šè¡Œæé€Ÿ" class="headerlink" title="åŠç†ä¸Šè¡Œæé€Ÿ"></a>åŠç†ä¸Šè¡Œæé€Ÿ</h1><p>500 Mbps çš„å®½å¸¦ä¸‹è¡Œå¯¹åº”ä¸Šè¡Œæ‰ç»™ 30 Mbps æ˜¯çœŸçš„æ‹‰è·¨ï¼Œä½†æ˜¯å¯ä»¥åŠç†åŠ é€ŸåŒ…: <span class="exturl" data-url="aHR0cHM6Ly93b2t1YW4uMTE0bWVuaHUuY29tLw==">æ²ƒå®½<i class="fa fa-external-link-alt"></i></span></p>
<p>ç”¨åŠç†å®½å¸¦çš„å¼‚åœ°æ‰‹æœºå·ç™»å½•</p>
<img src="https://images.zabrian.com/29685c89-0b86-439b-be44-1ea181ba1601/origin" title="æ²ƒå®½ç™»é™†ç•Œé¢" style="zoom:39%;" />

<p>ç„¶ååœ¨å·¦ä¾§ã€æˆ‘çš„å®½å¸¦ã€‘ä¸­æ·»åŠ å½“å‰å®½å¸¦</p>
<img src="https://images.zabrian.com/214b8dce-750d-4fea-cb68-b81701392d01/origin" title="æ²ƒå®½æ·»åŠ å®½å¸¦" style="zoom:40%;" />

<p>æ·»åŠ æˆåŠŸåå†å·¦ä¾§ ã€æˆ‘è¦è´­ä¹°ã€‘ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªã€å®½å¸¦ä¸Šè¡Œæé€ŸåŒ… 100 Mã€‘è¿™é‡Œä¸€æ¬¡æœ€å¤šå¯ä»¥è´­ä¹° 6 ä¸ªï¼ˆè¿ç»­åŠå¹´ï¼Œåˆ°æœŸåå¯ä»¥ç»§ç»­è´­ä¹°ï¼‰</p>
<img src="https://images.zabrian.com/13a412ea-2b2b-4be8-4013-821b35e6d201/origin" title="è´­ä¹°ä¸Šè¡Œæé€ŸåŒ…" style="zoom:40%;" />

<p>è´­ä¹°æˆåŠŸåï¼Œåœ¨å·¦ä¾§ã€é¦–é¡µã€‘ç‚¹å‡»ã€ç‚¹æˆ‘æé€Ÿã€‘å°±å¯ä»¥äº†ï¼Œæ— éœ€é‡å¯å…‰çŒ«å³å¯äº«å— 100 Mbps çš„ä¸Šè¡Œé€Ÿç‡äº†ã€‚</p>
<img src="https://images.zabrian.com/1b239e28-26bc-43cd-e168-d7970cc88701/origin" title="ä¸Šè¡Œæé€Ÿ" style="zoom:39%;" />

<h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>æœ€åç®—ä¸€ä¸‹æˆæœ¬</p>
<ul>
<li>ä¸€æ¬¡æ€§æˆæœ¬ï¼šæ¥å› 100 å…ƒè·¯è´¹ + è£…æœºè´¹ 300 å…ƒï¼ˆå”¯ä¸€çš„å‘ç‚¹ï¼‰ &#x3D; 400 å…ƒ</li>
<li>å‘¨æœŸæ€§æˆæœ¬ï¼šæ¯æœˆå¼‚åœ°å·ç å¥—é¤ 8 å…ƒ + å®½å¸¦è´¹ç”¨ 80 å…ƒ + ä¸Šè¡ŒåŠ é€ŸåŒ… 30 å…ƒ &#x3D; 118 å…ƒ</li>
</ul>
<p>æ€»ä½“è¿˜æ˜¯æ¯” 500 Mbps çš„èåˆå¥—ä¾¿å®œå¾ˆå¤šçš„ã€‚</p>
<p>æœ€åé™„ä¸Š speedtest å’Œ ustc çš„æµ‹é€Ÿç»“æœå§</p>
<img src="https://images.zabrian.com/ac825486-02e6-43f8-1e06-419808a0da01/origin" title="SpeedTest æµ‹é€Ÿ" style="zoom:100%;" />

<img src="https://images.zabrian.com/8cb09a0c-3136-4487-8e35-a242c3ecf601/origin" title="USTC æµ‹é€Ÿ" style="zoom:85%;" />
]]></content>
  </entry>
  <entry>
    <title>æ›´æ”¹ macOS å¼ºè°ƒè‰²</title>
    <url>/post/c59c6467.html</url>
    <content><![CDATA[<p>Apple åœ¨ <span class="exturl" data-url="aHR0cHM6Ly93d3cuYXBwbGUuY29tL2ltYWMtMjQ=">iMac 24â€<i class="fa fa-external-link-alt"></i></span> Mac ä¸­é¦–æ¬¡ä½¿ç”¨äº†æ–°çš„å¼ºè°ƒè‰²ï¼Œè¿™äº›å¼ºè°ƒè‰²æ˜¯è¿™äº› Mac ç‹¬æœ‰çš„ã€‚ä½†æ˜¯ç°åœ¨åªè¦æ˜¯ macOS 11.3.1 ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œå³ä½¿ä¸æ˜¯ iMac 24â€ æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›ç‰¹æœ‰çš„å¼ºè°ƒè‰²ã€‚</p>
<span id="more"></span>

<p>é¦–å…ˆéœ€è¦å¼€å¯åŸºäºç¡¬ä»¶çš„å¼ºè°ƒè‰² <code>NSColorSimulateHardwareAccent</code> åŠŸèƒ½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">defaults write -g NSColorSimulateHardwareAccent -bool YES</span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡ <code>NSColorSimulatedHardwareEnclosureNumber</code> é€‰æ‹©å…¶ä¸­ä»»æ„ä¸€ç§é¢œè‰²ã€‚å…¶ä¸­å¯é€‰çš„é¢œè‰²é€‰é¡¹ä¸º 3 åˆ° 8 (åŒ…å« 3 å’Œ 8)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">defaults write -g NSColorSimulatedHardwareEnclosureNumber -int 3</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°å¯åŠ¨ç”µè„‘æˆ–è€…é€€å‡ºç™»å½•é‡æ–°ç™»å½•å³å¯ç”Ÿæ•ˆã€‚<br>ç„¶ååœ¨ <strong>ç³»ç»Ÿè®¾ç½®</strong> -&gt; <strong>å¤–è§‚é€‰é¡¹å¡</strong> -&gt; <strong>å¼ºè°ƒè‰²</strong> å’Œ <strong>é«˜äº®æ ‡è®°é¢œè‰²</strong> é€‰é¡¹ä¸­ä¼šå‡ºç°ä¸€ä¸ª <strong>è¿™å° Mac</strong> çš„é¢œè‰²é€‰é¡¹ï¼Œå…¶ä¸­é¢œè‰²å³ä¸ºä¸Šé¢è®¾ç½®çš„é¢œè‰²ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <code>NSColorSimulatedHardwareEnclosureNumber</code> ä¸åŒå€¼çš„å®é™…æ•ˆæœ</p>
<img src="https://images.zabrian.com/c5f66aed-fff8-43e1-940d-8388311a0a01/origin" title="é¢œè‰² 3" style="zoom:57%;" />

<img src="https://images.zabrian.com/38169874-ea75-4086-24b1-ccd6416e9701/origin" title="é¢œè‰² 4" style="zoom:57%;" />

<img src="https://images.zabrian.com/1683833a-7ee4-416a-5659-2a31fbe46001/origin" title="é¢œè‰² 5" style="zoom:57%;" />

<img src="https://images.zabrian.com/fe160cc7-b5cb-435d-374b-6cb2e744d901/origin" title="é¢œè‰² 6" style="zoom:57%;" />

<img src="https://images.zabrian.com/5a1dfe77-2619-435a-290f-d058a032b601/origin" title="é¢œè‰² 7" style="zoom:57%;" />

<img src="https://images.zabrian.com/6dcb7e11-165d-4547-1bd4-ff7e02a8c001/origin" title="é¢œè‰² 8" style="zoom:57%;" />
]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•(äºŒ)</title>
    <url>/post/dd9207d9.html</url>
    <content><![CDATA[<p><a href="/post/5f8a6fc4.html">æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•</a> ä¸­ä»‹ç»äº†ä¸€ç§é€šè¿‡ Python ä»£ç å®ç°å¯¹å†…ç½®çš„ç±»å‹å¢åŠ è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚<br>ä»Šå¤©å†ä»‹ç»ä¸€ç§æ–¹æ³•ï¼Œå®ç°æ›´ä¸ºåº•å±‚ã€‚é‚£å°±æ˜¯ç›´æ¥ä¿®æ”¹ <code>cPython</code> çš„æºç ã€‚<br>è¿™é‡Œæ¼”ç¤ºç»™ <code>list</code> å’Œ <code>dict</code> å¢åŠ  <code>deepcopy</code> å’Œ <code>tojson</code> æ–¹æ³•ï¼Œå®ç°å¯¹ <code>list</code> å’Œ <code>dict</code> çš„æ·±æ‹·è´å’ŒæŠŠä¸€ä¸ª <code>list</code> å’Œ <code>dict</code> è½¬æ¢ä¸º <code>json</code> çš„æ–¹æ³•ã€‚<br>ç»™ <code>int</code> å’Œ <code>float</code> å¢åŠ  <code>add</code>, <code>sub</code>, <code>mul</code>, <code>div</code> æ–¹æ³•ï¼Œå®ç°åŠ å‡ä¹˜é™¤ã€‚</p>
<span id="more"></span>

<h2 id="Step-1-ä¸‹è½½ä»£ç "><a href="#Step-1-ä¸‹è½½ä»£ç " class="headerlink" title="Step 1 ä¸‹è½½ä»£ç "></a>Step 1 ä¸‹è½½ä»£ç </h2><p><code>cPython</code> ä»£ç å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9u">cPython<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><p>æˆ‘ä½¿ç”¨çš„æ˜¯ macOS ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œå°±åªä»‹ç» macOS éœ€è¦çš„ç¯å¢ƒ</p>
<ol>
<li>å®‰è£… C ç¼–è¯‘å™¨å’Œå·¥å…·åŒ…<br><code>xcode-select --install</code></li>
<li>å®‰è£…å…¶ä»–å·¥å…·<br><code>brew install openssl@3 xz zlib gdbm sqlite</code></li>
</ol>
<h2 id="Step-2-ä¿®æ”¹ä»£ç "><a href="#Step-2-ä¿®æ”¹ä»£ç " class="headerlink" title="Step 2 ä¿®æ”¹ä»£ç "></a>Step 2 ä¿®æ”¹ä»£ç </h2><p>é¦–å…ˆå°†åˆ†æ”¯åˆ‡æ¢åˆ° 3.12ï¼Œä¸ä½¿ç”¨ <code>main</code> çš„åŸå› æ˜¯ <code>main</code> åˆ†æ”¯éšæ—¶éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥é€‰æ‹©æ—§ç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§ã€‚<br>ç¡®ä¿ 3.12 åˆ†æ”¯çš„ä»£ç  <code>commit sha</code> ä¸º <code>0181aa2e3efedc6504b27f6fe74f096e5e454286</code></p>
<h3 id="ä¿®æ”¹-list"><a href="#ä¿®æ”¹-list" class="headerlink" title="ä¿®æ”¹ list"></a>ä¿®æ”¹ list</h3><p><code>list</code> çš„å®ç°åœ¨ <code>./Objects/listobject.c</code> ä¸­ã€‚æˆ‘ä»¬çš„ä¿®æ”¹å°±åœ¨è¿™é‡Œã€‚<br>é¦–å…ˆæ‰¾åˆ° <code>static PyMethodDef list_methods[]</code> è¿™é‡ŒåŒ…æ‹¬äº† <code>list</code> ç›¸å…³çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¡Œçš„ä¸Šé¢ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">list_method_deepcopy</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *copy_module = PyImport_ImportModule(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (copy_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyObject *deepcopy_func = PyObject_GetAttrString(copy_module, <span class="string">&quot;deepcopy&quot;</span>);</span><br><span class="line">    Py_DECREF(copy_module);</span><br><span class="line">    <span class="keyword">if</span> (deepcopy_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyObject *result = PyObject_CallFunctionObjArgs(deepcopy_func, self, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(deepcopy_func);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">list_method_tojson</span><span class="params">(PyObject *self, PyObject *args, PyObject *kwargs)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *json_module = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *dumps_func = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *result = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_tuple = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_with_self = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    json_module = PyImport_ImportModule(<span class="string">&quot;json&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (json_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dumps_func = PyObject_GetAttrString(json_module, <span class="string">&quot;dumps&quot;</span>);</span><br><span class="line">    Py_DECREF(json_module);</span><br><span class="line">    <span class="keyword">if</span> (dumps_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_tuple = PyTuple_Pack(<span class="number">1</span>, self);</span><br><span class="line">    Py_DECREF(dumps_func);</span><br><span class="line">    <span class="keyword">if</span> (args_tuple == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_with_self = PySequence_Concat(args_tuple, args);</span><br><span class="line">    Py_DECREF(args_tuple);</span><br><span class="line">    <span class="keyword">if</span> (args_with_self == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = PyObject_Call(dumps_func, args_with_self, kwargs);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(args_with_self);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>list_method_deepcopy</code> å°±æ˜¯ <code>deepcopy</code> çš„å…·ä½“å®ç°ï¼Œ<code>list_method_tojson</code> æ˜¯ <code>tojson</code> çš„å…·ä½“å®ç°ã€‚<br>ç„¶åå°†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å¢åŠ åˆ° <code>list_methods</code> ä¸­<br>æ³¨æ„ï¼Œè¦å¢åŠ åˆ°æœ€åä¸€è¡Œ <code>&#123;NULL,              NULL&#125;           /* sentinel */</code> ä¸Šæ–¹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)list_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the list&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)list_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert list to JSON string&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<p>æœ€åå®Œæ•´çš„ <code>list_methods[]</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyMethodDef list_methods[] = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;__getitem__&quot;</span>, (PyCFunction)list_subscript, METH_O|METH_COEXIST,</span><br><span class="line">     PyDoc_STR(<span class="string">&quot;__getitem__($self, index, /)\n--\n\nReturn self[index].&quot;</span>)&#125;,</span><br><span class="line">    LIST___REVERSED___METHODDEF</span><br><span class="line">    LIST___SIZEOF___METHODDEF</span><br><span class="line">    LIST_CLEAR_METHODDEF</span><br><span class="line">    LIST_COPY_METHODDEF</span><br><span class="line">    LIST_APPEND_METHODDEF</span><br><span class="line">    LIST_INSERT_METHODDEF</span><br><span class="line">    LIST_EXTEND_METHODDEF</span><br><span class="line">    LIST_POP_METHODDEF</span><br><span class="line">    LIST_REMOVE_METHODDEF</span><br><span class="line">    LIST_INDEX_METHODDEF</span><br><span class="line">    LIST_COUNT_METHODDEF</span><br><span class="line">    LIST_REVERSE_METHODDEF</span><br><span class="line">    LIST_SORT_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__class_getitem__&quot;</span>, Py_GenericAlias, METH_O|METH_CLASS, PyDoc_STR(<span class="string">&quot;See PEP 585&quot;</span>)&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)list_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the list&quot;</span>)&#125;,  # ç»™ <span class="built_in">list</span> å¢åŠ  deepcopy æ–¹æ³•ï¼Œè°ƒç”¨ list_method_deepcopy å®ç°</span><br><span class="line">    &#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)list_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert list to JSON string&quot;</span>)&#125;,    # ç»™ <span class="built_in">list</span> å¢åŠ  tojson æ–¹æ³•ï¼Œè°ƒç”¨ list_method_tojson å®ç°</span><br><span class="line">    &#123;<span class="literal">NULL</span>,              <span class="literal">NULL</span>&#125;           <span class="comment">/* sentinel */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-dict"><a href="#ä¿®æ”¹-dict" class="headerlink" title="ä¿®æ”¹ dict"></a>ä¿®æ”¹ dict</h3><p>å’Œä¿®æ”¹ list ç±»ä¼¼ï¼Œdict çš„å®ç°åœ¨ <code>./Objects/dictobject.c</code> ä¸­ã€‚<br>åŒç†è¿˜æ˜¯é¦–å…ˆæ‰¾åˆ° <code>static PyMethodDef mapp_methods[]</code> è¿™é‡ŒåŒ…æ‹¬äº† <code>dict</code> ç›¸å…³çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¡Œçš„ä¸Šé¢ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">dict_method_deepcopy</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *copy_module = PyImport_ImportModule(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (copy_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PyObject *deepcopy_func = PyObject_GetAttrString(copy_module, <span class="string">&quot;deepcopy&quot;</span>);</span><br><span class="line">    Py_DECREF(copy_module);</span><br><span class="line">    <span class="keyword">if</span> (deepcopy_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PyObject *result = PyObject_CallFunctionObjArgs(deepcopy_func, self, <span class="literal">NULL</span>);</span><br><span class="line">    Py_DECREF(deepcopy_func);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">dict_method_tojson</span><span class="params">(PyObject *self, PyObject *args, PyObject *kwargs)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *json_module = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *dumps_func = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *result = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_tuple = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_with_self = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    json_module = PyImport_ImportModule(<span class="string">&quot;json&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (json_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dumps_func = PyObject_GetAttrString(json_module, <span class="string">&quot;dumps&quot;</span>);</span><br><span class="line">    Py_DECREF(json_module);</span><br><span class="line">    <span class="keyword">if</span> (dumps_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_tuple = PyTuple_Pack(<span class="number">1</span>, self);</span><br><span class="line">    Py_DECREF(dumps_func);</span><br><span class="line">    <span class="keyword">if</span> (args_tuple == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_with_self = PySequence_Concat(args_tuple, args);</span><br><span class="line">    Py_DECREF(args_tuple);</span><br><span class="line">    <span class="keyword">if</span> (args_with_self == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = PyObject_Call(dumps_func, args_with_self, kwargs);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(args_with_self);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ä»£ç é™¤äº†æ–¹æ³•åå­—ï¼Œå®ç°æ–¹æ³•å’Œ <code>list</code> çš„ä¸€è‡´ï¼Œå½“ç„¶ã€‚æœ€åä¹Ÿè¿˜æ˜¯è¦åŠ åˆ° <code>mapp_methods[]</code> ä¸­</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)dict_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the dict&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)dict_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert dict to JSON string&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´çš„ mapp_methods</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyMethodDef mapp_methods[] = &#123;</span><br><span class="line">    DICT___CONTAINS___METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__getitem__&quot;</span>, _PyCFunction_CAST(dict_subscript),        METH_O | METH_COEXIST,</span><br><span class="line">     getitem__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__sizeof__&quot;</span>,      _PyCFunction_CAST(dict_sizeof),       METH_NOARGS,</span><br><span class="line">     sizeof__doc__&#125;,</span><br><span class="line">    DICT_GET_METHODDEF</span><br><span class="line">    DICT_SETDEFAULT_METHODDEF</span><br><span class="line">    DICT_POP_METHODDEF</span><br><span class="line">    DICT_POPITEM_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;keys&quot;</span>,            dictkeys_new,                   METH_NOARGS,</span><br><span class="line">    keys__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;items&quot;</span>,           dictitems_new,                  METH_NOARGS,</span><br><span class="line">    items__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;values&quot;</span>,          dictvalues_new,                 METH_NOARGS,</span><br><span class="line">    values__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;update&quot;</span>,          _PyCFunction_CAST(dict_update), METH_VARARGS | METH_KEYWORDS,</span><br><span class="line">     update__doc__&#125;,</span><br><span class="line">    DICT_FROMKEYS_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;clear&quot;</span>,           (PyCFunction)dict_clear,        METH_NOARGS,</span><br><span class="line">     clear__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;copy&quot;</span>,            (PyCFunction)dict_copy,         METH_NOARGS,</span><br><span class="line">     copy__doc__&#125;,</span><br><span class="line">    DICT___REVERSED___METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__class_getitem__&quot;</span>, Py_GenericAlias, METH_O|METH_CLASS, PyDoc_STR(<span class="string">&quot;See PEP 585&quot;</span>)&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)dict_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the dict&quot;</span>)&#125;,  # ç»™ dict å¢åŠ  deepcopy æ–¹æ³•ï¼Œè°ƒç”¨ dict_method_deepcopy å®ç°</span><br><span class="line">    &#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)dict_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert dict to JSON string&quot;</span>)&#125;,    # ç»™ dict å¢åŠ  tojson æ–¹æ³•ï¼Œè°ƒç”¨ dict_method_tojson å®ç°</span><br><span class="line">    &#123;<span class="literal">NULL</span>,              <span class="literal">NULL</span>&#125;   <span class="comment">/* sentinel */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-float"><a href="#ä¿®æ”¹-float" class="headerlink" title="ä¿®æ”¹ float"></a>ä¿®æ”¹ float</h3><p>float çš„å®ç°åœ¨ <code>./Objects/floatobject.c</code> ä¸­ã€‚ åŒç†æ‰¾åˆ° <code>float_methods[]</code> åœ¨ä¸Šæ–¹å¢åŠ ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_add</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Add(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_sub</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Subtract(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_mul</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Multiply(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_div</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_TrueDivide(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼çš„åœ¨ <code>float_methods[]</code> ä¸­å¢åŠ </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;add&quot;</span>, (PyCFunction)float_method_add, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Add float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;sub&quot;</span>, (PyCFunction)float_method_sub, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Subtract float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;mul&quot;</span>, (PyCFunction)float_method_mul, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Multiply float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;div&quot;</span>, (PyCFunction)float_method_div, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Divide float or int objects&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-int"><a href="#ä¿®æ”¹-int" class="headerlink" title="ä¿®æ”¹ int"></a>ä¿®æ”¹ int</h3><p><code>int</code> çš„å®ç°æ˜¯åœ¨ <code>.Objects/longobject.c</code> ä¸­ã€‚æ‰¾åˆ° <code>long_methods[]</code> åœ¨ä¸Šæ–¹å¢åŠ æ–¹æ³•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_add</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Add(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_sub</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Subtract(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_mul</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Multiply(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_div</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_TrueDivide(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ–¹æ³•å®ç°å’Œ <code>int</code> ä¸­çš„å®ç°æœ‰ç»†å¾®å·®åˆ«ã€‚æœ€åè¿˜æ˜¯ä¸€æ ·å¢åŠ  <code>long_methods[]</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;add&quot;</span>, (PyCFunction)long_method_add, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Add int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;sub&quot;</span>, (PyCFunction)long_method_sub, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Subtract int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;mul&quot;</span>, (PyCFunction)long_method_mul, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Multiply int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;div&quot;</span>, (PyCFunction)long_method_div, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Divide int or float objects&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="Step-3-ç¼–è¯‘"><a href="#Step-3-ç¼–è¯‘" class="headerlink" title="Step 3 ç¼–è¯‘"></a>Step 3 ç¼–è¯‘</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ä»£ç </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">LDFLAGS=<span class="string">&quot;-L<span class="subst">$(brew --prefix zlib)</span>/lib -L<span class="subst">$(brew --prefix bzip2)</span>/lib -L<span class="subst">$(brew --prefix openssl@3)</span>/lib&quot;</span> \</span><br><span class="line">CPPFLAGS=<span class="string">&quot;-I<span class="subst">$(brew --prefix zlib)</span>/include -I<span class="subst">$(brew --prefix bzip2)</span>/include -I<span class="subst">$(brew --prefix openssl@3)</span>/include&quot;</span> \</span><br><span class="line">./configure --with-openssl=$(brew --prefix openssl@3) &amp;&amp; make -j$(<span class="built_in">nproc</span>) -s</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘æˆåŠŸååœ¨ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª <code>python.exe</code> (ä¸ºä»€ä¹ˆåœ¨ macOS æ˜¯ .exe å¯å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uI2J1aWxkLWluc3RydWN0aW9ucw==">build-instructions<i class="fa fa-external-link-alt"></i></span>)</p>
<h2 id="Step-4-æµ‹è¯•"><a href="#Step-4-æµ‹è¯•" class="headerlink" title="Step 4 æµ‹è¯•"></a>Step 4 æµ‹è¯•</h2><p>æ–°å»ºä¸€ä¸ª .py æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">origin_dict = &#123;<span class="string">&quot;goods&quot;</span>: [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>]&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åŸå§‹å­—å…¸: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>)</span><br><span class="line">copy_dict = origin_dict.copy()  <span class="comment"># è‡ªå¸¦çš„ copy() æµ…æ‹·è´</span></span><br><span class="line">deepcopy_dict = origin_dict.deepcopy()  <span class="comment"># æ·»åŠ çš„ deepcopy() æ·±æ‹·è´</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() å­—å…¸: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() å­—å…¸: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line">origin_dict[<span class="string">&quot;goods&quot;</span>].append(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åŸå§‹å­—å…¸ä¿®æ”¹: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() ç»“æœ: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() ç»“æœ: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">int_number = <span class="number">1</span></span><br><span class="line">float_number = <span class="number">2.15</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(int_number.add(<span class="number">2</span>).add(<span class="number">3</span>).div(<span class="number">2</span>).mul(<span class="number">4</span>))   <span class="comment"># (1 + 2 + 3) / 2 * 4</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(float_number.add(<span class="number">2</span>).add(<span class="number">3</span>).div(<span class="number">3</span>).mul(<span class="number">7</span>)) <span class="comment"># (2.15 + 2 + 3) / 3 * 7</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">==================================================</span><br><span class="line">åŸå§‹å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">.copy() å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">.deepcopy() å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">åŸå§‹å­—å…¸ä¿®æ”¹: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">.copy() ç»“æœ: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>]&#125;</span><br><span class="line">.deepcopy() ç»“æœ: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">12.0</span><br><span class="line">==================================================</span><br><span class="line">16.683333333333334</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å®Œæˆäº†ä» cPython çš„æ”¹é€ å®ç°äº†ä»¥ä¸Šå‡ ç§æ–¹æ³•ã€‚</p>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><ol>
<li>ç›´æ¥ä¿®æ”¹ cPython çš„æºç å®ç°å¥½å¤„æ˜¯å®ç°äº†åŸç”Ÿå®ç°ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ã€‚å°±æ˜¯è¿™æ ·å†™çš„ä»£ç ï¼Œåªèƒ½è¿è¡Œåœ¨è¿™ä¸ªä¿®æ”¹åçš„ Python ç¯å¢ƒï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚<br>ä½†æ˜¯æ¢ä¸ªæ€è·¯æƒ³ï¼Œè¿™æ ·ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªå¥½å¤„å°±æ˜¯é—´æ¥çš„ä¿æŠ¤äº†ä»£ç ã€‚è¿™ä¸ªå…·ä½“çš„å†…å®¹åé¢å¯ä»¥åœ¨å±•å¼€èŠèŠã€‚</li>
<li>è¿™é‡Œç¼–è¯‘çš„ Python å…¶å®åªæ˜¯ä¸€ä¸ªè°ƒè¯•ç¯å¢ƒï¼Œå› ä¸ºæ²¡æœ‰å¯ç”¨ PGO æ‰€ä»¥ç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚<br>å¦‚æœæƒ³æŠŠè¿™ä¸ªç‰ˆæœ¬çš„ Python ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥åœ¨ <code>./configure</code> çš„æ—¶å€™å¢åŠ  <code>--enable-optimizations</code> å‚æ•°ã€‚å…·ä½“å†…å®¹å¯å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uI3Byb2ZpbGUtZ3VpZGVkLW9wdGltaXphdGlvbg==">profile-guided-optimization<i class="fa fa-external-link-alt"></i></span></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•</title>
    <url>/post/5f8a6fc4.html</url>
    <content><![CDATA[<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæƒ³ç»™ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å¢åŠ å¯¹åº”çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ªç±»å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™æƒ³ç»™å†…ç½®çš„ç±»å‹å¢åŠ ä¸€äº›è‡ªå®šä¹‰æ–¹æ³•å‘¢ï¼Ÿ</p>
<span id="more"></span>

<p>æ¯”å¦‚å¯¹äºå¯å˜ç±»å‹å¯¹è±¡ï¼Œæˆ‘ä»¬æƒ³å¢åŠ ä¸€ä¸ª <code>deepcopy</code> çš„æ–¹æ³•å®ç°æ·±æ‹·è´ï¼Œç±»ä¼¼<code>dd = &#123;&#39;a&#39;: [1, 2, 3]&#125;.deepcopy()</code> è¾¾åˆ° <code>dd = copy.deepcopy(&#123;&#39;a&#39;: [1, 2, 3]&#125;)</code> çš„æ•ˆæœï¼Œæ˜¾è€Œæ˜“è§çš„æ˜¯ç›´æ¥åœ¨ä¸€ä¸ª dict å¯¹è±¡ä¸Š <code>.deepcopy()</code> æ˜¯æ›´ä¼˜é›…çš„ã€‚ä½†æ˜¯äº‹ä¸æ„¿è¿ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šè¿‡å¸¸è§„æ‰‹æ®µç»™ dict å¢åŠ  <code>deepcopy()</code> æ–¹æ³•ã€‚</p>
<p>éš¾é“å°±çœŸçš„æ²¡æœ‰åŠæ³•å—ï¼Ÿä¸‹é¢è¿™æ®µä»£ç å¯ä»¥ä¼˜é›…çš„å®ç°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyType</span>(ctypes.Structure):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyObject</span>(ctypes.Structure):</span><br><span class="line">    Py_ssize_t = (</span><br><span class="line">        ctypes.c_int64 <span class="keyword">if</span> ctypes.sizeof(ctypes.c_void_p) == <span class="number">8</span> <span class="keyword">else</span> ctypes.c_int32</span><br><span class="line">    )</span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&quot;ob_refcnt&quot;</span>, Py_ssize_t),</span><br><span class="line">        (<span class="string">&quot;ob_type&quot;</span>, ctypes.POINTER(PyType)),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyTypeObject</span>(<span class="title class_ inherited__">PyObject</span>):</span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&quot;dict&quot;</span>, ctypes.POINTER(PyObject))</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject</span>(<span class="params">class_, method, force=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_</span>(<span class="params">function</span>):</span><br><span class="line">        name_, dict_ = class_.__name__, class_.__dict__</span><br><span class="line">        proxy_dict = PyTypeObject.from_address(<span class="built_in">id</span>(dict_))</span><br><span class="line">        namespace = &#123;&#125;</span><br><span class="line">        ctypes.pythonapi.PyDict_SetItem(</span><br><span class="line">            ctypes.py_object(namespace),</span><br><span class="line">            ctypes.py_object(name_),</span><br><span class="line">            proxy_dict.<span class="built_in">dict</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> namespace.get(name_, &#123;&#125;).get(method, <span class="literal">None</span>):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;å·²å­˜åœ¨æ–¹æ³• <span class="subst">&#123;class_.__name__&#125;</span>.<span class="subst">&#123;method&#125;</span>()&quot;</span>)</span><br><span class="line">        namespace[name_][method] = function</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _</span><br></pre></td></tr></table></figure>

<p>è€Œä½¿ç”¨ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç»™ <code>dict</code> æ·»åŠ ä¸€ä¸ª <code>deepcopy()</code> å®ç°å­—å…¸çš„æ·±æ‹·è´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">dict</span>, <span class="string">&#x27;deepcopy&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deepcopy</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">return</span> copy.deepcopy(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ä¸€ä¸‹</span></span><br><span class="line">origin_dict = &#123;<span class="string">&quot;goods&quot;</span>: [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹å­—å…¸: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;]&#125;</span></span><br><span class="line"></span><br><span class="line">copy_dict = origin_dict.copy() <span class="comment"># è‡ªå¸¦çš„ copy() æµ…æ‹·è´</span></span><br><span class="line">deepcopy_dict = origin_dict.deepcopy() <span class="comment"># æ·»åŠ çš„ deepcopy() æ·±æ‹·è´</span></span><br><span class="line"></span><br><span class="line">origin_dict[<span class="string">&quot;goods&quot;</span>].append(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹å­—å…¸å˜æ›´: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;banana&#x27;]&#125;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() ç»“æœ: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;banana&#x27;]&#125;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() ç»“æœ: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;]&#125;</span></span><br></pre></td></tr></table></figure>

<p>å†æˆ–è€…ç»™ <code>list</code> æ·»åŠ ä¸€ä¸ª <code>average()</code> æ–¹æ³•è®¡ç®—å¹³å‡æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">list</span>, <span class="string">&#x27;average&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">average</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(l) / <span class="built_in">len</span>(l)</span><br><span class="line"></span><br><span class="line">score = [<span class="number">95.0</span>, <span class="number">89.5</span>, <span class="number">77.0</span>, <span class="number">91.0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(score.average())  <span class="comment"># 88.125</span></span><br></pre></td></tr></table></figure>

<p>å†æˆ–è€…ç»™å­—ç¬¦ä¸²æ·»åŠ ä¸€ä¸ª <code>json()</code> æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>str.json()</code> å°†è¯¥å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸º <code>json</code> å¯¹è±¡ï¼ˆå½“ç„¶å‰ææ˜¯è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ä¸º <code>json</code> å¯¹è±¡ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">str</span>, <span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> loads(s)</span><br><span class="line"></span><br><span class="line">info = <span class="string">&#x27;&#123;&quot;first_name&quot;: &quot;Michael&quot;, &quot;last_name&quot;: &quot;Rodgers&quot;, &quot;department&quot;: &quot;Marketing&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(info.json()) <span class="comment"># &#123;&#x27;first_name&#x27;: &#x27;Michael&#x27;, &#x27;last_name&#x27;: &#x27;Rodgers&#x27;, &#x27;department&#x27;: &#x27;Marketing&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæ¯”å¦‚ç»™ <code>int</code> ç±»å‹æ·»åŠ  <code>add(number)</code> æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">int</span>, <span class="string">&#x27;add&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">i, number</span>):</span><br><span class="line">    <span class="keyword">return</span> i + number</span><br><span class="line"></span><br><span class="line">munber = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number.add(<span class="number">3</span>)) <span class="comment"># 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨</span></span><br><span class="line"><span class="built_in">print</span>(munber.add(<span class="number">3</span>).add(<span class="number">7</span>).add(-<span class="number">1</span>)) <span class="comment"># 14</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶é™¤äº†å†…ç½®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¿®è¡¥è‡ªå®šä¹‰ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.number = n</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params">Number, <span class="string">&#x27;sub&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">n, num</span>):</span><br><span class="line">    <span class="keyword">return</span> Number(n.number - num)</span><br><span class="line"></span><br><span class="line">number = Number(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(number.sub(<span class="number">3</span>).sub(<span class="number">5</span>).number)  <span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<!-- more -->
]]></content>
  </entry>
  <entry>
    <title>æµ‹è¯•åŠ å¯†æ–‡ç« </title>
    <url>/post/19c1a188.html</url>
    <content><![CDATA[<div class="encrypted-post-container" 
    data-ciphertext="AcXATMusTndjdMnyvOW0i/RWViLIMFFYQwZOM8r0G8vR1inGaEsOQPAKcDHyjiqf7ErXWVmhbC/f7YQJ7P1sRNcBRhQwLeWpl6fiORuOoncUH01bGetjO8Ws+sS4wRpL5jbYmeFS246S/THEtBA0fA8df91rEcqPn3wmKYjaT6VA5Z21x/XkUkYMKpd09DxNSduF2V4="
    data-iv="3ecHzzVwCakdF1N0"
    data-auth-tag="+Sq7IJ8Qb54ZnjllkRdNFQ=="
    data-abbrlink="19c1a188"
    data-wrapped-keys='[{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;6Hv+Gb8aY9mgWW9UT31SgMta6E6PzZHdjqtPgYUdBAo=&quot;,&quot;iv&quot;:&quot;YSxf5Q3w5YnApJdP&quot;,&quot;authTag&quot;:&quot;Fmnq092hIXmPSdumUmVsiA==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;N94QeAiovnRcGL70wldeUhQ+RnfOhQuh1sStKO+d0w8=&quot;,&quot;iv&quot;:&quot;NLmIutzLXyW0maUy&quot;,&quot;authTag&quot;:&quot;J+nKoM/6P3tiSYcNgBKncw==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;OApuX3u6fVT5hj2i+OVUgATUzfCH8d2ZSH1oxJFXcjk=&quot;,&quot;iv&quot;:&quot;m8wc064E8AUzgKCM&quot;,&quot;authTag&quot;:&quot;HuhxGZuV3a2BR3ZaVlhq4A==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;5MLCuC4WXSrB7VUeqAr6t2+vsgZqoRb67CPMvqKTYSI=&quot;,&quot;iv&quot;:&quot;8pMi8nVx3YC3vVOQ&quot;,&quot;authTag&quot;:&quot;6H7rWCCV5ao5vjYd5QuzxA==&quot;},{&quot;type&quot;:&quot;fido2&quot;,&quot;encryptedCEK&quot;:&quot;vcGvp8gJc/Q50G5k40UevlNwt9I/o4d/AyU5OvASkzs=&quot;,&quot;iv&quot;:&quot;FMYENVSF6acLrTkO&quot;,&quot;authTag&quot;:&quot;3GZmE/92+ZAiyqA1GlWZwQ==&quot;},{&quot;type&quot;:&quot;password&quot;,&quot;encryptedCEK&quot;:&quot;VN7HGtqhtuv3J79XZHeMUQZiEA7WaRdmegvaC36e910=&quot;,&quot;iv&quot;:&quot;VKqJA16L8kWTWXHj&quot;,&quot;authTag&quot;:&quot;AulxdBzu8HAyaLnO3yU1jg==&quot;,&quot;salt&quot;:&quot;1be53724816528d8cc0547ca98dfcc2649f00b343011a7d07f4633d72252943b&quot;}]'
    data-prf-salt="1be53724816528d8cc0547ca98dfcc2649f00b343011a7d07f4633d72252943b"
    data-cache="0">
  <div class="encrypted-post-notice">
    <div class="decrypt-methods"><button class="decrypt-btn" id="fido2-verify-btn"><i class="fa fa-fingerprint"></i> é€šè¡Œå¯†é’¥éªŒè¯</button><div class="password-decrypt-group">
        <button class="decrypt-btn" id="show-password-btn"><i class="fa fa-lock"></i> å¯†ç éªŒè¯</button>
        <div class="password-input-group" id="password-input-group" style="display:none">
          <input type="password" class="password-input" id="password-input" placeholder="è¾“å…¥å¯†ç " />
          <button class="decrypt-btn" id="password-decrypt-btn"><i class="fa fa-key"></i> ç¡®å®š</button>
        </div>
      </div></div>
    <div class="verification-status" id="verification-status"></div>
  </div>
  <div class="decrypted-content" id="decrypted-content" style="display:none"></div>
</div>]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—ä¸€ æ•°å­¦å‡½æ•°å’Œå¯¼æ•°è®¡ç®—</title>
    <url>/post/e0c91e46.html</url>
    <content><![CDATA[<p>è¯¥ç³»åˆ—æ—¨åœ¨æ”¶é›†æ•´ç†ä¸€äº›å¾ˆæœ‰æ„æ€çš„ Python ä»£ç ï¼Œè¿™äº›ä»£ç æœ‰äº›æ˜¯é€šè¿‡ç®€æ´çš„ä»£ç å®ç°äº†å¾ˆç‰›é€¼çš„åŠŸèƒ½ï¼Œæœ‰äº›åˆ™æ˜¯é€šè¿‡èŠ±é‡Œèƒ¡å“¨çš„æŠ€å·§ä»£ç çœ¼èŠ±ç¼­ä¹±ã€‚</p>
<p>è™½ç„¶å¾ˆå¤šä»£ç å¹¶ä¸é€‚åˆæ—¥å¸¸çš„ä½¿ç”¨ï¼Œä½†æ˜¯ç ”ç©¶ä¸€ä¸‹ç›¸å…³çš„æœºåˆ¶è¿˜æ˜¯å¯¹æå‡èƒ½åŠ›æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
<span id="more"></span>

<p>æœ¬æœŸä½œä¸ºç¬¬ä¸€æœŸï¼Œå…ˆæ¥ä¸ªå¼€èƒƒå°èœ</p>
<p>ä»¥ä¸‹ä»£ç å¾ˆæœ‰æ„æ€ï¼Œå®ƒå®ç°äº†å¸¸è§„æ•°å­¦ä¸Šçš„å‡½æ•°è¡¨ç¤ºã€‚å¹¶ä¸”è¿˜èƒ½è®¡ç®—å½“å‰çš„å‡½æ•°å€¼å’Œè®¡ç®—å¯¹åº”å˜é‡çš„å¯¼æ•°å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">items</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> items:</span><br><span class="line">        res = res * i</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, value=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;mul&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__truediv__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;div&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;pow&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__sub__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, wrapper_opt(<span class="string">&quot;mul&quot;</span>, Constant(-<span class="number">1</span>), other))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__radd__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rmul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;mul&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rtruediv__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;div&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name == other.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(<span class="variable language_">self</span>.name)</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Constant</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(value, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Variable</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> variable.name == <span class="variable language_">self</span>.name <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Operator</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs, name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.inputs = inputs</span><br><span class="line">        <span class="variable language_">self</span>.name = <span class="string">f&quot;Opt <span class="subst">&#123;name&#125;</span> of <span class="subst">&#123;inputs&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        opt2str = &#123;<span class="string">&quot;Add&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;Power&quot;</span>: <span class="string">&quot;^&quot;</span>, <span class="string">&quot;Multiply&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;Divide&quot;</span>: <span class="string">&quot;/&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> opt2str[<span class="variable language_">self</span>.name.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>]].join(<span class="built_in">map</span>(<span class="built_in">str</span>, <span class="variable language_">self</span>.inputs))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Add&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(inp.derivative(variable) <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Multiply</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Multiply&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> product(inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(</span><br><span class="line">            inp.derivative(variable)</span><br><span class="line">            * product(</span><br><span class="line">                other_inp.calculate()</span><br><span class="line">                <span class="keyword">for</span> other_inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs</span><br><span class="line">                <span class="keyword">if</span> other_inp != inp</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Divide</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Divide&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        a, b = [inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        a, b = [inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        da, db = [inp.derivative(variable) <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        <span class="keyword">return</span> (da * b - db * a) / (b ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Power</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Power&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        _x, n = <span class="variable language_">self</span>.inputs</span><br><span class="line">        n = n.value</span><br><span class="line">        <span class="keyword">return</span> _x.calculate() ** n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        _x, n = <span class="variable language_">self</span>.inputs</span><br><span class="line">        n = n.value</span><br><span class="line">        <span class="keyword">return</span> n * (_x.calculate() ** (n - <span class="number">1</span>)) * _x.derivative(variable)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wrapper_opt</span>(<span class="params">opt, self, other, r=<span class="literal">False</span></span>):</span><br><span class="line">    opt2class = &#123;<span class="string">&quot;add&quot;</span>: Add, <span class="string">&quot;mul&quot;</span>: Multiply, <span class="string">&quot;pow&quot;</span>: Power, <span class="string">&quot;div&quot;</span>: Divide&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, Node):</span><br><span class="line">        other = Constant(other)</span><br><span class="line">    inputs = [other, <span class="variable language_">self</span>] <span class="keyword">if</span> r <span class="keyword">else</span> [<span class="variable language_">self</span>, other]</span><br><span class="line">    node = opt2class[opt](inputs=inputs)</span><br><span class="line">    <span class="keyword">return</span> node</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = Variable(<span class="string">&quot;x&quot;</span>, <span class="number">2</span>)        <span class="comment"># å®šä¹‰å˜é‡ x é»˜è®¤å€¼ 2</span></span><br><span class="line">y = Variable(<span class="string">&quot;y&quot;</span>, <span class="number">3</span>)        <span class="comment"># å®šä¹‰å˜é‡ y é»˜è®¤å€¼ 3</span></span><br><span class="line">f = <span class="number">3</span> * x ** <span class="number">2</span> + <span class="number">4</span> * y - <span class="number">5</span>  <span class="comment"># å®šä¹‰å‡½æ•° f(x)=3xÂ²+4yâˆ’5</span></span><br><span class="line"><span class="built_in">print</span>(f)                    <span class="comment"># 3*x^2+4*y+-1*5</span></span><br><span class="line"><span class="built_in">print</span>(f.calculate())        <span class="comment"># 19    æ ¹æ®é»˜è®¤å€¼ x=2 y=3 è®¡ç®— f(x)</span></span><br><span class="line"><span class="built_in">print</span>(f.derivative(x))      <span class="comment"># 12    æ ¹æ®é»˜è®¤å€¼ x=2 è®¡ç®— f&#x27;(x)=6x</span></span><br><span class="line">x.value = <span class="number">3</span>                 <span class="comment"># x=3</span></span><br><span class="line">y.value = -<span class="number">5</span>                <span class="comment"># y=-5</span></span><br><span class="line"><span class="built_in">print</span>(f.calculate())        <span class="comment"># 2     æ ¹æ®é»˜è®¤å€¼ x=3 y=-5 è®¡ç®— f(x)</span></span><br><span class="line"><span class="built_in">print</span>(f.derivative(y))      <span class="comment"># 4     æ ¹æ®é»˜è®¤å€¼ y=4 è®¡ç®— f å¯¹ y æ±‚å¯¼ = 4</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>è°ƒæ•´ macOS é¡¶éƒ¨èœå•æ å›¾æ ‡é—´è·</title>
    <url>/post/baaa1138.html</url>
    <content><![CDATA[<p>æ— éœ€ä»»ä½•ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œé€šè¿‡ macOS å‘½ä»¤è¡Œå°±å¯ä»¥è°ƒæ•´é¡¶éƒ¨èœå•æ å›¾æ ‡é—´è·</p>
<span id="more"></span>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é—´è·</span></span><br><span class="line">defaults -currentHost <span class="built_in">read</span> -globalDomain NSStatusItemSpacing</span><br><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰å†…é—´è·</span></span><br><span class="line">defaults -currentHost <span class="built_in">read</span> -globalDomain NSStatusItemSelectionPadding</span><br><span class="line"><span class="comment"># æŒ‡å®šé—´è·</span></span><br><span class="line">defaults -currentHost write -globalDomain NSStatusItemSpacing -int 10</span><br><span class="line"><span class="comment"># æŒ‡å®šå†…é—´è·</span></span><br><span class="line">defaults -currentHost write -globalDomain NSStatusItemSelectionPadding -int 6</span><br><span class="line"><span class="comment"># æ¢å¤é»˜è®¤é—´è·</span></span><br><span class="line">defaults -currentHost delete -globalDomain NSStatusItemSpacing</span><br><span class="line"><span class="comment"># æ¢å¤é»˜è®¤å†…é—´è·</span></span><br><span class="line">defaults -currentHost delete -globalDomain NSStatusItemSelectionPadding</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
</search>
