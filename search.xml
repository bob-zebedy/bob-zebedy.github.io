<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Cloudflare è®¾ç½®å¼•ç”¨ç«™ç‚¹ç­–ç•¥</title>
    <url>/post/e6a2e300.html</url>
    <content><![CDATA[<p>å‰å‡ æ—¥ï¼ŒæŠŠæˆ‘çš„åšå®¢éƒ¨ç½²åœ¨ <code>Cloudflare Pages</code> ä¸Šé¢äº†ã€‚åŒæ—¶ç»‘å®šäº†ä¸€ä¸ªæ‰˜ç®¡åœ¨ <code>Cloudflare</code> ä¸Šé¢çš„åŸŸåï¼Œåˆ°è¿™é‡Œä¸€åˆ‡é¡ºåˆ©ã€‚<br>ä½†æ˜¯å½“æˆ‘å…´è‡´å‹ƒå‹ƒçš„æ‰“å¼€åšå®¢çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå›¾ç‰‡å…¨ 403 äº†ï¼Ÿ</p>
<span id="more"></span>

<p>ä¸€å¼€å§‹æƒ³åˆ°äº†å¯èƒ½æ˜¯æˆ‘çš„ <code>OSS</code> é˜²ç›—é“¾ã€‚è·‘å»çœ‹äº†ä¸€ä¸‹ï¼Œæˆ‘å·²ç»æ·»åŠ äº†å¯¹åº”çš„ <code>Referer</code> åŸŸåã€‚ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯æ·»åŠ  <code>Referer</code> ç”Ÿæ•ˆéœ€è¦æ—¶é—´ï¼Œäºæ˜¯ä¹è¿‡äº†å‡ ä¸ªå°æ—¶å†æ‰“å¼€é—®é¢˜ä¾æ—§ã€‚<br>æœ€è¯¡å¼‚çš„æ˜¯ï¼Œæ‰“å¼€ <code>Cloudflare Pages</code> é»˜è®¤çš„ <code>pages.dev</code> åŸŸåçš„æ—¶å€™ï¼Œå›¾ç‰‡å°±æ˜¯æ­£å¸¸çš„ã€‚æ’æŸ¥äº†ä¸€ä¸‹ï¼Œç„¶åå°±å‘ç°äº†ç«¯å€ªã€‚<br>é—®é¢˜æ¥è‡ªé€šè¿‡ç»‘å®šçš„è‡ªå®šä¹‰åŸŸåè®¿é—®çš„æ—¶å€™ï¼Œå›¾ç‰‡è¯·æ±‚çš„ Header ä¸­æ²¡æœ‰ <code>Referer</code> å­—æ®µã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€è°“çš„é˜²ç›—é“¾å…¶å®å°±æ˜¯æ£€æŸ¥ <code>Referer</code> å­—æ®µæ˜¯ä¸æ˜¯åœ¨ç™½åå•ä¸­ã€‚é‚£ä¹ˆé—®é¢˜æ¥è¿™äº†ï¼Œä¸ºä»€ä¹ˆ <code>pages.dev</code> åŸŸåä¸­è¯·æ±‚å›¾ç‰‡æœ‰ <code>Referer</code> ä½†æ˜¯è‡ªå®šä¹‰åŸŸåæ²¡æœ‰ï¼Ÿ<br>å†æ¬¡ç¨åŠ è§‚å¯Ÿå‘ç°äº†ä¸€ä¸ªç°è±¡</p>
<img src="https://images.zabrian.com/538e6269-12f2-4f3a-0bf1-bf030ba01501/origin" title="è‡ªå®šä¹‰åŸŸå" style="zoom:18%;" />

<img src="https://images.zabrian.com/a95cabc7-4b98-47be-7bdb-bc59cbb46101/origin" title="pages.dev åŸŸå" style="zoom:21%;" />

<p>åŸå› å°±åœ¨è¿™é‡Œ</p>
<ul>
<li>è‡ªå®šä¹‰åŸŸåçš„å¼•ç”¨ç«™ç‚¹ç­–ç•¥ä¸º <code>same-origin</code></li>
<li>pages.dev åŸŸåçš„å¼•ç”¨ç«™ç‚¹ç­–ç•¥ä¸º <code>strict-origin-when-cross-origin</code></li>
</ul>
<p>å°±æ˜¯å› ä¸ºæµè§ˆå™¨çš„ <strong>åŒæºç­–ç•¥(Same-Origin Policy)</strong> å› æ­¤è‡ªå®šä¹‰åŸŸåçš„è¯·æ±‚å›¾ç‰‡çš„æ—¶å€™æœªå¸¦ä¸Š <code>Referer</code><br>æ—¢ç„¶é—®é¢˜çŸ¥é“äº†ï¼Œå°±å¯ä»¥è§£å†³äº†ï¼šåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹è‡ªå®šä¹‰åŸŸåçš„è¯·æ±‚å¤´å°±è¡Œäº†ã€‚  </p>
<ol>
<li>æ‰“å¼€ Cloudflare æ§åˆ¶å°ï¼Œé€‰æ‹©å¯¹åº”çš„åŸŸå</li>
<li>ä¾§è¾¹æ é€‰æ‹© <strong>è§„åˆ™</strong> â†’ <strong>åˆ›å»ºè§„åˆ™</strong> â†’ <strong>å“åº”å¤´è½¬æ¢è§„åˆ™</strong></li>
<li>é€‰æ‹© <strong>å‘å“åº”æ·»åŠ é™æ€æ ‡å¤´</strong> æ¨¡æ¿</li>
<li>é€‰æ‹© <strong>è‡ªå®šä¹‰ç­›é€‰è¡¨è¾¾å¼</strong></li>
<li>ç¼–è¾‘è¡¨è¾¾å¼ <code>(http.request.full_uri wildcard &quot;https://è¿™é‡Œå¡«å†™ä½ è‡ªå·±çš„åŸŸå/*&quot;)</code></li>
<li>è§„åˆ™ <strong>æ·»åŠ é™æ€å“åº”å¤´</strong><ul>
<li><code>cross-origin-resource-policy = cross-origin</code></li>
<li><code>referrer-policy = strict-origin-when-cross-origin</code></li>
</ul>
</li>
</ol>
<p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶å†è®¿é—®è‡ªå®šä¹‰åŸŸåï¼Œå‘ç°å›¾ç‰‡å°±æ­£å¸¸æºå¸¦äº† <code>Referer</code></p>
]]></content>
  </entry>
  <entry>
    <title>Garmin å›½è¡Œç è¡¨ä½¿ç”¨ OSM åœ°å›¾</title>
    <url>/post/16e3b020.html</url>
    <content><![CDATA[<p>å›½è¡Œçš„ Garmin ç è¡¨ä¸‹è½½å¹¶å®‰è£… <code>OSM China</code> åœ°å›¾ä½œä¸ºéª‘è¡Œåœ°å›¾ã€‚<br>æ•°æ®æ¥æº <span class="exturl" data-url="aHR0cHM6Ly9hbHRlcm5hdGl2YXNsaWJyZXMub3JnL2VuL2Rvd25sb2Fkcy5waHAjQXNpYQ==">alternativaslibres<i class="fa fa-external-link-alt"></i></span> å¹¶æ·»åŠ äº†å¿…è¦çš„å…ƒæ•°æ®ã€‚</p>
<span id="more"></span>
<h1 id="ä¸‹è½½é“¾æ¥"><a href="#ä¸‹è½½é“¾æ¥" class="headerlink" title="ä¸‹è½½é“¾æ¥"></a>ä¸‹è½½é“¾æ¥</h1><p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå¹¶å°†ä¸‹è½½å¥½çš„ <code>img</code> æ–‡ä»¶å¤åˆ¶åˆ°ä½³æ˜ç è¡¨ <code>Garmin/Maps/</code> ç„¶ååœ¨ç è¡¨åœ°å›¾ä¸­ç¦ç”¨è‡ªå¸¦çš„æ‰€æœ‰åœ°å›¾å³å¯ä½¿ç”¨ã€‚</p>
<a class="btn" href="https://9lnk.io/gJHF" title="ç‚¹å‡»ä¸‹è½½ 2025-10-04"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½ 2025-10-04</a>
]]></content>
  </entry>
  <entry>
    <title>Cloudflare Workers é€šç”¨ Turnstile éªŒè¯æ¨¡å—</title>
    <url>/post/7b67508c.html</url>
    <content><![CDATA[<p>æœ€è¿‘ä½¿ç”¨ Cloudflare Workers å®ç°äº†ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC1ub3RlLmFwcC8=">åœ¨çº¿ç¬”è®°æœ¬<i class="fa fa-external-link-alt"></i></span> å’Œ <span class="exturl" data-url="aHR0cHM6Ly85bG5rLmlvLw==">çŸ­é“¾æ¥æœåŠ¡<i class="fa fa-external-link-alt"></i></span> åˆ†åˆ«ä½¿ç”¨äº† <code>Cloudflare KV</code> å’Œ <code>Cloudflare D1</code> è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ ¹æ® <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL2t2L3BsYXRmb3JtL3ByaWNpbmcv">Cloudflare KV å®šä»·æ–‡æ¡£<i class="fa fa-external-link-alt"></i></span> å…è´¹è®¡åˆ’æ¯å¤©æ˜¯æœ‰æ¬¡æ•°é™åˆ¶çš„ã€‚ä¸ºäº†é¿å…äº’è”ç½‘ä¸Šå„ç§æ‰«æå™¨çš„è¯·æ±‚å¯¼è‡´æ¶ˆè€—é™é¢ï¼Œå°±éœ€è¦è¿‡æ»¤ä¸€æ³¢éäººç±»è¯·æ±‚äº†ã€‚</p>
<span id="more"></span>

<p>è€Œåœ¨ä¸ä¹…å‰ï¼Œæˆ‘åˆšåˆšä½¿ç”¨ <code>Cloudflare Turnstile</code> ç»™åšå®¢å¢åŠ äº†ä¸€ä¸‹äººå·¥éªŒè¯ï¼Œå¯ä»¥å¦‚æ³•ç‚®åˆ¶ç»™è¿™ä¸ªä¹ŸåŠ ä¸Šã€‚ä½†æ˜¯ä»¥åæ¯ä¸€ä¸ª <code>worker</code> æƒ³è¿˜ç”¨éªŒè¯éƒ½éœ€è¦é‡å¤æ·»åŠ  <code>Turnstile</code> çš„ä»£ç ï¼Œæ‰€ä»¥å°±æŠŠè¿™ä¸ªé€»è¾‘ç»™æŠ½å‡ºæ¥ç»„æˆä¸€ä¸ªå•ç‹¬çš„æ¨¡å—äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cloudflare Workers é€šç”¨ Turnstile éªŒè¯æ¨¡å—</span></span><br><span class="line"><span class="comment"> * æä¾›å®Œæ•´çš„ Turnstile éªŒè¯ã€JWT Token ç®¡ç†å’Œ Cookie å¤„ç†åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT_CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">TURNSTILE_URL</span>: <span class="string">&quot;https://challenges.cloudflare.com/turnstile/v0/siteverify&quot;</span>,</span><br><span class="line">  <span class="attr">TURNSTILE_EXPIRE</span>: <span class="number">3600</span>,</span><br><span class="line">  <span class="attr">JWT_ALGORITHM</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆ JWT Token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">payload</span> - JWT payload</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;string&gt;</span>&#125; JWT token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateToken</span>(<span class="params">payload, secret</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> header = <span class="title function_">btoa</span>(</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">alg</span>: <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">JWT_ALGORITHM</span>, <span class="attr">typ</span>: <span class="string">&quot;JWT&quot;</span> &#125;)</span><br><span class="line">  ).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> encodedPayload = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(payload)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;encodedPayload&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(secret),</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(</span><br><span class="line">    <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">    key,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(data)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;data&#125;</span>.<span class="subst">$&#123;btoa(</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="built_in">String</span>.fromCharCode(...<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(signature))</span></span></span><br><span class="line"><span class="subst"><span class="string">  ).replace(/=/g, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ JWT Token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">token</span> - JWT token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyToken</span>(<span class="params">token, secret</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è·å–: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [header, payload, signature] = token.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!header || !payload || !signature) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;payload&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">      <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(secret),</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      [<span class="string">&quot;verify&quot;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSignature = <span class="title class_">Uint8Array</span>.<span class="title function_">from</span>(</span><br><span class="line">      <span class="title function_">atob</span>(signature + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (signature.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>)),</span><br><span class="line">      <span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">verify</span>(</span><br><span class="line">      <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">      key,</span><br><span class="line">      expectedSignature,</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(data)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token æœ‰æ•ˆ: <span class="subst">$&#123;isValid&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isValid) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decodedPayload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">      <span class="title function_">atob</span>(payload + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (payload.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è§£ç : <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decodedPayload)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isExpired = decodedPayload.<span class="property">exp</span> &gt; <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è¿‡æœŸ: <span class="subst">$&#123;!isExpired&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> isExpired;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token å¤±è´¥: <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯ Turnstile Response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">response</span> - Turnstile response token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">remoteip</span> - å®¢æˆ·ç«¯ IP</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">secretKey</span> - Turnstile secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyTurnstile</span>(<span class="params">response, remoteip, secretKey</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile è´¨è¯¢: <span class="subst">$&#123;remoteip&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;secret&quot;</span>, secretKey);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;response&quot;</span>, response);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;remoteip&quot;</span>, remoteip);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">await</span> (</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">TURNSTILE_URL</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      <span class="attr">body</span>: formData,</span><br><span class="line">    &#125;)</span><br><span class="line">  ).<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile ç»“æœ: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> result.<span class="property">success</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²é€šè¿‡éªŒè¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Request</span>&#125; <span class="variable">request</span> - è¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">cookieName</span> - Cookieå ç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">jwtSecret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;boolean&gt;</span>&#125; éªŒè¯ç»“æœï¼ˆtrue è¡¨ç¤ºæœ‰æ•ˆï¼Œfalse è¡¨ç¤ºæ— æ•ˆï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">isVerified</span>(<span class="params">request, cookieName, jwtSecret</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cookie = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Cookie&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> match = cookie.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`<span class="subst">$&#123;cookieName&#125;</span>=([^;]+)`</span>));</span><br><span class="line">  <span class="keyword">return</span> match ? <span class="keyword">await</span> <span class="title function_">verifyToken</span>(match[<span class="number">1</span>], jwtSecret) : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆ Turnstile éªŒè¯é¡µé¢ HTML</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">options</span> - é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; options.siteKey - Turnstile site key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.title] - é¡µé¢æ ‡é¢˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.logo] - Logoæ–‡æœ¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; [options.description] - æè¿°æ–‡æœ¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">string</span>&#125; HTMLå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTurnstileHTML</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  siteKey,</span></span><br><span class="line"><span class="params">  title = <span class="string">&quot;å®‰å…¨éªŒè¯&quot;</span>,</span></span><br><span class="line"><span class="params">  logo = <span class="string">&quot;ğŸ”’&quot;</span>,</span></span><br><span class="line"><span class="params">  description = <span class="string">&quot;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­ä½¿ç”¨&quot;</span>,</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&lt;title&gt;<span class="subst">$&#123;title&#125;</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;script src=&quot;https://challenges.cloudflare.com/turnstile/v0/api.js&quot; async defer&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">body&#123;font-family:system-ui;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;padding:0;min-height:100vh;display:flex;align-items:center;justify-content:center&#125;</span></span><br><span class="line"><span class="string">.container&#123;background:white;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.1);padding:40px;width:400px;text-align:center&#125;</span></span><br><span class="line"><span class="string">.logo&#123;font-size:24px;font-weight:bold;color:#333;margin-bottom:24px&#125;</span></span><br><span class="line"><span class="string">.title&#123;color:#333;margin-bottom:16px;font-size:18px&#125;</span></span><br><span class="line"><span class="string">.description&#123;color:#666;margin-bottom:24px;font-size:14px&#125;</span></span><br><span class="line"><span class="string">.turnstile-container&#123;display:flex;justify-content:center;margin:20px 0;min-height:65px&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;container&quot;&gt;&lt;div class=&quot;logo&quot;&gt;<span class="subst">$&#123;logo&#125;</span>&lt;/div&gt;&lt;h2 class=&quot;title&quot;&gt;<span class="subst">$&#123;title&#125;</span>&lt;/h2&gt;&lt;p class=&quot;description&quot;&gt;<span class="subst">$&#123;description&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;form method=&quot;POST&quot;&gt;&lt;div class=&quot;turnstile-container&quot;&gt;&lt;div class=&quot;cf-turnstile&quot; data-sitekey=&quot;<span class="subst">$&#123;siteKey&#125;</span>&quot; data-callback=&quot;onSuccess&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;function onSuccess()&#123;document.querySelector(&#x27;form&#x27;).submit();&#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®éªŒè¯æˆåŠŸçš„å“åº”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">targetPath</span> - é‡å®šå‘ç›®æ ‡è·¯å¾„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">cookieName</span> - Cookieåç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">jwtSecret</span> - JWT secret key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [expireTime] - è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;Response&gt;</span>&#125; é‡å®šå‘å“åº”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setSuccessResponse</span>(<span class="params"></span></span><br><span class="line"><span class="params">  targetPath,</span></span><br><span class="line"><span class="params">  cookieName,</span></span><br><span class="line"><span class="params">  jwtSecret,</span></span><br><span class="line"><span class="params">  expireTime</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123;</span><br><span class="line">    <span class="attr">verified</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">iat</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>),</span><br><span class="line">    <span class="attr">exp</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + expireTime,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">await</span> <span class="title function_">generateToken</span>(payload, jwtSecret);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Cookie è®¾ç½®: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">302</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Location</span>: targetPath,</span><br><span class="line">      <span class="string">&quot;Set-Cookie&quot;</span>: <span class="string">`<span class="subst">$&#123;cookieName&#125;</span>=<span class="subst">$&#123;token&#125;</span>; Path=/; Max-Age=<span class="subst">$&#123;expireTime&#125;</span>; HttpOnly; SameSite=Lax; Secure`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Turnstile éªŒè¯ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"> * ```javascript</span></span><br><span class="line"><span class="comment"> * import &#123; turnstileMiddleware &#125; from &#x27;./shared/turnstile-auth.js&#x27;;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * const turnstileAuth = turnstileMiddleware(&#123;</span></span><br><span class="line"><span class="comment"> *   cookieName: &#x27;my_app_verified&#x27;,</span></span><br><span class="line"><span class="comment"> *   logo: &#x27;ğŸ“ MyApp&#x27;,</span></span><br><span class="line"><span class="comment"> *   skipPaths: [&#x27;/api/public&#x27;]</span></span><br><span class="line"><span class="comment"> * &#125;);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * export default &#123;</span></span><br><span class="line"><span class="comment"> *   async fetch(request, env) &#123;</span></span><br><span class="line"><span class="comment"> *     const authResult = await turnstileAuth(request, env);</span></span><br><span class="line"><span class="comment"> *     if (authResult) return authResult;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     // éªŒè¯é€šè¿‡ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment"> *     return new Response(&#x27;Hello World&#x27;);</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * ```</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç¯å¢ƒå˜é‡é…ç½®ï¼š</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_SITE_KEY: Turnstile ç«™ç‚¹ Key</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_SECRET_KEY: Turnstile ç«™ç‚¹å¯†é’¥</span></span><br><span class="line"><span class="comment"> * - TURNSTILE_EXPIRE: Turnstile è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 3600ï¼ˆ1å°æ—¶ï¼‰</span></span><br><span class="line"><span class="comment"> * - JWT_SECRET: JWT ç­¾åå¯†é’¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">turnstileMiddleware</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    cookieName = <span class="string">&quot;app_verified&quot;</span>,</span><br><span class="line">    logo = <span class="string">&quot;ğŸ”’&quot;</span>,</span><br><span class="line">    title = <span class="string">&quot;å®‰å…¨éªŒè¯&quot;</span>,</span><br><span class="line">    description = <span class="string">&quot;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­ä½¿ç”¨&quot;</span>,</span><br><span class="line">    skipPaths = [],</span><br><span class="line">    skipMethods = [<span class="string">&quot;OPTIONS&quot;</span>],</span><br><span class="line">  &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">turnstileAuth</span>(<span class="params">request, env</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; pathname, search &#125; = url;</span><br><span class="line">    <span class="keyword">const</span> &#123; method &#125; = request;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      skipMethods.<span class="title function_">includes</span>(method) ||</span><br><span class="line">      skipPaths.<span class="title function_">some</span>(<span class="function">(<span class="params">path</span>) =&gt;</span> pathname.<span class="title function_">startsWith</span>(path))</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">isVerified</span>(request, cookieName, env.<span class="property">JWT_SECRET</span>))) &#123;</span><br><span class="line">      <span class="keyword">if</span> (method === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">await</span> request.<span class="title function_">formData</span>();</span><br><span class="line">        <span class="keyword">const</span> remoteip = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;CF-Connecting-IP&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> response = formData.<span class="title function_">get</span>(<span class="string">&quot;cf-turnstile-response&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          <span class="keyword">await</span> <span class="title function_">verifyTurnstile</span>(response, remoteip, env.<span class="property">TURNSTILE_SECRET_KEY</span>)</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">const</span> expireTime =</span><br><span class="line">            <span class="built_in">parseInt</span>(env.<span class="property">TURNSTILE_EXPIRE</span>) || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">TURNSTILE_EXPIRE</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">setSuccessResponse</span>(</span><br><span class="line">            pathname + search,</span><br><span class="line">            cookieName,</span><br><span class="line">            env.<span class="property">JWT_SECRET</span>,</span><br><span class="line">            expireTime</span><br><span class="line">          );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;éªŒè¯å¤±è´¥&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·³è½¬ Turnstile é¡µé¢&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(</span><br><span class="line">        <span class="title function_">getTurnstileHTML</span>(&#123;</span><br><span class="line">          <span class="attr">siteKey</span>: env.<span class="property">TURNSTILE_SITE_KEY</span>,</span><br><span class="line">          title,</span><br><span class="line">          logo,</span><br><span class="line">          description,</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">headers</span>: &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html; charset=utf-8&quot;</span> &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦å°†ä»¥ä¸Šä»£ç ä¿å­˜æ‰¾ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œåœ¨ <code>worker</code> ä»£ç ä¸­å¼•ç”¨ï¼Œå¹¶ä¸”é€šè¿‡åœ¨ <code>wrangler.jsonc</code> ä¸­è®¾ç½® <code>TURNSTILE_SITE_KEY</code>(å¿…é¡») <code>TURNSTILE_SECRET_KEY</code>(å¿…é¡») <code>JWT_SECRET</code>(å¿…é¡») <code>TURNSTILE_EXPIRE</code>(å¯é€‰) è¿™å‡ ä¸ªç¯å¢ƒå˜é‡ï¼Œå‰©ä¸‹çš„æŒ‰ç…§ä»£ç ä¸­çš„ç¤ºä¾‹ä½¿ç”¨å³å¯ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>GitLab è‡ªåŠ¨éƒ¨ç½² GitHub Pages åšå®¢</title>
    <url>/post/4a4b01f0.html</url>
    <content><![CDATA[<p>åœ¨ä¹‹å‰ã€Š<a href="/post/8d4f8799.html" title="æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨">æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨</a>ã€‹è¯´åˆ°æˆ‘ç°åœ¨æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè€Œä¸”æ ¹æ®ä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬å·²ç»æ­å»ºå¥½äº†è¿™æ ·çš„ä¸€ä¸ªç¯å¢ƒã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆå°±èµ¶ç´§ç”¨èµ·æ¥å§ã€‚</p>
<span id="more"></span>

<p>é‚£ä¹ˆè¿™ä¸€ç¯‡ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹å¦‚ä½•ç”¨è¿™ä¸ªå®¶åº­ç§äºº GitLab å®ç°è‡ªåŠ¨éƒ¨ç½²æ‰˜ç®¡åœ¨ GitHub Pages ä¸Šçš„åšå®¢ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ <code>Hexo</code> æ¡†æ¶ + <code>Next</code> ä¸»é¢˜ï¼Œå…¶ä»–çš„é™æ€åšå®¢æ¡†æ¶å¤§åŒå°å¼‚ã€‚è¿™çš„å…³æ³¨ç‚¹ä¸åœ¨æ­å»ºåšå®¢ï¼Œè¿™é‡Œå‡å®šä½ å·²ç»æœ‰äº†ä¸€ä¸ªæ­£åœ¨æ‰˜ç®¡çš„ GitHub Pages åšå®¢ã€‚è¿™ç¯‡æ–‡ç« å°†æ­¤åšå®¢ä¸ºä¾‹å­è®²è§£ä¸€ä¸‹ã€‚</p>
<h1 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h1><p>ç”¨è¿‡ <code>Hexo</code> çš„éƒ½çŸ¥é“ï¼Œå®ƒéœ€è¦åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šæ­å»ºä¸€ä¸ª <code>Node</code> ç¯å¢ƒã€‚å®‰è£…æ¡†æ¶ã€è‡ªå®šä¹‰ä¿®æ”¹é…ç½®ã€Markdown å†™æ–‡ç« ï¼Œç„¶åç”Ÿæˆã€æœ€ååˆ©ç”¨ Git æ¨é€åˆ° GitHub ä»“åº“ ç„¶åæ‰èƒ½åœ¨ç½‘ä¸Šçœ‹åˆ°å‘å¸ƒçš„æ–‡ç« ã€‚é‚£ä¹ˆè¿™æ ·å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸä¸€å¤©ä½ æœ¬åœ°çš„å†™åšå®¢çš„ç¯å¢ƒä¸¢å¤±äº†ï¼ˆæ¯”å¦‚ç”µè„‘åäº†ï¼Œç¡¬ç›˜åäº†ç­‰ç­‰ç­‰ç­‰ï¼‰é‚£ä¹ˆå¦‚æœä½ æƒ³å†æ›´æ–°ä½ çš„åšå®¢å°±éœ€è¦å†æ¬¡æ­å»ºè¿™æ ·ä¸€ä¸ªç¯å¢ƒï¼Œé™¤äº†éœ€è¦å°†æ‰€æœ‰çš„é…ç½®å†æ¬¡é…ç½®ä¸€éï¼Œå…³é”®æ˜¯æ—§çš„ Markdown æ–‡ç« å·²ç»å‡ ä¹å†æ‰¾ä¸å›æ¥äº†ã€‚</p>
<p>å‡ å¹´å‰æˆ‘ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´æ”¾å¼ƒäº†ä¹‹å‰å†™äº†å¾ˆå¤šæ–‡ç« çš„åšå®¢ã€‚é‚£åˆ°è¿™é‡Œå°±æœ‰äººæƒ³äº†ï¼Œå¦‚æœæˆ‘æŠŠä½äºæœ¬åœ°çš„é‚£ä¸ª â€˜ç¯å¢ƒâ€™ ä¹Ÿç”¨ Git ç®¡ç†èµ·æ¥å‘¢ï¼Ÿä¸é”™çš„æƒ³æ³•ï¼Œä¹‹åæˆ‘ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œåœ¨ GitHub ä¸Šå†æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œç”¨æ¥ä¿å­˜æœ¬åœ°å†™åšå®¢çš„ç¯å¢ƒï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ¢ç”µè„‘äº†ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªä»“åº“ clone ä¸‹æ¥ï¼Œå®‰è£…ä¸€ä¸‹ç›¸å…³çš„ä¾èµ–ï¼Œå°±å¯ä»¥ç»§ç»­äº†ã€‚</p>
<p>çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†å¾ˆå¿«å°±é‡åˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šè¿™é‡Œç›¸å½“äºæŠŠä½ çš„åšå®¢æ‰€æœ‰æºç éƒ½å…¬å¼€äº†å‡ºå»ï¼Œæœ‰ä»€ä¹ˆå¼Šç«¯ä¹ˆï¼Ÿæ¯”å¦‚å‡å¦‚ä½ ä½¿ç”¨äº† <code>hexo-blog-encrypt</code> æ’ä»¶å¯¹æŸäº›åšå®¢è¿›è¡ŒåŠ å¯†ï¼Œå¯†ç ä½¿éœ€è¦æ˜æ–‡å†™åœ¨å¾…åŠ å¯†åšå®¢çš„å¤´éƒ¨ä¿¡æ¯é‡Œçš„ã€‚å¥½å®¶ä¼™ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸å°±æˆäº†é˜²å›å­ä¸é˜²å°äººäº†ï¼Ÿæ‰€ä»¥è¿™å°±éœ€è¦æŠŠæºç æ‰˜ç®¡åœ¨æˆ‘ä»¬ä¹‹å‰æ­å»ºé‚£ä¸ªå®¶åº­ç§äººçš„ GitLab ä¸Šçš„ã€‚</p>
<p>ä½†æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘åˆåŒå’å•å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ç»å¸¸å¿˜è®°æŠŠæœ¬åœ°çš„åšå®¢æºç  push åˆ° GitLab ä¸Šã€‚å¤§éƒ¨åˆ†çš„æ—¶å€™éƒ½æ˜¯æœ¬åœ°å†™å®Œï¼Œä¿®æ”¹çš„å·®ä¸å¤šä¹‹åå°± <code>hexo deploy</code> éƒ¨ç½²åå°±å¿˜äº† push åˆ° GitLabï¼Œå¯¼è‡´ç”¨çš„æ—¶å€™è¯¥ä¸¢çš„æ–‡ç« è¿˜æ˜¯ä¸¢äº†ã€‚æ¼ç¾æˆæ€’ä¹‹ä¸‹ï¼ŒèŒç”Ÿäº†åˆ©ç”¨ GitLab CI&#x2F;CD è‡ªåŠ¨éƒ¨ç½²ã€‚å®ç°æ¯æ¬¡å†™å®Œæ–‡ç« ï¼Œåªéœ€è¦ push æœ¬åœ°æºç åˆ° GitLabï¼Œç„¶å GitLab è‡ªåŠ¨éƒ¨ç½²ã€‚è¿™æ ·ä¸€æ¥å°±ä¸æ€•æ¯æ¬¡å†™å®Œæ–‡ç« æ‰‹åŠ¨éƒ¨ç½²ä¹‹åå¿˜è®°æäº¤æœ¬åœ°æºç ï¼ŒäºŒæ¥ä¹Ÿå‡å°‘äº†éœ€è¦æ‰‹åŠ¨çš„æ­¥éª¤ã€‚æ¯•ç«Ÿæ‡’æƒ°æ‰æ˜¯äººç±»çš„ç¬¬ä¸€ç”Ÿäº§åŠ›ã€‚</p>
<h1 id="å¼€å§‹å§"><a href="#å¼€å§‹å§" class="headerlink" title="å¼€å§‹å§"></a>å¼€å§‹å§</h1><h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><p>ä½¿ç”¨ GitLab CI&#x2F;CD åŠŸèƒ½ä¸æ˜¯å¿…é¡» Dockerï¼Œä½†æ˜¯å®¹å™¨åŒ–çš„ Docker èƒ½å¤Ÿéš”ç¦»ç‰©ç†æœºï¼Œé˜²æ­¢ä¸€è¨€ä¸åˆä¸€ä¸ª <code>rm -rf /*</code> è®©ä½ çš„å¿ƒè¡€ç™½è´¹ã€‚</p>
<p>ä»¥ä¸‹å‘½ä»¤éœ€è¦ ssh åˆ° GitLab æœåŠ¡æ‰€åœ¨çš„æœºå™¨ä¸­è¿›è¡Œ</p>
<ol>
<li>å¸è½½æ—§ç‰ˆæœ¬ Dockerï¼ˆå¦‚æœæ²¡å®‰è£…è¿‡ï¼Œå¯ä»¥çœç•¥ï¼‰</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®‰è£…å¿…è¦ä¾èµ–</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt install apt-transport-https ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ·»åŠ  apt æº</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">sudo</span> gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line"> <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string"> <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å®‰è£… Docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¯åŠ¨ Docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥ä¸Šå‘½ä»¤æ²¡æœ‰å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆ docker å°±å·²ç»å®‰è£…åˆ°æœåŠ¡å™¨ä¸Šäº†ã€‚å¦‚æœä¸æ”¾å¿ƒï¼Œå¯ä»¥é€šè¿‡ <code>sudo docker -v</code> å‘½ä»¤ï¼Œå¦‚æœè¾“å‡ºç±»ä¼¼ <code>Docker version 20.10.12, build e91ed57</code> å°±è¯´æ˜ docker å·²ç»æ­£ç¡®å®‰è£…äº†ã€‚</p>
<h2 id="å®‰è£…-Gitlab-Runner"><a href="#å®‰è£…-Gitlab-Runner" class="headerlink" title="å®‰è£… Gitlab-Runner"></a>å®‰è£… Gitlab-Runner</h2><p>ä»¥ä¸‹çš„å‘½ä»¤éƒ½éœ€è¦ ssh åˆ° GitLab æœåŠ¡æ‰€åœ¨çš„æœºå™¨ä¸­è¿›è¡Œ</p>
<ol>
<li>æ·»åŠ  gitlab-runner åº“</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -L <span class="string">&quot;https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh&quot;</span> | <span class="built_in">sudo</span> bash</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®‰è£… gitlab-runner</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gitlab-runner</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œgitlab-runner å°±å®‰è£…å¥½äº†ï¼Œå¯ä»¥è¿è¡Œ <code>sudo gitlab-runner -v</code> å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ gitlab-runner å®‰è£…æˆåŠŸã€‚</p>
<h2 id="æ³¨å†Œ-Runner"><a href="#æ³¨å†Œ-Runner" class="headerlink" title="æ³¨å†Œ Runner"></a>æ³¨å†Œ Runner</h2><p>é¦–å…ˆä½¿ç”¨ <code>root</code> ç”¨æˆ·ç™»å½• gitlab -&gt; ç‚¹å‡»å·¦ä¸Šæ–¹ <code>Menu</code> -&gt; è¿›å…¥ <code>Admin</code> -&gt; ç‚¹å‡»å·¦ä¾§é¢æ¿ <code>Overview</code> ä¸‹çš„ <code>Runners</code><br><img src="https://images.zabrian.com/4dc2c2e2-dffb-44f5-2a7e-4140ab776f01/origin" title="GitLab-Admin-Runners" style="zoom:100%;" /></p>
<p>ç„¶åç‚¹å‡»å³ä¸Šæ–¹ Register an instance runnerï¼Œå¤åˆ¶ Registration token<br><img src="https://images.zabrian.com/fc6c425a-3304-44c8-a670-b425588c6101/origin" title="Register an instance runner" style="zoom:100%;" /></p>
<p>å†æ¬¡é€šè¿‡ ssh è¿æ¥ GitLab æœåŠ¡å™¨æ³¨å†Œä¸€ä¸ªå…±äº« Runner</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-runner register</span><br><span class="line">Enter the GitLab instance URL (<span class="keyword">for</span> example, https://gitlab.com/):</span><br><span class="line">http://git.home/            <span class="comment"># æœ¬åœ° GitLab åŸŸåæˆ–è€…IP</span></span><br><span class="line">Enter the registration token:</span><br><span class="line">xxxxxxxxxxxxxxxx            <span class="comment"># ä¸Šé¢è·å–åˆ°çš„ token</span></span><br><span class="line">Enter a description <span class="keyword">for</span> the runner:</span><br><span class="line">[ubuntu]: node              <span class="comment"># runner è‡ªå®šä¸€ä¸ªåå­—</span></span><br><span class="line">Enter tags <span class="keyword">for</span> the runner (comma-separated):</span><br><span class="line">node                        <span class="comment"># runner tag çš„åå­—ï¼Œé€šè¿‡ tag æŒ‡å®šè¿è¡Œ runner</span></span><br><span class="line">Registering runner... succeeded                     runner=xxxxxx</span><br><span class="line">Enter an executor: custom, ssh, docker-ssh+machine, kubernetes, docker, docker-ssh, parallels, shell, virtualbox, docker+machine:</span><br><span class="line">docker                      <span class="comment"># è¿™é‡Œé€‰æ‹© docker</span></span><br><span class="line">Enter the default Docker image (<span class="keyword">for</span> example, ruby:2.6):</span><br><span class="line">node:17                     <span class="comment"># docker é•œåƒä»¥åŠç‰ˆæœ¬</span></span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">&#x27;s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>

<p>å½“åˆ›å»ºå¥½ Runner ä¹‹åï¼Œå†æ¬¡å›åˆ° <code>Runners</code> é¡µé¢åˆ·æ–°å°±å¯ä»¥æ˜¾ç¤ºåˆšåˆšåˆ›å»ºçš„ Runner äº†ã€‚</p>
<h2 id="åˆ›å»º-SSH-å¯†é’¥å¯¹"><a href="#åˆ›å»º-SSH-å¯†é’¥å¯¹" class="headerlink" title="åˆ›å»º SSH å¯†é’¥å¯¹"></a>åˆ›å»º SSH å¯†é’¥å¯¹</h2><p>åœ¨æœ¬åœ°æˆ–è€…æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -f blog -t rsa -b 2048 -C <span class="string">&quot;xxxx@xxx.xxx&quot;</span>     <span class="comment"># é‚®ç®±è‡ªè¡Œæ›¿æ¢</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆä¸€ä¸ªæ— å¯†ç çš„ SSH çš„å¯†é’¥å¯¹</p>
<p>å…¬é’¥ä¸º <code>blog.pub</code>ï¼Œç§é’¥ä¸º <code>blog</code></p>
<h2 id="GitHub-æ·»åŠ -Deploy-keys"><a href="#GitHub-æ·»åŠ -Deploy-keys" class="headerlink" title="GitHub æ·»åŠ  Deploy keys"></a>GitHub æ·»åŠ  Deploy keys</h2><p>ç™»å½• GitHubï¼Œè¿›å…¥éƒ¨ç½²çš„åšå®¢ä»“åº“ï¼Œç‚¹å‡» <code>Settings</code> -&gt; <code>Deploy keys</code> -&gt; <code>Add deploy key</code></p>
<p>å°† <code>blog.pub</code> å…¬é’¥çš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ° <code>Key</code> ä¸­ï¼Œç„¶å <code>Title</code> å¤„è‡ªå®šä¹‰ä¸€ä¸ªåå­—</p>
<h2 id="GitLab-é…ç½®-CI-CD"><a href="#GitLab-é…ç½®-CI-CD" class="headerlink" title="GitLab é…ç½® CI&#x2F;CD"></a>GitLab é…ç½® CI&#x2F;CD</h2><p>è¿›å…¥ GitLab åšå®¢é¡¹ç›®ï¼Œç‚¹å‡» <code>Settings</code> ä¸‹çš„ <code>CI/CD</code>ï¼Œå³ä¾§å±•å¼€ <code>Runners</code> é€‰é¡¹å¡ï¼Œå³ä¾§ <code>Shared runners</code> æ‰“å¼€ <code>Enable shared runners for this project</code> é€‰é¡¹<br><img src="https://images.zabrian.com/6f66496d-6e87-463b-1fe6-657a77a5d801/origin" title="Enable shared runners for this project" style="zoom:25%;" /></p>
<p>ç„¶åå†å±•å¼€åˆ°ä¸‹æ–¹ <code>Variables</code></p>
<p>æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡åˆ†åˆ«æ˜¯</p>
<ul>
<li><code>SSH_KNOWN_HOSTS</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=</span><br></pre></td></tr></table></figure>

<ul>
<li><code>SSH_PRIVATE_KEY</code><br><a href="#%E5%88%9B%E5%BB%BA-SSH-%E5%AF%86%E9%92%A5%E5%AF%B9">åˆ›å»º SSH å¯†é’¥å¯¹</a> ä¸­çš„ç§é’¥ <code>blog</code> å†…å®¹<img src="https://images.zabrian.com/5f546e74-b6d1-4751-a4d7-c80d71e37801/origin" title="GitLab-CICD-Settings-Variables" style="zoom:47%;" /></li>
</ul>
<h2 id="é¡¹ç›®-gitlab-ci-yml-é…ç½®"><a href="#é¡¹ç›®-gitlab-ci-yml-é…ç½®" class="headerlink" title="é¡¹ç›® .gitlab-ci.yml é…ç½®"></a>é¡¹ç›® <code>.gitlab-ci.yml</code> é…ç½®</h2><p>ç»è¿‡ä»¥ä¸Šé…ç½®ï¼Œç°åœ¨ç¦»æˆåŠŸæœ‰ä¸€æ­¥ä¹‹é¥ã€‚</p>
<p>åœ¨ GitLab åšå®¢æºç é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.gitlab-ci.yml</code> çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">main</span> <span class="comment"># æŒ‡å®šåªæœ‰ä¸»åˆ†æ”¯è§¦å‘è¯¥ CI</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node</span> <span class="comment"># æ­¤å¤„ tag æŒ‡å®šåˆ›å»º GitLab Runner æ—¶å€™å¡«å†™ tag åå­—</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ln</span> <span class="string">-sf</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span> <span class="string">/etc/localtime</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">eval</span> <span class="string">$(ssh-agent</span> <span class="string">-s)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">touch</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;$SSH_PRIVATE_KEY&quot;</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">rm</span> <span class="string">-rf</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">touch</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;$SSH_KNOWN_HOSTS&quot;</span> <span class="string">&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">700</span> <span class="string">~/.ssh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">700</span> <span class="string">~/.ssh/*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;xxxx@xxx.xxx&quot;</span> <span class="comment"># GitHub çš„é‚®ç®±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;xxxx&quot;</span> <span class="comment"># GitHub çš„åå­—</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">init.defaultBranch</span> <span class="string">main</span> <span class="comment"># GitHub é¡¹ç›®çš„ä¸»åˆ†æ”¯ main æˆ–è€… master</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">-g</span> <span class="string">hexo-cli</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-deployer-git</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-renderer-swig</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-generator-searchdb</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-symbols-count-time</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-generator-sitemap</span> <span class="string">--save</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-abbrlink</span> <span class="string">--save</span> <span class="comment"># ä»¥ä¸Š npm æ­¥éª¤æ ¹æ®è‡ªå·±æ·»åŠ çš„æ’ä»¶è‡ªå®šä¹‰</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hexo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>

<p>ç„¶å <code>git add .gitlab-ci.yml</code> æœ€åæ¨é€åˆ°ä»“åº“ä¹‹åï¼Œä»ä¾§è¾¹ <code>CI/CD</code> ä¸‹ <code>Pipelines</code> å°±å¯ä»¥çœ‹åˆ°è‡ªåŠ¨è¿è¡Œéƒ¨ç½²å·¥ä½œäº†</p>
<h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œç°åœ¨å°±å¯ä»¥æ¯æ¬¡åœ¨æœ¬åœ°ç¼–è¾‘åï¼Œåªéœ€è¦æ¨é€åˆ° GitLab å¹¶ç¨ç­‰ç‰‡åˆ»ï¼ŒGitHub Pages çš„é¡µé¢å°±æœ‰æœ€æ–°çš„å†…å®¹äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Hexo é™æ€åšå®¢ä½¿ç”¨ Cloudflare Turnstile</title>
    <url>/post/50a431e6.html</url>
    <content><![CDATA[<p>åœ¨ <a href="/post/ec93b507.html" title="Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†">Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†</a> ä¸€æ–‡ä¸­ã€‚ä½¿ç”¨ Workers æ­å»ºäº†ä¸€ä¸ª Images ä»£ç†ï¼Œé€šè¿‡è®¾ç½® <code>Referer</code> å’Œ URL ç­¾åæœ‰æ•ˆæœŸå®ç°ç®€æ˜“çš„é˜²ç›—é“¾ä»¥åŠé˜²åˆ·æµé‡ã€‚ä½†æ˜¯è¿™äº›æªæ–½åªèƒ½åšåˆ°é˜²å›å­ä¸é˜²å°äººï¼Œå…¶å®å¾ˆè½»æ˜“çš„å°±å¯ä»¥é€šè¿‡ä»£ç è‡ªåŠ¨å®ç°åˆ·å›¾ç‰‡æµé‡ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæƒ³ç€èƒ½ä¸èƒ½ä½¿ç”¨ <code>Cloudflare Turnstile</code> é˜»æŒ¡éäººç±»è¯·æ±‚çš„æµé‡ã€‚ä½†æ˜¯ç ”ç©¶äº†ä¸€ä¸‹å‘ç° <code>Cloudflare Turnstile</code> éœ€è¦ <strong><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3R1cm5zdGlsZS9nZXQtc3RhcnRlZC9zZXJ2ZXItc2lkZS12YWxpZGF0aW9uLw==">æœåŠ¡ç«¯ä»£ç éªŒè¯<i class="fa fa-external-link-alt"></i></span></strong> ä½†æ˜¯å¾ˆæ˜¾ç„¶ï¼Œ<code>Hexo</code> è¿™ç§çº¯é™æ€åšå®¢æ²¡æœ‰åç«¯æœåŠ¡ï¼Œæ‰€ä»¥æ€ç´¢äº†ä¸€ä¸‹å†³å®šè¿˜æ˜¯ä½¿ç”¨ Workers å®ç°ä¸€ä¸ªæ”¯æŒé™æ€ç½‘é¡µçš„ <code>Cloudflare Turnstile</code> æ–¹æ¡ˆã€‚</p>
<span id="more"></span>

<p>æ€è·¯å°±æ˜¯å°†åŸå§‹åšå®¢é€šè¿‡ <code>Cloudflare Pages</code> æ‰˜ç®¡å¹¶ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰åŸŸåæ¯”å¦‚ <code>source.example.com</code> ä½œä¸ºé™æ€é¡µé¢çš„æºç«™ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ª blog çš„ Workers (ç»‘å®šè‡ªå®šä¹‰åŸŸå <code>blog.example.com</code>) ä½œä¸ºä»£ç†ç«™ï¼Œåœ¨è¿™ä¸ª blog çš„ Workers ä¸­å®ç° <code>Cloudflare Turnstile</code> çš„æœåŠ¡ç«¯éªŒè¯é€»è¾‘ï¼ŒéªŒè¯é€šè¿‡åˆ™æ³¨å…¥ä¸€ä¸ª <code>JWT Token</code> å®ç°åœ¨æœ‰æ•ˆæœŸå†…å°±æ— éœ€å†æ¬¡éªŒè¯ã€‚</p>
<ol>
<li>æ‰“å¼€ <span class="exturl" data-url="aHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tLw==">Cloudflare Dashboard<i class="fa fa-external-link-alt"></i></span> ç‚¹å‡»å·¦ä¾§çš„ <strong>Turnstile</strong> åœ¨å³ä¾§ç‚¹å‡» <strong>æ·»åŠ å°ç»„ä»¶</strong><img src="https://images.zabrian.com/d0a19b46-f067-4866-2f22-f3d224d3a301/origin" title="Turnstile é¦–é¡µ" style="zoom:16%;" /></li>
<li>æŒ‰ç…§å®é™…æƒ…å†µå¡«å†™ä¿¡æ¯ï¼ŒåŸŸååˆ™æ·»åŠ é™æ€é¡µé¢çš„ä»£ç†åŸŸå (ä¸Šæ–‡ä¸­çš„ <code>blog.example.com</code> è€Œä¸æ˜¯ <code>source.example.com</code>)ï¼Œä¸‹æ–¹é€‰æ‹© <strong>æ‰˜ç®¡</strong> å’Œ <strong>å¦</strong><img src="https://images.zabrian.com/b0bdf585-c029-4e0c-ffb8-6b1fe7c34401/origin" title="Turnstile æ·»åŠ ç»„ä»¶" style="zoom:16%;" /></li>
<li>æ·»åŠ å®Œæˆåç¡®è®¤å·²ç»æ·»åŠ æ­£ç¡®çš„åŸŸåï¼Œå¹¶ä¸”ç”Ÿæˆä¸¤ä¸ªéœ€è¦ç”¨åˆ°çš„æ•°æ®: <strong>ç«™ç‚¹å¯†é’¥</strong> å’Œ <strong>å¯†é’¥</strong> æ— éœ€é©¬ä¸Šè®°ä¸‹æ¥ï¼Œåç»­è¿˜å¯ä»¥å†æ¬¡æŸ¥çœ‹ã€‚<img src="https://images.zabrian.com/517237f3-678a-463f-a7f8-8fd73f39cf01/origin" title="æŸ¥çœ‹ä¿¡æ¯" style="zoom:16%;" /></li>
<li>é…ç½® <code>Cloudflare Pages</code> æºç«™ç‚¹ç»‘å®š <code>source.example.com</code> åŸŸåï¼Œå¹¶ç¡®è®¤æºç«™ç‚¹å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</li>
<li>æ·»åŠ è‡ªå®šä¹‰ Workers ä½¿ç”¨ä¸‹æ–¹ä»£ç ï¼Œæ›¿æ¢ä¸ºå®é™…çš„å†…å®¹ã€‚ç»‘å®šè‡ªå®šä¹‰åŸŸå <code>blog.example.com</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é…ç½®å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">BLOG_SOURCE</span>: <span class="string">&quot;https://source.example.com&quot;</span>, <span class="comment">// é™æ€é¡µé¢æºç«™ URLï¼Œè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">  <span class="attr">TURNSTILE_URL</span>: <span class="string">&quot;https://challenges.cloudflare.com/turnstile/v0/siteverify&quot;</span>, <span class="comment">// Turnstile éªŒè¯åœ°å€</span></span><br><span class="line">  <span class="attr">TURNSTILE_SITEKEY</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// Turnstile ç«™ç‚¹å¯†é’¥ï¼Œæ ¹æ®å®é™…ä¿®æ”¹</span></span><br><span class="line">  <span class="attr">TURNSTILE_SECRET</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// Turnstile å¯†é’¥ï¼Œæ ¹æ®å®é™…ä¿®æ”¹</span></span><br><span class="line">  <span class="attr">JWT_SECRET</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// JWT å¯†é’¥ï¼Œå¯é€šè¿‡å‘½ä»¤ç”Ÿæˆ openssl rand -base64 48</span></span><br><span class="line">  <span class="attr">COOKIE_NAME</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// æ³¨å…¥çš„ JWT Token cookie åå­—ï¼Œå¯è‡ªå®šä¹‰</span></span><br><span class="line">  <span class="attr">COOKIE_EXPIRE</span>: <span class="number">3600</span>, <span class="comment">// Turnstile æœ‰æ•ˆæœŸ 1 å°æ—¶ï¼Œå¯è‡ªå®šä¹‰</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆ JWT token</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateToken</span>(<span class="params">payload</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> header = &#123; <span class="attr">alg</span>: <span class="string">&quot;HS256&quot;</span>, <span class="attr">typ</span>: <span class="string">&quot;JWT&quot;</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> encodedHeader = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(header)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> encodedPayload = <span class="title function_">btoa</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(payload)).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;encodedHeader&#125;</span>.<span class="subst">$&#123;encodedPayload&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    encoder.<span class="title function_">encode</span>(<span class="variable constant_">CONFIG</span>.<span class="property">JWT_SECRET</span>),</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(<span class="string">&quot;HMAC&quot;</span>, key, encoder.<span class="title function_">encode</span>(data));</span><br><span class="line">  <span class="keyword">const</span> encodedSignature = <span class="title function_">btoa</span>(</span><br><span class="line">    <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(...<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(signature))</span><br><span class="line">  ).<span class="title function_">replace</span>(<span class="regexp">/=/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;data&#125;</span>.<span class="subst">$&#123;encodedSignature&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ JWT token</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyToken</span>(<span class="params">token</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è·å–: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> parts = token.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (parts.<span class="property">length</span> !== <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [header, payload, signature] = parts;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">`<span class="subst">$&#123;header&#125;</span>.<span class="subst">$&#123;payload&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">      <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">      encoder.<span class="title function_">encode</span>(<span class="variable constant_">CONFIG</span>.<span class="property">JWT_SECRET</span>),</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      [<span class="string">&quot;verify&quot;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedSignature = <span class="title class_">Uint8Array</span>.<span class="title function_">from</span>(</span><br><span class="line">      <span class="title function_">atob</span>(signature + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (signature.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>)),</span><br><span class="line">      <span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> isValid = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">verify</span>(</span><br><span class="line">      <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">      key,</span><br><span class="line">      expectedSignature,</span><br><span class="line">      encoder.<span class="title function_">encode</span>(data)</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token æœ‰æ•ˆ: <span class="subst">$&#123;isValid&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isValid) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> decodedPayload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">      <span class="title function_">atob</span>(payload + <span class="string">&quot;===&quot;</span>.<span class="title function_">substring</span>(<span class="number">0</span>, (<span class="number">4</span> - (payload.<span class="property">length</span> % <span class="number">4</span>)) % <span class="number">4</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è§£ç : <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decodedPayload)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> isExpired = decodedPayload.<span class="property">exp</span> &gt; <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token è¿‡æœŸ: <span class="subst">$&#123;!isExpired&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> isExpired;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JWT Token å¤±è´¥: <span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turnstile HTML é¡µé¢</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTurnstileHTML</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;å®‰å…¨éªŒè¯ - Zabrian&#x27;s Blog&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;script src=&quot;https://challenges.cloudflare.com/turnstile/v0/api.js&quot; async defer&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">  &lt;style&gt;</span></span><br><span class="line"><span class="string">    body &#123; font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; &#125;</span></span><br><span class="line"><span class="string">    .container &#123; background: white; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); padding: 40px; width: 400px; min-height: 300px; text-align: center; box-sizing: border-box; &#125;</span></span><br><span class="line"><span class="string">    .logo &#123; font-size: 24px; font-weight: bold; color: #333; margin-bottom: 24px; &#125;</span></span><br><span class="line"><span class="string">    .title &#123; color: #333; margin-bottom: 16px; font-size: 18px; font-weight: 500; &#125;</span></span><br><span class="line"><span class="string">    .description &#123; color: #666; margin-bottom: 24px; font-size: 14px; line-height: 1.5; &#125;</span></span><br><span class="line"><span class="string">    .turnstile-container &#123; display: flex; justify-content: center; align-items: center; margin: 20px 0; min-height: 65px; width: 100%; &#125;</span></span><br><span class="line"><span class="string">    .cf-turnstile &#123; margin: 0 auto; &#125;</span></span><br><span class="line"><span class="string">  &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;logo&quot;&gt;Zabrian&#x27;s Blog&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class=&quot;title&quot;&gt;å®‰å…¨éªŒè¯&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;description&quot;&gt;è¯·å®Œæˆä»¥ä¸‹éªŒè¯åç»§ç»­è®¿é—®&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;turnstile-container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-turnstile&quot; data-sitekey=&quot;<span class="subst">$&#123;CONFIG.TURNSTILE_SITEKEY&#125;</span>&quot; data-callback=&quot;onSuccess&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;script&gt;function onSuccess()&#123;document.querySelector(&#x27;form&#x27;).submit();&#125;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ Turnstile Response</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyTurnstile</span>(<span class="params">response, remoteip</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile è´¨è¯¢: <span class="subst">$&#123;remoteip&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;secret&quot;</span>, <span class="variable constant_">CONFIG</span>.<span class="property">TURNSTILE_SECRET</span>);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;response&quot;</span>, response);</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&quot;remoteip&quot;</span>, remoteip);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> verifyResponse = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">CONFIG</span>.<span class="property">TURNSTILE_URL</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: formData,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> verifyResponse.<span class="title function_">json</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Turnstile ç»“æœ: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> result.<span class="property">success</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡ JWT éªŒè¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">isVerifiedToken</span>(<span class="params">request</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cookie = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Cookie&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> match = cookie.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="variable constant_">CONFIG</span>.<span class="property">COOKIE_NAME</span> + <span class="string">&quot;=([^;]+)&quot;</span>));</span><br><span class="line">  <span class="keyword">if</span> (!match) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = match[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">verifyToken</span>(token);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®éªŒè¯æˆåŠŸçš„ Cookie</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setSuccessResponse</span>(<span class="params">targetPath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123;</span><br><span class="line">    <span class="attr">verified</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">iat</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>),</span><br><span class="line">    <span class="attr">exp</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + <span class="variable constant_">CONFIG</span>.<span class="property">COOKIE_EXPIRE</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = <span class="keyword">await</span> <span class="title function_">generateToken</span>(payload);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Cookie è®¾ç½®: <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">302</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Location</span>: targetPath,</span><br><span class="line">      <span class="string">&quot;Set-Cookie&quot;</span>: <span class="string">`<span class="subst">$&#123;CONFIG.COOKIE_NAME&#125;</span>=<span class="subst">$&#123;token&#125;</span>; Path=/; Max-Age=<span class="subst">$&#123;CONFIG.COOKIE_EXPIRE&#125;</span>; HttpOnly; SameSite=Lax; Secure`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request, env, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²éªŒè¯</span></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="title function_">isVerifiedToken</span>(request))) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†è´¨è¯¢è¯·æ±‚</span></span><br><span class="line">      <span class="keyword">if</span> (request.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">await</span> request.<span class="title function_">formData</span>();</span><br><span class="line">        <span class="keyword">const</span> remoteip = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;CF-Connecting-IP&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> response = formData.<span class="title function_">get</span>(<span class="string">&quot;cf-turnstile-response&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">verifyTurnstile</span>(response, remoteip)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">setSuccessResponse</span>(url.<span class="property">pathname</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;éªŒè¯å¤±è´¥&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ˜¾ç¤ºéªŒè¯é¡µé¢</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è·³è½¬ Turnstile é¡µé¢&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="title function_">getTurnstileHTML</span>(), &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html; charset=utf-8&quot;</span> &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»£ç†åˆ°æºç«™</span></span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable constant_">CONFIG</span>.<span class="property">BLOG_SOURCE</span> + url.<span class="property">pathname</span> + url.<span class="property">search</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ä»£ç†æºç«™: <span class="subst">$&#123;target&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>(target, request);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œå°±å®ç°äº†é€šè¿‡è®¿é—® <code>blog.example.com</code> æ˜¾ç¤ºä¸€ä¸ªéªŒè¯é¡µé¢çš„æ•ˆæœã€‚<br><img src="https://images.zabrian.com/028c5ff7-7939-4fd4-dc38-3de8f13f4801/origin" title="Turnstile éªŒè¯é¡µé¢" style="zoom:100%;" /><br>éªŒè¯é€šè¿‡åå³å¯è®¿é—®é™æ€é¡µé¢ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ä¿®æ”¹ä»£ç ä¸­çš„ <code>COOKIE_EXPIRE</code> è‡ªè¡Œè°ƒæ•´éªŒè¯é—´éš”æ—¶é—´ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæºç«™ç‚¹çš„ URL ä¸æš´éœ²ï¼Œåªé€šè¿‡ä»£ç†ç«™ç‚¹çš„ URL è®¿é—®ï¼Œå³å¯å®ç°å®šæœŸé€šè¿‡ <code>Cloudflare Turnstile</code> é¿å…å¤§é‡æœºå™¨æµé‡ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Cloudflare ä½¿ç”¨ Workers å»ºç«‹ Images ä»£ç†</title>
    <url>/post/ec93b507.html</url>
    <content><![CDATA[<p>æœ€æ—©è¿™ä¸ªåšå®¢æ˜¯æ‰˜ç®¡åœ¨ GitHub pages ä¸Šçš„ï¼Œç»‘å®šçš„åŸŸåæ˜¯åœ¨é˜¿é‡Œäº‘æ³¨å†Œçš„ï¼Œå‡ ä¸ªæœˆå‰å¶ç„¶ä¸€æ¬¡æœºä¼šï¼Œåœ¨ Cloudflare ä¸Šæ³¨å†Œäº†ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„åŸŸåã€‚äºæ˜¯å°±ä¹Ÿé€šè¿‡ Cloudflare pages æ‰˜ç®¡äº†ç›¸åŒçš„ GitHub pages ä»“åº“ï¼Œå› æ­¤ç›®å‰ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnphYnJpYW4uY29tLw==">Cloudflare pages<i class="fa fa-external-link-alt"></i></span> æˆ–è€… <a href="https://blog.zebedy.com/">GitHub pages</a> å‡å¯è®¿é—®ï¼Œå†…å®¹éƒ½æ¥è‡ªåŒä¸€ä¸ª GitHub repo</p>
<span id="more"></span>

<h1 id="ä½¿ç”¨-Images"><a href="#ä½¿ç”¨-Images" class="headerlink" title="ä½¿ç”¨ Images"></a>ä½¿ç”¨ Images</h1><p>å°±åœ¨æˆ‘æ— èŠæŠŠç©èµ›åšè©è¨çš„å„ç§åŠŸèƒ½çš„æ—¶å€™ï¼Œå‘ç° Images çš„å®šä»·è¿˜ç®—å¾ˆå®æƒ ï¼Œäºæ˜¯ä¹å¼€é€šäº† Images Stream Bundle Basic å¥—é¤ï¼ŒåŒ…å«é¢„ä»˜è´¹ $5.00&#x2F;æœˆ 100,000 å¼ å›¾ç‰‡å’Œ 1,000 åˆ†é’Ÿè§†é¢‘å­˜å‚¨ä»¥åŠåä»˜è´¹ $1.00&#x2F;100,000 å¼ å›¾ç‰‡çš„äº¤ä»˜ã€‚<br>æ—¢ç„¶éƒ½è®¢é˜…äº†ï¼Œç„¶åå°±æƒ³ç€æŠŠåšå®¢ç°åœ¨çš„å›¾ç‰‡éƒ½è¿ç§»åˆ° Images ä¸Šæ¥ã€‚ä½†æ˜¯å§ï¼Œé—®é¢˜å°±åœ¨äº Images çš„å›¾ç‰‡æ˜¯å¯ä»¥å…¬å…±è¯»çš„ã€‚ç›´æ¥æ”¾åˆ°åšå®¢ä¸Šä¸‡ä¸€å“ªå¤©è¢«åˆ·æµé‡äº†ï¼Œå¾—ä¸å¿å¤±ã€‚ç ”ç©¶äº†ä¸€ä¸‹å‘ç° Images æ˜¯å¯ä»¥ç”Ÿæˆå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç­¾å URL çš„ï¼Œå¯æ˜¯é—®é¢˜æ˜¯æˆ‘çš„åšå®¢æ˜¯é™æ€åšå®¢ï¼Œå›¾ç‰‡é“¾æ¥éƒ½éœ€è¦å†™æ­»åœ¨ <code>&lt;img&gt;</code> æ ‡ç­¾é‡Œé¢ã€‚å·¦æ€å³æƒ³ä¹‹ä¸‹æƒ³åˆ°äº†ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•ã€‚<br>æ€»ä½“æ€è·¯å°±æ˜¯ä¸Šä¼ çš„å›¾ç‰‡æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åè¯¥å›¾ç‰‡å°±å¿…é¡»é€šè¿‡ç­¾å URL è®¿é—®ï¼Œç„¶åå®ç°ä¸€ä¸ª Worker åˆ¤æ–­ URL æ˜¯å¦åŒ…å«ç­¾åä¿¡æ¯ï¼Œå¦‚æœä¸åŒ…å«ï¼Œåˆ™é€šè¿‡ URL æ¥æ”¶ <code>å›¾åƒ ID(imageID)</code> å’Œ <code>å˜ä½“(variant)</code> ç„¶åå¯¹ URL å®ç°ç­¾åï¼Œç”Ÿæˆä¸€ä¸ªå¸¦ç­¾åçš„ URL å¹¶ 302 é‡å®šå‘å› Workerã€‚å¦‚æœ URL åŒ…å«ç­¾åä¿¡æ¯ï¼Œåˆ™è¯·æ±‚å›¾ç‰‡èµ„æºå¹¶è¿”å›ã€‚</p>
<img src="https://images.zabrian.com/2d0fc541-8fd3-48d7-d763-e1fee14d3401/origin" title="æµç¨‹å›¾" style="zoom:42%;" />

<p>æ€è·¯æœ‰äº†é‚£å°±å¼€å§‹ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ª Worker ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCOUNT_HASH</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Images å¸æˆ·å“ˆå¸Œ&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">KEY</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Image è´¦æˆ· API ä»¤ç‰Œ&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_CUSTOM_DOMAIN</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Worker ç»‘å®šçš„è‡ªå®šä¹‰åŸŸå&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EXPIRATION</span> = <span class="number">60</span>; <span class="comment">// ç­¾åå›¾ç‰‡è¿‡æœŸæ—¶é—´ 1 min</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ALLOWED_REFERERS</span> = []; <span class="comment">// æ­¤å¤„å¡«å†™è¯·æ±‚ Referer ç™½åå•ä½œä¸ºé˜²ç›—é“¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_DELIVERY_DOMAIN</span> = <span class="string">&quot;imagedelivery.net&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">bufferToHex</span> = (<span class="params">buffer</span>) =&gt;</span><br><span class="line">  [...<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buffer)]</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>))</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateSignedUrl</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line">  <span class="keyword">const</span> secretKey = encoder.<span class="title function_">encode</span>(<span class="variable constant_">KEY</span>);</span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">importKey</span>(</span><br><span class="line">    <span class="string">&quot;raw&quot;</span>,</span><br><span class="line">    secretKey,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> exp = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + <span class="variable constant_">EXPIRATION</span>;</span><br><span class="line">  url.<span class="property">searchParams</span>.<span class="title function_">set</span>(<span class="string">&quot;exp&quot;</span>, exp);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stringToSign = url.<span class="property">pathname</span> + <span class="string">&quot;?&quot;</span> + url.<span class="property">searchParams</span>.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">const</span> mac = <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">sign</span>(</span><br><span class="line">    <span class="string">&quot;HMAC&quot;</span>,</span><br><span class="line">    key,</span><br><span class="line">    encoder.<span class="title function_">encode</span>(stringToSign)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> signature = <span class="title function_">bufferToHex</span>(<span class="keyword">new</span> <span class="title class_">Uint8Array</span>(mac).<span class="property">buffer</span>);</span><br><span class="line">  url.<span class="property">searchParams</span>.<span class="title function_">set</span>(<span class="string">&quot;sig&quot;</span>, signature);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ Referer (åªæœ‰ ALLOWED_REFERERS ä¸ä¸ºç©ºæ—¶æ‰æ£€æŸ¥)</span></span><br><span class="line">    <span class="keyword">const</span> referer = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Referer&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable constant_">ALLOWED_REFERERS</span>.<span class="property">length</span> &amp;&amp; !<span class="variable constant_">ALLOWED_REFERERS</span>.<span class="title function_">some</span>(<span class="function">(<span class="params">allow</span>) =&gt;</span> referer.<span class="title function_">startsWith</span>(allow))) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Forbidden&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">403</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æè·¯å¾„</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> match = url.<span class="property">pathname</span>.<span class="title function_">match</span>(<span class="regexp">/^\/([^/]+)\/([^/]+)$/</span>);</span><br><span class="line">    <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Bad Request&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">400</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [, imageID, variant] = match;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!url.<span class="property">searchParams</span>.<span class="title function_">has</span>(<span class="string">&quot;exp&quot;</span>) || !url.<span class="property">searchParams</span>.<span class="title function_">has</span>(<span class="string">&quot;sig&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// æ— ç­¾å - ç”Ÿæˆç­¾åå¹¶é‡å®šå‘</span></span><br><span class="line">      <span class="keyword">const</span> deliveryUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_DELIVERY_DOMAIN&#125;</span>/<span class="subst">$&#123;ACCOUNT_HASH&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">const</span> signedUrl = <span class="keyword">await</span> <span class="title function_">generateSignedUrl</span>(deliveryUrl);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> redirectUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_CUSTOM_DOMAIN&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      redirectUrl.<span class="property">search</span> = signedUrl.<span class="property">search</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">redirect</span>(redirectUrl.<span class="title function_">toString</span>(), <span class="number">302</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æœ‰ç­¾å - ç›´æ¥è¯·æ±‚å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> imageUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(</span><br><span class="line">        <span class="string">`https://<span class="subst">$&#123;IMAGE_DELIVERY_DOMAIN&#125;</span>/<span class="subst">$&#123;ACCOUNT_HASH&#125;</span>/<span class="subst">$&#123;imageID&#125;</span>/<span class="subst">$&#123;variant&#125;</span>`</span></span><br><span class="line">      );</span><br><span class="line">      imageUrl.<span class="property">search</span> = url.<span class="property">search</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">fetch</span>(imageUrl.<span class="title function_">toString</span>(), request);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(resp.<span class="property">body</span>, &#123;</span><br><span class="line">        <span class="attr">status</span>: resp.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">headers</span>: resp.<span class="property">headers</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°† <code>Worker.js</code> ä¸­ <code>IMAGE_CUSTOM_DOMAIN</code> çš„åŸŸåç»‘å®šåˆ°è¿™ä¸ª Worker ä¸Šã€‚<br>åœ¨ Images ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œæ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åè·å–åˆ°ä»–çš„<code>å›¾åƒ ID</code>ï¼Œå¯ä»¥åœ¨ Images é‡Œé¢è‡ªå®šä¹‰ä¸€ä¸ª<code>å˜ä½“</code>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ <code>https://IMAGE_CUSTOM_DOMAIN/&#123;imageID&#125;/&#123;variant&#125;</code> è®¿é—®è¯¥å›¾ç‰‡ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ° <code>https://IMAGE_CUSTOM_DOMAIN/&#123;imageID&#125;/&#123;variant&#125;?exp=&#123;exp&#125;&amp;sig=&#123;sig&#125;</code> å…¶ä¸­ <code>sig</code> å°±æ˜¯ç­¾åä¿¡æ¯ï¼Œ<code>exp</code> æ˜¯è¯¥é“¾æ¥çš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœå¡«å†™äº† <code>ALLOWED_REFERERS</code> åˆ™è¯·æ±‚å¿…é¡»æºå¸¦å¯¹åº”çš„ <code>Referer</code> å¦åˆ™ä¼š <code>403</code></p>
<p>ç°åœ¨ Cloudflare çš„æµç¨‹å°±æ²¡æœ‰é—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥è§£å†³é™æ€åšå®¢çš„é—®é¢˜ã€‚æˆ‘æ˜¯ç”¨çš„ Hexo çš„é™æ€åšå®¢ï¼Œæ–‡ç« ä¸­æ’å…¥å›¾ç‰‡éœ€è¦ä½¿ç”¨ <code>&lt;img&gt;</code> æ ‡ç­¾ã€‚æ¯æ¬¡éƒ½éœ€è¦å°†æœ¬åœ°å›¾ç‰‡ä¼ åˆ° Cloudflare Images å¹¶ä¸”ç¼–è¾‘å›¾åƒæ‰‹åŠ¨æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åå†è·å–åˆ°å¯¹åº”çš„å›¾åƒ ID å†æ›¿æ¢ä¸º URL ç•¥æ˜¾éº»çƒ¦ã€‚å› æ­¤æ‰‹åŠ¨åˆ›å»ºäº†ä¸€ä¸ªè„šæœ¬è‡ªåŠ¨åŒ–å®ç°ä»¥ä¸ŠåŠŸèƒ½ï¼Œæˆ‘åªéœ€è¦åœ¨ <code>&lt;img&gt;</code> æ ‡ç­¾ä¸­æ·»åŠ å›¾ç‰‡çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œç„¶åå†™å¥½åšå®¢ä¹‹åè°ƒç”¨è„šæœ¬å°±ä¼šè‡ªåŠ¨å°†æ–‡ç« ä¸­å¼•ç”¨çš„ img å›¾ç‰‡ä¸Šä¼ åˆ° Cloudflare Images å¹¶ä¸”æ‰“å¼€ <strong>éœ€è¦å·²ç­¾åçš„ URL</strong> ç„¶åæ ¹æ®è¿”å›çš„å›¾åƒ ID è‡ªåŠ¨æ‹¼æ¥ http é“¾æ¥å¹¶æ›¿æ¢åŸæ–‡ <code>&lt;img&gt;</code> æ ‡ç­¾çš„æœ¬åœ°æ–‡ä»¶åœ°å€ã€‚</p>
<p>åœ¨æœ¬åœ° Hexo é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª <code>tools/upload-images.js</code> æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FormData</span> = <span class="built_in">require</span>(<span class="string">&quot;form-data&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sharp = <span class="built_in">require</span>(<span class="string">&quot;sharp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cloudflare Images API é…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_ACCOUNT_ID</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Image å¸æˆ· ID&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_API_TOKEN</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Cloudflare API Token&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CF_IMAGES_API_URL</span> = <span class="string">`https://api.cloudflare.com/client/v4/accounts/<span class="subst">$&#123;CF_ACCOUNT_ID&#125;</span>/images/v1`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">IMAGE_BASE_URL</span> = <span class="string">&quot;æ­¤å¤„å¡«å†™ Worker å¸¦ https çš„ URL åœ°å€&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_WIDTH</span> = <span class="number">800</span>; <span class="comment">// å›¾åƒçš„æœ€å¤§å®½åº¦</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_HEIGHT</span> = <span class="number">600</span>; <span class="comment">// å›¾åƒçš„æœ€å¤§é«˜åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> abbrlink = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">if</span> (!abbrlink) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;è¯·æä¾› abbrlink\n  ä¾‹å¦‚: npm run upload e6a2e300&quot;</span>);</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ® abbrlink æŸ¥æ‰¾å¯¹åº”çš„æ–‡ç« æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findPostByAbbrlink</span>(<span class="params">abbrlink</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> postsDir = path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;../source/_posts&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> files = fs.<span class="title function_">readdirSync</span>(postsDir);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.<span class="title function_">endsWith</span>(<span class="string">&quot;.md&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(postsDir, file);</span><br><span class="line">    <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(filePath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ front matter</span></span><br><span class="line">    <span class="keyword">const</span> frontMatterMatch = content.<span class="title function_">match</span>(<span class="regexp">/^---\n([\s\S]*?)\n---/</span>);</span><br><span class="line">    <span class="keyword">if</span> (frontMatterMatch) &#123;</span><br><span class="line">      <span class="keyword">const</span> frontMatter = frontMatterMatch[<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">const</span> abbrlinkMatch = frontMatter.<span class="title function_">match</span>(<span class="regexp">/abbrlink:\s*([a-fA-F0-9]+)/</span>);</span><br><span class="line">      <span class="keyword">if</span> (abbrlinkMatch &amp;&amp; abbrlinkMatch[<span class="number">1</span>] === abbrlink) &#123;</span><br><span class="line">        <span class="keyword">return</span> filePath;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¡ç®—åˆé€‚çš„å›¾ç‰‡å°ºå¯¸å’Œç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">calculateOptimalSize</span>(<span class="params">imagePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> metadata = <span class="keyword">await</span> <span class="title function_">sharp</span>(imagePath).<span class="title function_">metadata</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; width, height &#125; = metadata;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (width &lt;= <span class="variable constant_">MAX_WIDTH</span> &amp;&amp; height &lt;= <span class="variable constant_">MAX_HEIGHT</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      width,</span><br><span class="line">      height,</span><br><span class="line">      <span class="attr">zoom</span>: <span class="number">100</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> widthScale = <span class="variable constant_">MAX_WIDTH</span> / width;</span><br><span class="line">  <span class="keyword">const</span> heightScale = <span class="variable constant_">MAX_HEIGHT</span> / height;</span><br><span class="line">  <span class="keyword">const</span> scale = <span class="title class_">Math</span>.<span class="title function_">min</span>(widthScale, heightScale);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newWidth = <span class="title class_">Math</span>.<span class="title function_">round</span>(width * scale);</span><br><span class="line">  <span class="keyword">const</span> newHeight = <span class="title class_">Math</span>.<span class="title function_">round</span>(height * scale);</span><br><span class="line">  <span class="keyword">const</span> zoom = <span class="title class_">Math</span>.<span class="title function_">round</span>(scale * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">width</span>: newWidth,</span><br><span class="line">    <span class="attr">height</span>: newHeight,</span><br><span class="line">    <span class="attr">zoom</span>: zoom</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»æ–‡ä»¶å†…å®¹ä¸­æå–æ‰€æœ‰å›¾ç‰‡æ ‡ç­¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extractImageTags</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="comment">// åŒ¹é… HTML img æ ‡ç­¾: &lt;img src=&quot;path&quot; title=&quot;title&quot;&gt;</span></span><br><span class="line">  <span class="keyword">const</span> regex = <span class="regexp">/&lt;img\s+src=&quot;([^&quot;]+)&quot;(?:\s+title=&quot;([^&quot;]*)&quot;)?[^&gt;]*&gt;/g</span>;</span><br><span class="line">  <span class="keyword">const</span> matches = [];</span><br><span class="line">  <span class="keyword">let</span> match;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ((match = regex.<span class="title function_">exec</span>(content)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">    matches.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">fullTag</span>: match[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">localPath</span>: match[<span class="number">1</span>],</span><br><span class="line">      <span class="attr">title</span>: match[<span class="number">2</span>] || <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> matches;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸Šä¼ å›¾ç‰‡åˆ° Cloudflare Images</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadToCloudflare</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> fileName = path.<span class="title function_">basename</span>(filePath);</span><br><span class="line">  <span class="keyword">const</span> newFileName = <span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>-<span class="subst">$&#123;fileName&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> form = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  form.<span class="title function_">append</span>(<span class="string">&quot;file&quot;</span>, fs.<span class="title function_">createReadStream</span>(filePath), &#123; <span class="attr">filename</span>: newFileName &#125;);</span><br><span class="line">  form.<span class="title function_">append</span>(<span class="string">&quot;requireSignedURLs&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="variable constant_">CF_IMAGES_API_URL</span>, form, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;CF_API_TOKEN&#125;</span>`</span>,</span><br><span class="line">      ...form.<span class="title function_">getHeaders</span>(),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!response.<span class="property">data</span>.<span class="property">success</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;ä¸Šä¼ å¤±è´¥: &quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response.<span class="property">data</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">data</span>.<span class="property">result</span>.<span class="property">id</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å¤„ç†æ–‡ç« : <span class="subst">$&#123;abbrlink&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> postPath = <span class="title function_">findPostByAbbrlink</span>(abbrlink);</span><br><span class="line">  <span class="keyword">if</span> (!postPath) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æœªæ‰¾åˆ°è¯¥æ–‡ç« `</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> content = fs.<span class="title function_">readFileSync</span>(postPath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> imageTags = <span class="title function_">extractImageTags</span>(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (imageTags.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å›¾ç‰‡æ•°é‡ <span class="subst">$&#123;imageTags.length&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> tag <span class="keyword">of</span> imageTags) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è·³è¿‡ URL å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">if</span> (tag.<span class="property">localPath</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: è·³è¿‡ URL å›¾ç‰‡ <span class="subst">$&#123;tag.localPath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è§£ææœ¬åœ°è·¯å¾„</span></span><br><span class="line">      <span class="keyword">const</span> imagePath = path.<span class="title function_">isAbsolute</span>(tag.<span class="property">localPath</span>)</span><br><span class="line">        ? tag.<span class="property">localPath</span></span><br><span class="line">        : path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, tag.<span class="property">localPath</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(imagePath)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å›¾ç‰‡ä¸å­˜åœ¨ <span class="subst">$&#123;imagePath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: æ­£åœ¨å¤„ç† <span class="subst">$&#123;tag.localPath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è‡ªåŠ¨ç¼©æ”¾å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> &#123; width, height, zoom &#125; = <span class="keyword">await</span> <span class="title function_">calculateOptimalSize</span>(imagePath);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: è‡ªåŠ¨ç¼©æ”¾ <span class="subst">$&#123;width&#125;</span>x<span class="subst">$&#123;height&#125;</span> (<span class="subst">$&#123;zoom&#125;</span>%)`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">const</span> imageId = <span class="keyword">await</span> <span class="title function_">uploadToCloudflare</span>(imagePath);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: ä¸Šä¼ æˆåŠŸ <span class="subst">$&#123;imageId&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ç”Ÿæˆæ–°æ ‡ç­¾ - HTML img æ ¼å¼</span></span><br><span class="line">      <span class="keyword">const</span> newUrl = <span class="string">`<span class="subst">$&#123;IMAGE_BASE_URL&#125;</span>/<span class="subst">$&#123;imageId&#125;</span>/origin`</span>;</span><br><span class="line">      <span class="keyword">const</span> titleText = tag.<span class="property">title</span> || <span class="string">&quot;å›¾ç‰‡&quot;</span>;</span><br><span class="line">      <span class="keyword">const</span> newTag = <span class="string">`&lt;img src=&quot;<span class="subst">$&#123;newUrl&#125;</span>&quot; title=&quot;<span class="subst">$&#123;titleText&#125;</span>&quot; style=&quot;zoom:<span class="subst">$&#123;zoom&#125;</span>%;&quot; /&gt;`</span>;</span><br><span class="line"></span><br><span class="line">      content = content.<span class="title function_">replace</span>(tag.<span class="property">fullTag</span>, newTag);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å¤„ç†å®Œæˆ <span class="subst">$&#123;tag.localPath&#125;</span> -&gt; <span class="subst">$&#123;newUrl&#125;</span> (<span class="subst">$&#123;zoom&#125;</span>%)`</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;abbrlink&#125;</span>: å¤„ç†å¤±è´¥: <span class="subst">$&#123;tag.localPath&#125;</span>`</span>, error.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(postPath, content, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¤„ç†å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<p>å¹¶å°†è¯¥è„šæœ¬æ·»åŠ åˆ° package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...çœç•¥</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...çœç•¥</span></span><br><span class="line">    <span class="attr">&quot;upload&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node tools/upload-images.js&quot;</span></span><br><span class="line">    <span class="comment">// ...çœç•¥</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// ...çœç•¥</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥é€šè¿‡ <code>npm run upload xxxxxxxx</code> è‡ªåŠ¨ä¸Šä¼ è¯¥æ–‡ç« ä¸­å‡ºç°çš„å›¾ç‰‡å¹¶æ›¿æ¢é“¾æ¥å•¦ã€‚</p>
<h1 id="ä½¿ç”¨-R2"><a href="#ä½¿ç”¨-R2" class="headerlink" title="ä½¿ç”¨ R2"></a>ä½¿ç”¨ R2</h1><p>å¦‚æœä¸æƒ³ä½¿ç”¨ Images çš„ä»˜è´¹åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ R2 çš„å…è´¹å¥—é¤æ­å»ºã€‚å…¶ä¸­ R2 çš„å…è´¹å¥—é¤åŒ…å« 10G å­˜å‚¨ç©ºé—´ã€ A ç±»æ“ä½œ 100w&#x2F;æœˆ å’Œ B ç±»æ“ä½œ 1000w&#x2F;æœˆã€‚</p>
<blockquote>
<p>è¯¦æƒ…å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3IyL3ByaWNpbmcvIzp+OnRleHQ9Zm9yJTIwMiUyMEdCLi0sRnJlZSUyMHRpZXIsLVlvdSUyMGNhbiUyMHVzZQ==">Cloudflare Docs R2<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>å¦‚æœç›´æ¥æŠŠåŸŸåç»‘å®šåˆ° <code>R2 Bucket</code> ä¸Šå¼€å¯å…¬ç½‘è®¿é—®ï¼Œå¾ˆå®¹æ˜“ä¸€å¤œä¹‹é—´å€¾å®¶è¡äº§ã€‚æ‰€ä»¥å…³é—­ <code>R2 Bucket</code> å…¬ç½‘è®¿é—®ï¼Œä½¿ç”¨ Workers å…è´¹è®¡åˆ’çš„ 10w&#x2F;å¤© çš„è¯·æ±‚é‡å¤©ç„¶çš„é™åˆ¶é¿å…è¢«åˆ·æµé‡ã€‚</p>
<blockquote>
<p>è¯¦æƒ…å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmNsb3VkZmxhcmUuY29tL3dvcmtlcnMvcGxhdGZvcm0vcHJpY2luZy8jOn46dGV4dD1QYWdlcyUyMEZ1bmN0aW9ucyUyMHByaWNpbmcuLSxXb3JrZXJzLC1Vc2VycyUyMG9uJTIwdGhl">Cloudflare Docs Workers<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>R2 Bucket</code>ï¼Œåç§°è‡ªå®šä¹‰ã€‚ç„¶åæ–°å»ºä¸€ä¸ª Workers ä»£ç å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">fetch</span>(<span class="params">request, env</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">method</span> !== <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Method Not Allowed&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">405</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">const</span> path = <span class="built_in">decodeURIComponent</span>(url.<span class="property">pathname</span>.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (!path) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Not Found&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">404</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cacheKey = <span class="keyword">new</span> <span class="title class_">Request</span>(<span class="string">`<span class="subst">$&#123;url.origin&#125;</span><span class="subst">$&#123;url.pathname&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> cached = <span class="keyword">await</span> caches.<span class="property">default</span>.<span class="title function_">match</span>(cacheKey);</span><br><span class="line">      <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> file = <span class="keyword">await</span> env.<span class="property">IMAGES</span>.<span class="title function_">get</span>(path); <span class="comment">// IMAGES ä¸ºåç»­æ­¥éª¤ä¸­ç»‘å®šçš„åç§°ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">      <span class="keyword">if</span> (!file) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Not Found&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">404</span> &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">new</span> <span class="title class_">Response</span>(file.<span class="property">body</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&quot;Content-Type&quot;</span>: file.<span class="property">httpMetadata</span>?.<span class="property">contentType</span> || <span class="string">&quot;application/octet-stream&quot;</span>,</span><br><span class="line">          <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;public, max-age=21600&quot;</span>, <span class="comment">// ç¼“å­˜æ—¶é—´ 6 å°æ—¶ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> caches.<span class="property">default</span>.<span class="title function_">put</span>(cacheKey, response.<span class="title function_">clone</span>());</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;Server Error&quot;</span>, &#123; <span class="attr">status</span>: <span class="number">500</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ Workers ç»‘å®šå¤„æ·»åŠ ç»‘å®šä¸Šé¢åˆ›å»ºçš„ <code>R2 Bucket</code>ï¼Œåç§°åªéœ€è¦ä¸ Workers ä»£ç ä¸­çš„åç§°ä¸€è‡´å³å¯ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>OpenWrt é…ç½®è®°å½•</title>
    <url>/post/465f36a1.html</url>
    <content><![CDATA[<p>è¿™é‡Œä¼šå¢é‡è®°å½• OpenWrt ç›¸å…³çš„ä¸€äº›æŠ€å·§æˆ–è€…é…ç½®æ–¹æ³•ã€‚</p>
<span id="more"></span>

<h1 id="å†…ç½‘è®¾å¤‡ç›´æ¥è®¿é—®å…‰çŒ«"><a href="#å†…ç½‘è®¾å¤‡ç›´æ¥è®¿é—®å…‰çŒ«" class="headerlink" title="å†…ç½‘è®¾å¤‡ç›´æ¥è®¿é—®å…‰çŒ«"></a>å†…ç½‘è®¾å¤‡ç›´æ¥è®¿é—®å…‰çŒ«</h1><p>åœ¨å…‰çŒ«æ¡¥æ¥çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬ OpenWrt å’Œå…‰çŒ«çš„å› ä¸ºä¸åœ¨ä¸€ä¸ªç½‘æ®µä¸‹ï¼Œæ‰€ä»¥ OpenWrt åˆ†é…çš„ IP å¹¶ä¸èƒ½ç›´æ¥è®¿é—®å…‰çŒ«ã€‚ä½†æ˜¯é€šè¿‡å¯¹ OpenWrt é˜²ç«å¢™è¿›è¡Œç›¸å…³çš„çš„é…ç½®å¯ä»¥å®ç°è®¿é—®å…‰çŒ«</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul>
<li>OpenWrt WAN å£: eth0</li>
<li>å…‰çŒ« IP: 192.168.1.1</li>
</ul>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>ç™»å½• OpenWrt åå°ã€‚åœ¨ <code>ç½‘ç»œ</code> -&gt; <code>é˜²ç«å¢™</code> -&gt; <code>è‡ªå®šä¹‰è§„åˆ™</code> ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ifconfig eth0 192.168.1.10 netmask 255.255.255.0 broadcast 192.168.1.255</span><br><span class="line">iptables -I forwarding_rule -d 192.168.1.1 -j ACCEPT</span><br><span class="line">iptables -t nat -I postrouting_rule -d 192.168.1.1 -j MASQUERADE</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šä¸€ä¸‹:</p>
<ol>
<li>ç¬¬ä¸€è¡Œ <code>eth0</code> æ˜¯ OpenWrt WAN å£</li>
<li>ç¬¬ä¸€è¡Œ <code>192.168.1.10</code> æ˜¯æ‰‹åŠ¨åˆ†é…ç»™ <code>eth0</code> ä¸€ä¸ªå…‰çŒ«æ‰€åœ¨ç½‘æ®µçš„ IPï¼Œå¯ä»¥æ—¶å…¶ä»–çš„åœ°å€ï¼Œåªè¦ä¸å’Œå½“å‰å…‰çŒ«ç½‘æ®µä¸‹ IP å†²çªå°±è¡Œ</li>
<li>ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œ <code>192.168.1.1</code> æ˜¯å…‰çŒ«çš„ IP åœ°å€</li>
</ol>
<p>ç„¶åé‡å¯ OpenWrtï¼Œæ­¤æ—¶å†…ç½‘è®¾å¤‡å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® <code>192.168.1.1</code> ç™»å½•å…‰çŒ«åå°äº†ã€‚</p>
<h1 id="å¼€å¯-Dnsmasq-æ—¥å¿—"><a href="#å¼€å¯-Dnsmasq-æ—¥å¿—" class="headerlink" title="å¼€å¯ Dnsmasq æ—¥å¿—"></a>å¼€å¯ Dnsmasq æ—¥å¿—</h1><p>ç¼–è¾‘ <code>dnsmasq</code> é…ç½® <code>/etc/dnsmasq.conf</code> æ–‡ä»¶</p>
<p>æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">log</span>-queries</span><br><span class="line"><span class="built_in">log</span>-facility=<span class="regexp">/tmp/</span>dnsmasq.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯ dnsmasq æœåŠ¡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/etc/init.d/dnsmasq restart</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ—¥å¿—è§£æå™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -f -n 1 /tmp/dnsmasq.log</span><br></pre></td></tr></table></figure>

<h1 id="ç³»ç»Ÿæ—¥å¿—ä¸­å±è”½-crontab-ç›¸å…³æ—¥å¿—"><a href="#ç³»ç»Ÿæ—¥å¿—ä¸­å±è”½-crontab-ç›¸å…³æ—¥å¿—" class="headerlink" title="ç³»ç»Ÿæ—¥å¿—ä¸­å±è”½ crontab ç›¸å…³æ—¥å¿—"></a>ç³»ç»Ÿæ—¥å¿—ä¸­å±è”½ crontab ç›¸å…³æ—¥å¿—</h1><p>ç¼–è¾‘ç³»ç»Ÿé…ç½® <code>/etc/config/system</code></p>
<p>åœ¨ <code>system</code> æ®µä¸­ä¿®æ”¹ç›¸å…³é…ç½®ä¸ºä»¥ä¸‹å†…å®¹</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="keyword">option</span> cronloglevel <span class="string">&#x27;4&#x27;</span></span><br><span class="line"><span class="keyword">option</span> conloglevel <span class="string">&#x27;9&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡å¯ crontab æœåŠ¡å³å¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/etc/init.d/cron restart</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>Windy è‡ªå®šä¹‰è‰²å±‚</title>
    <url>/post/fbb67a4e.html</url>
    <content><![CDATA[<p>Windy è‡ªå®šä¹‰è‰²å±‚</p>
<p>ä¿®æ”¹æ–¹æ³•ï¼šæ‰“å¼€ App â­¢ <strong>è®¾ç½®</strong> â­¢ åº•éƒ¨ <strong>è‡ªå®šä¹‰è‰²å±‚</strong> â­¢ <strong>Select overlay</strong> é€‰æ‹©å¯¹åº”çš„æ•°æ® â­¢ åº•éƒ¨ <strong>Import&#x2F;Export color</strong> â­¢ å¤åˆ¶å¯¹åº”çš„ä»£ç åˆ°ä¸‹æ–¹æ–‡æœ¬æ¡† â­¢ ç‚¹å‡» <strong>Import gradient</strong> â­¢ ç‚¹å‡» <strong>Save created color</strong></p>
<span id="more"></span>

<h1 id="æ°”è±¡é›·è¾¾-radar"><a href="#æ°”è±¡é›·è¾¾-radar" class="headerlink" title="æ°”è±¡é›·è¾¾ [radar]"></a>æ°”è±¡é›·è¾¾ [radar]</h1><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="https://images.zabrian.com/e26a271a-0f7d-461f-8ebc-f334f7010f01/origin" title="åŸå§‹å›¾å±‚" style="zoom:20%;" /></div><div class="group-picture-column"><img src="https://images.zabrian.com/c0abf2e7-61e3-447b-ef4a-8d43b4ff5b01/origin" title="ä¿®æ”¹åå›¾å±‚" style="zoom:20%;" /></div></div></div>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">35</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">239</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">4.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">239</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="number">157</span><span class="punctuation">,</span> <span class="number">241</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">9.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="number">157</span><span class="punctuation">,</span> <span class="number">241</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">10</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">231</span><span class="punctuation">,</span> <span class="number">235</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">14.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">231</span><span class="punctuation">,</span> <span class="number">235</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">15</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">109</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">61</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">19.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">109</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">61</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">20</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">216</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">24.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">216</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">25</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">144</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">29.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">144</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">30</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">34.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">35</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">231</span><span class="punctuation">,</span> <span class="number">192</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">39.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">231</span><span class="punctuation">,</span> <span class="number">192</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">44.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">45</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">49.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">50</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">215</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">54.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">215</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">55</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">59.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">190</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">60</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">64.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">65</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">150</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">180</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">69.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">150</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">180</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">70</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">175</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">79.99</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">175</span><span class="punctuation">,</span> <span class="number">145</span><span class="punctuation">,</span> <span class="number">240</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">80</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">81</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">250</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">,</span> <span class="number">255</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>NexT ä¸»é¢˜é«˜çº§æ ‡ç­¾æ’ä»¶</title>
    <url>/post/daa7f9d2.html</url>
    <content><![CDATA[<p>Hexo NexT ä¸»é¢˜æä¾›äº†ä¸€ç³»åˆ—çš„é«˜çº§çš„æ ‡ç­¾æ’ä»¶ï¼Œå¯ä»¥ç®€å•çš„å®ç°ä¸€äº›å¤æ‚çš„åŠŸèƒ½ã€‚</p>
<span id="more"></span>

<h1 id="æŒ‰é’®-Button"><a href="#æŒ‰é’®-Button" class="headerlink" title="æŒ‰é’® Button"></a>æŒ‰é’® Button</h1><h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% button url, text, icon [class], [title] %&#125;</span><br><span class="line">&#123;% btn url, text, icon [class], [title] %&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>url</code>: ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„çš„ URL</li>
<li><code>text</code>: æŒ‰é’®æ–‡æœ¬ã€‚å¦‚æœæœªæŒ‡å®šå›¾æ ‡ï¼Œåˆ™ä¸ºå¿…å¡«é¡¹</li>
<li><code>icon</code>: <span class="exturl" data-url="aHR0cHM6Ly9mb250YXdlc29tZS5jb20vdjQvaWNvbnM=">FontAwesome<i class="fa fa-external-link-alt"></i></span> å›¾æ ‡ã€‚å¦‚æœæœªæŒ‡å®šæ–‡æœ¬ï¼Œåˆ™ä¸ºå¿…å¡«é¡¹</li>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>fa-fw</code>; å¯é€‰: <code>fa-fw</code> | <code>fa-lg</code> | <code>fa-2x</code> | <code>fa-3x</code> | <code>fa-4x</code> | <code>fa-5x</code></li>
<li><code>[title]</code>: å¯é€‰å‚æ•°; é¼ æ ‡æ‚¬åœæ—¶æç¤º</li>
</ul>
<h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% button #, æŒ‰é’®æ–‡æœ¬ %&#125;</span><br></pre></td></tr></table></figure>
<a class="btn" href="#">æŒ‰é’®æ–‡æœ¬</a>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% btn #, æŒ‰é’®æ–‡æœ¬ %&#125; &#123;% btn #, æŒ‰é’®æ–‡æœ¬ &amp; æŒ‰é’®æ ‡é¢˜,, æŒ‰é’®æ ‡é¢˜ %&#125;</span><br></pre></td></tr></table></figure>
<a class="btn" href="#">æŒ‰é’®æ–‡æœ¬</a> <a class="btn" href="#" title="æŒ‰é’®æ ‡é¢˜">æŒ‰é’®æ–‡æœ¬ & æŒ‰é’®æ ‡é¢˜</a>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% btn #,, home %&#125;</span><br><span class="line">&#123;% btn #,, home fa-lg %&#125;</span><br><span class="line">&#123;% btn #,, home fa-2x %&#125;</span><br><span class="line">&#123;% btn #,, home fa-3x %&#125;</span><br><span class="line">&#123;% btn #,, home fa-4x %&#125;</span><br><span class="line">&#123;% btn #,, home fa-5x %&#125;</span><br></pre></td></tr></table></figure>
<a class="btn" href="#"><i class="fa fa-home"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-lg"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-2x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-3x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-4x"></i></a>
<a class="btn" href="#"><i class="fa fa-home fa-5x"></i></a>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% btn #, æŒ‰é’®æ–‡æœ¬, home %&#125;</span><br></pre></td></tr></table></figure>
<a class="btn" href="#"><i class="fa fa-home"></i>æŒ‰é’®æ–‡æœ¬</a>

<h1 id="ç¬”è®°-Note"><a href="#ç¬”è®°-Note" class="headerlink" title="ç¬”è®° Note"></a>ç¬”è®° Note</h1><h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><figure class="highlight yml"><figcaption><span>NexT _config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Note tag (bootstrap callout)</span></span><br><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bootstrap callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bootstrap callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">modern</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight jinja"><table><tr><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">note</span> [class] [no-icon] [summary] %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ç¬”è®°å†…å®¹</span></span><br><span class="line"><span class="language-xml"></span><span class="template-tag">&#123;% <span class="name">endnote</span> %&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>default</code>; å¯é€‰: <code>default</code> | <code>primary</code> | <code>success</code> | <code>info</code> | <code>warning</code> | <code>danger</code></li>
<li><code>[no-icon]</code>: å¯é€‰å‚æ•°; ç¦ç”¨ icon</li>
<li><code>[summary]</code>: å¯é€‰å‚æ•°; ç¬”è®°æ‘˜è¦</li>
</ul>
<h2 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="note default"><p>default æ ·ä¾‹</p>
</div>
<div class="note primary"><p>primary æ ·ä¾‹</p>
</div>
<div class="note success"><p>success æ ·ä¾‹</p>
</div>
<div class="note info"><p>info æ ·ä¾‹</p>
</div>
<div class="note warning"><p>warning æ ·ä¾‹</p>
</div>
<div class="note danger"><p>danger æ ·ä¾‹</p>
</div>

<h1 id="æ ‡ç­¾é¡µ-Tabs"><a href="#æ ‡ç­¾é¡µ-Tabs" class="headerlink" title="æ ‡ç­¾é¡µ Tabs"></a>æ ‡ç­¾é¡µ Tabs</h1><h2 id="è®¾ç½®-1"><a href="#è®¾ç½®-1" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><figure class="highlight yml"><figcaption><span>NexT _config.yml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tabs tag</span></span><br><span class="line"><span class="attr">tabs:</span></span><br><span class="line">  <span class="comment"># Make the nav bar of tabs with long content stick to the top.</span></span><br><span class="line">  <span class="attr">sticky:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">transition:</span></span><br><span class="line">    <span class="attr">tabs:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">labels:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æ³•-2"><a href="#ç”¨æ³•-2" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">  &lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">  æ ‡ç­¾é¡µå†…å®¹</span><br><span class="line">  &lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Unique name</code>: å½“å‰é¡µé¢ä¸‹å”¯ä¸€åç§°</li>
<li><code>[index]</code>: æ´»åŠ¨æ ‡ç­¾é¡µç´¢å¼•</li>
<li><code>[Tab caption]</code>: æ ‡ç­¾é¡µæ ‡é¢˜</li>
<li><code>[@icon]</code>: <span class="exturl" data-url="aHR0cHM6Ly9mb250YXdlc29tZS5jb20vdjQvaWNvbnM=">FontAwesome<i class="fa fa-external-link-alt"></i></span> å›¾æ ‡</li>
</ul>
<h2 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><div class="tabs" id="æ ‡ç­¾é¡µ"><ul class="nav-tabs"><li class="tab active"><a href="#æ ‡ç­¾é¡µ-1"><i class="fa fa-table"></i>è¡¨æ ¼</a></li><li class="tab"><a href="#æ ‡ç­¾é¡µ-2"><i class="fa fa-code"></i>ä»£ç å—</a></li><li class="tab"><a href="#æ ‡ç­¾é¡µ-3"><i class="fa fa-camera"></i>å›¾ç‰‡</a></li></ul><div class="tab-content"><div class="tab-pane active" id="æ ‡ç­¾é¡µ-1"><table>
<thead>
<tr>
<th align="left">å·¦å¯¹é½åˆ—</th>
<th align="right">å³å¯¹é½åˆ—</th>
<th align="center">å±…ä¸­åˆ—</th>
</tr>
</thead>
<tbody><tr>
<td align="left">11</td>
<td align="right">12</td>
<td align="center">13</td>
</tr>
<tr>
<td align="left">21</td>
<td align="right">22</td>
<td align="center">23</td>
</tr>
<tr>
<td align="left">31</td>
<td align="right">32</td>
<td align="center">33</td>
</tr>
</tbody></table></div><div class="tab-pane" id="æ ‡ç­¾é¡µ-2"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">    a,b = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        a,b = b,a+b</span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="æ ‡ç­¾é¡µ-3"><p>  <img src="https://images.zabrian.com/e9347cac-bb91-4e23-392c-536d7ae0b401/origin"></p></div></div></div>

<h1 id="æ–‡æœ¬æ ‡ç­¾-Label"><a href="#æ–‡æœ¬æ ‡ç­¾-Label" class="headerlink" title="æ–‡æœ¬æ ‡ç­¾ Label"></a>æ–‡æœ¬æ ‡ç­¾ Label</h1><h2 id="ç”¨æ³•-3"><a href="#ç”¨æ³•-3" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% label [class]@text %&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>[class]</code>: å¯é€‰å‚æ•°; é»˜è®¤ <code>default</code>; å¯é€‰: <code>default</code> | <code>primary</code> | <code>success</code> | <code>info</code> | <code>warning</code> | <code>danger</code></li>
<li><code>text</code>: æ ‡ç­¾æ–‡æœ¬</li>
</ul>
<h2 id="ä¾‹å­-3"><a href="#ä¾‹å­-3" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>æ›²æ›²æŠ˜æŠ˜çš„è·å¡˜ä¸Šé¢ï¼Œå¼¥æœ›æ—³æ˜¯ç”°ç”°çš„å¶å­ã€‚å¶å­å‡ºæ°´å¾ˆé«˜ï¼Œåƒ<mark class="label default">äº­äº­æ—³èˆå¥³æ—³è£™</mark>ã€‚<br>å±‚å±‚çš„å¶å­ä¸­é—´ï¼Œé›¶æ˜Ÿåœ°ç‚¹ç¼€ç€äº›ç™½èŠ±ï¼Œæœ‰è¢…å¨œåœ°å¼€ç€æ—³ï¼Œæœ‰ç¾æ¶©åœ°æ‰“ç€æœµå„¿æ—³ï¼›æ­£å¦‚<mark class="label primary">ä¸€ç²’ç²’çš„æ˜ç </mark>ï¼Œåˆå¦‚<mark class="label success">ç¢§å¤©é‡Œçš„æ˜Ÿæ˜Ÿ</mark>ï¼Œåˆå¦‚<mark class="label info">åˆšå‡ºæµ´çš„ç¾äºº</mark>ã€‚<br>å¾®é£è¿‡å¤„ï¼Œé€æ¥ç¼•ç¼•æ¸…é¦™ï¼Œ<mark class="label warning">ä»¿ä½›è¿œå¤„é«˜æ¥¼ä¸Šæ¸ºèŒ«çš„æ­Œå£°ä¼¼çš„</mark>ã€‚è¿™æ—¶å€™å¶å­ä¸èŠ±ä¹Ÿæœ‰ä¸€ä¸çš„é¢¤åŠ¨ï¼Œåƒé—ªç”µèˆ¬ï¼Œéœæ—¶ä¼ è¿‡è·å¡˜çš„é‚£è¾¹å»äº†ã€‚<br>å¶å­æœ¬æ˜¯è‚©å¹¶è‚©å¯†å¯†åœ°æŒ¨ç€ï¼Œè¿™ä¾¿å®›ç„¶æœ‰äº†ä¸€é“<mark class="label danger">å‡ç¢§çš„æ³¢ç—•</mark>ã€‚å¶å­åº•ä¸‹æ˜¯è„‰è„‰çš„æµæ°´ï¼Œé®ä½äº†ï¼Œä¸èƒ½è§ä¸€äº›é¢œè‰²ï¼›è€Œå¶å­å´æ›´è§é£è‡´äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/post/4a17b156.html</url>
    <content><![CDATA[<center>Hello World</center>
]]></content>
  </entry>
  <entry>
    <title>iPhone 17 å£çº¸</title>
    <url>/post/958b861f.html</url>
    <content><![CDATA[<p>2025-09-10 è‹¹æœå‘å¸ƒäº†å…¨æ–°çš„ iPhone 17 ç³»åˆ—ï¼Œé™¤äº†å¸¦æ¥äº†å…¨æ–°çš„ iPhone Air ç³»åˆ—ï¼ŒåŒæ—¶è¿˜æ–°å¢äº†æ¯æ¬¾æœºå‹å¯¹åº”çš„ç³»ç»Ÿå£çº¸ã€‚</p>
<span id="more"></span>

<div class="tabs" id="iphone-17-ç³»åˆ—å£çº¸"><ul class="nav-tabs"><li class="tab active"><a href="#iphone-17-ç³»åˆ—å£çº¸-1"><i class="fa fa-mobile"></i>iPhone 17 ç³»åˆ—</a></li><li class="tab"><a href="#iphone-17-ç³»åˆ—å£çº¸-2"><i class="fa fa-mobile"></i>iPhone 17 Air ç³»åˆ—</a></li><li class="tab"><a href="#iphone-17-ç³»åˆ—å£çº¸-3"><i class="fa fa-mobile"></i>iPhone 17 Pro ç³»åˆ—</a></li></ul><div class="tab-content"><div class="tab-pane active" id="iphone-17-ç³»åˆ—å£çº¸-1"><img src="https://images.zabrian.com/d81266c0-d74e-49ce-64fe-0794ab6d1001/origin" title="iPhone 17 ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/eSDn" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a><center>
  <br></div><div class="tab-pane" id="iphone-17-ç³»åˆ—å£çº¸-2"><img src="https://images.zabrian.com/65a42a74-6d52-41c6-f26e-a484100d9801/origin" title="iPhone 17 Air ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/dC4Q" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a><center>
  <br></div><div class="tab-pane" id="iphone-17-ç³»åˆ—å£çº¸-3"><img src="https://images.zabrian.com/6755691c-557d-4069-7881-fb08a524cd01/origin" title="iPhone 17 Pro ç³»åˆ—" style="zoom:8%;" />
  <br>
  <center><a class="btn" href="https://9lnk.io/XEkx" title="ç‚¹å‡»ä¸‹è½½åŸå›¾"><i class="fa fa-download"></i>ç‚¹å‡»ä¸‹è½½åŸå›¾</a></center>
  <br></div></div></div>]]></content>
  </entry>
  <entry>
    <title>macOS Chrome &#39;è¿™äº›æ‰©å±•ç¨‹åºä¸å†å—æ”¯æŒï¼Œå› æ­¤å·²åœç”¨&#39; è§£å†³åŠæ³•</title>
    <url>/post/e72f1311.html</url>
    <content><![CDATA[<p>ä»Šå¤©æ—©ä¸Šå‘ç° macOS Chrome ç‰ˆæœ¬æ›´æ–°åˆ°äº† 138.0.7204.101 æ‰“å¼€æµè§ˆå™¨çš„æ—¶å€™æç¤º â€œè¿™äº›æ‰©å±•ç¨‹åºä¸å†å—æ”¯æŒï¼Œå› æ­¤å·²åœç”¨â€ï¼Œç®€å•æœäº†ä¸€ä¸‹å‘ç°æœ‰è§£å†³åŠæ³•ï¼Œä½†æ˜¯éƒ½æ˜¯é’ˆå¯¹äº Windows ä¸‹çš„è§£å†³æ–¹æ¡ˆã€‚<br>è€Œå¯¹äº macOS æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼Œä»»é€‰å…¶ä¸€å³å¯ã€‚</p>
<div class="note danger"><p>2025-09-11 æ›´æ–°: Chrome å·²ç»æ›´æ–°åˆ° 140 ç‰ˆæœ¬ï¼Œä»¥ä¸‹æ–¹æ³•å·²ç»ä¸é€‚ç”¨ã€‚</p>
</div>

<span id="more"></span>

<h2 id="é€šè¿‡-chrome-flags-æ¨è"><a href="#é€šè¿‡-chrome-flags-æ¨è" class="headerlink" title="é€šè¿‡ chrome:&#x2F;&#x2F;flags (æ¨è)"></a>é€šè¿‡ chrome:&#x2F;&#x2F;flags (æ¨è)</h2><ol>
<li>å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Chrome</li>
<li>åœ°å€æ è¾“å…¥ <code>chrome://flags</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Enabled</code><br><code>temporary-unexpire-flags-m137</code></li>
<li>é‡å¯æµè§ˆå™¨å¹¶å†æ¬¡æ‰“å¼€ <code>chrome://flags</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Disabled</code><br><code>extension-manifest-v2-deprecation-warning</code><br><code>extension-manifest-v2-deprecation-disabled</code><br><code>extension-manifest-v2-deprecation-unsupported</code></li>
<li>ä»¥ä¸‹è®¾ç½®æ”¹ä¸º <code>Enabled</code><br><code>allow-legacy-mv2-extensions</code></li>
<li>é‡å¯æµè§ˆå™¨</li>
</ol>
<h2 id="é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†"><a href="#é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†" class="headerlink" title="é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†"></a>é€šè¿‡ä¼ä¸šæ”¿ç­–ç®¡ç†</h2><p>æ ¹æ® <span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWVlbnRlcnByaXNlLmdvb2dsZS9pbnRsL3poX2NuL3BvbGljaWVzLz9wb2xpY3k9RXh0ZW5zaW9uTWFuaWZlc3RWMkF2YWlsYWJpbGl0eQ==">ExtensionManifestV2Availability<i class="fa fa-external-link-alt"></i></span> çš„æè¿°ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡ä¼ä¸šæ§åˆ¶ç®¡ç†è¿›è¡Œè®¾ç½®ã€‚<br>æ­¤æ–¹æ³•æœ‰ä¸€éš”å¼Šç«¯æ˜¯ Chrome ä¼šæ˜¾ç¤ºä¸€æ¡ <code>æ‚¨çš„æµè§ˆå™¨ç”±è´µå•ä½ç®¡ç†</code> çš„æç¤ºï¼Œåªæ˜¯å› ä¸ºä½¿ç”¨äº†ä¼ä¸šç®¡ç†çš„é…ç½®ï¼Œæ‰€ä»¥ä¼šæç¤ºã€‚å®é™…å¹¶æ— ä»»ä½•ä¼ä¸šå¯¹ä½ çš„æµè§ˆå™¨è¿›è¡Œç®¡ç†ã€‚<br>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p <span class="string">&quot;/Library/Managed Preferences&quot;</span> &amp;&amp; <span class="built_in">sudo</span> <span class="built_in">tee</span> <span class="string">&quot;/Library/Managed Preferences/com.google.Chrome.plist&quot;</span> &gt;/dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;</span></span><br><span class="line"><span class="string">  &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;\&gt;</span></span><br><span class="line"><span class="string">&lt;plist version=&quot;1.0&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;dict&gt;</span></span><br><span class="line"><span class="string">    &lt;key&gt;ExtensionManifestV2Availability&lt;/key&gt;</span></span><br><span class="line"><span class="string">    &lt;integer&gt;2&lt;/integer&gt;</span></span><br><span class="line"><span class="string">  &lt;/dict&gt;</span></span><br><span class="line"><span class="string">&lt;/plist&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>å®Œå…¨å…³é—­ Chrome åå†æ‰“å¼€ï¼Œåœ¨åœ°å€æ è¾“å…¥ <code>chrome://policy/</code> ç‚¹å‡»å·¦ä¸Šè§’çš„é‡æ–°åŠ è½½æ”¿ç­–ï¼Œç„¶åæ—§ç‰ˆçš„æ‰©å±•å°±å¯ä»¥ç»§ç»­ä½¿ç”¨å•¦ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>åŒ—äº¬è”é€šå¼‚åœ°å®½å¸¦åŠç†æŒ‡å—</title>
    <url>/post/de583f28.html</url>
    <content><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒåŒ—äº¬è”é€šçš„å®½å¸¦æ˜¯çœŸçš„è´µã€‚ä¹‹å‰è”ç³»äº†è”é€šçš„å®½å¸¦ä¸“å‘˜ï¼Œå’¨è¯¢äº†ä¸€ä¸‹èåˆå¥—é¤ã€‚</p>
<ul>
<li>1000 Mbps ä¸‰å¹´åˆçº¦ 149 å…ƒ&#x2F;æœˆï¼ˆè¿™ä¸ªè¿˜æ˜¯æœ‰ä¼˜æƒ çš„ä»·æ ¼ï¼‰æå‰è§£çº¦è¿çº¦é‡‘ &#x3D; æœªå±¥çº¦æœˆæ•° âœ–ï¸ 30 å…ƒ</li>
<li>500 Mbps æ— åˆçº¦ 166 å…ƒ&#x2F;æœˆ</li>
</ul>
<p>å› ä¸ºæˆ‘å®¶æ‰€æœ‰çš„æ‰‹æœºå·éƒ½æ˜¯è”é€šçš„ï¼Œå¥—é¤ä¹Ÿéƒ½å¾ˆå¤Ÿç”¨ï¼Œæ‰€ä»¥èåˆå¥—çš„æ‰‹æœºå·å¥—é¤æ²¡å•¥ç”¨ã€‚äº†è§£åˆ°å¼‚åœ°å®½å¸¦ä»·æ ¼å¾ˆç¾ä¸½åå°±æƒ³ç€åŠä¸€ä¸ªã€‚</p>
<span id="more"></span>

<p>åŒ—äº¬åœ°åŒºçš„å¼‚åœ°å®½å¸¦åˆ†ä¸¤ç§</p>
<ul>
<li>300 Mbps 60 å…ƒ&#x2F;æœˆ</li>
<li>500 Mbps 80 å…ƒ&#x2F;æœˆ</li>
</ul>
<img src="https://images.zabrian.com/8ec6254c-3291-42f6-69b0-2c8d53f22901/origin" title="å¼‚åœ°å®½å¸¦å¥—é¤" style="zoom:62%;" />

<h1 id="åŠå¡"><a href="#åŠå¡" class="headerlink" title="åŠå¡"></a>åŠå¡</h1><p>æ—¢ç„¶æ˜¯å¼‚åœ°å®½å¸¦ï¼Œé¦–å…ˆæ˜¯éœ€è¦ä¸€ä¸ªå¼‚åœ°æ‰‹æœºå¡ã€‚åœ¨æŸå®æ‰¾äº†ä¸€ä¸ªåŠå¡ï¼Œé€‰äº†ä¸€ä¸ª 19 å—é’±çš„å¥—é¤ï¼Œåæ­£å°±æ˜¯èƒ½åŠå¤šä¾¿å®œå°±å¤šä¾¿å®œã€‚19 å·®ä¸å¤šå°±æ˜¯èƒ½åœ¨å¼€å¡çš„æœ€ä¾¿å®œäº†ã€‚å¼‚åœ°é€‰çš„å¤©æ´¥ï¼Œä¸»è¦å°±æ˜¯ç¦»åŒ—äº¬è¿‘ï¼Œæ–¹ä¾¿ã€‚</p>
<p>ç„¶åè®°å¾—è¯¢é—®ä¸€ä¸‹å¡æ˜¯ä¸æ˜¯èƒ½æ­£å¸¸æ”¹å¥—é¤åŠå®½å¸¦å•¥çš„ï¼Œåˆ«åŠç‰©è”ç½‘å¡å°±è¡Œï¼Œè¦åŠçš„ä¸€å®šæ˜¯æ­£å¸¸çš„æ‰‹æœºå¡ã€‚ç„¶åé…é€åœ°å€å†™ä¸€ä¸ªå¤©æ´¥çš„åœ°å€ï¼Œåƒä¸‡ä¸èƒ½å†™å¼‚åœ°ï¼Œå› ä¸ºå¤©æ´¥è”é€šä¸èƒ½å¼‚åœ°é…é€ã€‚å¿…é¡»è¦å¤©æ´¥æœ¬åœ°çš„åœ°å€ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å°±ç›´æ¥å†™åˆ°äº†å¤©æ´¥ç«™ã€‚</p>
<p>ç„¶åå°±æ˜¯æäº¤èº«ä»½è¯å•¥çš„å®¡æ ¸ï¼Œå½“å¤©å®¡æ ¸é€šè¿‡ä¸‹åˆæ˜¾ç¤ºå°±åˆ†é…äº†å°å“¥ä¸Šé—¨é€å¡ã€‚ç„¶åå°±æ˜¯æ‰“ç”µè¯ç»™å°å“¥æ”¹ä¸€ä¸‹æ—¶é—´ã€‚æ¯•ç«Ÿå½“å¤©ä¸‹åˆå·²ç» 3 ç‚¹äº†ï¼Œè¿˜åœ¨ä¸Šç­å’‹ï¼Œå¯èƒ½åˆ°å¤©æ´¥å–å¡ã€‚</p>
<p>ç„¶åæˆ‘å°±çº¦åˆ°äº†å‘¨å…­ä¸‹åˆ 3 ç‚¹äº†ã€‚ç„¶åå°±æ˜¯ä¹°äº†å‘¨å…­ 14:09 ~ 14:42 ä»åŒ—äº¬åˆ°å¤©æ´¥çš„å»ç¨‹ï¼Œ15:22 ~ 15:52 ä»å¤©æ´¥åˆ°åŒ—äº¬å—çš„è¿”ç¨‹ã€‚ä¸€å…±èŠ±äº† 100 è¿‡ç‚¹ã€‚</p>
<p>å½“å¤©ä¸Šè½¦ä¹‹åç»™å°å“¥æ‰“äº†ä¸ªç”µè¯ï¼Œè¯´äº†ä¸‹æ˜¯ä¸“ç¨‹æ¥åŠå¡çš„ï¼Œè¿”ç¨‹æ—¶é—´æ¯”è¾ƒç´§ï¼Œå¸Œæœ›èƒ½å°½å¿«åˆ°ã€‚å°å“¥è¡¨ç¤ºæ²¡é—®é¢˜ã€‚ç„¶åæˆ‘å¿«åˆ°ç«™çš„æ—¶å€™å°å“¥æ¥ç”µè¯äº†è¯´ä»–å·²ç»åˆ°äº†ï¼ˆd&#x3D;(Â´â–½ ï½€)&#x3D;bï¼‰</p>
<p>ç„¶åå°±å’Œå°å“¥åœ¨è½¦ç«™é‡Œé¢ç¢°ä¸Šé¢äº†ã€‚æ‹ç…§åŠå¡ä¸€æ°”å‘µæˆï¼Œå…¨ç¨‹èŠ±äº†ä¸åˆ° 5 åˆ†é’Ÿã€‚äº¤äº† 500 å—é’±è¯è´¹ç»“æŸã€‚ç„¶åè¿”ç¨‹å›å®¶ã€‚</p>
<h1 id="æ”¹å¥—é¤"><a href="#æ”¹å¥—é¤" class="headerlink" title="æ”¹å¥—é¤"></a>æ”¹å¥—é¤</h1><p>å¼€å¡çš„æ—¶å€™é€‰çš„æ˜¯ 19 å—é’±çš„å¥—é¤ï¼Œç¬¬äºŒå¤©ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ”¹åˆ° 8 å…ƒä¿å·å¥—é¤ã€‚æ‰€ä»¥ä¸Šé¢åŠå¡çš„æ—¶å€™éœ€è¦ç¡®è®¤å¡ç‰‡å¥—é¤èƒ½å¦ä¿®æ”¹ï¼ˆæœ‰çš„æœ‰åˆçº¦ï¼Œä¸èƒ½ä¿®æ”¹æˆ–è€…å¾—è¿‡å‡ ä¸ªæœˆæ‰èƒ½ä¿®æ”¹ï¼‰å¯ä»¥ç›´æ¥æ‰“ç”µè¯ç»™è”é€šï¼Œè½¬åˆ°äººå·¥æ”¹ã€‚ä½†æ˜¯æˆ‘å«Œæ‰“ç”µè¯éº»çƒ¦ï¼Œä¸‹è½½äº†è”é€š appï¼Œç”¨æ–°åŠçš„æ‰‹æœºå¡ç™»å½•ï¼Œå³ä¸Šè§’åœ¨çº¿å®¢æœä¿®æ”¹å¥—é¤åˆ° 8 å…ƒä¿å·å¥—é¤å°±è¡Œã€‚å®¢æœä¼šå‘Šè¯‰ä½ ä¼šæœ‰ä¸“å±ç»ç† 48h å†…è”ç³»ï¼Œä½†æ˜¯æˆ‘çš„å½“å¤©ä¸‹åˆå°±æ¥ç”µè”ç³»äº†ï¼Œç¡®è®¤ä¿®æ”¹åæ¬¡æœˆå°±ç”Ÿæ•ˆäº†ã€‚</p>
<img src="https://images.zabrian.com/83d18cc4-1a34-43d3-043c-b63386745e01/origin" title="è”ç³»å®¢æœä¿®æ”¹å¥—é¤" style="zoom:62%;" />

<h1 id="åŠå®½å¸¦"><a href="#åŠå®½å¸¦" class="headerlink" title="åŠå®½å¸¦"></a>åŠå®½å¸¦</h1><p>è¿™é‡ŒåŠå®½å¸¦ä¸€å®šè¦ä»è”é€š app ä¸ŠåŠç†ï¼Œå»è¥ä¸šå…æ˜¯åŠä¸äº†è¿™ä¸ªä»·æ ¼çš„å¼‚åœ°å®½å¸¦ã€‚</p>
<p>app é‡Œé¢çš„ä½ç½®åœ¨è¿™é‡Œ</p>
<img src="https://images.zabrian.com/8d192054-73d8-4156-87f5-c8f5eed0fd01/origin" title="å¼‚åœ°åŒäº«ä¸“åŒº" style="zoom:62%;" />

<p>ç„¶åé€‰æ‹©å…¨å›½ä¸€å®¶äº²å¼‚åœ°å®½å¸¦</p>
<img src="https://images.zabrian.com/32f222f5-5e1f-4b39-5329-848898dd2f01/origin" title="å…¨å›½ä¸€å®¶äº²å¼‚åœ°å®½å¸¦" style="zoom:62%;" />

<p>ç„¶åè¿›å»ä¹‹åé€‰æ‹©å®½å¸¦åŠç†çš„åŸå¸‚ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯åŒ—äº¬ï¼Œç„¶åå°±ä¼šæœ‰èƒ½åŠç†çš„ç±»å‹ï¼ŒåŒ…æ‹¬ 300 Mbps å’Œ 500 Mbps é€‰å¥½ä¹‹åå¡«å†™ä¸‹é¢çš„å…·ä½“çš„å†…å®¹ï¼Œæäº¤é¢„çº¦å³å¯ã€‚</p>
<p>ç„¶åè¿‡äº†å‡ ä¸ªå°æ—¶å°±æœ‰è”é€šçš„ç”µè¯äº†ï¼Œç¡®å®šåŠç†çš„å®½å¸¦åï¼Œè¡¨ç¤ºåŒ—äº¬æœ‰ä¸€ä¸ª 300 å—é’±çš„å®‰è£…è´¹ã€‚æ¬¡æœˆä»è¯è´¹é‡Œé¢æ‰£é™¤ã€‚ç¡®å®šæ— è¯¯åå®¢æœç»™æˆ‘å‘äº†ä¸€ä¸ªçŸ­ä¿¡ï¼Œé‡Œé¢æœ‰ä¸ªé“¾æ¥ã€‚éœ€è¦ä¸Šä¼ èº«ä»½è¯æ­£åé¢å’Œæ‹æ‘„ä¸€å¼ å…å† è‡ªæ‹ç…§ã€‚ç„¶åå°±ç­‰ç€åˆ†é…å°å“¥å§ã€‚</p>
<h1 id="ä¸Šé—¨å®‰è£…"><a href="#ä¸Šé—¨å®‰è£…" class="headerlink" title="ä¸Šé—¨å®‰è£…"></a>ä¸Šé—¨å®‰è£…</h1><p>åˆ°äº†é¢„çº¦çš„é‚£å¤©ï¼Œå°å“¥ä¸Šé—¨ã€‚ç¡®è®¤äº†ä¿¡æ¯ä¹‹åå°±å¼€å§‹è£…å…‰çŒ«å•¥çš„ã€‚åœ¨è¿™ä¸ªé€”ä¸­ï¼Œå› ä¸ºç°åœ¨åŒ—äº¬å¤©æ°”å·²ç»å¾ˆçƒ­äº†ï¼Œå°å“¥åˆæ˜¯ä¸­åˆä¸Šé—¨çš„ã€‚é€’ä¸Šç“¶æ°´ï¼Œæ‹¿ä¸ªæ¿å‡³åä¼šå„¿ã€‚è¦æ˜¯æŠ½çƒŸå¯ä»¥å†é€’ä¸ªçƒŸå•¥çš„ã€‚ä¹‹åå°±å¼€å§‹è¡¨è¾¾è‡ªå·±æƒ³è¦å…¬ç½‘ IP çš„è¯‰æ±‚ï¼ˆæ¯•ç«Ÿæ±‚äººåŠäº‹å„¿ï¼Œæ‰€ä»¥å‰é¢å°±å®¢æ°”ç‚¹ï¼‰å°å“¥é—®äº†ä¸ªåŸå› ï¼Œæˆ‘è¯´å®¶é‡Œæœ‰ç›‘æ§éœ€è¦ã€‚ç„¶åå°å“¥è¿˜æ‹äº†ä¸ªç›‘æ§çš„ç…§ç‰‡ï¼Œå¹¶ä¸”è¿˜è¯´ï¼šâ€œç°åœ¨å…¬ç½‘ IP ä¸å¥½æ‹¿ï¼Œéœ€è¦æœ‰æ˜ç¡®çš„éœ€æ±‚æ‰èƒ½ç”³è¯·ï¼Œä½ è¿™ä¸ªè¦ç”¨ç›‘æ§ã€‚ä½†å…¶å®ç°åœ¨ç›‘æ§è¿™ä¸ªç†ç”±ä¸æ€ä¹ˆèƒ½è¿‡äº†ã€‚ä½ è¦æ˜¯æœ‰æ˜ç¡®è¯‰æ±‚å¯ä»¥ç»™ä½ ç”³è¯·ã€‚â€ï¼ˆåæ­£å°±æ˜¯ä¸€è¾¹è¡¨è¾¾ä¸å¥½æï¼Œä½†æ˜¯ä¸€è¾¹è¿˜éƒ½ç»™ç”³è¯·äº†ï¼‰ç„¶åå°±é¡ºä¾¿è¿æ¡¥æ¥ä¸€èµ·ç»™åŠäº†ï¼Œé¡ºä¾¿åŠ äº†ä¸€ä¸‹å°å“¥ç§äººçš„å¾®ä¿¡ï¼ˆè™½ç„¶ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯è¦åŠ ä¼å¾®ï¼Œä½†æ˜¯å°å“¥è¿˜æ˜¯ç»™äº†ä»–ç§äººçš„å¾®ä¿¡ï¼‰æœ€åè£…å¥½åä»–é‚£èµ°äº†ä¸ªæµ‹é€Ÿï¼Œå®‰è£… 500 M å®é™…æµ‹é€Ÿèƒ½åˆ° 650ã€‚è¿˜ä¸é”™ã€‚æœ€åè®°äº†ä¸€ä¸‹å®½å¸¦çš„å¯†ç ï¼Œæå®šã€‚ä»ä¸Šé—¨åˆ°æœ€åå°å“¥èµ°ä¸€å…±èŠ±äº†ä¸åˆ° 10 minï¼Œå¤–åŠ ä¸€ç“¶æ°´çš„é’±ã€‚</p>
<h1 id="åŠç†ä¸Šè¡Œæé€Ÿ"><a href="#åŠç†ä¸Šè¡Œæé€Ÿ" class="headerlink" title="åŠç†ä¸Šè¡Œæé€Ÿ"></a>åŠç†ä¸Šè¡Œæé€Ÿ</h1><p>500 Mbps çš„å®½å¸¦ä¸‹è¡Œå¯¹åº”ä¸Šè¡Œæ‰ç»™ 30 Mbps æ˜¯çœŸçš„æ‹‰è·¨ï¼Œä½†æ˜¯å¯ä»¥åŠç†åŠ é€ŸåŒ…: <span class="exturl" data-url="aHR0cHM6Ly93b2t1YW4uMTE0bWVuaHUuY29tLw==">æ²ƒå®½<i class="fa fa-external-link-alt"></i></span></p>
<p>ç”¨åŠç†å®½å¸¦çš„å¼‚åœ°æ‰‹æœºå·ç™»å½•</p>
<img src="https://images.zabrian.com/29685c89-0b86-439b-be44-1ea181ba1601/origin" title="æ²ƒå®½ç™»é™†ç•Œé¢" style="zoom:39%;" />

<p>ç„¶ååœ¨å·¦ä¾§ã€æˆ‘çš„å®½å¸¦ã€‘ä¸­æ·»åŠ å½“å‰å®½å¸¦</p>
<img src="https://images.zabrian.com/214b8dce-750d-4fea-cb68-b81701392d01/origin" title="æ²ƒå®½æ·»åŠ å®½å¸¦" style="zoom:40%;" />

<p>æ·»åŠ æˆåŠŸåå†å·¦ä¾§ ã€æˆ‘è¦è´­ä¹°ã€‘ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªã€å®½å¸¦ä¸Šè¡Œæé€ŸåŒ… 100 Mã€‘è¿™é‡Œä¸€æ¬¡æœ€å¤šå¯ä»¥è´­ä¹° 6 ä¸ªï¼ˆè¿ç»­åŠå¹´ï¼Œåˆ°æœŸåå¯ä»¥ç»§ç»­è´­ä¹°ï¼‰</p>
<img src="https://images.zabrian.com/13a412ea-2b2b-4be8-4013-821b35e6d201/origin" title="è´­ä¹°ä¸Šè¡Œæé€ŸåŒ…" style="zoom:40%;" />

<p>è´­ä¹°æˆåŠŸåï¼Œåœ¨å·¦ä¾§ã€é¦–é¡µã€‘ç‚¹å‡»ã€ç‚¹æˆ‘æé€Ÿã€‘å°±å¯ä»¥äº†ï¼Œæ— éœ€é‡å¯å…‰çŒ«å³å¯äº«å— 100 Mbps çš„ä¸Šè¡Œé€Ÿç‡äº†ã€‚</p>
<img src="https://images.zabrian.com/1b239e28-26bc-43cd-e168-d7970cc88701/origin" title="ä¸Šè¡Œæé€Ÿ" style="zoom:39%;" />

<h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>æœ€åç®—ä¸€ä¸‹æˆæœ¬</p>
<ul>
<li>ä¸€æ¬¡æ€§æˆæœ¬ï¼šæ¥å› 100 å…ƒè·¯è´¹ + è£…æœºè´¹ 300 å…ƒï¼ˆå”¯ä¸€çš„å‘ç‚¹ï¼‰ &#x3D; 400 å…ƒ</li>
<li>å‘¨æœŸæ€§æˆæœ¬ï¼šæ¯æœˆå¼‚åœ°å·ç å¥—é¤ 8 å…ƒ + å®½å¸¦è´¹ç”¨ 80 å…ƒ + ä¸Šè¡ŒåŠ é€ŸåŒ… 30 å…ƒ &#x3D; 118 å…ƒ</li>
</ul>
<p>æ€»ä½“è¿˜æ˜¯æ¯” 500 Mbps çš„èåˆå¥—ä¾¿å®œå¾ˆå¤šçš„ã€‚</p>
<p>æœ€åé™„ä¸Š speedtest å’Œ ustc çš„æµ‹é€Ÿç»“æœå§</p>
<img src="https://images.zabrian.com/ac825486-02e6-43f8-1e06-419808a0da01/origin" title="SpeedTest æµ‹é€Ÿ" style="zoom:100%;" />

<img src="https://images.zabrian.com/8cb09a0c-3136-4487-8e35-a242c3ecf601/origin" title="USTC æµ‹é€Ÿ" style="zoom:85%;" />
]]></content>
  </entry>
  <entry>
    <title>æ­å»ºå®¶åº­ç§äºº GitLab æœåŠ¡å™¨</title>
    <url>/post/8d4f8799.html</url>
    <content><![CDATA[<p>å¤§æ¦‚ä»Šå¹´ï¼ˆ2022ï¼‰ä¸€æœˆä¸­æ—¬çš„æ—¶å€™å…¥æ‰‹äº†ä¸€ä¸ª <span class="exturl" data-url="aHR0cHM6Ly9yODZzLm5ldC8=">R86S<i class="fa fa-external-link-alt"></i></span> çš„å°ä¸»æœºã€‚å› ä¸ºé”™è¿‡äº†ä¼—ç­¹çš„è½¦ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥ä¸‹çš„å•ã€‚æœ€åå…¥æ‰‹äº† 16G çš„é»‘è‰²åƒå…†ç‰ˆæœ¬ã€‚ä¸ä¸Šä¸‡å…†ä¸€ä¸ªåŸå› æ˜¯å®¶é‡Œæ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ä¸‡å…†ç‰ˆçš„æ²¡æœ‰ NVME ç¡¬ç›˜ä½ï¼Œè¿™ä¸€ç‚¹å¯¹æˆ‘è¿˜æ˜¯åˆšéœ€ã€‚</p>
<span id="more"></span>

<p>æœ€åç”¨äº†å·®ä¸å¤šä¸€å‘¨çš„æ—¶é—´ï¼Œç»ˆäºåœ¨å¹´å‰ï¼Œè¿™ä¸ªå¿ƒå¿ƒå¿µçš„å°ä¸»æœºåˆ°æ‰‹äº†ã€‚<br>æœ‰å…³è¿™ä¸ªå°ä¸»æœºæˆ‘å°±ä¸å¤šåšä»‹ç»äº†ï¼Œä»Šå¤©ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹æˆ‘æ€ä¹ˆç”¨å®ƒåœ¨æˆ‘çš„å®¶åº­ç¯å¢ƒæ­å»ºä¸€ä¸ªç§äººçš„ GitLabã€‚è¿™ç¯‡æ–‡ç« ä»æˆ‘ä¸ºä»€ä¹ˆè¦æ­å»ºå®¶åº­ç§äºº GitLab ä»¥åŠå¦‚ä½•æ­å»ºã€‚éƒ½ä¼šéƒ½åšä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ã€‚</p>
<h1 id="åˆè¡·"><a href="#åˆè¡·" class="headerlink" title="åˆè¡·"></a>åˆè¡·</h1><p>å®¶é‡Œæ˜¯æœ‰ä¸€ä¸ª J4125 çš„è½¯è·¯ç”±ï¼Œå»å¹´å¾ˆæ—©å°±ä¹°äº†ã€‚ä¸€ç›´åœ¨æˆ‘å®¶ä½œä¸ºä¸»è·¯ç”±è´Ÿè´£æ‹¨å·å’Œç§‘å­¦ä¸Šç½‘çš„åŠŸèƒ½ï¼Œç”¨çš„ OpenWrt ä¹Ÿæ˜¯æˆ‘è‡ªå·±é…ç½®å’Œ GitHub Action ç¼–è¯‘çš„ï¼Œä¹Ÿæ»¡è¶³äº†æˆ‘å®¶çš„åŸºæœ¬éœ€æ±‚ã€‚è€Œä¸”ä¹Ÿå› ä¸ºæ˜¯ç‰©ç†æœºç›´è£…ï¼Œå†åŠ ä¸Šå®³æ€• J4125 ç©èµ·æ¥æ€•æ€§èƒ½ä¸å¤Ÿï¼Œå†å½±å“äº†æ­£å¸¸çš„ç½‘ç»œã€‚æ‰€ä»¥ä¹Ÿå°±ä¸æƒ³å†æŠ˜è…¾ä»–äº†ï¼Œå°±è®©ä»–å®‰å®‰å¿ƒå¿ƒåšæˆ‘å®¶çš„è·¯ç”±å™¨å°±å¥½äº†ã€‚</p>
<p>ä½†ä¸æ­¤åŒæ—¶å‘¢ï¼Œä½œä¸ºä¸€ä¸ªçˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜ï¼Œèº«è¾¹çš„å¾ˆå¤šä¸ç®¡æ˜¯ç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶çš„å°ç©æ„å„¿éƒ½æ˜¯æœ‰ç‰¹åˆ«çš„éœ€æ±‚çš„ã€‚</p>
<p>å°±æ¯”å¦‚å»å¹´ï¼ˆ2021ï¼‰å¹´ä¹°çš„ä¸€ä¸ª <span class="exturl" data-url="aHR0cHM6Ly9kcm9wLmNvbS9idXkvc3RhY2stb3ZlcmZsb3ctdGhlLWtleS1tYWNyb3BhZA==">STACK OVERFLOW THE KEY MACROPAD<i class="fa fa-external-link-alt"></i></span> é”®ç›˜ï¼Œé…ä¸Šä»æ·˜å®ä¹°çš„é”®å¸½ï¼Œå› ä¸ºä½¿ç”¨ QMK çš„é”®ç›˜æ–¹æ¡ˆï¼Œæ‰€ä»¥å¯ä»¥å®šåˆ¶å›ºä»¶ã€‚ç°åœ¨å·²ç»æˆä¸ºäº†æˆ‘çš„ä¸“ç”¨å¯†ç è¾“å…¥å™¨ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨è¿˜å°è¯•çœ‹ä»–è¿˜æœ‰æ²¡åˆ«çš„å¥½ç©çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘éœ€è¦å¯¹è¿™ä¸ªé”®ç›˜å›ºä»¶çš„ä»£ç ä¸æ–­è¿›è¡Œä¿®æ”¹ã€ç¼–è¯‘ã€åˆ·å…¥ï¼Œç„¶åå†å°è¯•ä¿®æ”¹ã€ç¼–è¯‘ã€åˆ·å…¥ã€‚è¿™æ ·çš„æ“ä½œé‡å¤èµ·æ¥ä¼šè®©äººå¾ˆç¹çï¼Œä½†æ˜¯å› ä¸ºå›ºä»¶ä¸­å­˜åœ¨ä¸€äº›æ•æ„Ÿä»£ç ï¼ˆæ¯”å¦‚æˆ‘çš„å„ç§å¯†ç ï¼‰æ‰€ä»¥ä¸æ–¹ä¾¿æ‰˜ç®¡åˆ° GitHubã€‚æ‰€ä»¥ä¹‹å‰æˆ‘å°±åœ¨æƒ³è¦æ˜¯èƒ½æœ‰ä¸€ä¸ªç§äººçš„ Git å¤šå¥½ã€‚é™¤äº†ä»£ç çš„æ‰˜ç®¡ï¼Œå¦‚æœè¿˜å¯ä»¥åŠ å…¥ CI&#x2F;CD è¿™ç§æŒç»­é›†æˆçš„èƒ½åŠ›ï¼Œå°±å¯ä»¥è§£æ”¾å¾ˆå¤šæ— è°“çš„é‡å¤çš„åŠ³åŠ¨ã€‚è€Œèƒ½åŒæ—¶æ»¡è¶³è¿™ä¸ªéœ€æ±‚çš„è®©æˆ‘æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ GitLab äº†ã€‚</p>
<p>é™¤äº†ä¸Šé¢è¯´çš„é‚£ä¸ªé”®ç›˜å›ºä»¶ï¼Œè¿˜æœ‰æ¯”å¦‚è¯´æˆ‘çš„ Rimeï¼ˆé¼ é¡»ç®¡ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºè¯åº“ä¸­æœ‰å¾ˆå¤šçš„è‡ªå®šä¹‰è¯ï¼Œä»¥åŠè¿˜æœ‰äººåé€šè®¯åœ°å€ä¹‹ç±»çš„æ•æ„Ÿè¯ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸æ–¹ä¾¿æŠŠè¿™ä¸ªé…ç½®ç›´æ¥æ‰˜ç®¡åœ¨ GitHub ä¸Šçš„ã€‚</p>
<p>è¿˜æœ‰ç°åœ¨çœ‹åˆ°çš„è¿™ä¸ªåšå®¢ï¼Œç”¨ Hexo ç”Ÿæˆçš„ GitHub Pages é™æ€é¡µé¢ï¼Œåšå®¢æœ¬èº«çš„ä»£ç æˆ‘ä¸æƒ³æ”¾åˆ° GitHub ä¸Šï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„æˆ‘ä¹Ÿéœ€è¦ä¸€ä¸ªç§äººçš„ GitLabã€‚é™¤äº†èƒ½å®ç°ä»£ç çš„æ‰˜ç®¡ï¼Œè¿˜èƒ½é¡ºä¾¿åˆ©ç”¨ GitLab CI å®ç°ä¸€é”®å‘å¸ƒï¼Œæ¯æ¬¡åªè¦æäº¤äº†ä»£ç ï¼Œç¨ç­‰ç‰‡åˆ» GitHub Pages å°±è‡ªåŠ¨éƒ¨ç½²å¥½äº†ã€‚</p>
<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><p>ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šã€‚ç°åœ¨æœ‰äº† R86S è¿™æ ·ä¸€ä¸ªæ€§èƒ½è·Ÿå¾—ä¸Šçš„å°ä¸»æœºï¼Œåœ¨ä¸œè¥¿åˆ°è´§çš„ç¬¬äºŒå¤©ï¼Œå°±å¼€å§‹äº†ä»–çš„æŠ˜è…¾ä¹‹è·¯ã€‚</p>
<h2 id="å®‰è£…ç¡¬ä»¶"><a href="#å®‰è£…ç¡¬ä»¶" class="headerlink" title="å®‰è£…ç¡¬ä»¶"></a>å®‰è£…ç¡¬ä»¶</h2><p>å› ä¸ºè¿™ä¸ª R86S åªå¸¦äº†ä¸€ä¸ªç”µæºï¼Œå†…ç½®çš„ä¸€ä¸ª EMMC å®¹é‡åªæœ‰ 128G ä¸”æ€§èƒ½å ªå¿§ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯å®‰è£…ä¸€ä¸ªè‡ªå·±çš„ NVME å›ºæ€ã€‚è®°å¾—ä¹‹å‰æœ‰ä¸€å—ä¹°å¤šäº†çš„åƒç°ä¸‰æ˜Ÿ 980 Pro 500Gï¼Œéƒ½æ²¡æœ‰å¼€å°ã€‚ä¹‹å‰è¿˜å·®ç‚¹ç»™æŒ‚åˆ°æµ·é²œå¸‚åœºå‡ºæ‰ï¼Œç°åœ¨ç»ˆäºæ´¾ä¸Šç”¨åœºäº†ã€‚<br>å®‰è£…å¥½ç¡¬ç›˜ç„¶åæ‰¾ä¸€ä¸ªç½‘çº¿ï¼Œè¿æ¥å¥½è·¯ç”±å™¨çš„ LAN å£å’Œ R86S çš„éšä¾¿ä¸€ä¸ªç½‘å£ã€‚è¿æ¥å¥½é”®ç›˜é¼ æ ‡ï¼Œå°±å¯ä»¥æ’ä¸Šç”µæºè‡ªåŠ¨ä¸Šç”µå¼€æœºäº†ã€‚</p>
<h2 id="å®‰è£…ç³»ç»Ÿ"><a href="#å®‰è£…ç³»ç»Ÿ" class="headerlink" title="å®‰è£…ç³»ç»Ÿ"></a>å®‰è£…ç³»ç»Ÿ</h2><p>æ—¢ç„¶æ˜¯æ˜¯è¦åšå°å‹æœåŠ¡å™¨ï¼Œå“ªæœ‰ç”¨æ¡Œé¢æ“ä½œç³»ç»Ÿçš„ã€‚æ‰€ä»¥è¿™é‡Œå°±é€‰æ‹©äº† <span class="exturl" data-url="aHR0cHM6Ly91YnVudHUuY29tL2Rvd25sb2FkL3NlcnZlcg==">Ubuntu Server 20.04.3 LTS<i class="fa fa-external-link-alt"></i></span>ã€‚ä¸‹è½½å®Œé•œåƒåï¼Œå†™å…¥åˆ° U ç›˜ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡ U ç›˜ å¯åŠ¨å°±å¯ä»¥è¿›å®‰è£…ç¯èŠ‚äº†ã€‚<br>å®‰è£…ç³»ç»Ÿæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹</p>
<ol>
<li><p>åˆ†é… IP åœ°å€çš„æ–¹å¼</p>
<p>åœ¨è¿›è¡Œç½‘ç»œé…ç½®çš„æ—¶å€™ï¼Œæ—¢å¯ä»¥é€šè¿‡ DHCP åŠ¨æ€åˆ†é… IPï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šã€‚å¦‚æœæ˜¯ DHCP åˆ†é…ï¼Œåˆ™åç»­éœ€è¦åˆ°è·¯ç”±å™¨ä¸­ç»‘å®šä¸€ä¸‹ Mac åœ°å€å’Œ IPï¼Œæ¯•ç«Ÿæˆ‘ä»¬åœ¨å†…ç½‘è®¿é—®ä¹Ÿæ˜¯éœ€è¦æœ‰ä¸€ä¸ªå†…ç½‘çš„å›ºå®š IPã€‚é€šè¿‡æ‰‹åŠ¨æŒ‡å®š IP åœ°å€ï¼Œè¦æ³¨æ„ä¸è¦å’Œç°æœ‰åˆ†é…çš„çš„åœ°å€å†²çªã€‚æ‰‹åŠ¨æŒ‡å®š IP å°±ä¸éœ€è¦åç»­åˆ°è·¯ç”±å™¨ç»‘å®š Mac åœ°å€å’Œ IP äº†ã€‚</p>
</li>
<li><p>é€‰æ‹©å®‰è£…ç¡¬ç›˜</p>
<p>å› ä¸ºä¸»æ¿ä¸Šå¸¦ä¸€ä¸ª EMMCï¼Œæ‰€ä»¥åœ¨é€‰æ‹©ç¡¬ç›˜çš„æ—¶å€™è®°å¾—é€‰è‡ªå·±å®‰è£…çš„ NVME SSD ä¸Šï¼Œè€Œä¸”è°ƒæ•´æ ¹ç›®å½•å¤§å°è°ƒæ•´ä¸ºå‰©ä½™ SSD æ‰€ç”±ç©ºé—´ã€‚å¦åˆ™æ ¹ç›®å½•é»˜è®¤åªåˆ’åˆ†äº† 100Gï¼Œåé¢è¿›å…¥ç³»ç»Ÿåè¿˜éœ€è¦æ‰‹åŠ¨æ‰©å®¹ã€‚</p>
</li>
<li><p>å®‰è£…åä¿®æ”¹ç½‘ç»œé…ç½®</p>
<p>å®‰è£…å®Œç³»ç»Ÿåé‡æ–°å¯åŠ¨æœ‰å¯èƒ½ä¼šå‡ºç°æ—¥å¿— <code>A start job is running for wait for network to be configured.</code> å¯¼è‡´éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½è¿›å…¥ç³»ç»Ÿã€‚è¿™æ—¶å€™éœ€è¦ç­‰è¿›åˆ°ç³»ç»Ÿåä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶</p>
<p><code>/etc/netplan/00-installer-config.yaml</code>ï¼ˆæ–‡ä»¶å <code>00-installer-config.yaml</code> ä¸å›ºå®šï¼Œä½†æ˜¯æ–‡ä»¶åç±»ä¼¼çš„ä¸€ä¸ª <code>yaml</code> æ–‡ä»¶)</p>
<p>åœ¨æ¯ä¸€ä¸ªè®¾å¤‡ä¸‹é¢æ·»åŠ  <code>optional: true</code></p>
<p>æœ€åçš„é…ç½®åº”è¯¥ç±»ä¼¼</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp1s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp2s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enp3s0:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååº”ç”¨æ›´æ”¹</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">netplan <span class="built_in">apply</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="åˆ›å»º-GitLab-å¤‡ä»½ä½ç½®"><a href="#åˆ›å»º-GitLab-å¤‡ä»½ä½ç½®" class="headerlink" title="åˆ›å»º GitLab å¤‡ä»½ä½ç½®"></a>åˆ›å»º GitLab å¤‡ä»½ä½ç½®</h2><p>ä¸Šé¢è¯´åˆ°äº†ï¼Œè¿™ä¸ª R86S è‡ªå¸¦ä¸€ä¸ª 128G çš„ EMMC å­˜å‚¨ï¼Œè™½ç„¶æ€§èƒ½æ¯”è¾ƒå·®ï¼Œä½†æ˜¯ä¸œè¥¿ä¸èƒ½æµªè´¹äº†ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘æ‹¿æ¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ GitLab æ•°æ®å¤‡ä»½å­˜å‚¨ï¼Œå³ä½¿æ˜¯ä¸»ç¡¬ç›˜æŒ‚äº†ï¼Œè¿˜æœ‰ä¸€ä»½ç‹¬ç«‹çš„å¤‡ä»½å­˜åœ¨ï¼Œè€Œä¸”çŸ­æ—¶é—´å†… 128G è¿˜æ˜¯å¤Ÿç”¨çš„ã€‚</p>
<h3 id="åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº"><a href="#åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº"></a>åˆ›å»ºæ–°çš„ç¡¬ç›˜åˆ†åŒº</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> cfdisk /dev/mmcblk0        <span class="comment"># mmcblk0 æ˜¯ EMMC è®¾å¤‡</span></span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 /dev/mmcblk0     <span class="comment"># æ ¼å¼åŒ–ä¸º ext4</span></span><br></pre></td></tr></table></figure>

<h3 id="æŒ‚è½½åˆ°-mmc"><a href="#æŒ‚è½½åˆ°-mmc" class="headerlink" title="æŒ‚è½½åˆ° &#x2F;mmc"></a>æŒ‚è½½åˆ° &#x2F;mmc</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/fstab</span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line">/dev/mmcblk0 /mmc ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-GitLab"><a href="#å®‰è£…-GitLab" class="headerlink" title="å®‰è£… GitLab"></a>å®‰è£… GitLab</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y curl openssh-server ca-certificates tzdata perl</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ -GitLab-æº"><a href="#æ·»åŠ -GitLab-æº" class="headerlink" title="æ·»åŠ  GitLab æº"></a>æ·»åŠ  GitLab æº</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | <span class="built_in">sudo</span> bash</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-GitLab-1"><a href="#å®‰è£…-GitLab-1" class="headerlink" title="å®‰è£… GitLab"></a>å®‰è£… GitLab</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install gitlab-ce</span><br></pre></td></tr></table></figure>

<h3 id="è·å–-root-ç”¨æˆ·å¯†ç "><a href="#è·å–-root-ç”¨æˆ·å¯†ç " class="headerlink" title="è·å– root ç”¨æˆ·å¯†ç "></a>è·å– root ç”¨æˆ·å¯†ç </h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/gitlab/initial_root_password</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶åé¢ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚å› æ­¤è¯·åŠæ—¶ä¿ç®¡å¥½è¯¥å¯†ç æˆ–è€…åŠæ—¶è¿›è¡Œä¿®æ”¹ã€‚</strong></p>
<h3 id="é…ç½®-GitLab"><a href="#é…ç½®-GitLab" class="headerlink" title="é…ç½® GitLab"></a>é…ç½® GitLab</h3><p>å¦‚æœä¸Šé¢å‡ æ­¥éƒ½æ¯”è¾ƒé¡ºåˆ©ï¼Œä¸å‡ºæ„å¤–ï¼Œç°åœ¨åº”è¯¥å·²ç»åœ¨è¿™ä¸ªç³»ç»Ÿä¸­å®‰è£…å¥½äº† GitLabã€‚æ¥ä¸‹æ¥å…ˆè¿›è¡Œä¸€äº›ç®€è¦åœ°é…ç½®ã€‚</p>
<p>GitLab çš„é…ç½®æ–‡ä»¶æ˜¯ <code>/etc/gitlab/gitlab.rb</code></p>
<p>æˆ‘å®¶ OpenWrt ä¸»è·¯ç”±åœ¨ DHCP ä¸­è®¾ç½®çš„ <code>æœ¬åœ°æœåŠ¡å™¨</code> å’Œ <code>æœ¬åœ°åŸŸå</code> åˆ†åˆ«ä¸º <code>/home/</code> å’Œ <code>home</code>ï¼ŒåŒæ—¶æˆ‘ä¹Ÿå¸Œæœ›èƒ½é€šè¿‡åŸŸåè®¿é—®è¿™ä¸ª GitLab æœåŠ¡å™¨ã€‚æ‰€ä»¥æˆ‘è¿˜æ·»åŠ äº†ä¸€æ¡ <code>è‡ªå®šä¹‰æŒŸæŒåŸŸå</code>ï¼Œå…¶ä¸­åŸŸåä¸º <code>git</code>ï¼ŒIP åœ°å€ä¸º R86S åˆ†é…çš„å›ºå®š IPï¼ˆæ¯”å¦‚æˆ‘å®¶çš„æ˜¯ <code>192.168.50.50</code>ï¼‰ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥é€šè¿‡åŸŸå <code>http://git.home</code> æ¥è®¿é—®è¿™ä¸ª GitLab æœåŠ¡å™¨äº†ã€‚</p>
<p>æ ¹æ®ä»¥ä¸Šå‰æï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹çš„å‡ ä¸ªåœ°æ–¹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">external_url</span> <span class="string">&#x27;http://git.home&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;gitlab_ssh_host&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;git.home&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;time_zone&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">gitlab_rails[&#x27;backup_path&#x27;]</span> <span class="string">=</span> <span class="string">&#x27;/mmc&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>backup_path</code> å³ä¸º <a href="#%E5%88%9B%E5%BB%BA-GitLab-%E5%A4%87%E4%BB%BD%E4%BD%8D%E7%BD%AE">EMMC è®¾å¤‡çš„æŒ‚è½½ç‚¹</a></p>
<p>ä¿®æ”¹å®Œ <code>gitlab.rb</code> åéœ€è¦é‡æ–°é…ç½® GitLab æ‰èƒ½ç”Ÿæ•ˆ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>

<p>ç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <span class="exturl" data-url="aHR0cDovL2dpdC5ob21lLw==">http://git.home<i class="fa fa-external-link-alt"></i></span> å°±å¯ä»¥çœ‹åˆ°æ­å»ºå¥½çš„ GitLab äº†ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>æ›´æ”¹ macOS å¼ºè°ƒè‰²</title>
    <url>/post/c59c6467.html</url>
    <content><![CDATA[<p>Apple åœ¨ <span class="exturl" data-url="aHR0cHM6Ly93d3cuYXBwbGUuY29tL2ltYWMtMjQ=">iMac 24â€<i class="fa fa-external-link-alt"></i></span> Mac ä¸­é¦–æ¬¡ä½¿ç”¨äº†æ–°çš„å¼ºè°ƒè‰²ï¼Œè¿™äº›å¼ºè°ƒè‰²æ˜¯è¿™äº› Mac ç‹¬æœ‰çš„ã€‚ä½†æ˜¯ç°åœ¨åªè¦æ˜¯ macOS 11.3.1 ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œå³ä½¿ä¸æ˜¯ iMac 24â€ æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›ç‰¹æœ‰çš„å¼ºè°ƒè‰²ã€‚</p>
<span id="more"></span>

<p>é¦–å…ˆéœ€è¦å¼€å¯åŸºäºç¡¬ä»¶çš„å¼ºè°ƒè‰² <code>NSColorSimulateHardwareAccent</code> åŠŸèƒ½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">defaults write -g NSColorSimulateHardwareAccent -bool YES</span><br></pre></td></tr></table></figure>

<p>ç„¶åé€šè¿‡ <code>NSColorSimulatedHardwareEnclosureNumber</code> é€‰æ‹©å…¶ä¸­ä»»æ„ä¸€ç§é¢œè‰²ã€‚å…¶ä¸­å¯é€‰çš„é¢œè‰²é€‰é¡¹ä¸º 3 åˆ° 8 (åŒ…å« 3 å’Œ 8)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">defaults write -g NSColorSimulatedHardwareEnclosureNumber -int 3</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°å¯åŠ¨ç”µè„‘æˆ–è€…é€€å‡ºç™»å½•é‡æ–°ç™»å½•å³å¯ç”Ÿæ•ˆã€‚<br>ç„¶ååœ¨ <strong>ç³»ç»Ÿè®¾ç½®</strong> -&gt; <strong>å¤–è§‚é€‰é¡¹å¡</strong> -&gt; <strong>å¼ºè°ƒè‰²</strong> å’Œ <strong>é«˜äº®æ ‡è®°é¢œè‰²</strong> é€‰é¡¹ä¸­ä¼šå‡ºç°ä¸€ä¸ª <strong>è¿™å° Mac</strong> çš„é¢œè‰²é€‰é¡¹ï¼Œå…¶ä¸­é¢œè‰²å³ä¸ºä¸Šé¢è®¾ç½®çš„é¢œè‰²ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <code>NSColorSimulatedHardwareEnclosureNumber</code> ä¸åŒå€¼çš„å®é™…æ•ˆæœ</p>
<img src="https://images.zabrian.com/c5f66aed-fff8-43e1-940d-8388311a0a01/origin" title="é¢œè‰² 3" style="zoom:57%;" />

<img src="https://images.zabrian.com/38169874-ea75-4086-24b1-ccd6416e9701/origin" title="é¢œè‰² 4" style="zoom:57%;" />

<img src="https://images.zabrian.com/1683833a-7ee4-416a-5659-2a31fbe46001/origin" title="é¢œè‰² 5" style="zoom:57%;" />

<img src="https://images.zabrian.com/fe160cc7-b5cb-435d-374b-6cb2e744d901/origin" title="é¢œè‰² 6" style="zoom:57%;" />

<img src="https://images.zabrian.com/5a1dfe77-2619-435a-290f-d058a032b601/origin" title="é¢œè‰² 7" style="zoom:57%;" />

<img src="https://images.zabrian.com/6dcb7e11-165d-4547-1bd4-ff7e02a8c001/origin" title="é¢œè‰² 8" style="zoom:57%;" />
]]></content>
  </entry>
  <entry>
    <title>macOS GPG ä½¿ç”¨æŒ‡å—</title>
    <url>/post/cb9ee24d.html</url>
    <content><![CDATA[<p>è¿™ç¯‡æŒ‡å—é¢å‘çš„æ˜¯å¯¹ <code>GPG</code> æœ‰äº†ä¸€å®šäº†è§£çš„çš„æœ‹å‹ï¼Œå¦‚æœä½ è¿˜ä¸çŸ¥é“ <code>GPG</code> æ˜¯ä»€ä¹ˆï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦å…ˆè¡¥å……ä¸€ä¸‹è¿™éƒ¨åˆ†çš„åŸºç¡€çŸ¥è¯†ï¼Œå†æ¥é£Ÿç”¨æ¯”è¾ƒåˆé€‚ã€‚</p>
<p>å¦‚æœä½ å·²ç»å¤§æ¦‚äº†è§£ <code>GPG</code> çš„ä¸€äº›å†…å®¹ï¼ŒçŸ¥é“å®ƒèƒ½ç”¨æ¥å¹²ä»€ä¹ˆè€Œä¸”ä½ çœŸçš„éœ€è¦ç”¨åˆ°ã€‚é‚£ä¹ˆè¿™ç¯‡æŒ‡å—æˆ–è®¸å¯¹ä½ æœ‰ä¸€ç‚¹çš„å¸®åŠ©ã€‚</p>
<p>è¿™ç¯‡æŒ‡å—ä¸»è¦é’ˆå¯¹äº <code>macOS</code> ç³»ç»Ÿä¸‹çš„ <code>GPG</code> ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ <code>Windows</code> æˆ–è€… <code>Linux</code>ï¼Œå…¶ä¸­æœ‰äº›å†…å®¹å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚</p>
<span id="more"></span>

<p>æ–‡ä¸­ä½¿ç”¨çš„ <code>GPG</code> ç‰ˆæœ¬æ˜¯ <code>2.4.5</code> ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ã€‚</p>
<blockquote>
<p>å¤‡æ³¨: ä¸‹æ–‡ä¸­æ‰€æœ‰çš„å±•ç¤ºå†…å®¹çš„éƒ¨åˆ† <code>$</code> å¼€å¤´çš„è¡Œè¡¨ç¤ºçš„å½“å‰ <code>shell</code> ç¯å¢ƒçš„å‘½ä»¤è¾“å…¥è¡Œã€‚å‘½ä»¤å‡ä¸åŒ…å« <code>$</code> æœ¬èº«ã€‚</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --version</span><br><span class="line">gpg (GnuPG) 2.4.5</span><br><span class="line">libgcrypt 1.10.3</span><br><span class="line">Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">License GNU GPL-3.0-or-later &lt;https://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Home: /Users/zebedy/.gnupg</span><br><span class="line">æ”¯æŒçš„ç®—æ³•ï¼š</span><br><span class="line">å…¬é’¥ï¼š RSA, ELG, DSA, ECDH, ECDSA, EDDSA</span><br><span class="line">å¯†æ–‡ï¼š IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,</span><br><span class="line">    CAMELLIA128, CAMELLIA192, CAMELLIA256</span><br><span class="line">æ•£åˆ—ï¼š SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224</span><br><span class="line">å‹ç¼©ï¼š  ä¸å‹ç¼©, ZIP, ZLIB, BZIP2</span><br></pre></td></tr></table></figure>

<h1 id="åˆæ¬¡ä½¿ç”¨"><a href="#åˆæ¬¡ä½¿ç”¨" class="headerlink" title="åˆæ¬¡ä½¿ç”¨"></a>åˆæ¬¡ä½¿ç”¨</h1><p>å¦‚æœä½ è¿˜æ²¡æœ‰ä»»ä½•å¯†é’¥ï¼Œæƒ³æ–°ç”Ÿæˆä¸€ä¸ªä½¿ç”¨ã€‚å»ºè®®ä»è¿™é‡Œå¼€å§‹ã€‚</p>
<h2 id="ç”Ÿæˆä¸»å¯†é’¥"><a href="#ç”Ÿæˆä¸»å¯†é’¥" class="headerlink" title="ç”Ÿæˆä¸»å¯†é’¥"></a>ç”Ÿæˆä¸»å¯†é’¥</h2><p>ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>--gen-key</code> å°±å¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ›´å¤šçš„ç»†èŠ‚è®¾ç½®ï¼Œæ‰€ä»¥ç”¨ <code>--full-gen-key</code> æ¥ä»£æ›¿</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --full-gen-key</span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š</span><br><span class="line">   (1) RSA å’Œ RSA</span><br><span class="line">   (2) DSA å’Œ Elgamal</span><br><span class="line">   (3) DSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (4) RSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (9) ECCï¼ˆç­¾åå’ŒåŠ å¯†ï¼‰ *é»˜è®¤*</span><br><span class="line">  (10) ECCï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line"> ï¼ˆ14ï¼‰å¡ä¸­ç°æœ‰å¯†é’¥</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 9</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥ç‰ˆæœ¬ï¼ˆ<code>2.4.5</code>ï¼‰ä¸‹å¯ä»¥é€šè¿‡ <code>*é»˜è®¤*</code> å¯ä»¥çœ‹é»˜è®¤çš„å¯†é’¥ç±»å‹ä¸º <code>ECCï¼ˆç­¾åå’ŒåŠ å¯†ï¼‰</code> è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚ä½¿ç”¨é»˜è®¤å³å¯ã€‚</p>
<p>åœ¨å½“å‰ç•Œé¢è¾“å…¥é€‰é¡¹å‰é¢æ‹¬å·ä¸­çš„æ•°å­— <code>9</code> ä¹‹åå›è½¦ç¡®è®¤ï¼Œæˆ–è€…ä¸è¾“å…¥ä»»ä½•å†…å®¹ç›´æ¥å›è½¦ç¡®è®¤å³å¯ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·é€‰æ‹©æ‚¨æƒ³è¦ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ï¼š</span><br><span class="line">   (1) Curve 25519 *é»˜è®¤*</span><br><span class="line">   (4) NIST P-384</span><br><span class="line">   (6) Brainpool P-256</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 1</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼ä¸Šä¸€æ­¥ï¼Œé€‰æ‹©ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ï¼Œè¿™é‡Œé€‰æ‹©é»˜è®¤ <code>Curve 25519</code> å³å¯ã€‚</p>
<p>åœ¨å½“å‰ç•Œé¢è¾“å…¥ <code>1</code> ä¹‹åå›è½¦ç¡®è®¤ï¼Œæˆ–è€…ä¸è¾“å…¥ä»»ä½•å†…å®¹ç›´æ¥å›è½¦ç¡®è®¤å³å¯ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚</span><br><span class="line">         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ</span><br><span class="line">      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ</span><br><span class="line">å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œéœ€è¦é€‰æ‹©å¯†é’¥çš„æœ‰æ•ˆæœŸã€‚</p>
<p>å¦‚æœæ˜¯ä¸ªäººä½¿ç”¨ï¼Œå¯ä»¥é€‰æ‹©æ°¸ä¸è¿‡æœŸï¼Œè¿™æ ·å¯ä»¥é¿å…ä»¥åè¿‡æœŸåè¿˜éœ€è¦å†æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ã€‚</p>
<p>è€Œå¦‚æœéœ€è¦é…ç½®ç‰¹å®šçš„è¿‡æœŸæ—¶é—´ã€‚åˆ™æ ¹æ®ä¸‹é¢çš„ä¸‰ä¸ªé€‰é¡¹è¾“å…¥å¯¹åº”çš„å†…å®¹å³å¯ï¼Œæ¯”å¦‚éœ€è¦åœ¨ä¸€å‘¨åè¿‡æœŸï¼Œåˆ™è¾“å…¥ <code>1w</code> 3 ä¸ªæœˆåè¿‡æœŸ <code>3m</code></p>
<p>æˆ‘è¿™é‡Œå°±é€‰äº† <code>0</code> è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚è¾“å…¥æ•°å­— <code>0</code> å›è½¦åç»è¿‡äºŒæ¬¡ç¡®è®¤ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚</span><br><span class="line"></span><br><span class="line">çœŸå®å§“åï¼š</span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œå¼€å§‹åé¢çš„æ­¥éª¤å°±æ˜¯è¾“å…¥å¯†é’¥å¯¹åº”çš„ä¸ªäººä¿¡æ¯äº†ã€‚</p>
<p>ä¾æ¬¡è¾“å…¥å†…å®¹åŒ…æ‹¬ <code>çœŸå®å§“å</code>, <code>ç”µå­é‚®ä»¶åœ°å€</code>, <code>æ³¨é‡Š</code> å…¶ä¸­æ³¨é‡Šå¯ä»¥çœç•¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GnuPG éœ€è¦æ„å»ºç”¨æˆ·æ ‡è¯†ä»¥è¾¨è®¤æ‚¨çš„å¯†é’¥ã€‚</span><br><span class="line"></span><br><span class="line">çœŸå®å§“åï¼š zebedy</span><br><span class="line">ç”µå­é‚®ä»¶åœ°å€ï¼š zebedy@example.com</span><br><span class="line">æ³¨é‡Šï¼š</span><br><span class="line">æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š</span><br><span class="line">    â€œzebedy &lt;zebedy@example.com&gt;â€</span><br><span class="line"></span><br><span class="line">æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¦‚æœç¡®è®¤ä¸ªäººä¿¡æ¯è¾“å…¥æ²¡é—®é¢˜ï¼Œå°±å¯ä»¥è¾“å…¥å­—æ¯ <code>O</code> å›è½¦ç¡®è®¤ã€‚</p>
<p>ç¡®å®šä¹‹åæ ¹æ®æç¤ºè®¾ç½®ä¸»å¯†é’¥çš„å¯†ç ã€‚ç¡®å®šå¯†ç åã€‚ç»è¿‡çŸ­æš‚çš„æ—¶é—´å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥äº†ã€‚</p>
<p>è¿™ä¸ªå¯†ç ä¸€å®šè¦å¦¥å–„ä¿ç®¡ï¼Œä¼šç»å¸¸éœ€è¦ä½¿ç”¨ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line">gpg: åŠé”€è¯ä¹¦å·²è¢«å­˜å‚¨ä¸ºâ€˜/Users/zebedy/.gnupg/openpgp-revocs.d/A31F6E522B93990CA1A1C548D188A1DD832AB894.revâ€™</span><br><span class="line">å…¬é’¥å’Œç§é’¥å·²ç»ç”Ÿæˆå¹¶è¢«ç­¾åã€‚</span><br><span class="line"></span><br><span class="line">pub   ed25519 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                      zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519 2024-03-24 [E]</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œï¼Œä¸»å¯†é’¥å°±ç”Ÿæˆç»“æŸäº†ã€‚</p>
<h2 id="ç”Ÿæˆå­å¯†é’¥"><a href="#ç”Ÿæˆå­å¯†é’¥" class="headerlink" title="ç”Ÿæˆå­å¯†é’¥"></a>ç”Ÿæˆå­å¯†é’¥</h2><h3 id="æ›¿æ¢é»˜è®¤-pinentry"><a href="#æ›¿æ¢é»˜è®¤-pinentry" class="headerlink" title="æ›¿æ¢é»˜è®¤ pinentry"></a>æ›¿æ¢é»˜è®¤ <code>pinentry</code></h3><p>åœ¨ç”Ÿæˆå­å¯†é’¥ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åšä¸€ä¸ªäº‹æƒ…ï¼šæ›¿æ¢é»˜è®¤çš„ <code>pinentry</code></p>
<p><code>pinentry</code> æ˜¯ç”¨æ¥åˆç”¨ä¹äº¤äº’è¾“å…¥å¯†ç çš„ï¼Œå› ä¸ºé»˜è®¤çš„ <code>pinentry</code> ä¾èµ– <code>GPG_TTY</code> æ‰€ä»¥å¯ä»¥å†ç»ˆç«¯ä¸­å®ç°è¾“å…¥å¯†ç ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å…¶ä»–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ VSCode æˆ–è€… JB å…¨å®¶æ¡¶çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å› ä¸ºæ— æ³•è¾“å…¥å¯†ç å¯¼è‡´å¤±è´¥ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹çš„ <code>pinentry-mac</code>ï¼Œå¹¶æ›¿æ¢é»˜è®¤ <code>pinentry</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">brew install pinentry-mac</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;pinentry-program <span class="subst">$(which pinentry-mac)</span>&quot;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡å¯ <code>gpg-agent</code> å³å¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> RELOADAGENT | gpg-connect-agent</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç”¨äº-SSH-é‰´æƒçš„å­å¯†é’¥"><a href="#åˆ›å»ºç”¨äº-SSH-é‰´æƒçš„å­å¯†é’¥" class="headerlink" title="åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥"></a>åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥</h3><h4 id="åˆ›å»ºå­å¯†é’¥"><a href="#åˆ›å»ºå­å¯†é’¥" class="headerlink" title="åˆ›å»ºå­å¯†é’¥"></a>åˆ›å»ºå­å¯†é’¥</h4><p>é¦–å…ˆæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ä¸»å¯†é’¥çš„ç›¸å…³ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">gpg: æ­£åœ¨æ£€æŸ¥ä¿¡ä»»åº¦æ•°æ®åº“</span><br><span class="line">gpg: marginals needed: 3  completes needed: 1  trust model: pgp</span><br><span class="line">gpg: æ·±åº¦ï¼š0  æœ‰æ•ˆæ€§ï¼š  4  å·²ç­¾åï¼š  0  ä¿¡ä»»åº¦ï¼š0-ï¼Œ0qï¼Œ0nï¼Œ0mï¼Œ0fï¼Œ4u</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€è¡Œ å¼€å¤´çš„ <code>pub</code> è¡¨ç¤ºè¿™ä¸ªæ˜¯å…¬é’¥, <code>ed25519</code> æ˜¯ä¸Šé¢åˆ›å»ºå¯†é’¥æ—¶é€‰æ‹©çš„æ¤­åœ†æ›²çº¿æ–¹æ³•, åé¢çš„ <code>D188A1DD832AB894</code> æ˜¯å…¬é’¥çš„ 16 ä½çŸ­æ‘˜è¦, <code>2024-03-24</code> æ˜¯ç”Ÿæˆæ—¶é—´, <code>[SC]</code> ä¸­ <code>S:signing</code> è¡¨ç¤ºå¯ä»¥ç”¨äºç­¾å <code>C:certification</code> è¡¨ç¤ºå¯ä»¥ç”¨äºè®¤è¯ã€‚</li>
<li>ç¬¬äºŒè¡Œ <code>A31F6E522B93990CA1A1C548D188A1DD832AB894</code> æ˜¯å¯†é’¥çš„ 40 ä½é•¿æ‘˜è¦ã€‚å…¶ä¸­ä¸Šé¢çš„çŸ­æ‘˜è¦å°±æ˜¯é•¿æ‘˜è¦çš„å 16 ä½ã€‚</li>
<li>ç¬¬ä¸‰è¡Œ <code>uid</code> æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œ<code>[ ç»å¯¹ ]</code> è¡¨ç¤ºè¯¥å¯†é’¥çš„ä¿¡ä»»ç­‰çº§æ˜¯æœ€é«˜çº§åˆ«: ç»å¯¹ä¿¡ä»»ã€‚åé¢åˆ†åˆ«æ˜¯è¾“å…¥çš„åå­—ï¼Œæ³¨é‡Šå’Œç”µå­é‚®ä»¶</li>
<li>ç¬¬å››è¡Œ <code>sub</code> è¡¨ç¤ºè¿™ä¸ªæ˜¯å­å…¬é’¥ï¼Œæ˜¯åˆ›å»ºä¸»å¯†é’¥çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªå­å¯†é’¥ï¼Œæœ€åçš„<code>[E]</code> ä¸­ <code>E:encryption</code> è¡¨ç¤ºå¯ç”¨äºåŠ å¯†</li>
</ul>
<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>--list-secret-keys</code> æŸ¥çœ‹ç§é’¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-secret-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">sec   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">ssb   cv25519/2978529F4782B600 2024-03-24 [E]</span><br></pre></td></tr></table></figure>

<p>å†…å®¹å’Œä¸Šé¢åªæœ‰å‰é¢çš„ <code>pub</code> -&gt; <code>sec</code>(è¡¨ç¤ºç§é’¥)ï¼Œ<code>sub</code> -&gt; <code>ssb</code>(è¡¨ç¤ºå­ç§é’¥) ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„å†…å®¹éƒ½ä¸€æ ·ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çŸ¥é“ä¸»å¯†é’¥çš„æ‘˜è¦æ˜¯ <code>D188A1DD832AB894</code> (è¿™é‡Œç”¨é•¿çŸ­æ‘˜è¦éƒ½å¯ä»¥ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢å°±éƒ½ç”¨çŸ­æ‘˜è¦ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>uid</code> ä¸­çš„å§“å)</p>
<p>æ¥ä¸‹æ¥å°±éœ€è¦ç”¨è¿™ä¸ªä¸»å¯†é’¥ç”Ÿæˆä¸€ä¸ªå­å¯†é’¥ã€‚å› ä¸ºéœ€è¦ç”¨åˆ°é«˜çº§è‡ªå®šä¹‰ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š <code>--expert</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --expert --edit-key D188A1DD832AB894 <span class="comment"># æˆ–è€…æ˜¯ gpg --expert --edit-key zebedy</span></span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">ç§é’¥å¯ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ <code>shell</code> å˜æˆäº† <code>gpg&gt;</code> è¡¨ç¤ºè¿›å…¥äº†ä¸ <code>GPG</code> çš„äº¤äº’</p>
<p>è¾“å…¥ <code>addkey</code> æ·»åŠ ä¸€ä¸ªæ–°çš„å­å¯†é’¥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg&gt; addkey</span><br><span class="line">è¯·é€‰æ‹©æ‚¨è¦ä½¿ç”¨çš„å¯†é’¥ç±»å‹ï¼š</span><br><span class="line">   (3) DSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (4) RSAï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">   (5) ElGamalï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">   (6) RSAï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">   (7) DSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">   (8) RSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">  (10) ECCï¼ˆä»…ç”¨äºç­¾åï¼‰</span><br><span class="line">  (11) ECCï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</span><br><span class="line">  (12) ECCï¼ˆä»…ç”¨äºåŠ å¯†ï¼‰</span><br><span class="line">  (13) ç°æœ‰å¯†é’¥</span><br><span class="line"> ï¼ˆ14ï¼‰å¡ä¸­ç°æœ‰å¯†é’¥</span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ 8</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥ <code>8</code> å›è½¦ç¡®è®¤ï¼Œä½¿ç”¨ <code>RSAï¼ˆè‡ªå®šä¹‰ç”¨é€”ï¼‰</code> é€‰é¡¹æ‰‹åŠ¨é…ç½®è¿™ä¸ªå¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ S</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå­å¯†é’¥ç›®å‰å¯ç”¨çš„åŠŸèƒ½æœ‰ <code>ç­¾åï¼ˆSignï¼‰</code> å’Œ <code>åŠ å¯†ï¼ˆEncryptï¼‰</code></p>
<p>ä½†æ˜¯ <code>SSH</code> é‰´æƒä¸éœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦å–æ¶ˆè¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚</p>
<p>è¾“å…¥ <code>S</code> å›è½¦åå–æ¶ˆ <code>ç­¾åï¼ˆSignï¼‰</code> çš„åŠŸèƒ½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š åŠ å¯†ï¼ˆEncryptï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ E</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å­å¯†é’¥ç›®å‰å¯ç”¨çš„åŠŸèƒ½å°±åªæœ‰ <code>åŠ å¯†ï¼ˆEncryptï¼‰</code> äº†ï¼Œå†æ¬¡è¾“å…¥ <code>E</code> å›è½¦ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ A</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å·²å¯ç”¨åŠŸèƒ½å°±æ²¡æœ‰äº†ä»»ä½•å†…å®¹ï¼Œè¾“å…¥ <code>A</code> å›è½¦åå¼€å¯ <code>SSH</code> é‰´æƒéœ€è¦çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„å¯å®ç°çš„åŠŸèƒ½ï¼š ç­¾åï¼ˆSignï¼‰ åŠ å¯†ï¼ˆEncryptï¼‰ èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line">ç›®å‰å¯ç”¨çš„åŠŸèƒ½ï¼š èº«ä»½éªŒè¯ï¼ˆAuthenticateï¼‰</span><br><span class="line"></span><br><span class="line">   (S) ç­¾ååŠŸèƒ½å¼€å…³</span><br><span class="line">   (E) åŠ å¯†åŠŸèƒ½å¼€å…³</span><br><span class="line">   (A) èº«ä»½éªŒè¯åŠŸèƒ½å¼€å…³</span><br><span class="line">   (Q) å·²å®Œæˆ</span><br><span class="line"></span><br><span class="line">æ‚¨çš„é€‰æ‹©æ˜¯ï¼Ÿ Q</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¾“å…¥ <code>Q</code> ç»“æŸè‡ªå®šä¹‰åŠŸèƒ½ï¼Œè¿›å…¥ <code>RSA</code> å¯†é’¥é€‰é¡¹ã€‚</p>
<p>å› ä¸ºæ·»åŠ å­å¯†é’¥çš„æ—¶å€™é€‰æ‹©çš„æ˜¯ <code>RSA</code> å¯†é’¥ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡å®šå¯†é’¥é•¿åº¦ã€‚é•¿åº¦è¶Šé•¿ï¼Œå®‰å…¨æ€§è¶Šé«˜ã€‚æˆ‘è¿™é‡Œå°±é€‰æ‹© <code>4096</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RSA å¯†é’¥çš„é•¿åº¦åº”åœ¨ 1024 ä½ä¸ 4096 ä½ä¹‹é—´ã€‚</span><br><span class="line">æ‚¨æƒ³è¦ä½¿ç”¨çš„å¯†é’¥é•¿åº¦ï¼Ÿ(3072) 4096</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¾ç½®å­å¯†é’¥çš„æœ‰æ•ˆæœŸã€‚å› ä¸ºä¹Ÿæ˜¯ä¸ªäººé•¿æœŸä½¿ç”¨ï¼Œæ‰€ä»¥é€‰æ‹© <code>0 å¯†é’¥æ°¸ä¸è¿‡æœŸ</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">è¯·è®¾å®šè¿™ä¸ªå¯†é’¥çš„æœ‰æ•ˆæœŸé™ã€‚</span><br><span class="line">         0 = å¯†é’¥æ°¸ä¸è¿‡æœŸ</span><br><span class="line">      &lt;n&gt;  = å¯†é’¥åœ¨ n å¤©åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;w = å¯†é’¥åœ¨ n å‘¨åè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;m = å¯†é’¥åœ¨ n æœˆåè¿‡æœŸ</span><br><span class="line">      &lt;n&gt;y = å¯†é’¥åœ¨ n å¹´åè¿‡æœŸ</span><br><span class="line">å¯†é’¥çš„æœ‰æ•ˆæœŸé™æ˜¯ï¼Ÿ(0) 0</span><br></pre></td></tr></table></figure>

<p>ç„¶åç»è¿‡ä¸¤æ¬¡è¾“å…¥ <code>y</code> çš„ç¡®è®¤åï¼Œä¼šæç¤ºè¾“å…¥ä¸»å¯†é’¥çš„å¯†ç ã€‚å› ä¸ºåˆ›å»ºå­å¯†é’¥éœ€è¦ç”¨åˆ°ä¸»å¯†é’¥çš„ç§é’¥ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°ä¸»å¯†é’¥çš„å¯†ç ã€‚</p>
<p>è¾“å…¥å®Œæ­£ç¡®å¯†ç åï¼Œç»è¿‡çŸ­æš‚æ—¶é—´å°±ç”Ÿæˆäº†ä¸€ä¸ª <code>RSA</code> å¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¤§é‡çš„éšæœºå­—èŠ‚ã€‚åœ¨è´¨æ•°ç”ŸæˆæœŸé—´åšäº›å…¶ä»–æ“ä½œï¼ˆæ•²æ‰“é”®ç›˜</span><br><span class="line">ã€ç§»åŠ¨é¼ æ ‡ã€è¯»å†™ç¡¬ç›˜ä¹‹ç±»çš„ï¼‰å°†ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ï¼›è¿™ä¼šè®©éšæœºæ•°</span><br><span class="line">å‘ç”Ÿå™¨æœ‰æ›´å¥½çš„æœºä¼šè·å¾—è¶³å¤Ÿçš„ç†µã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt;</span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šé¢ç›¸æ¯”å¯ä»¥çœ‹åˆ°å·²ç»å¤šäº†ä¸€ä¸ªæ‘˜è¦ä¸º <code>EFA3B0684ECE9D91</code> çš„å­å¯†é’¥ã€‚</p>
<p>è¿˜æœ‰æœ€åä¸€æ­¥ï¼Œè¾“å…¥ <code>save</code> å›è½¦ä¿å­˜å°±é€€å‡º <code>GPG</code> çš„äº¤äº’ <code>shell</code> äº†ã€‚</p>
<p>è‡³æ­¤ï¼Œå­å¯†é’¥åˆ›å»ºå®Œæˆã€‚</p>
<p>å›åˆ°æŸ¥çœ‹å¯†é’¥ä¿¡æ¯é‚£é‡Œã€‚æˆ‘ä»¬å†é€šè¿‡ <code>--list-keys</code> æŸ¥çœ‹å½“å‰å¯†é’¥ä¿¡æ¯å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå­å¯†é’¥äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”ä¸Šé¢å¯ä»¥çœ‹åˆ°åˆ°äº†ä¸€ä¸ª <code>EFA3B0684ECE9D91</code> çš„å­å¯†é’¥</p>
<h4 id="é…ç½®-SSH"><a href="#é…ç½®-SSH" class="headerlink" title="é…ç½® SSH"></a>é…ç½® SSH</h4><h5 id="å¯ç”¨-GPG-Agent-çš„-SSH-æ”¯æŒ"><a href="#å¯ç”¨-GPG-Agent-çš„-SSH-æ”¯æŒ" class="headerlink" title="å¯ç”¨ GPG Agent çš„ SSH æ”¯æŒ"></a>å¯ç”¨ GPG Agent çš„ SSH æ”¯æŒ</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.gnupg/gpg-agent.conf <span class="comment"># æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ä»¶ä¸­å•ç‹¬ä¸€è¡Œæ·»åŠ  <code>enable-ssh-support</code></p>
<h5 id="è®¾ç½®-GPG-Agent-æ›¿ä»£-SSH-Agent"><a href="#è®¾ç½®-GPG-Agent-æ›¿ä»£-SSH-Agent" class="headerlink" title="è®¾ç½® GPG Agent æ›¿ä»£ SSH Agent"></a>è®¾ç½® GPG Agent æ›¿ä»£ SSH Agent</h5><p>ä¿®æ”¹å¯¹åº” shell çš„é…ç½®æ–‡ä»¶ (æˆ‘ä½¿ç”¨çš„æ˜¯ <code>zsh</code>ï¼Œè‡ªå·±æ ¹æ®ä½¿ç”¨çš„ <code>shell</code> è°ƒæ•´)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ°åˆé€‚çš„åœ°æ–¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GPG_TTY=$(<span class="built_in">tty</span>)</span><br><span class="line"><span class="built_in">export</span> SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)</span><br><span class="line">gpgconf --launch gpg-agent</span><br></pre></td></tr></table></figure>

<h5 id="æ·»åŠ å­å¯†é’¥-keygrip"><a href="#æ·»åŠ å­å¯†é’¥-keygrip" class="headerlink" title="æ·»åŠ å­å¯†é’¥ keygrip"></a>æ·»åŠ å­å¯†é’¥ keygrip</h5><p>é¦–å…ˆé€šè¿‡ <code>--with-keygrip</code> è·å–å­å¯†é’¥çš„ <code>keygrip</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --with-keygrip --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">      Keygrip = F95E3D5B168563C4F65853E8C0396815CE819A21</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">      Keygrip = C5F82430DCB7B754782189638CBC8778D3E84AB8</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br><span class="line">      Keygrip = 9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°ä¸Šä¸€æ­¥åˆ›å»ºçš„å­å¯†é’¥ <code>EFA3B0684ECE9D91</code> ä»–çš„ <code>Keygrip = 9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</code></p>
<p>ç¼–è¾‘ <code>~/.gnupg/sshcontrol</code> æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim ~/.gnupg/sshcontrol</span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ª <code>9C0935998C1D9F9BDE3030BB1C1A10A4454E56F8</code> æ·»åŠ åˆ°å•ç‹¬ä¸€è¡Œï¼Œä¿å­˜ã€‚</p>
<p>ç„¶åé‡å¯ç»ˆç«¯</p>
<p>æ£€æŸ¥ <code>SSH Key</code> æ˜¯å¦å­˜åœ¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-add -l</span><br><span class="line">4096 SHA256:GvaU9MfvKVMa9FVM+KN28z+MDCML6429dWeILycSPPw (none) (RSA)</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°ç±»ä¼¼å†…å®¹å°±è¡¨ç¤ºæ·»åŠ æˆåŠŸ</p>
<h5 id="å¯¼å‡º-SSH-å…¬é’¥"><a href="#å¯¼å‡º-SSH-å…¬é’¥" class="headerlink" title="å¯¼å‡º SSH å…¬é’¥"></a>å¯¼å‡º SSH å…¬é’¥</h5><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --export-ssh-key EFA3B0684ECE9D91 <span class="comment"># æˆ–è€…æ˜¯ gpg --export-ssh-key zebedy</span></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6guDA+iEFZe2op48auILxCkN6IRWJstpp1X/iNtohEcUpBxJ3g0qMKiMQnFHOTsL0PCci2Ifmg740DE5RWC+QPhAiJCl/VT6nUK4wT+wx+0CoseQEg9RLWnq6+WYXi2GLEKZLIdxvpcrsm6IaEIUk8Z8CMbuJocFrOeAGsV9F9QsRIFyqGNw8v6/+rBDDZdfGbKrp54heNM61YtvVDtSSCgMq0iFW8mlxR1F3egaiffJid/LWWlDht15ndB8C+5ZIpK/Tbr6bHy9VWnbXOmxP4MBL4SyTUkEgvAqMEG5PWiS6PsfUbkvWTNRx6TG5RsZ7Xu0AVcB6//ZEHkjZeIeW9glMf7tC3H8bhpadDcDusPCeJv04TuAkFjYZVUSCnvR1qVUxe6VR9rhE6tBi86YGngvIRcWHjVe7o1CiQLSFAp9T5vD1HjRo8Q6pnKP4sq66jXH61MrhLMhLQt3RVryWe2AlPYtcYPlWRrl4uj3o8TKNQDhBFO7tMssHo474eC50epzpdOoC4etzHcIIVmMKSnvSl1Z46LUgkmcgL4Wj0NTqBWx58KFKjpYAT5dcZisvUsGM6pbFgFJRLRUcjibiR3vm3H34p08vaLYW5ldOJKwTf59rGiRI/ileY+1xpBsbc48PBAyX13433Lgw9TnRvjd+Ovkma7PU/QoJPKm+Sw== openpgp:0x4ECE9D91</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æŠŠè¿™ä¸ªå®ƒæ·»åŠ åˆ°ä»»ä½•éœ€è¦ä½¿ç”¨ <code>SSH</code> çš„åœ°æ–¹ï¼Œæ¯”å¦‚ <code>GitHub</code> æˆ–è€…è‡ªå·±æœåŠ¡å™¨ä¸Šçš„ <code>~/.ssh/authorized_keys</code> ä¸­ã€‚</p>
<p>è‡³æ­¤ï¼Œé€šè¿‡ GPG ç”Ÿæˆ SSH ä¸“ç”¨å¯†é’¥çš„è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</p>
<h3 id="åˆ›å»ºç”¨äº-ä»£ç ç­¾å-çš„å­å¯†é’¥"><a href="#åˆ›å»ºç”¨äº-ä»£ç ç­¾å-çš„å­å¯†é’¥" class="headerlink" title="åˆ›å»ºç”¨äº ä»£ç ç­¾å çš„å­å¯†é’¥"></a>åˆ›å»ºç”¨äº ä»£ç ç­¾å çš„å­å¯†é’¥</h3><h4 id="æ£€æŸ¥å¯†é’¥é‚®ç®±"><a href="#æ£€æŸ¥å¯†é’¥é‚®ç®±" class="headerlink" title="æ£€æŸ¥å¯†é’¥é‚®ç®±"></a>æ£€æŸ¥å¯†é’¥é‚®ç®±</h4><blockquote>
<p>å¤‡æ³¨: å¦‚æœåœ¨<a href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8">åˆæ¬¡ä½¿ç”¨</a>çš„æ—¶å€™è¾“å…¥çš„é‚®ç®±ä¸æ˜¯ <code>GitHub</code> æˆ–è€… <code>GitLab</code> çš„é‚®ç®±ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆéœ€è¦åœ¨ç¼–è¾‘å¯†é’¥ <code>gpg --expert --edit-key D188A1DD832AB894</code> çš„äº¤äº’ä¸­é€šè¿‡ <code>adduid</code> ç»™ä¸»å¯†é’¥æ·»åŠ å¯¹åº”çš„é‚®ç®±ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --edit-key D188A1DD832AB894 <span class="comment"># ç¼–è¾‘ä¸»å¯†é’¥</span></span><br><span class="line">gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">ç§é’¥å¯ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1). zebedy &lt;zebedy@example.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt; adduid</span><br><span class="line">çœŸå®å§“åï¼š github name <span class="comment"># GitHub/GitLab ç”¨æˆ·åï¼ˆä¹Ÿå¯ä»¥ä¸å’Œç”¨æˆ·åä¸€è‡´ï¼‰</span></span><br><span class="line">ç”µå­é‚®ä»¶åœ°å€ï¼š github@gmail.com <span class="comment"># GitHub/GitLab é‚®ç®±ï¼ˆå¿…é¡»ä¸€è‡´ï¼‰</span></span><br><span class="line">æ³¨é‡Šï¼š github <span class="comment"># å¯é€‰</span></span><br><span class="line">æ‚¨é€‰å®šäº†æ­¤ç”¨æˆ·æ ‡è¯†ï¼š</span><br><span class="line">    â€œgithub name (github) &lt;github@gmail.com&gt;â€</span><br><span class="line"></span><br><span class="line">æ›´æ”¹å§“åï¼ˆNï¼‰ã€æ³¨é‡Šï¼ˆCï¼‰ã€ç”µå­é‚®ä»¶åœ°å€ï¼ˆEï¼‰æˆ–ç¡®å®šï¼ˆOï¼‰/é€€å‡ºï¼ˆQï¼‰ï¼Ÿ O</span><br><span class="line"></span><br><span class="line">sec  ed25519/D188A1DD832AB894</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šSC</span><br><span class="line">     ä¿¡ä»»åº¦ï¼šç»å¯¹        æœ‰æ•ˆæ€§ï¼šç»å¯¹</span><br><span class="line">ssb  cv25519/2978529F4782B600</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šE</span><br><span class="line">ssb  rsa4096/EFA3B0684ECE9D91</span><br><span class="line">     åˆ›å»ºäºï¼š2024-03-24  æœ‰æ•ˆè‡³ï¼šæ°¸ä¸       å¯ç”¨äºï¼šAR</span><br><span class="line">[ ç»å¯¹ ] (1)  zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">[ æœªçŸ¥ ] (2). github name (github) &lt;github@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">gpg&gt; save <span class="comment"># save ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹å¯†é’¥ä¿¡æ¯å°±å¯ä»¥çœ‹åˆ°å·²ç»åŒ…å«æ–°çš„ <code>uid</code> äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] github name (github) &lt;github@gmail.com&gt;</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿæˆå­å¯†é’¥-1"><a href="#ç”Ÿæˆå­å¯†é’¥-1" class="headerlink" title="ç”Ÿæˆå­å¯†é’¥"></a>ç”Ÿæˆå­å¯†é’¥</h4><p>å’Œä¸Šé¢ç”Ÿæˆ<a href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E4%BA%8E-SSH-%E9%89%B4%E6%9D%83%E7%9A%84%E5%AD%90%E5%AF%86%E9%92%A5">åˆ›å»ºç”¨äº SSH é‰´æƒçš„å­å¯†é’¥</a>å­å¯†é’¥çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå®šä¹‰å¯†é’¥åŠŸèƒ½ã€‚æ‰€ä»¥ä¸å¿…ä½¿ç”¨ <code>--expert</code> å‚æ•°</p>
<p>è¿™é‡Œå¯†é’¥ç±»å‹å¯ä»¥é€‰æ‹© <code>ECC</code> ä¹Ÿå¯ä»¥é€‰æ‹© <code>RSA</code>ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸ç®¡æ˜¯ <code>ECC</code> è¿˜æ˜¯ <code>RSA</code>ï¼Œéƒ½éœ€è¦é€‰æ‹©åŒ…å« <code>ä»…ç”¨äºç­¾å</code> çš„é€‰é¡¹ã€‚</p>
<p>è¿™é‡Œæˆ‘å°±ç”¨ <code>ECC</code> ä¸¾ä¾‹ï¼Œå…·ä½“è¿‡ç¨‹å°±ä¸å†èµ˜è¿°ï¼Œå’Œä¸Šé¢<a href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E5%AF%86%E9%92%A5">åˆ›å»ºå­å¯†é’¥</a>çš„è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯æ²¡æœ‰äº†è‡ªå®šä¹‰å¯†é’¥åŠŸèƒ½ï¼Œè¿‡ç¨‹æ›´ç®€å•äº†ã€‚</p>
<p>åˆ›å»ºå®ŒæˆååŒæ ·è®°å¾—ä½¿ç”¨ <code>save</code> ä¿å­˜åè‡ªåŠ¨é€€å‡º <code>GPG</code> çš„äº¤äº’ç¯å¢ƒï¼Œç„¶åæŸ¥è¯¢ä¸€ä¸‹å½“å‰çš„å¯†é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --list-keys --keyid-format=long</span><br><span class="line">[keyboxd]</span><br><span class="line">---------</span><br><span class="line">pub   ed25519/D188A1DD832AB894 2024-03-24 [SC]</span><br><span class="line">      A31F6E522B93990CA1A1C548D188A1DD832AB894</span><br><span class="line">uid                   [ ç»å¯¹ ] github name (github) &lt;github@gmail.com&gt;</span><br><span class="line">uid                   [ ç»å¯¹ ] zebedy &lt;zebedy@example.com&gt;</span><br><span class="line">sub   cv25519/2978529F4782B600 2024-03-24 [E]</span><br><span class="line">sub   rsa4096/EFA3B0684ECE9D91 2024-03-24 [AR]</span><br><span class="line">sub   ed25519/0623CAE2AAFF25C2 2024-03-24 [S]</span><br></pre></td></tr></table></figure>

<p>å°±çœ‹åˆ°äº†æ–°åˆ›å»ºçš„å¯†é’¥ <code>0623CAE2AAFF25C2</code> ç”¨é€”åªæœ‰ <code>[S]</code>ï¼Œåªç”¨äºç­¾åã€‚</p>
<h4 id="æŸ¥è¯¢å­å¯†é’¥å…¬é’¥"><a href="#æŸ¥è¯¢å­å¯†é’¥å…¬é’¥" class="headerlink" title="æŸ¥è¯¢å­å¯†é’¥å…¬é’¥"></a>æŸ¥è¯¢å­å¯†é’¥å…¬é’¥</h4><p>é€šè¿‡ <code>--export</code> æŸ¥è¯¢å­å¯†é’¥å…¬é’¥ï¼Œä½†æ˜¯é»˜è®¤æ˜¯äºŒè¿›åˆ¶çš„æ ¼å¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦ <code>--armor</code> æ˜¾ç¤ºä¸ºæ–‡æœ¬æ ¼å¼æ‰èƒ½ä½¿ç”¨ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --armor --<span class="built_in">export</span> 0623CAE2AAFF25C2! <span class="comment"># æ³¨æ„è¿™é‡Œåœ¨å¯†é’¥æ‘˜è¦æœ«å°¾æœ‰ä¸€ä¸ªè‹±æ–‡çš„æ„Ÿå¹å·!</span></span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">mDMEZf+fkxYJKwYBBAHaRw8BAQdA8JIOJ9bqkGIH/b2Q5B8iLeYC7KhGy8I5AesQ</span><br><span class="line">Vgt2eju0J2dpdGh1YiBuYW1lIChnaXRodWIpIDxnaXRodWJAZ21haWwuY29tPoiT</span><br><span class="line">BBMWCgA7FiEEox9uUiuTmQyhocVI0Yih3YMquJQFAmX/pYwCGwMFCwkIBwICIgIG</span><br><span class="line">FQoJCAsCBBYCAwECHgcCF4AACgkQ0Yih3YMquJSl/wEAqpJRTjfRuUiCrYuIPech</span><br><span class="line">ffae/iYtz4St5xtgsgfVRi8BAPcAU9+HLFHZCK80vpiEVlp1jhCIUihetVuxzTJ6</span><br><span class="line">6x8AtBt6ZWJlZHkgPHplYmVkeUBleGFtcGxlLmNvbT6IkwQTFgoAOxYhBKMfblIr</span><br><span class="line">k5kMoaHFSNGIod2DKriUBQJl/5+TAhsDBQsJCAcCAiICBhUKCQgLAgQWAgMBAh4H</span><br><span class="line">AheAAAoJENGIod2DKriUPxgA/1g/tpw/gRrf6zwCVPQfuG5pgV25nqJlHNLqKv2c</span><br><span class="line">k8+FAP4ri6zN9Ay5QQX1lEU3xQROGq53irN/ZPBI6d0EP9q5B7gzBGX/pv8WCSsG</span><br><span class="line">AQQB2kcPAQEHQIrZWY1psJL/ELYuNi5lXSSUeWLw8wjHA+YvDiLxUyiXiO8EGBYK</span><br><span class="line">ACAWIQSjH25SK5OZDKGhxUjRiKHdgyq4lAUCZf+m/wIbAgCBCRDRiKHdgyq4lHYg</span><br><span class="line">BBkWCgAdFiEEhVrKN2SCNk5enPJMBiPK4qr/JcIFAmX/pv8ACgkQBiPK4qr/JcKo</span><br><span class="line">qAD9HGRow6SUGM7ySZXLxPa/AWa2iHnmbru3z7HheRSZ4q8A/jiCY75rPpsOjT6k</span><br><span class="line">rRejWTCDEJFL5SLdnWSsFwzbTQUE5FUA/j/CphTxuujBMdu/52EHwYg5Bo2+eeLp</span><br><span class="line">AFNyPSyt71g0AQDNhS5X8GQ1GSBZ5CvBRZ/fRd0vShn3kikkTt51UP9OBA==</span><br><span class="line">=qGsF</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆè¦åœ¨æ‘˜è¦æœ«å°¾æ·»åŠ ä¸€ä¸ª <code>!</code> å·å‘¢ï¼Ÿ</p>
<p>å› ä¸ºå¦‚æœæ²¡æœ‰è¿™ä¸ªæ„Ÿå¹å·åˆ™ä¼šå¯¼å‡ºè¿™ä¸ªå­å¯†é’¥æ‰€å±çš„ä¸»å¯†é’¥ä¸‹çš„æ‰€æœ‰å…¬é’¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gpg --armor --<span class="built_in">export</span> 0623CAE2AAFF25C2 <span class="comment"># è¿™é‡Œæ²¡æœ‰æ„Ÿå¹å·ï¼Œå‘ç°å†…å®¹ç›¸æ¯”ä¸Šé¢é•¿äº†å¾ˆå¤š</span></span><br><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line"></span><br><span class="line">mDMEZf+fkxYJKwYBBAHaRw8BAQdA8JIOJ9bqkGIH/b2Q5B8iLeYC7KhGy8I5AesQ</span><br><span class="line">Vgt2eju0J2dpdGh1YiBuYW1lIChnaXRodWIpIDxnaXRodWJAZ21haWwuY29tPoiT</span><br><span class="line">BBMWCgA7FiEEox9uUiuTmQyhocVI0Yih3YMquJQFAmX/pYwCGwMFCwkIBwICIgIG</span><br><span class="line">FQoJCAsCBBYCAwECHgcCF4AACgkQ0Yih3YMquJSl/wEAqpJRTjfRuUiCrYuIPech</span><br><span class="line">ffae/iYtz4St5xtgsgfVRi8BAPcAU9+HLFHZCK80vpiEVlp1jhCIUihetVuxzTJ6</span><br><span class="line">6x8AtBt6ZWJlZHkgPHplYmVkeUBleGFtcGxlLmNvbT6IkwQTFgoAOxYhBKMfblIr</span><br><span class="line">k5kMoaHFSNGIod2DKriUBQJl/5+TAhsDBQsJCAcCAiICBhUKCQgLAgQWAgMBAh4H</span><br><span class="line">AheAAAoJENGIod2DKriUPxgA/1g/tpw/gRrf6zwCVPQfuG5pgV25nqJlHNLqKv2c</span><br><span class="line">k8+FAP4ri6zN9Ay5QQX1lEU3xQROGq53irN/ZPBI6d0EP9q5B7g4BGX/n5MSCisG</span><br><span class="line">AQQBl1UBBQEBB0DLVTiDrM7loVyWzEQPpHDjsjtUz6tKLINI+I4Sr1pfWQMBCAeI</span><br><span class="line">eAQYFgoAIBYhBKMfblIrk5kMoaHFSNGIod2DKriUBQJl/5+TAhsMAAoJENGIod2D</span><br><span class="line">KriUPiYA/j2FEaBqUYpR497NgPggF0WNe55OJGF38ER3WqFOTcxzAP9vPRsBp+Jx</span><br><span class="line">s4MHTfnU+v7XZNNASWeomn8/+9+241kWDrkCDQRl/6GfARAAuoLgwPohBWXtqKeP</span><br><span class="line">GriC8QpDeiEVibLaadV/4jbaIRHFKQcSd4NKjCojEJxRzk7C9DwnItiH5oO+NAxO</span><br><span class="line">UVgvkD4QIiQpf1U+p1CuME/sMftAqLHkBIPUS1p6uvlmF4thixCmSyHcb6XK7Jui</span><br><span class="line">GhCFJPGfAjG7iaHBazngBrFfRfULESBcqhjcPL+v/qwQw2XXxmyq6eeIXjTOtWLb</span><br><span class="line">1Q7UkgoDKtIhVvJpcUdRd3oGon3yYnfy1lpQ4bdeZ3QfAvuWSKSv026+mx8vVVp2</span><br><span class="line">1zpsT+DAS+Esk1JBILwKjBBuT1okuj7H1G5L1kzUcekxuUbGe17tAFXAev/2RB5I</span><br><span class="line">2XiHlvYJTH+7Qtx/G4aWnQ3A7rDwnib9OE7gJBY2GVVEgp70dalVMXulUfa4ROrQ</span><br><span class="line">YvOmBp4LyEXFh41Xu6NQokC0hQKfU+bw9R40aPEOqZyj+LKuuo1x+tTK4SzIS0Ld</span><br><span class="line">0Va8lntgJT2LXGD5Vka5eLo96PEyjUA4QRTu7TLLB6OO+HgudHqc6XTqAuHrcx3C</span><br><span class="line">CFZjCkp70pdWeOi1IJJnIC+Fo9DU6gVsefChSo6WAE+XXGYrL1LBjOqWxYBSUS0V</span><br><span class="line">HI4m4kd75tx9+KdPL2i2FuZXTiSsE3+faxokSP4pXmPtcaQbG3OPDwQMl9d+N9y4</span><br><span class="line">MPU50b43fjr5Jmuz1P0KCTypvksAEQEAAYhvBBgWCgAhFiEEox9uUiuTmQyhocVI</span><br><span class="line">0Yih3YMquJQFAmX/oZ8DGyAEAACPZwD9GPj32r7XUNSffp2lPSNhV8eAMVxzdkov</span><br><span class="line">lYEWNJuCTZ0A/3gCT77sacaH3jDmoeT8yhFxA4YR8CcVteiXt3/RVCAAuDMEZf+m</span><br><span class="line">/xYJKwYBBAHaRw8BAQdAitlZjWmwkv8Qti42LmVdJJR5YvDzCMcD5i8OIvFTKJeI</span><br><span class="line">7wQYFgoAIBYhBKMfblIrk5kMoaHFSNGIod2DKriUBQJl/6b/AhsCAIEJENGIod2D</span><br><span class="line">KriUdiAEGRYKAB0WIQSFWso3ZII2Tl6c8kwGI8riqv8lwgUCZf+m/wAKCRAGI8ri</span><br><span class="line">qv8lwqioAP0cZGjDpJQYzvJJlcvE9r8BZraIeeZuu7fPseF5FJnirwD+OIJjvms+</span><br><span class="line">mw6NPqStF6NZMIMQkUvlIt2dZKwXDNtNBQTkVQD+P8KmFPG66MEx27/nYQfBiDkG</span><br><span class="line">jb554ukAU3I9LK3vWDQBAM2FLlfwZDUZIFnkK8FFn99F3S9KGfeSKSRO3nVQ/04E</span><br><span class="line">=7KWW</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬åªéœ€è¦è¿™ä¸ªå­å¯†é’¥ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>!</code> åªåŒ…å«è¯¥å­å¯†é’¥çš„å…¬é’¥å°±è¡Œã€‚</p>
<p>ç„¶åå°†è¯¥å…¬é’¥æ·»åŠ åˆ° <code>GitHub</code> æˆ–è€… <code>GitLab</code> ä¸­å³å¯ã€‚</p>
<h4 id="é…ç½®-Git"><a href="#é…ç½®-Git" class="headerlink" title="é…ç½® Git"></a>é…ç½® Git</h4><p>ç»™ Git å…¨å±€é…ç½®ç­¾å Key</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global user.signingkey 0623CAE2AAFF25C2!</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸éœ€è¦è‡ªåŠ¨ä½¿ç”¨ GPG ç­¾åä»£ç ï¼Œå¯ä»¥æ¯æ¬¡åœ¨ <code>commit</code> çš„æ—¶å€™ä½¿ç”¨ <code>-S</code> å‚æ•°ï¼ˆå¤§å†™ Sï¼‰è¿›è¡Œç­¾å</p>
<p>å¦‚æœæƒ³æäº¤çš„æ—¶å€™è‡ªåŠ¨ç­¾åï¼Œå¯ä»¥è¿›è¡Œé…ç½®ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ¬¡æäº¤ä»£ç åå°±å¯ä»¥æŸ¥çœ‹ç­¾åä¿¡æ¯äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --show-signature</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ <code>push</code> åˆ° <code>GitHub</code> ä¸Šåä¹Ÿå¯ä»¥çœ‹åˆ°æäº¤æœ‰ä¸€ä¸ª <code>verified</code> çš„æ ‡è®°ã€‚</p>
<p>è‡³æ­¤ï¼Œåˆ›å»ºç”¨äºä»£ç ç­¾åçš„å­å¯†é’¥ç»“æŸã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—ä¸€ æ•°å­¦å‡½æ•°å’Œå¯¼æ•°è®¡ç®—</title>
    <url>/post/e0c91e46.html</url>
    <content><![CDATA[<p>è¯¥ç³»åˆ—æ—¨åœ¨æ”¶é›†æ•´ç†ä¸€äº›å¾ˆæœ‰æ„æ€çš„ Python ä»£ç ï¼Œè¿™äº›ä»£ç æœ‰äº›æ˜¯é€šè¿‡ç®€æ´çš„ä»£ç å®ç°äº†å¾ˆç‰›é€¼çš„åŠŸèƒ½ï¼Œæœ‰äº›åˆ™æ˜¯é€šè¿‡èŠ±é‡Œèƒ¡å“¨çš„æŠ€å·§ä»£ç çœ¼èŠ±ç¼­ä¹±ã€‚</p>
<p>è™½ç„¶å¾ˆå¤šä»£ç å¹¶ä¸é€‚åˆæ—¥å¸¸çš„ä½¿ç”¨ï¼Œä½†æ˜¯ç ”ç©¶ä¸€ä¸‹ç›¸å…³çš„æœºåˆ¶è¿˜æ˜¯å¯¹æå‡èƒ½åŠ›æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
<span id="more"></span>

<p>æœ¬æœŸä½œä¸ºç¬¬ä¸€æœŸï¼Œå…ˆæ¥ä¸ªå¼€èƒƒå°èœ</p>
<p>ä»¥ä¸‹ä»£ç å¾ˆæœ‰æ„æ€ï¼Œå®ƒå®ç°äº†å¸¸è§„æ•°å­¦ä¸Šçš„å‡½æ•°è¡¨ç¤ºã€‚å¹¶ä¸”è¿˜èƒ½è®¡ç®—å½“å‰çš„å‡½æ•°å€¼å’Œè®¡ç®—å¯¹åº”å˜é‡çš„å¯¼æ•°å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">items</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> items:</span><br><span class="line">        res = res * i</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, value=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;mul&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__truediv__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;div&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;pow&quot;</span>, <span class="variable language_">self</span>, other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__sub__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, wrapper_opt(<span class="string">&quot;mul&quot;</span>, Constant(-<span class="number">1</span>), other))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__radd__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;add&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rmul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;mul&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rtruediv__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> wrapper_opt(<span class="string">&quot;div&quot;</span>, <span class="variable language_">self</span>, other, r=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.name == other.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(<span class="variable language_">self</span>.name)</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Constant</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(value, value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Variable</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> variable.name == <span class="variable language_">self</span>.name <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Operator</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs, name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.inputs = inputs</span><br><span class="line">        <span class="variable language_">self</span>.name = <span class="string">f&quot;Opt <span class="subst">&#123;name&#125;</span> of <span class="subst">&#123;inputs&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        opt2str = &#123;<span class="string">&quot;Add&quot;</span>: <span class="string">&quot;+&quot;</span>, <span class="string">&quot;Power&quot;</span>: <span class="string">&quot;^&quot;</span>, <span class="string">&quot;Multiply&quot;</span>: <span class="string">&quot;*&quot;</span>, <span class="string">&quot;Divide&quot;</span>: <span class="string">&quot;/&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> opt2str[<span class="variable language_">self</span>.name.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>]].join(<span class="built_in">map</span>(<span class="built_in">str</span>, <span class="variable language_">self</span>.inputs))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Add&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(inp.derivative(variable) <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Multiply</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Multiply&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> product(inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(</span><br><span class="line">            inp.derivative(variable)</span><br><span class="line">            * product(</span><br><span class="line">                other_inp.calculate()</span><br><span class="line">                <span class="keyword">for</span> other_inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs</span><br><span class="line">                <span class="keyword">if</span> other_inp != inp</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Divide</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Divide&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        a, b = [inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        a, b = [inp.calculate() <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        da, db = [inp.derivative(variable) <span class="keyword">for</span> inp <span class="keyword">in</span> <span class="variable language_">self</span>.inputs]</span><br><span class="line">        <span class="keyword">return</span> (da * b - db * a) / (b ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Power</span>(<span class="title class_ inherited__">Operator</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(inputs, name=<span class="string">&quot;Power&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">self</span>):</span><br><span class="line">        _x, n = <span class="variable language_">self</span>.inputs</span><br><span class="line">        n = n.value</span><br><span class="line">        <span class="keyword">return</span> _x.calculate() ** n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derivative</span>(<span class="params">self, variable</span>):</span><br><span class="line">        _x, n = <span class="variable language_">self</span>.inputs</span><br><span class="line">        n = n.value</span><br><span class="line">        <span class="keyword">return</span> n * (_x.calculate() ** (n - <span class="number">1</span>)) * _x.derivative(variable)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wrapper_opt</span>(<span class="params">opt, self, other, r=<span class="literal">False</span></span>):</span><br><span class="line">    opt2class = &#123;<span class="string">&quot;add&quot;</span>: Add, <span class="string">&quot;mul&quot;</span>: Multiply, <span class="string">&quot;pow&quot;</span>: Power, <span class="string">&quot;div&quot;</span>: Divide&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, Node):</span><br><span class="line">        other = Constant(other)</span><br><span class="line">    inputs = [other, <span class="variable language_">self</span>] <span class="keyword">if</span> r <span class="keyword">else</span> [<span class="variable language_">self</span>, other]</span><br><span class="line">    node = opt2class[opt](inputs=inputs)</span><br><span class="line">    <span class="keyword">return</span> node</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = Variable(<span class="string">&quot;x&quot;</span>, <span class="number">2</span>)        <span class="comment"># å®šä¹‰å˜é‡ x é»˜è®¤å€¼ 2</span></span><br><span class="line">y = Variable(<span class="string">&quot;y&quot;</span>, <span class="number">3</span>)        <span class="comment"># å®šä¹‰å˜é‡ y é»˜è®¤å€¼ 3</span></span><br><span class="line">f = <span class="number">3</span> * x ** <span class="number">2</span> + <span class="number">4</span> * y - <span class="number">5</span>  <span class="comment"># å®šä¹‰å‡½æ•° f(x)=3xÂ²+4yâˆ’5</span></span><br><span class="line"><span class="built_in">print</span>(f)                    <span class="comment"># 3*x^2+4*y+-1*5</span></span><br><span class="line"><span class="built_in">print</span>(f.calculate())        <span class="comment"># 19    æ ¹æ®é»˜è®¤å€¼ x=2 y=3 è®¡ç®— f(x)</span></span><br><span class="line"><span class="built_in">print</span>(f.derivative(x))      <span class="comment"># 12    æ ¹æ®é»˜è®¤å€¼ x=2 è®¡ç®— f&#x27;(x)=6x</span></span><br><span class="line">x.value = <span class="number">3</span>                 <span class="comment"># x=3</span></span><br><span class="line">y.value = -<span class="number">5</span>                <span class="comment"># y=-5</span></span><br><span class="line"><span class="built_in">print</span>(f.calculate())        <span class="comment"># 2     æ ¹æ®é»˜è®¤å€¼ x=3 y=-5 è®¡ç®— f(x)</span></span><br><span class="line"><span class="built_in">print</span>(f.derivative(y))      <span class="comment"># 4     æ ¹æ®é»˜è®¤å€¼ y=4 è®¡ç®— f å¯¹ y æ±‚å¯¼ = 4</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•(äºŒ)</title>
    <url>/post/dd9207d9.html</url>
    <content><![CDATA[<p><a href="/post/5f8a6fc4.html">æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•</a> ä¸­ä»‹ç»äº†ä¸€ç§é€šè¿‡ Python ä»£ç å®ç°å¯¹å†…ç½®çš„ç±»å‹å¢åŠ è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚<br>ä»Šå¤©å†ä»‹ç»ä¸€ç§æ–¹æ³•ï¼Œå®ç°æ›´ä¸ºåº•å±‚ã€‚é‚£å°±æ˜¯ç›´æ¥ä¿®æ”¹ <code>cPython</code> çš„æºç ã€‚<br>è¿™é‡Œæ¼”ç¤ºç»™ <code>list</code> å’Œ <code>dict</code> å¢åŠ  <code>deepcopy</code> å’Œ <code>tojson</code> æ–¹æ³•ï¼Œå®ç°å¯¹ <code>list</code> å’Œ <code>dict</code> çš„æ·±æ‹·è´å’ŒæŠŠä¸€ä¸ª <code>list</code> å’Œ <code>dict</code> è½¬æ¢ä¸º <code>json</code> çš„æ–¹æ³•ã€‚<br>ç»™ <code>int</code> å’Œ <code>float</code> å¢åŠ  <code>add</code>, <code>sub</code>, <code>mul</code>, <code>div</code> æ–¹æ³•ï¼Œå®ç°åŠ å‡ä¹˜é™¤ã€‚</p>
<span id="more"></span>

<h2 id="Step-1-ä¸‹è½½ä»£ç "><a href="#Step-1-ä¸‹è½½ä»£ç " class="headerlink" title="Step 1 ä¸‹è½½ä»£ç "></a>Step 1 ä¸‹è½½ä»£ç </h2><p><code>cPython</code> ä»£ç å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9u">cPython<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><p>æˆ‘ä½¿ç”¨çš„æ˜¯ macOS ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œå°±åªä»‹ç» macOS éœ€è¦çš„ç¯å¢ƒ</p>
<ol>
<li>å®‰è£… C ç¼–è¯‘å™¨å’Œå·¥å…·åŒ…<br><code>xcode-select --install</code></li>
<li>å®‰è£…å…¶ä»–å·¥å…·<br><code>brew install openssl@3 xz zlib gdbm sqlite</code></li>
</ol>
<h2 id="Step-2-ä¿®æ”¹ä»£ç "><a href="#Step-2-ä¿®æ”¹ä»£ç " class="headerlink" title="Step 2 ä¿®æ”¹ä»£ç "></a>Step 2 ä¿®æ”¹ä»£ç </h2><p>é¦–å…ˆå°†åˆ†æ”¯åˆ‡æ¢åˆ° 3.12ï¼Œä¸ä½¿ç”¨ <code>main</code> çš„åŸå› æ˜¯ <code>main</code> åˆ†æ”¯éšæ—¶éƒ½åœ¨æ›´æ–°ï¼Œæ‰€ä»¥é€‰æ‹©æ—§ç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§ã€‚<br>ç¡®ä¿ 3.12 åˆ†æ”¯çš„ä»£ç  <code>commit sha</code> ä¸º <code>0181aa2e3efedc6504b27f6fe74f096e5e454286</code></p>
<h3 id="ä¿®æ”¹-list"><a href="#ä¿®æ”¹-list" class="headerlink" title="ä¿®æ”¹ list"></a>ä¿®æ”¹ list</h3><p><code>list</code> çš„å®ç°åœ¨ <code>./Objects/listobject.c</code> ä¸­ã€‚æˆ‘ä»¬çš„ä¿®æ”¹å°±åœ¨è¿™é‡Œã€‚<br>é¦–å…ˆæ‰¾åˆ° <code>static PyMethodDef list_methods[]</code> è¿™é‡ŒåŒ…æ‹¬äº† <code>list</code> ç›¸å…³çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¡Œçš„ä¸Šé¢ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">list_method_deepcopy</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *copy_module = PyImport_ImportModule(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (copy_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyObject *deepcopy_func = PyObject_GetAttrString(copy_module, <span class="string">&quot;deepcopy&quot;</span>);</span><br><span class="line">    Py_DECREF(copy_module);</span><br><span class="line">    <span class="keyword">if</span> (deepcopy_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyObject *result = PyObject_CallFunctionObjArgs(deepcopy_func, self, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(deepcopy_func);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">list_method_tojson</span><span class="params">(PyObject *self, PyObject *args, PyObject *kwargs)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *json_module = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *dumps_func = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *result = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_tuple = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_with_self = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    json_module = PyImport_ImportModule(<span class="string">&quot;json&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (json_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dumps_func = PyObject_GetAttrString(json_module, <span class="string">&quot;dumps&quot;</span>);</span><br><span class="line">    Py_DECREF(json_module);</span><br><span class="line">    <span class="keyword">if</span> (dumps_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_tuple = PyTuple_Pack(<span class="number">1</span>, self);</span><br><span class="line">    Py_DECREF(dumps_func);</span><br><span class="line">    <span class="keyword">if</span> (args_tuple == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_with_self = PySequence_Concat(args_tuple, args);</span><br><span class="line">    Py_DECREF(args_tuple);</span><br><span class="line">    <span class="keyword">if</span> (args_with_self == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = PyObject_Call(dumps_func, args_with_self, kwargs);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(args_with_self);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>list_method_deepcopy</code> å°±æ˜¯ <code>deepcopy</code> çš„å…·ä½“å®ç°ï¼Œ<code>list_method_tojson</code> æ˜¯ <code>tojson</code> çš„å…·ä½“å®ç°ã€‚<br>ç„¶åå°†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å¢åŠ åˆ° <code>list_methods</code> ä¸­<br>æ³¨æ„ï¼Œè¦å¢åŠ åˆ°æœ€åä¸€è¡Œ <code>&#123;NULL,              NULL&#125;           /* sentinel */</code> ä¸Šæ–¹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)list_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the list&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)list_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert list to JSON string&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<p>æœ€åå®Œæ•´çš„ <code>list_methods[]</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyMethodDef list_methods[] = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;__getitem__&quot;</span>, (PyCFunction)list_subscript, METH_O|METH_COEXIST,</span><br><span class="line">     PyDoc_STR(<span class="string">&quot;__getitem__($self, index, /)\n--\n\nReturn self[index].&quot;</span>)&#125;,</span><br><span class="line">    LIST___REVERSED___METHODDEF</span><br><span class="line">    LIST___SIZEOF___METHODDEF</span><br><span class="line">    LIST_CLEAR_METHODDEF</span><br><span class="line">    LIST_COPY_METHODDEF</span><br><span class="line">    LIST_APPEND_METHODDEF</span><br><span class="line">    LIST_INSERT_METHODDEF</span><br><span class="line">    LIST_EXTEND_METHODDEF</span><br><span class="line">    LIST_POP_METHODDEF</span><br><span class="line">    LIST_REMOVE_METHODDEF</span><br><span class="line">    LIST_INDEX_METHODDEF</span><br><span class="line">    LIST_COUNT_METHODDEF</span><br><span class="line">    LIST_REVERSE_METHODDEF</span><br><span class="line">    LIST_SORT_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__class_getitem__&quot;</span>, Py_GenericAlias, METH_O|METH_CLASS, PyDoc_STR(<span class="string">&quot;See PEP 585&quot;</span>)&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)list_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the list&quot;</span>)&#125;,  # ç»™ <span class="built_in">list</span> å¢åŠ  deepcopy æ–¹æ³•ï¼Œè°ƒç”¨ list_method_deepcopy å®ç°</span><br><span class="line">    &#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)list_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert list to JSON string&quot;</span>)&#125;,    # ç»™ <span class="built_in">list</span> å¢åŠ  tojson æ–¹æ³•ï¼Œè°ƒç”¨ list_method_tojson å®ç°</span><br><span class="line">    &#123;<span class="literal">NULL</span>,              <span class="literal">NULL</span>&#125;           <span class="comment">/* sentinel */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-dict"><a href="#ä¿®æ”¹-dict" class="headerlink" title="ä¿®æ”¹ dict"></a>ä¿®æ”¹ dict</h3><p>å’Œä¿®æ”¹ list ç±»ä¼¼ï¼Œdict çš„å®ç°åœ¨ <code>./Objects/dictobject.c</code> ä¸­ã€‚<br>åŒç†è¿˜æ˜¯é¦–å…ˆæ‰¾åˆ° <code>static PyMethodDef mapp_methods[]</code> è¿™é‡ŒåŒ…æ‹¬äº† <code>dict</code> ç›¸å…³çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¡Œçš„ä¸Šé¢ï¼Œå¢åŠ ä»¥ä¸‹ä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">dict_method_deepcopy</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *copy_module = PyImport_ImportModule(<span class="string">&quot;copy&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (copy_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PyObject *deepcopy_func = PyObject_GetAttrString(copy_module, <span class="string">&quot;deepcopy&quot;</span>);</span><br><span class="line">    Py_DECREF(copy_module);</span><br><span class="line">    <span class="keyword">if</span> (deepcopy_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PyObject *result = PyObject_CallFunctionObjArgs(deepcopy_func, self, <span class="literal">NULL</span>);</span><br><span class="line">    Py_DECREF(deepcopy_func);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">dict_method_tojson</span><span class="params">(PyObject *self, PyObject *args, PyObject *kwargs)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *json_module = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *dumps_func = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *result = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_tuple = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *args_with_self = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    json_module = PyImport_ImportModule(<span class="string">&quot;json&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (json_module == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dumps_func = PyObject_GetAttrString(json_module, <span class="string">&quot;dumps&quot;</span>);</span><br><span class="line">    Py_DECREF(json_module);</span><br><span class="line">    <span class="keyword">if</span> (dumps_func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_tuple = PyTuple_Pack(<span class="number">1</span>, self);</span><br><span class="line">    Py_DECREF(dumps_func);</span><br><span class="line">    <span class="keyword">if</span> (args_tuple == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args_with_self = PySequence_Concat(args_tuple, args);</span><br><span class="line">    Py_DECREF(args_tuple);</span><br><span class="line">    <span class="keyword">if</span> (args_with_self == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = PyObject_Call(dumps_func, args_with_self, kwargs);</span><br><span class="line"></span><br><span class="line">    Py_DECREF(args_with_self);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ä»£ç é™¤äº†æ–¹æ³•åå­—ï¼Œå®ç°æ–¹æ³•å’Œ <code>list</code> çš„ä¸€è‡´ï¼Œå½“ç„¶ã€‚æœ€åä¹Ÿè¿˜æ˜¯è¦åŠ åˆ° <code>mapp_methods[]</code> ä¸­</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)dict_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the dict&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)dict_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert dict to JSON string&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´çš„ mapp_methods</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyMethodDef mapp_methods[] = &#123;</span><br><span class="line">    DICT___CONTAINS___METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__getitem__&quot;</span>, _PyCFunction_CAST(dict_subscript),        METH_O | METH_COEXIST,</span><br><span class="line">     getitem__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__sizeof__&quot;</span>,      _PyCFunction_CAST(dict_sizeof),       METH_NOARGS,</span><br><span class="line">     sizeof__doc__&#125;,</span><br><span class="line">    DICT_GET_METHODDEF</span><br><span class="line">    DICT_SETDEFAULT_METHODDEF</span><br><span class="line">    DICT_POP_METHODDEF</span><br><span class="line">    DICT_POPITEM_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;keys&quot;</span>,            dictkeys_new,                   METH_NOARGS,</span><br><span class="line">    keys__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;items&quot;</span>,           dictitems_new,                  METH_NOARGS,</span><br><span class="line">    items__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;values&quot;</span>,          dictvalues_new,                 METH_NOARGS,</span><br><span class="line">    values__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;update&quot;</span>,          _PyCFunction_CAST(dict_update), METH_VARARGS | METH_KEYWORDS,</span><br><span class="line">     update__doc__&#125;,</span><br><span class="line">    DICT_FROMKEYS_METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;clear&quot;</span>,           (PyCFunction)dict_clear,        METH_NOARGS,</span><br><span class="line">     clear__doc__&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;copy&quot;</span>,            (PyCFunction)dict_copy,         METH_NOARGS,</span><br><span class="line">     copy__doc__&#125;,</span><br><span class="line">    DICT___REVERSED___METHODDEF</span><br><span class="line">    &#123;<span class="string">&quot;__class_getitem__&quot;</span>, Py_GenericAlias, METH_O|METH_CLASS, PyDoc_STR(<span class="string">&quot;See PEP 585&quot;</span>)&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;deepcopy&quot;</span>, (PyCFunction)dict_method_deepcopy, METH_NOARGS, PyDoc_STR(<span class="string">&quot;Return a deep copy of the dict&quot;</span>)&#125;,  # ç»™ dict å¢åŠ  deepcopy æ–¹æ³•ï¼Œè°ƒç”¨ dict_method_deepcopy å®ç°</span><br><span class="line">    &#123;<span class="string">&quot;tojson&quot;</span>, (PyCFunction)dict_method_tojson, METH_VARARGS | METH_KEYWORDS, PyDoc_STR(<span class="string">&quot;Convert dict to JSON string&quot;</span>)&#125;,    # ç»™ dict å¢åŠ  tojson æ–¹æ³•ï¼Œè°ƒç”¨ dict_method_tojson å®ç°</span><br><span class="line">    &#123;<span class="literal">NULL</span>,              <span class="literal">NULL</span>&#125;   <span class="comment">/* sentinel */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-float"><a href="#ä¿®æ”¹-float" class="headerlink" title="ä¿®æ”¹ float"></a>ä¿®æ”¹ float</h3><p>float çš„å®ç°åœ¨ <code>./Objects/floatobject.c</code> ä¸­ã€‚ åŒç†æ‰¾åˆ° <code>float_methods[]</code> åœ¨ä¸Šæ–¹å¢åŠ ä»¥ä¸‹æ–¹æ³•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_add</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Add(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_sub</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Subtract(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_mul</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Multiply(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">float_method_div</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyFloat_Check(other) || PyLong_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_TrueDivide(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type float or int&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼çš„åœ¨ <code>float_methods[]</code> ä¸­å¢åŠ </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;add&quot;</span>, (PyCFunction)float_method_add, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Add float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;sub&quot;</span>, (PyCFunction)float_method_sub, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Subtract float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;mul&quot;</span>, (PyCFunction)float_method_mul, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Multiply float or int objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;div&quot;</span>, (PyCFunction)float_method_div, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Divide float or int objects&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹-int"><a href="#ä¿®æ”¹-int" class="headerlink" title="ä¿®æ”¹ int"></a>ä¿®æ”¹ int</h3><p><code>int</code> çš„å®ç°æ˜¯åœ¨ <code>.Objects/longobject.c</code> ä¸­ã€‚æ‰¾åˆ° <code>long_methods[]</code> åœ¨ä¸Šæ–¹å¢åŠ æ–¹æ³•</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_add</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Add(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_sub</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Subtract(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_mul</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Multiply(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> PyObject *</span><br><span class="line"><span class="title function_">long_method_div</span><span class="params">(PyObject *self, PyObject *args)</span></span><br><span class="line">&#123;</span><br><span class="line">    PyObject *other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">&quot;O&quot;</span>, &amp;other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyLong_Check(other) || PyFloat_Check(other)) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyNumber_TrueDivide(self, other);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_SetString(PyExc_TypeError, <span class="string">&quot;Argument must be of type int or float&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ–¹æ³•å®ç°å’Œ <code>int</code> ä¸­çš„å®ç°æœ‰ç»†å¾®å·®åˆ«ã€‚æœ€åè¿˜æ˜¯ä¸€æ ·å¢åŠ  <code>long_methods[]</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;add&quot;</span>, (PyCFunction)long_method_add, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Add int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;sub&quot;</span>, (PyCFunction)long_method_sub, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Subtract int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;mul&quot;</span>, (PyCFunction)long_method_mul, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Multiply int or float objects&quot;</span>)&#125;,</span><br><span class="line">&#123;<span class="string">&quot;div&quot;</span>, (PyCFunction)long_method_div, METH_VARARGS, PyDoc_STR(<span class="string">&quot;Divide int or float objects&quot;</span>)&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="Step-3-ç¼–è¯‘"><a href="#Step-3-ç¼–è¯‘" class="headerlink" title="Step 3 ç¼–è¯‘"></a>Step 3 ç¼–è¯‘</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ä»£ç </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">LDFLAGS=<span class="string">&quot;-L<span class="subst">$(brew --prefix zlib)</span>/lib -L<span class="subst">$(brew --prefix bzip2)</span>/lib -L<span class="subst">$(brew --prefix openssl@3)</span>/lib&quot;</span> \</span><br><span class="line">CPPFLAGS=<span class="string">&quot;-I<span class="subst">$(brew --prefix zlib)</span>/include -I<span class="subst">$(brew --prefix bzip2)</span>/include -I<span class="subst">$(brew --prefix openssl@3)</span>/include&quot;</span> \</span><br><span class="line">./configure --with-openssl=$(brew --prefix openssl@3) &amp;&amp; make -j$(<span class="built_in">nproc</span>) -s</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘æˆåŠŸååœ¨ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª <code>python.exe</code> (ä¸ºä»€ä¹ˆåœ¨ macOS æ˜¯ .exe å¯å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uI2J1aWxkLWluc3RydWN0aW9ucw==">build-instructions<i class="fa fa-external-link-alt"></i></span>)</p>
<h2 id="Step-4-æµ‹è¯•"><a href="#Step-4-æµ‹è¯•" class="headerlink" title="Step 4 æµ‹è¯•"></a>Step 4 æµ‹è¯•</h2><p>æ–°å»ºä¸€ä¸ª .py æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">origin_dict = &#123;<span class="string">&quot;goods&quot;</span>: [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>]&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åŸå§‹å­—å…¸: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>)</span><br><span class="line">copy_dict = origin_dict.copy()  <span class="comment"># è‡ªå¸¦çš„ copy() æµ…æ‹·è´</span></span><br><span class="line">deepcopy_dict = origin_dict.deepcopy()  <span class="comment"># æ·»åŠ çš„ deepcopy() æ·±æ‹·è´</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() å­—å…¸: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() å­—å…¸: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line">origin_dict[<span class="string">&quot;goods&quot;</span>].append(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åŸå§‹å­—å…¸ä¿®æ”¹: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() ç»“æœ: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() ç»“æœ: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">int_number = <span class="number">1</span></span><br><span class="line">float_number = <span class="number">2.15</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(int_number.add(<span class="number">2</span>).add(<span class="number">3</span>).div(<span class="number">2</span>).mul(<span class="number">4</span>))   <span class="comment"># (1 + 2 + 3) / 2 * 4</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(float_number.add(<span class="number">2</span>).add(<span class="number">3</span>).div(<span class="number">3</span>).mul(<span class="number">7</span>)) <span class="comment"># (2.15 + 2 + 3) / 3 * 7</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">==================================================</span><br><span class="line">åŸå§‹å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">.copy() å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">.deepcopy() å­—å…¸: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">åŸå§‹å­—å…¸ä¿®æ”¹: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">.copy() ç»“æœ: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>]&#125;</span><br><span class="line">.deepcopy() ç»“æœ: &#123;<span class="string">&#x27;goods&#x27;</span>: [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>]&#125;</span><br><span class="line">==================================================</span><br><span class="line">12.0</span><br><span class="line">==================================================</span><br><span class="line">16.683333333333334</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å®Œæˆäº†ä» cPython çš„æ”¹é€ å®ç°äº†ä»¥ä¸Šå‡ ç§æ–¹æ³•ã€‚</p>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><ol>
<li>ç›´æ¥ä¿®æ”¹ cPython çš„æºç å®ç°å¥½å¤„æ˜¯å®ç°äº†åŸç”Ÿå®ç°ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ã€‚å°±æ˜¯è¿™æ ·å†™çš„ä»£ç ï¼Œåªèƒ½è¿è¡Œåœ¨è¿™ä¸ªä¿®æ”¹åçš„ Python ç¯å¢ƒï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚<br>ä½†æ˜¯æ¢ä¸ªæ€è·¯æƒ³ï¼Œè¿™æ ·ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªå¥½å¤„å°±æ˜¯é—´æ¥çš„ä¿æŠ¤äº†ä»£ç ã€‚è¿™ä¸ªå…·ä½“çš„å†…å®¹åé¢å¯ä»¥åœ¨å±•å¼€èŠèŠã€‚</li>
<li>è¿™é‡Œç¼–è¯‘çš„ Python å…¶å®åªæ˜¯ä¸€ä¸ªè°ƒè¯•ç¯å¢ƒï¼Œå› ä¸ºæ²¡æœ‰å¯ç”¨ PGO æ‰€ä»¥ç¼–è¯‘å¾ˆå¿«ï¼Œä½†æ˜¯ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚<br>å¦‚æœæƒ³æŠŠè¿™ä¸ªç‰ˆæœ¬çš„ Python ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå¯ä»¥åœ¨ <code>./configure</code> çš„æ—¶å€™å¢åŠ  <code>--enable-optimizations</code> å‚æ•°ã€‚å…·ä½“å†…å®¹å¯å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3B5dGhvbi9jcHl0aG9uI3Byb2ZpbGUtZ3VpZGVkLW9wdGltaXphdGlvbg==">profile-guided-optimization<i class="fa fa-external-link-alt"></i></span></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>æµ‹è¯•åŠ å¯†æ–‡ç« </title>
    <url>/post/19c1a188.html</url>
    <content><![CDATA[<div class="encrypted-post-container" data-ciphertext="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" data-iv="rgsSaHMlVNlaaFga" data-auth-tag="GDtZRSYJDLY+/ZEhfbWNew==" data-abbrlink="19c1a188" data-wrapped-keys='[{&quot;encryptedCEK&quot;:&quot;N5SF556XGeGkbc6Ajxy6P6+0s1NibRvjOFpT/LCGrWQ=&quot;,&quot;iv&quot;:&quot;8kPXWq7aboRVAwjH&quot;,&quot;authTag&quot;:&quot;jtu/B8fQpFAigD4v3Ukf/A==&quot;},{&quot;encryptedCEK&quot;:&quot;x5LL1NPhChGZUgpfWwwI9cyDadv8BlJz30VYa3M0KTo=&quot;,&quot;iv&quot;:&quot;gUEzrAuMeMlbSUBt&quot;,&quot;authTag&quot;:&quot;MmzjDs2zIEsTd6CjtWZKSg==&quot;},{&quot;encryptedCEK&quot;:&quot;T2RaW4jLYWEs/N4AIgssXMVUPuCSdonsVnskDY++ZgU=&quot;,&quot;iv&quot;:&quot;2D7v7Qta2VGDmjuf&quot;,&quot;authTag&quot;:&quot;TjnkIYHrwPLiOED5hxlzfw==&quot;},{&quot;encryptedCEK&quot;:&quot;GBvM1waH92B7f3fKLorvj1L/Fw/Tl21B4Jea+kIppgo=&quot;,&quot;iv&quot;:&quot;Wtea9fnzAjK7YALb&quot;,&quot;authTag&quot;:&quot;3vj3MXk4mhrPQi0PVw1UyQ==&quot;},{&quot;encryptedCEK&quot;:&quot;qg7aA/dDAcaum7nJBbsmFHJ6EEvrm1eEc9sYSmfPI3g=&quot;,&quot;iv&quot;:&quot;0Gv5TVgAhzi9eIpw&quot;,&quot;authTag&quot;:&quot;E8VaiE0Jj0IXi2nUOY2usA==&quot;}]' data-prf-salt="6618dfe71300bc447de222d214e552fd14b296149f3f16d050d8d332a712b4ac">
  <div class="encrypted-post-notice">
    <button class="fido2-verify-btn" id="fido2-verify-btn"><i class="fa fa-fingerprint"></i> éªŒè¯èº«ä»½</button>
    <div class="verification-status" id="verification-status"></div>
  </div>
  <div class="decrypted-content" id="decrypted-content" style="display:none"></div>
</div>]]></content>
  </entry>
  <entry>
    <title>è°ƒæ•´ macOS é¡¶éƒ¨èœå•æ å›¾æ ‡é—´è·</title>
    <url>/post/baaa1138.html</url>
    <content><![CDATA[<p>æ— éœ€ä»»ä½•ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œé€šè¿‡ macOS å‘½ä»¤è¡Œå°±å¯ä»¥è°ƒæ•´é¡¶éƒ¨èœå•æ å›¾æ ‡é—´è·</p>
<span id="more"></span>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é—´è·</span></span><br><span class="line">defaults -currentHost <span class="built_in">read</span> -globalDomain NSStatusItemSpacing</span><br><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰å†…é—´è·</span></span><br><span class="line">defaults -currentHost <span class="built_in">read</span> -globalDomain NSStatusItemSelectionPadding</span><br><span class="line"><span class="comment"># æŒ‡å®šé—´è·</span></span><br><span class="line">defaults -currentHost write -globalDomain NSStatusItemSpacing -int 10</span><br><span class="line"><span class="comment"># æŒ‡å®šå†…é—´è·</span></span><br><span class="line">defaults -currentHost write -globalDomain NSStatusItemSelectionPadding -int 6</span><br><span class="line"><span class="comment"># æ¢å¤é»˜è®¤é—´è·</span></span><br><span class="line">defaults -currentHost delete -globalDomain NSStatusItemSpacing</span><br><span class="line"><span class="comment"># æ¢å¤é»˜è®¤å†…é—´è·</span></span><br><span class="line">defaults -currentHost delete -globalDomain NSStatusItemSelectionPadding</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>æœ‰ç‚¹æ„æ€çš„ Python ç³»åˆ—äºŒ å†…ç½®ç±»å‹å¢åŠ é¢å¤–æ–¹æ³•</title>
    <url>/post/5f8a6fc4.html</url>
    <content><![CDATA[<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæƒ³ç»™ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å¢åŠ å¯¹åº”çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ªç±»å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™æƒ³ç»™å†…ç½®çš„ç±»å‹å¢åŠ ä¸€äº›è‡ªå®šä¹‰æ–¹æ³•å‘¢ï¼Ÿ</p>
<span id="more"></span>

<p>æ¯”å¦‚å¯¹äºå¯å˜ç±»å‹å¯¹è±¡ï¼Œæˆ‘ä»¬æƒ³å¢åŠ ä¸€ä¸ª <code>deepcopy</code> çš„æ–¹æ³•å®ç°æ·±æ‹·è´ï¼Œç±»ä¼¼<code>dd = &#123;&#39;a&#39;: [1, 2, 3]&#125;.deepcopy()</code> è¾¾åˆ° <code>dd = copy.deepcopy(&#123;&#39;a&#39;: [1, 2, 3]&#125;)</code> çš„æ•ˆæœï¼Œæ˜¾è€Œæ˜“è§çš„æ˜¯ç›´æ¥åœ¨ä¸€ä¸ª dict å¯¹è±¡ä¸Š <code>.deepcopy()</code> æ˜¯æ›´ä¼˜é›…çš„ã€‚ä½†æ˜¯äº‹ä¸æ„¿è¿ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šè¿‡å¸¸è§„æ‰‹æ®µç»™ dict å¢åŠ  <code>deepcopy()</code> æ–¹æ³•ã€‚</p>
<p>éš¾é“å°±çœŸçš„æ²¡æœ‰åŠæ³•å—ï¼Ÿä¸‹é¢è¿™æ®µä»£ç å¯ä»¥ä¼˜é›…çš„å®ç°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyType</span>(ctypes.Structure):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyObject</span>(ctypes.Structure):</span><br><span class="line">    Py_ssize_t = (</span><br><span class="line">        ctypes.c_int64 <span class="keyword">if</span> ctypes.sizeof(ctypes.c_void_p) == <span class="number">8</span> <span class="keyword">else</span> ctypes.c_int32</span><br><span class="line">    )</span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&quot;ob_refcnt&quot;</span>, Py_ssize_t),</span><br><span class="line">        (<span class="string">&quot;ob_type&quot;</span>, ctypes.POINTER(PyType)),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyTypeObject</span>(<span class="title class_ inherited__">PyObject</span>):</span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&quot;dict&quot;</span>, ctypes.POINTER(PyObject))</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inject</span>(<span class="params">class_, method, force=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_</span>(<span class="params">function</span>):</span><br><span class="line">        name_, dict_ = class_.__name__, class_.__dict__</span><br><span class="line">        proxy_dict = PyTypeObject.from_address(<span class="built_in">id</span>(dict_))</span><br><span class="line">        namespace = &#123;&#125;</span><br><span class="line">        ctypes.pythonapi.PyDict_SetItem(</span><br><span class="line">            ctypes.py_object(namespace),</span><br><span class="line">            ctypes.py_object(name_),</span><br><span class="line">            proxy_dict.<span class="built_in">dict</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> namespace.get(name_, &#123;&#125;).get(method, <span class="literal">None</span>):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;å·²å­˜åœ¨æ–¹æ³• <span class="subst">&#123;class_.__name__&#125;</span>.<span class="subst">&#123;method&#125;</span>()&quot;</span>)</span><br><span class="line">        namespace[name_][method] = function</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _</span><br></pre></td></tr></table></figure>

<p>è€Œä½¿ç”¨ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç»™ <code>dict</code> æ·»åŠ ä¸€ä¸ª <code>deepcopy()</code> å®ç°å­—å…¸çš„æ·±æ‹·è´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">dict</span>, <span class="string">&#x27;deepcopy&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deepcopy</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">return</span> copy.deepcopy(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ä¸€ä¸‹</span></span><br><span class="line">origin_dict = &#123;<span class="string">&quot;goods&quot;</span>: [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹å­—å…¸: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;]&#125;</span></span><br><span class="line"></span><br><span class="line">copy_dict = origin_dict.copy() <span class="comment"># è‡ªå¸¦çš„ copy() æµ…æ‹·è´</span></span><br><span class="line">deepcopy_dict = origin_dict.deepcopy() <span class="comment"># æ·»åŠ çš„ deepcopy() æ·±æ‹·è´</span></span><br><span class="line"></span><br><span class="line">origin_dict[<span class="string">&quot;goods&quot;</span>].append(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹å­—å…¸å˜æ›´: <span class="subst">&#123;origin_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;banana&#x27;]&#125;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.copy() ç»“æœ: <span class="subst">&#123;copy_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;, &#x27;banana&#x27;]&#125;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;.deepcopy() ç»“æœ: <span class="subst">&#123;deepcopy_dict&#125;</span>&quot;</span>) <span class="comment"># &#123;&#x27;goods&#x27;: [&#x27;apple&#x27;, &#x27;orange&#x27;]&#125;</span></span><br></pre></td></tr></table></figure>

<p>å†æˆ–è€…ç»™ <code>list</code> æ·»åŠ ä¸€ä¸ª <code>average()</code> æ–¹æ³•è®¡ç®—å¹³å‡æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">list</span>, <span class="string">&#x27;average&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">average</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(l) / <span class="built_in">len</span>(l)</span><br><span class="line"></span><br><span class="line">score = [<span class="number">95.0</span>, <span class="number">89.5</span>, <span class="number">77.0</span>, <span class="number">91.0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(score.average())  <span class="comment"># 88.125</span></span><br></pre></td></tr></table></figure>

<p>å†æˆ–è€…ç»™å­—ç¬¦ä¸²æ·»åŠ ä¸€ä¸ª <code>json()</code> æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>str.json()</code> å°†è¯¥å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸º <code>json</code> å¯¹è±¡ï¼ˆå½“ç„¶å‰ææ˜¯è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ä¸º <code>json</code> å¯¹è±¡ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">str</span>, <span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> loads(s)</span><br><span class="line"></span><br><span class="line">info = <span class="string">&#x27;&#123;&quot;first_name&quot;: &quot;Michael&quot;, &quot;last_name&quot;: &quot;Rodgers&quot;, &quot;department&quot;: &quot;Marketing&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(info.json()) <span class="comment"># &#123;&#x27;first_name&#x27;: &#x27;Michael&#x27;, &#x27;last_name&#x27;: &#x27;Rodgers&#x27;, &#x27;department&#x27;: &#x27;Marketing&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæ¯”å¦‚ç»™ <code>int</code> ç±»å‹æ·»åŠ  <code>add(number)</code> æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inject(<span class="params"><span class="built_in">int</span>, <span class="string">&#x27;add&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">i, number</span>):</span><br><span class="line">    <span class="keyword">return</span> i + number</span><br><span class="line"></span><br><span class="line">munber = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number.add(<span class="number">3</span>)) <span class="comment"># 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨</span></span><br><span class="line"><span class="built_in">print</span>(munber.add(<span class="number">3</span>).add(<span class="number">7</span>).add(-<span class="number">1</span>)) <span class="comment"># 14</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶é™¤äº†å†…ç½®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¿®è¡¥è‡ªå®šä¹‰ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.number = n</span><br><span class="line"></span><br><span class="line"><span class="meta">@inject(<span class="params">Number, <span class="string">&#x27;sub&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">n, num</span>):</span><br><span class="line">    <span class="keyword">return</span> Number(n.number - num)</span><br><span class="line"></span><br><span class="line">number = Number(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(number.sub(<span class="number">3</span>).sub(<span class="number">5</span>).number)  <span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<!-- more -->
]]></content>
  </entry>
</search>
